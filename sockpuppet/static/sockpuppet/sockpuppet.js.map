{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/form-serialize/index.js","webpack:///./node_modules/@rails/actioncable/app/assets/javascripts/action_cable.js","webpack:///./node_modules/@stimulus/core/dist/src/event_listener.js","webpack:///./node_modules/@stimulus/core/dist/src/dispatcher.js","webpack:///./node_modules/@stimulus/core/dist/src/action_descriptor.js","webpack:///./node_modules/@stimulus/core/dist/src/action.js","webpack:///./node_modules/@stimulus/core/dist/src/binding.js","webpack:///./node_modules/@stimulus/mutation-observers/dist/src/element_observer.js","webpack:///./node_modules/@stimulus/mutation-observers/dist/src/attribute_observer.js","webpack:///./node_modules/@stimulus/multimap/dist/src/set_operations.js","webpack:///./node_modules/@stimulus/multimap/dist/src/multimap.js","webpack:///./node_modules/@stimulus/multimap/dist/src/indexed_multimap.js","webpack:///./node_modules/@stimulus/mutation-observers/dist/src/token_list_observer.js","webpack:///./node_modules/@stimulus/mutation-observers/dist/src/value_list_observer.js","webpack:///./node_modules/@stimulus/core/dist/src/binding_observer.js","webpack:///./node_modules/@stimulus/core/dist/src/context.js","webpack:///./node_modules/@stimulus/core/dist/src/definition.js","webpack:///./node_modules/@stimulus/core/dist/src/module.js","webpack:///./node_modules/@stimulus/core/dist/src/data_map.js","webpack:///./node_modules/@stimulus/core/dist/src/selectors.js","webpack:///./node_modules/@stimulus/core/dist/src/target_set.js","webpack:///./node_modules/@stimulus/core/dist/src/scope.js","webpack:///./node_modules/@stimulus/core/dist/src/scope_observer.js","webpack:///./node_modules/@stimulus/core/dist/src/router.js","webpack:///./node_modules/@stimulus/core/dist/src/schema.js","webpack:///./node_modules/@stimulus/core/dist/src/application.js","webpack:///./node_modules/@stimulus/core/dist/src/target_properties.js","webpack:///./node_modules/@stimulus/core/dist/src/controller.js","webpack:///./node_modules/stimulus_reflex/node_modules/morphdom/dist/morphdom-esm.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/cable_ready.js","webpack:///./node_modules/stimulus_reflex/schema.js","webpack:///./node_modules/stimulus_reflex/consumer.js","webpack:///./node_modules/stimulus_reflex/utils.js","webpack:///./node_modules/stimulus_reflex/lifecycle.js","webpack:///./node_modules/stimulus_reflex/attributes.js","webpack:///./node_modules/stimulus_reflex/controllers.js","webpack:///./node_modules/stimulus_reflex/log.js","webpack:///./node_modules/stimulus_reflex/stimulus_reflex.js","webpack:///./node_modules/reconnecting-websocket/dist/reconnecting-websocket-mjs.js","webpack:///./javascript/stimulus-websocket/index.js","webpack:///./sockpuppet/js/sockpuppet.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","k_r_submitter","k_r_success_contrls","brackets","hash_serializer","result","match","hash_assign","keys","length","shift","between","Array","isArray","push","_values","string","index","isNaN","children","RegExp","exec","parse_keys","existing","str_serialize","replace","encodeURIComponent","form","options","hash","undefined","serializer","elements","radio_store","element","disabled","test","nodeName","type","val","checked","empty","selectOptions","isSelectedOptions","j","option","allowedEmpty","hasValue","selected","slice","adapters","logger","self","console","WebSocket","log","this","enabled","_adapters$logger","_len","arguments","messages","_key","Date","now","apply","concat","_typeof","iterator","obj","constructor","classCallCheck","instance","Constructor","TypeError","createClass","defineProperties","target","props","descriptor","configurable","writable","protoProps","staticProps","getTime","secondsSince","time","ConnectionMonitor","connection","visibilityDidChange","reconnectAttempts","start","isRunning","startedAt","stoppedAt","startPolling","addEventListener","getPollInterval","stop","stopPolling","removeEventListener","recordPing","pingedAt","recordConnect","disconnectedAt","recordDisconnect","poll","clearTimeout","pollTimeout","_this","setTimeout","reconnectIfStale","_constructor$pollInte","pollInterval","min","max","interval","multiplier","Math","round","number","clamp","connectionIsStale","staleThreshold","disconnectedRecently","reopen","_this2","document","visibilityState","isOpen","INTERNAL","message_types","welcome","disconnect","ping","confirmation","rejection","disconnect_reasons","unauthorized","invalid_request","server_restart","default_mount_path","protocols","supportedProtocols","indexOf","Connection","consumer","open","subscriptions","monitor","disconnected","send","data","webSocket","JSON","stringify","isActive","getState","uninstallEventHandlers","url","installEventHandlers","close","_ref","allowReconnect","error","reopenDelay","getProtocol","protocol","isState","isProtocolSupported","states","state","readyState","toLowerCase","eventName","events","handler","message","event","_JSON$parse","parse","identifier","reason","reconnect","reload","notify","reject","notifyAll","willAttemptReconnect","extend","properties","Subscription","params","mixin","perform","action","command","unsubscribe","remove","Subscriptions","channelName","channel","subscription","add","ensureActiveConnection","sendCommand","forget","findAll","map","filter","callbackName","_this3","args","_len2","_key2","Consumer","_url","connect","createWebSocketURL","a","createElement","href","getConfig","head","querySelector","getAttribute","createConsumer","factory","EventListener","eventTarget","unorderedBindings","Set","bindingConnected","binding","bindingDisconnected","delete","handleEvent","extendedEvent","stopImmediatePropagation_1","stopImmediatePropagation","assign","immediatePropagationStopped","extendEvent","_i","_a","bindings","from","sort","left","right","leftIndex","rightIndex","Dispatcher","application","eventListenerMaps","Map","started","eventListeners","forEach","eventListener","values","reduce","listeners","fetchEventListenerForBinding","handleError","detail","fetchEventListener","eventListenerMap","fetchEventListenerMapForEventTarget","createEventListener","set","descriptorPattern","Action","tagName","defaultEventNames","getDefaultEventNameForElement","methodName","forToken","token","descriptorString","content","matches","trim","eventTargetName","window","toString","eventNameSuffix","e","Error","Binding","context","willBeInvokedByEvent","invokeWithEvent","method","controller","Element","contains","scope","containsElement","ElementObserver","delegate","mutationObserver","MutationObserver","mutations","processMutations","observe","attributes","childList","subtree","refresh","takeRecords","matchElementsInTree","has","removeElement","_b","_c","addElement","mutations_1","mutation","processMutation","processAttributeChange","attributeName","processRemovedNodes","removedNodes","processAddedNodes","addedNodes","node","elementAttributeChanged","matchElement","nodes","elementFromNode","processTree","elementIsActive","tree","processor","nodeType","Node","ELEMENT_NODE","isConnected","elementMatched","elementUnmatched","AttributeObserver","elementObserver","hasAttribute","querySelectorAll","selector","elementMatchedAttribute","elementUnmatchedAttribute","elementAttributeValueChanged","fetch","del","size","prune","Multimap","valuesByKey","hasKey","some","getValuesForKey","getKeysForValue","__extends","extendStatics","setPrototypeOf","__proto__","b","__","_super","IndexedMultimap","keysByValue","TokenListObserver","attributeObserver","tokensByElement","tokensMatched","readTokensForElement","refreshTokensForElement","unmatchedTokens","matchedTokens","tokensUnmatched","tokens","tokenMatched","tokenUnmatched","previousTokens","currentTokens","firstDifferingIndex","_","findIndex","tokensAreEqual","tokenString","split","parseTokenString","ValueListObserver","tokenListObserver","parseResultsByToken","WeakMap","valuesByTokenByElement","fetchParseResultForToken","fetchValuesByTokenForElement","elementMatchedValue","elementUnmatchedValue","parseResult","parseToken","valuesByToken","parseValueForToken","BindingObserver","bindingsByAction","valueListObserver","actionAttribute","disconnectAllActions","schema","connectAction","disconnectAction","clear","Context","controllerConstructor","bindingObserver","dispatcher","initialize","parentElement","blessControllerConstructor","bless","extendWithReflect","Controller","_newTarget","Reflect","construct","Module","definition","blessDefinition","contextsByScope","connectedContexts","connectContextForScope","fetchContextForScope","disconnectContextForScope","DataMap","getFormattedKey","setAttribute","removeAttribute","char","attributeValueContainsToken","TargetSet","targetName","find","targetNames","getSelectorForTargetNames","findElement","findAllElements","getSelectorForTargetName","join","targetDescriptor","targetAttribute","Scope","targets","tail","filterElements","closest","controllerSelector","controllerAttribute","ScopeObserver","scopesByIdentifierByElement","scopeReferenceCounts","scopesByIdentifier","fetchScopesByIdentifierForElement","referenceCount","scopeConnected","scopeDisconnected","Router","scopeObserver","modulesByIdentifier","contexts","loadDefinition","unloadIdentifier","connectModule","disconnectModule","getContextForElementAndIdentifier","defaultSchema","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","fulfilled","step","next","rejected","done","then","__generator","body","f","y","g","label","sent","trys","ops","verb","v","op","pop","Application","documentElement","router","register","load","rest","definitions","unload","identifiers","getControllerForElementAndIdentifier","defineTargetProperties","ancestors","getPrototypeOf","getAncestorsForConstructor","getOwnTargetNamesForConstructor","getTargetNamesForConstructor","charAt","toUpperCase","capitalize","range","doc","HAS_TEMPLATE_SUPPORT","HAS_RANGE_SUPPORT","createRange","toElement","str","template","innerHTML","childNodes","createFragmentFromTemplate","selectNode","createContextualFragment","createFragmentFromRange","fragment","createFragmentFromWrap","compareNodeNames","fromEl","toEl","fromCodeStart","toCodeStart","fromNodeName","toNodeName","charCodeAt","syncBooleanAttrProp","specialElHandlers","OPTION","parentNode","parentName","selectedIndex","INPUT","TEXTAREA","newValue","firstChild","oldValue","nodeValue","placeholder","SELECT","optgroup","curChild","nextSibling","noop","defaultGetNodeKey","id","morphAttrs","fromNode","toNode","toNodeHtml","getNodeKey","onBeforeNodeAdded","onNodeAdded","onBeforeElUpdated","onElUpdated","onBeforeNodeDiscarded","onNodeDiscarded","onBeforeElChildrenUpdated","childrenOnly","fromNodesLookup","keyedRemovalList","addKeyedRemoval","removeNode","skipKeyedNodes","removeChild","walkDiscardedChildNodes","handleNodeAdded","el","unmatchedFromEl","replaceChild","morphEl","toElKey","curToNodeKey","curFromNodeKey","fromNextSibling","toNextSibling","matchingFromEl","curToNodeChild","curFromNodeChild","outer","isSameNode","curFromNodeType","isCompatible","insertBefore","appendChild","onBeforeNodeAddedResult","actualize","ownerDocument","cleanupFromEl","specialElHandler","morphChildren","indexTree","namespaceURI","morphedNode","morphedNodeType","toNodeType","nextChild","moveChildren","createElementNS","len","elToRemove","morphdomFactory","attr","attrName","attrNamespaceURI","attrValue","toNodeAttrs","localName","getAttributeNS","prefix","setAttributeNS","fromNodeAttrs","hasAttributeNS","removeAttributeNS","activeElement","textInputTagNames","textInputTypes","color","date","datetime","email","month","password","search","tel","text","textarea","week","isTextInput","assignFocus","focusSelector","focusElement","focus","dispatch","evt","Event","bubbles","cancelable","dispatchEvent","getClassNames","names","flat","shouldMorph","permanentAttributeName","isEqualNode","permanent","ignore","attribute","DOMOperations","consoleLog","config","level","includes","notification","title","permission","Notification","requestPermission","setCookie","cookie","morph","html","String","parent","ordinal","innerHtml","outerHtml","outerHTML","textContent","insertAdjacentHtml","position","insertAdjacentHTML","insertAdjacentText","setProperty","setValue","addCssClass","classList","removeCssClass","setStyle","style","setStyles","styles","entries","setDatasetProperty","dataset","operations","emitMissingElementWarnings","xpath","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","reflexAttribute","reflexPermanentAttribute","reflexRootAttribute","reflexDatasetAttribute","getConsumer","findConsumer","depth","isConsumer","camelize","uppercaseFirstLetter","$1","substr","emitEvent","CustomEvent","invokeLifecycleMethod","stage","reflexId","reflexData","reflexController","reflex","reflexMethodName","specificLifecycleMethodName","specificLifecycleMethod","genericLifecycleMethodName","genericLifecycleMethod","reflexError","dispatchLifecycleEvent","attributeValue","attributeValues","extractElementAttributes","attrs","memo","tag_name","multipleInstances","collectedOptions","elem","collectCheckedOptions","extractDataAttributes","startsWith","selectors","warn","localReflexControllers","app","StimulusReflex","logs","request","stimulusControllerIdentifier","success","response","halted","broadcaster","stimulusReflex","duration","payload","serverMessage","NOOP","stimulusApplication","actionCableConsumer","actionCableParams","actionCableSubscriptionActive","promises","debugging","extendStimulusController","location","validity","badInput","opts","crypto","msCrypto","getRandomValues","Uint8Array","uuidv4","getReflexRoots","datasetAttribute","extractElementDataset","permanent_attribute_name","isActionCableConnectionOpen","promise","catch","preventDefault","stopPropagation","stimulate","totalOperations","received","cableReady","operation","urls","completedOperations","connected","createSubscription","super","setupDeclarativeReflexes","callback","delay","timeoutId","debounce","controllers","reflexes","actions","findControllerByReflexString","allReflexControllers","controllerValue","actionValue","reflexString","extractReflexName","list","reflexRoot","stimulusReflexInitialized","beforeDOMUpdateHandler","subject","nothing","initializeOptions","debug","__read","ar","__spread","ErrorEvent","CloseEvent","code","wasClean","getGlobalWebSocket","DEFAULT","maxReconnectionDelay","minReconnectionDelay","random","minUptime","reconnectionDelayGrowFactor","connectionTimeout","maxRetries","Infinity","maxEnqueuedMessages","startClosed","ReconnectingWebSocket","_listeners","_retryCount","_shouldReconnect","_connectLock","_binaryType","_closeCalled","_messageQueue","onclose","onerror","onmessage","onopen","_handleOpen","_debug","_options","_connectTimeout","_uptimeTimeout","_acceptOpen","_ws","binaryType","listener","_callEventListener","_handleMessage","_handleError","_disconnect","_connect","_handleClose","_clearTimeouts","_protocols","CONNECTING","OPEN","CLOSING","CLOSED","acc","Blob","byteLength","bufferedAmount","extensions","e_1","listeners_1","__values","listeners_1_1","e_1_1","return","_getNextDelay","_d","pow","_wait","_getNextUrl","urlProvider","_removeListeners","w","_addListeners","_handleTimeout","meta_type","max_age","host"],"mappings":"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","file":"sockpuppet.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","// get successful control from form and assemble into object\n// http://www.w3.org/TR/html401/interact/forms.html#h-17.13.2\n\n// types which indicate a submit action and are not successful controls\n// these will be ignored\nvar k_r_submitter = /^(?:submit|button|image|reset|file)$/i;\n\n// node names which could be successful controls\nvar k_r_success_contrls = /^(?:input|select|textarea|keygen)/i;\n\n// Matches bracket notation.\nvar brackets = /(\\[[^\\[\\]]*\\])/g;\n\n// serializes form fields\n// @param form MUST be an HTMLForm element\n// @param options is an optional argument to configure the serialization. Default output\n// with no options specified is a url encoded string\n//    - hash: [true | false] Configure the output type. If true, the output will\n//    be a js object.\n//    - serializer: [function] Optional serializer function to override the default one.\n//    The function takes 3 arguments (result, key, value) and should return new result\n//    hash and url encoded str serializers are provided with this module\n//    - disabled: [true | false]. If true serialize disabled fields.\n//    - empty: [true | false]. If true serialize empty fields\nfunction serialize(form, options) {\n    if (typeof options != 'object') {\n        options = { hash: !!options };\n    }\n    else if (options.hash === undefined) {\n        options.hash = true;\n    }\n\n    var result = (options.hash) ? {} : '';\n    var serializer = options.serializer || ((options.hash) ? hash_serializer : str_serialize);\n\n    var elements = form && form.elements ? form.elements : [];\n\n    //Object store each radio and set if it's empty or not\n    var radio_store = Object.create(null);\n\n    for (var i=0 ; i<elements.length ; ++i) {\n        var element = elements[i];\n\n        // ingore disabled fields\n        if ((!options.disabled && element.disabled) || !element.name) {\n            continue;\n        }\n        // ignore anyhting that is not considered a success field\n        if (!k_r_success_contrls.test(element.nodeName) ||\n            k_r_submitter.test(element.type)) {\n            continue;\n        }\n\n        var key = element.name;\n        var val = element.value;\n\n        // we can't just use element.value for checkboxes cause some browsers lie to us\n        // they say \"on\" for value when the box isn't checked\n        if ((element.type === 'checkbox' || element.type === 'radio') && !element.checked) {\n            val = undefined;\n        }\n\n        // If we want empty elements\n        if (options.empty) {\n            // for checkbox\n            if (element.type === 'checkbox' && !element.checked) {\n                val = '';\n            }\n\n            // for radio\n            if (element.type === 'radio') {\n                if (!radio_store[element.name] && !element.checked) {\n                    radio_store[element.name] = false;\n                }\n                else if (element.checked) {\n                    radio_store[element.name] = true;\n                }\n            }\n\n            // if options empty is true, continue only if its radio\n            if (val == undefined && element.type == 'radio') {\n                continue;\n            }\n        }\n        else {\n            // value-less fields are ignored unless options.empty is true\n            if (!val) {\n                continue;\n            }\n        }\n\n        // multi select boxes\n        if (element.type === 'select-multiple') {\n            val = [];\n\n            var selectOptions = element.options;\n            var isSelectedOptions = false;\n            for (var j=0 ; j<selectOptions.length ; ++j) {\n                var option = selectOptions[j];\n                var allowedEmpty = options.empty && !option.value;\n                var hasValue = (option.value || allowedEmpty);\n                if (option.selected && hasValue) {\n                    isSelectedOptions = true;\n\n                    // If using a hash serializer be sure to add the\n                    // correct notation for an array in the multi-select\n                    // context. Here the name attribute on the select element\n                    // might be missing the trailing bracket pair. Both names\n                    // \"foo\" and \"foo[]\" should be arrays.\n                    if (options.hash && key.slice(key.length - 2) !== '[]') {\n                        result = serializer(result, key + '[]', option.value);\n                    }\n                    else {\n                        result = serializer(result, key, option.value);\n                    }\n                }\n            }\n\n            // Serialize if no selected options and options.empty is true\n            if (!isSelectedOptions && options.empty) {\n                result = serializer(result, key, '');\n            }\n\n            continue;\n        }\n\n        result = serializer(result, key, val);\n    }\n\n    // Check for all empty radio buttons and serialize them with key=\"\"\n    if (options.empty) {\n        for (var key in radio_store) {\n            if (!radio_store[key]) {\n                result = serializer(result, key, '');\n            }\n        }\n    }\n\n    return result;\n}\n\nfunction parse_keys(string) {\n    var keys = [];\n    var prefix = /^([^\\[\\]]*)/;\n    var children = new RegExp(brackets);\n    var match = prefix.exec(string);\n\n    if (match[1]) {\n        keys.push(match[1]);\n    }\n\n    while ((match = children.exec(string)) !== null) {\n        keys.push(match[1]);\n    }\n\n    return keys;\n}\n\nfunction hash_assign(result, keys, value) {\n    if (keys.length === 0) {\n        result = value;\n        return result;\n    }\n\n    var key = keys.shift();\n    var between = key.match(/^\\[(.+?)\\]$/);\n\n    if (key === '[]') {\n        result = result || [];\n\n        if (Array.isArray(result)) {\n            result.push(hash_assign(null, keys, value));\n        }\n        else {\n            // This might be the result of bad name attributes like \"[][foo]\",\n            // in this case the original `result` object will already be\n            // assigned to an object literal. Rather than coerce the object to\n            // an array, or cause an exception the attribute \"_values\" is\n            // assigned as an array.\n            result._values = result._values || [];\n            result._values.push(hash_assign(null, keys, value));\n        }\n\n        return result;\n    }\n\n    // Key is an attribute name and can be assigned directly.\n    if (!between) {\n        result[key] = hash_assign(result[key], keys, value);\n    }\n    else {\n        var string = between[1];\n        // +var converts the variable into a number\n        // better than parseInt because it doesn't truncate away trailing\n        // letters and actually fails if whole thing is not a number\n        var index = +string;\n\n        // If the characters between the brackets is not a number it is an\n        // attribute name and can be assigned directly.\n        if (isNaN(index)) {\n            result = result || {};\n            result[string] = hash_assign(result[string], keys, value);\n        }\n        else {\n            result = result || [];\n            result[index] = hash_assign(result[index], keys, value);\n        }\n    }\n\n    return result;\n}\n\n// Object/hash encoding serializer.\nfunction hash_serializer(result, key, value) {\n    var matches = key.match(brackets);\n\n    // Has brackets? Use the recursive assignment function to walk the keys,\n    // construct any missing objects in the result tree and make the assignment\n    // at the end of the chain.\n    if (matches) {\n        var keys = parse_keys(key);\n        hash_assign(result, keys, value);\n    }\n    else {\n        // Non bracket notation can make assignments directly.\n        var existing = result[key];\n\n        // If the value has been assigned already (for instance when a radio and\n        // a checkbox have the same name attribute) convert the previous value\n        // into an array before pushing into it.\n        //\n        // NOTE: If this requirement were removed all hash creation and\n        // assignment could go through `hash_assign`.\n        if (existing) {\n            if (!Array.isArray(existing)) {\n                result[key] = [ existing ];\n            }\n\n            result[key].push(value);\n        }\n        else {\n            result[key] = value;\n        }\n    }\n\n    return result;\n}\n\n// urlform encoding serializer\nfunction str_serialize(result, key, value) {\n    // encode newlines as \\r\\n cause the html spec says so\n    value = value.replace(/(\\r)?\\n/g, '\\r\\n');\n    value = encodeURIComponent(value);\n\n    // spaces should be '+' rather than '%20'.\n    value = value.replace(/%20/g, '+');\n    return result + (result ? '&' : '') + encodeURIComponent(key) + '=' + value;\n}\n\nmodule.exports = serialize;\n","(function(global, factory) {\n  typeof exports === \"object\" && typeof module !== \"undefined\" ? factory(exports) : typeof define === \"function\" && define.amd ? define([ \"exports\" ], factory) : factory(global.ActionCable = {});\n})(this, function(exports) {\n  \"use strict\";\n  var adapters = {\n    logger: self.console,\n    WebSocket: self.WebSocket\n  };\n  var logger = {\n    log: function log() {\n      if (this.enabled) {\n        var _adapters$logger;\n        for (var _len = arguments.length, messages = Array(_len), _key = 0; _key < _len; _key++) {\n          messages[_key] = arguments[_key];\n        }\n        messages.push(Date.now());\n        (_adapters$logger = adapters.logger).log.apply(_adapters$logger, [ \"[ActionCable]\" ].concat(messages));\n      }\n    }\n  };\n  var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function(obj) {\n    return typeof obj;\n  } : function(obj) {\n    return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  };\n  var classCallCheck = function(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n  var createClass = function() {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n    return function(Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  }();\n  var now = function now() {\n    return new Date().getTime();\n  };\n  var secondsSince = function secondsSince(time) {\n    return (now() - time) / 1e3;\n  };\n  var clamp = function clamp(number, min, max) {\n    return Math.max(min, Math.min(max, number));\n  };\n  var ConnectionMonitor = function() {\n    function ConnectionMonitor(connection) {\n      classCallCheck(this, ConnectionMonitor);\n      this.visibilityDidChange = this.visibilityDidChange.bind(this);\n      this.connection = connection;\n      this.reconnectAttempts = 0;\n    }\n    ConnectionMonitor.prototype.start = function start() {\n      if (!this.isRunning()) {\n        this.startedAt = now();\n        delete this.stoppedAt;\n        this.startPolling();\n        addEventListener(\"visibilitychange\", this.visibilityDidChange);\n        logger.log(\"ConnectionMonitor started. pollInterval = \" + this.getPollInterval() + \" ms\");\n      }\n    };\n    ConnectionMonitor.prototype.stop = function stop() {\n      if (this.isRunning()) {\n        this.stoppedAt = now();\n        this.stopPolling();\n        removeEventListener(\"visibilitychange\", this.visibilityDidChange);\n        logger.log(\"ConnectionMonitor stopped\");\n      }\n    };\n    ConnectionMonitor.prototype.isRunning = function isRunning() {\n      return this.startedAt && !this.stoppedAt;\n    };\n    ConnectionMonitor.prototype.recordPing = function recordPing() {\n      this.pingedAt = now();\n    };\n    ConnectionMonitor.prototype.recordConnect = function recordConnect() {\n      this.reconnectAttempts = 0;\n      this.recordPing();\n      delete this.disconnectedAt;\n      logger.log(\"ConnectionMonitor recorded connect\");\n    };\n    ConnectionMonitor.prototype.recordDisconnect = function recordDisconnect() {\n      this.disconnectedAt = now();\n      logger.log(\"ConnectionMonitor recorded disconnect\");\n    };\n    ConnectionMonitor.prototype.startPolling = function startPolling() {\n      this.stopPolling();\n      this.poll();\n    };\n    ConnectionMonitor.prototype.stopPolling = function stopPolling() {\n      clearTimeout(this.pollTimeout);\n    };\n    ConnectionMonitor.prototype.poll = function poll() {\n      var _this = this;\n      this.pollTimeout = setTimeout(function() {\n        _this.reconnectIfStale();\n        _this.poll();\n      }, this.getPollInterval());\n    };\n    ConnectionMonitor.prototype.getPollInterval = function getPollInterval() {\n      var _constructor$pollInte = this.constructor.pollInterval, min = _constructor$pollInte.min, max = _constructor$pollInte.max, multiplier = _constructor$pollInte.multiplier;\n      var interval = multiplier * Math.log(this.reconnectAttempts + 1);\n      return Math.round(clamp(interval, min, max) * 1e3);\n    };\n    ConnectionMonitor.prototype.reconnectIfStale = function reconnectIfStale() {\n      if (this.connectionIsStale()) {\n        logger.log(\"ConnectionMonitor detected stale connection. reconnectAttempts = \" + this.reconnectAttempts + \", pollInterval = \" + this.getPollInterval() + \" ms, time disconnected = \" + secondsSince(this.disconnectedAt) + \" s, stale threshold = \" + this.constructor.staleThreshold + \" s\");\n        this.reconnectAttempts++;\n        if (this.disconnectedRecently()) {\n          logger.log(\"ConnectionMonitor skipping reopening recent disconnect\");\n        } else {\n          logger.log(\"ConnectionMonitor reopening\");\n          this.connection.reopen();\n        }\n      }\n    };\n    ConnectionMonitor.prototype.connectionIsStale = function connectionIsStale() {\n      return secondsSince(this.pingedAt ? this.pingedAt : this.startedAt) > this.constructor.staleThreshold;\n    };\n    ConnectionMonitor.prototype.disconnectedRecently = function disconnectedRecently() {\n      return this.disconnectedAt && secondsSince(this.disconnectedAt) < this.constructor.staleThreshold;\n    };\n    ConnectionMonitor.prototype.visibilityDidChange = function visibilityDidChange() {\n      var _this2 = this;\n      if (document.visibilityState === \"visible\") {\n        setTimeout(function() {\n          if (_this2.connectionIsStale() || !_this2.connection.isOpen()) {\n            logger.log(\"ConnectionMonitor reopening stale connection on visibilitychange. visbilityState = \" + document.visibilityState);\n            _this2.connection.reopen();\n          }\n        }, 200);\n      }\n    };\n    return ConnectionMonitor;\n  }();\n  ConnectionMonitor.pollInterval = {\n    min: 3,\n    max: 30,\n    multiplier: 5\n  };\n  ConnectionMonitor.staleThreshold = 6;\n  var INTERNAL = {\n    message_types: {\n      welcome: \"welcome\",\n      disconnect: \"disconnect\",\n      ping: \"ping\",\n      confirmation: \"confirm_subscription\",\n      rejection: \"reject_subscription\"\n    },\n    disconnect_reasons: {\n      unauthorized: \"unauthorized\",\n      invalid_request: \"invalid_request\",\n      server_restart: \"server_restart\"\n    },\n    default_mount_path: \"/cable\",\n    protocols: [ \"actioncable-v1-json\", \"actioncable-unsupported\" ]\n  };\n  var message_types = INTERNAL.message_types, protocols = INTERNAL.protocols;\n  var supportedProtocols = protocols.slice(0, protocols.length - 1);\n  var indexOf = [].indexOf;\n  var Connection = function() {\n    function Connection(consumer) {\n      classCallCheck(this, Connection);\n      this.open = this.open.bind(this);\n      this.consumer = consumer;\n      this.subscriptions = this.consumer.subscriptions;\n      this.monitor = new ConnectionMonitor(this);\n      this.disconnected = true;\n    }\n    Connection.prototype.send = function send(data) {\n      if (this.isOpen()) {\n        this.webSocket.send(JSON.stringify(data));\n        return true;\n      } else {\n        return false;\n      }\n    };\n    Connection.prototype.open = function open() {\n      if (this.isActive()) {\n        logger.log(\"Attempted to open WebSocket, but existing socket is \" + this.getState());\n        return false;\n      } else {\n        logger.log(\"Opening WebSocket, current state is \" + this.getState() + \", subprotocols: \" + protocols);\n        if (this.webSocket) {\n          this.uninstallEventHandlers();\n        }\n        this.webSocket = new adapters.WebSocket(this.consumer.url, protocols);\n        this.installEventHandlers();\n        this.monitor.start();\n        return true;\n      }\n    };\n    Connection.prototype.close = function close() {\n      var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n        allowReconnect: true\n      }, allowReconnect = _ref.allowReconnect;\n      if (!allowReconnect) {\n        this.monitor.stop();\n      }\n      if (this.isActive()) {\n        return this.webSocket.close();\n      }\n    };\n    Connection.prototype.reopen = function reopen() {\n      logger.log(\"Reopening WebSocket, current state is \" + this.getState());\n      if (this.isActive()) {\n        try {\n          return this.close();\n        } catch (error) {\n          logger.log(\"Failed to reopen WebSocket\", error);\n        } finally {\n          logger.log(\"Reopening WebSocket in \" + this.constructor.reopenDelay + \"ms\");\n          setTimeout(this.open, this.constructor.reopenDelay);\n        }\n      } else {\n        return this.open();\n      }\n    };\n    Connection.prototype.getProtocol = function getProtocol() {\n      if (this.webSocket) {\n        return this.webSocket.protocol;\n      }\n    };\n    Connection.prototype.isOpen = function isOpen() {\n      return this.isState(\"open\");\n    };\n    Connection.prototype.isActive = function isActive() {\n      return this.isState(\"open\", \"connecting\");\n    };\n    Connection.prototype.isProtocolSupported = function isProtocolSupported() {\n      return indexOf.call(supportedProtocols, this.getProtocol()) >= 0;\n    };\n    Connection.prototype.isState = function isState() {\n      for (var _len = arguments.length, states = Array(_len), _key = 0; _key < _len; _key++) {\n        states[_key] = arguments[_key];\n      }\n      return indexOf.call(states, this.getState()) >= 0;\n    };\n    Connection.prototype.getState = function getState() {\n      if (this.webSocket) {\n        for (var state in adapters.WebSocket) {\n          if (adapters.WebSocket[state] === this.webSocket.readyState) {\n            return state.toLowerCase();\n          }\n        }\n      }\n      return null;\n    };\n    Connection.prototype.installEventHandlers = function installEventHandlers() {\n      for (var eventName in this.events) {\n        var handler = this.events[eventName].bind(this);\n        this.webSocket[\"on\" + eventName] = handler;\n      }\n    };\n    Connection.prototype.uninstallEventHandlers = function uninstallEventHandlers() {\n      for (var eventName in this.events) {\n        this.webSocket[\"on\" + eventName] = function() {};\n      }\n    };\n    return Connection;\n  }();\n  Connection.reopenDelay = 500;\n  Connection.prototype.events = {\n    message: function message(event) {\n      if (!this.isProtocolSupported()) {\n        return;\n      }\n      var _JSON$parse = JSON.parse(event.data), identifier = _JSON$parse.identifier, message = _JSON$parse.message, reason = _JSON$parse.reason, reconnect = _JSON$parse.reconnect, type = _JSON$parse.type;\n      switch (type) {\n       case message_types.welcome:\n        this.monitor.recordConnect();\n        return this.subscriptions.reload();\n\n       case message_types.disconnect:\n        logger.log(\"Disconnecting. Reason: \" + reason);\n        return this.close({\n          allowReconnect: reconnect\n        });\n\n       case message_types.ping:\n        return this.monitor.recordPing();\n\n       case message_types.confirmation:\n        return this.subscriptions.notify(identifier, \"connected\");\n\n       case message_types.rejection:\n        return this.subscriptions.reject(identifier);\n\n       default:\n        return this.subscriptions.notify(identifier, \"received\", message);\n      }\n    },\n    open: function open() {\n      logger.log(\"WebSocket onopen event, using '\" + this.getProtocol() + \"' subprotocol\");\n      this.disconnected = false;\n      if (!this.isProtocolSupported()) {\n        logger.log(\"Protocol is unsupported. Stopping monitor and disconnecting.\");\n        return this.close({\n          allowReconnect: false\n        });\n      }\n    },\n    close: function close(event) {\n      logger.log(\"WebSocket onclose event\");\n      if (this.disconnected) {\n        return;\n      }\n      this.disconnected = true;\n      this.monitor.recordDisconnect();\n      return this.subscriptions.notifyAll(\"disconnected\", {\n        willAttemptReconnect: this.monitor.isRunning()\n      });\n    },\n    error: function error() {\n      logger.log(\"WebSocket onerror event\");\n    }\n  };\n  var extend = function extend(object, properties) {\n    if (properties != null) {\n      for (var key in properties) {\n        var value = properties[key];\n        object[key] = value;\n      }\n    }\n    return object;\n  };\n  var Subscription = function() {\n    function Subscription(consumer) {\n      var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var mixin = arguments[2];\n      classCallCheck(this, Subscription);\n      this.consumer = consumer;\n      this.identifier = JSON.stringify(params);\n      extend(this, mixin);\n    }\n    Subscription.prototype.perform = function perform(action) {\n      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      data.action = action;\n      return this.send(data);\n    };\n    Subscription.prototype.send = function send(data) {\n      return this.consumer.send({\n        command: \"message\",\n        identifier: this.identifier,\n        data: JSON.stringify(data)\n      });\n    };\n    Subscription.prototype.unsubscribe = function unsubscribe() {\n      return this.consumer.subscriptions.remove(this);\n    };\n    return Subscription;\n  }();\n  var Subscriptions = function() {\n    function Subscriptions(consumer) {\n      classCallCheck(this, Subscriptions);\n      this.consumer = consumer;\n      this.subscriptions = [];\n    }\n    Subscriptions.prototype.create = function create(channelName, mixin) {\n      var channel = channelName;\n      var params = (typeof channel === \"undefined\" ? \"undefined\" : _typeof(channel)) === \"object\" ? channel : {\n        channel: channel\n      };\n      var subscription = new Subscription(this.consumer, params, mixin);\n      return this.add(subscription);\n    };\n    Subscriptions.prototype.add = function add(subscription) {\n      this.subscriptions.push(subscription);\n      this.consumer.ensureActiveConnection();\n      this.notify(subscription, \"initialized\");\n      this.sendCommand(subscription, \"subscribe\");\n      return subscription;\n    };\n    Subscriptions.prototype.remove = function remove(subscription) {\n      this.forget(subscription);\n      if (!this.findAll(subscription.identifier).length) {\n        this.sendCommand(subscription, \"unsubscribe\");\n      }\n      return subscription;\n    };\n    Subscriptions.prototype.reject = function reject(identifier) {\n      var _this = this;\n      return this.findAll(identifier).map(function(subscription) {\n        _this.forget(subscription);\n        _this.notify(subscription, \"rejected\");\n        return subscription;\n      });\n    };\n    Subscriptions.prototype.forget = function forget(subscription) {\n      this.subscriptions = this.subscriptions.filter(function(s) {\n        return s !== subscription;\n      });\n      return subscription;\n    };\n    Subscriptions.prototype.findAll = function findAll(identifier) {\n      return this.subscriptions.filter(function(s) {\n        return s.identifier === identifier;\n      });\n    };\n    Subscriptions.prototype.reload = function reload() {\n      var _this2 = this;\n      return this.subscriptions.map(function(subscription) {\n        return _this2.sendCommand(subscription, \"subscribe\");\n      });\n    };\n    Subscriptions.prototype.notifyAll = function notifyAll(callbackName) {\n      var _this3 = this;\n      for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n      return this.subscriptions.map(function(subscription) {\n        return _this3.notify.apply(_this3, [ subscription, callbackName ].concat(args));\n      });\n    };\n    Subscriptions.prototype.notify = function notify(subscription, callbackName) {\n      for (var _len2 = arguments.length, args = Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n        args[_key2 - 2] = arguments[_key2];\n      }\n      var subscriptions = void 0;\n      if (typeof subscription === \"string\") {\n        subscriptions = this.findAll(subscription);\n      } else {\n        subscriptions = [ subscription ];\n      }\n      return subscriptions.map(function(subscription) {\n        return typeof subscription[callbackName] === \"function\" ? subscription[callbackName].apply(subscription, args) : undefined;\n      });\n    };\n    Subscriptions.prototype.sendCommand = function sendCommand(subscription, command) {\n      var identifier = subscription.identifier;\n      return this.consumer.send({\n        command: command,\n        identifier: identifier\n      });\n    };\n    return Subscriptions;\n  }();\n  var Consumer = function() {\n    function Consumer(url) {\n      classCallCheck(this, Consumer);\n      this._url = url;\n      this.subscriptions = new Subscriptions(this);\n      this.connection = new Connection(this);\n    }\n    Consumer.prototype.send = function send(data) {\n      return this.connection.send(data);\n    };\n    Consumer.prototype.connect = function connect() {\n      return this.connection.open();\n    };\n    Consumer.prototype.disconnect = function disconnect() {\n      return this.connection.close({\n        allowReconnect: false\n      });\n    };\n    Consumer.prototype.ensureActiveConnection = function ensureActiveConnection() {\n      if (!this.connection.isActive()) {\n        return this.connection.open();\n      }\n    };\n    createClass(Consumer, [ {\n      key: \"url\",\n      get: function get$$1() {\n        return createWebSocketURL(this._url);\n      }\n    } ]);\n    return Consumer;\n  }();\n  function createWebSocketURL(url) {\n    if (typeof url === \"function\") {\n      url = url();\n    }\n    if (url && !/^wss?:/i.test(url)) {\n      var a = document.createElement(\"a\");\n      a.href = url;\n      a.href = a.href;\n      a.protocol = a.protocol.replace(\"http\", \"ws\");\n      return a.href;\n    } else {\n      return url;\n    }\n  }\n  function createConsumer() {\n    var url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getConfig(\"url\") || INTERNAL.default_mount_path;\n    return new Consumer(url);\n  }\n  function getConfig(name) {\n    var element = document.head.querySelector(\"meta[name='action-cable-\" + name + \"']\");\n    if (element) {\n      return element.getAttribute(\"content\");\n    }\n  }\n  exports.Connection = Connection;\n  exports.ConnectionMonitor = ConnectionMonitor;\n  exports.Consumer = Consumer;\n  exports.INTERNAL = INTERNAL;\n  exports.Subscription = Subscription;\n  exports.Subscriptions = Subscriptions;\n  exports.adapters = adapters;\n  exports.createWebSocketURL = createWebSocketURL;\n  exports.logger = logger;\n  exports.createConsumer = createConsumer;\n  exports.getConfig = getConfig;\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n});\n","var EventListener = /** @class */ (function () {\n    function EventListener(eventTarget, eventName) {\n        this.eventTarget = eventTarget;\n        this.eventName = eventName;\n        this.unorderedBindings = new Set;\n    }\n    EventListener.prototype.connect = function () {\n        this.eventTarget.addEventListener(this.eventName, this, false);\n    };\n    EventListener.prototype.disconnect = function () {\n        this.eventTarget.removeEventListener(this.eventName, this, false);\n    };\n    // Binding observer delegate\n    /** @hidden */\n    EventListener.prototype.bindingConnected = function (binding) {\n        this.unorderedBindings.add(binding);\n    };\n    /** @hidden */\n    EventListener.prototype.bindingDisconnected = function (binding) {\n        this.unorderedBindings.delete(binding);\n    };\n    EventListener.prototype.handleEvent = function (event) {\n        var extendedEvent = extendEvent(event);\n        for (var _i = 0, _a = this.bindings; _i < _a.length; _i++) {\n            var binding = _a[_i];\n            if (extendedEvent.immediatePropagationStopped) {\n                break;\n            }\n            else {\n                binding.handleEvent(extendedEvent);\n            }\n        }\n    };\n    Object.defineProperty(EventListener.prototype, \"bindings\", {\n        get: function () {\n            return Array.from(this.unorderedBindings).sort(function (left, right) {\n                var leftIndex = left.index, rightIndex = right.index;\n                return leftIndex < rightIndex ? -1 : leftIndex > rightIndex ? 1 : 0;\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return EventListener;\n}());\nexport { EventListener };\nfunction extendEvent(event) {\n    if (\"immediatePropagationStopped\" in event) {\n        return event;\n    }\n    else {\n        var stopImmediatePropagation_1 = event.stopImmediatePropagation;\n        return Object.assign(event, {\n            immediatePropagationStopped: false,\n            stopImmediatePropagation: function () {\n                this.immediatePropagationStopped = true;\n                stopImmediatePropagation_1.call(this);\n            }\n        });\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnRfbGlzdGVuZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXZlbnRfbGlzdGVuZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUE7SUFLRSx1QkFBWSxXQUF3QixFQUFFLFNBQWlCO1FBQ3JELElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFBO1FBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFBO1FBQzFCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsQ0FBQTtJQUNsQyxDQUFDO0lBRUQsK0JBQU8sR0FBUDtRQUNFLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUE7SUFDaEUsQ0FBQztJQUVELGtDQUFVLEdBQVY7UUFDRSxJQUFJLENBQUMsV0FBVyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ25FLENBQUM7SUFFRCw0QkFBNEI7SUFFNUIsY0FBYztJQUNkLHdDQUFnQixHQUFoQixVQUFpQixPQUFnQjtRQUMvQixJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3JDLENBQUM7SUFFRCxjQUFjO0lBQ2QsMkNBQW1CLEdBQW5CLFVBQW9CLE9BQWdCO1FBQ2xDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDeEMsQ0FBQztJQUVELG1DQUFXLEdBQVgsVUFBWSxLQUFZO1FBQ3RCLElBQU0sYUFBYSxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUN4QyxLQUFzQixVQUFhLEVBQWIsS0FBQSxJQUFJLENBQUMsUUFBUSxFQUFiLGNBQWEsRUFBYixJQUFhLEVBQUU7WUFBaEMsSUFBTSxPQUFPLFNBQUE7WUFDaEIsSUFBSSxhQUFhLENBQUMsMkJBQTJCLEVBQUU7Z0JBQzdDLE1BQUs7YUFDTjtpQkFBTTtnQkFDTCxPQUFPLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFBO2FBQ25DO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsc0JBQUksbUNBQVE7YUFBWjtZQUNFLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxJQUFJLEVBQUUsS0FBSztnQkFDekQsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxVQUFVLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQTtnQkFDdEQsT0FBTyxTQUFTLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDckUsQ0FBQyxDQUFDLENBQUE7UUFDSixDQUFDOzs7T0FBQTtJQUNILG9CQUFDO0FBQUQsQ0FBQyxBQWhERCxJQWdEQzs7QUFFRCxxQkFBcUIsS0FBWTtJQUMvQixJQUFJLDZCQUE2QixJQUFJLEtBQUssRUFBRTtRQUMxQyxPQUFPLEtBQUssQ0FBQTtLQUNiO1NBQU07UUFDRyxJQUFBLDJEQUF3QixDQUFVO1FBQzFDLE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUU7WUFDMUIsMkJBQTJCLEVBQUUsS0FBSztZQUNsQyx3QkFBd0I7Z0JBQ3RCLElBQUksQ0FBQywyQkFBMkIsR0FBRyxJQUFJLENBQUE7Z0JBQ3ZDLDBCQUF3QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUNyQyxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0tBQ0g7QUFDSCxDQUFDIn0=","import { EventListener } from \"./event_listener\";\nvar Dispatcher = /** @class */ (function () {\n    function Dispatcher(application) {\n        this.application = application;\n        this.eventListenerMaps = new Map;\n        this.started = false;\n    }\n    Dispatcher.prototype.start = function () {\n        if (!this.started) {\n            this.started = true;\n            this.eventListeners.forEach(function (eventListener) { return eventListener.connect(); });\n        }\n    };\n    Dispatcher.prototype.stop = function () {\n        if (this.started) {\n            this.started = false;\n            this.eventListeners.forEach(function (eventListener) { return eventListener.disconnect(); });\n        }\n    };\n    Object.defineProperty(Dispatcher.prototype, \"eventListeners\", {\n        get: function () {\n            return Array.from(this.eventListenerMaps.values())\n                .reduce(function (listeners, map) { return listeners.concat(Array.from(map.values())); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Binding observer delegate\n    /** @hidden */\n    Dispatcher.prototype.bindingConnected = function (binding) {\n        this.fetchEventListenerForBinding(binding).bindingConnected(binding);\n    };\n    /** @hidden */\n    Dispatcher.prototype.bindingDisconnected = function (binding) {\n        this.fetchEventListenerForBinding(binding).bindingDisconnected(binding);\n    };\n    // Error handling\n    Dispatcher.prototype.handleError = function (error, message, detail) {\n        if (detail === void 0) { detail = {}; }\n        this.application.handleError(error, \"Error \" + message, detail);\n    };\n    Dispatcher.prototype.fetchEventListenerForBinding = function (binding) {\n        var eventTarget = binding.eventTarget, eventName = binding.eventName;\n        return this.fetchEventListener(eventTarget, eventName);\n    };\n    Dispatcher.prototype.fetchEventListener = function (eventTarget, eventName) {\n        var eventListenerMap = this.fetchEventListenerMapForEventTarget(eventTarget);\n        var eventListener = eventListenerMap.get(eventName);\n        if (!eventListener) {\n            eventListener = this.createEventListener(eventTarget, eventName);\n            eventListenerMap.set(eventName, eventListener);\n        }\n        return eventListener;\n    };\n    Dispatcher.prototype.createEventListener = function (eventTarget, eventName) {\n        var eventListener = new EventListener(eventTarget, eventName);\n        if (this.started) {\n            eventListener.connect();\n        }\n        return eventListener;\n    };\n    Dispatcher.prototype.fetchEventListenerMapForEventTarget = function (eventTarget) {\n        var eventListenerMap = this.eventListenerMaps.get(eventTarget);\n        if (!eventListenerMap) {\n            eventListenerMap = new Map;\n            this.eventListenerMaps.set(eventTarget, eventListenerMap);\n        }\n        return eventListenerMap;\n    };\n    return Dispatcher;\n}());\nexport { Dispatcher };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlzcGF0Y2hlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kaXNwYXRjaGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUVoRDtJQUtFLG9CQUFZLFdBQXdCO1FBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFBO1FBQzlCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsQ0FBQTtRQUNoQyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQTtJQUN0QixDQUFDO0lBRUQsMEJBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFBO1lBQ25CLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFVBQUEsYUFBYSxJQUFJLE9BQUEsYUFBYSxDQUFDLE9BQU8sRUFBRSxFQUF2QixDQUF1QixDQUFDLENBQUE7U0FDdEU7SUFDSCxDQUFDO0lBRUQseUJBQUksR0FBSjtRQUNFLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQTtZQUNwQixJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxVQUFBLGFBQWEsSUFBSSxPQUFBLGFBQWEsQ0FBQyxVQUFVLEVBQUUsRUFBMUIsQ0FBMEIsQ0FBQyxDQUFBO1NBQ3pFO0lBQ0gsQ0FBQztJQUVELHNCQUFJLHNDQUFjO2FBQWxCO1lBQ0UsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQztpQkFDL0MsTUFBTSxDQUFDLFVBQUMsU0FBUyxFQUFFLEdBQUcsSUFBSyxPQUFBLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUExQyxDQUEwQyxFQUFFLEVBQXFCLENBQUMsQ0FBQTtRQUNsRyxDQUFDOzs7T0FBQTtJQUVELDRCQUE0QjtJQUU1QixjQUFjO0lBQ2QscUNBQWdCLEdBQWhCLFVBQWlCLE9BQWdCO1FBQy9CLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxPQUFPLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUN0RSxDQUFDO0lBRUQsY0FBYztJQUNkLHdDQUFtQixHQUFuQixVQUFvQixPQUFnQjtRQUNsQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsT0FBTyxDQUFDLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDekUsQ0FBQztJQUVELGlCQUFpQjtJQUVqQixnQ0FBVyxHQUFYLFVBQVksS0FBWSxFQUFFLE9BQWUsRUFBRSxNQUFtQjtRQUFuQix1QkFBQSxFQUFBLFdBQW1CO1FBQzVELElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxXQUFTLE9BQVMsRUFBRSxNQUFNLENBQUMsQ0FBQTtJQUNqRSxDQUFDO0lBRU8saURBQTRCLEdBQXBDLFVBQXFDLE9BQWdCO1FBQzNDLElBQUEsaUNBQVcsRUFBRSw2QkFBUyxDQUFZO1FBQzFDLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUN4RCxDQUFDO0lBRU8sdUNBQWtCLEdBQTFCLFVBQTJCLFdBQXdCLEVBQUUsU0FBaUI7UUFDcEUsSUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsbUNBQW1DLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDOUUsSUFBSSxhQUFhLEdBQUcsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ25ELElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDbEIsYUFBYSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUE7WUFDaEUsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsQ0FBQTtTQUMvQztRQUNELE9BQU8sYUFBYSxDQUFBO0lBQ3RCLENBQUM7SUFFTyx3Q0FBbUIsR0FBM0IsVUFBNEIsV0FBd0IsRUFBRSxTQUFpQjtRQUNyRSxJQUFNLGFBQWEsR0FBRyxJQUFJLGFBQWEsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUE7UUFDL0QsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtTQUN4QjtRQUNELE9BQU8sYUFBYSxDQUFBO0lBQ3RCLENBQUM7SUFFTyx3REFBbUMsR0FBM0MsVUFBNEMsV0FBd0I7UUFDbEUsSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQzlELElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUNyQixnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQTtZQUMxQixJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO1NBQzFEO1FBQ0QsT0FBTyxnQkFBZ0IsQ0FBQTtJQUN6QixDQUFDO0lBQ0gsaUJBQUM7QUFBRCxDQUFDLEFBL0VELElBK0VDIn0=","// capture nos.:            12   23 4               43   1 5   56 7  76\nvar descriptorPattern = /^((.+?)(@(window|document))?->)?(.+?)(#(.+))?$/;\nexport function parseDescriptorString(descriptorString) {\n    var source = descriptorString.trim();\n    var matches = source.match(descriptorPattern) || [];\n    return {\n        eventTarget: parseEventTarget(matches[4]),\n        eventName: matches[2],\n        identifier: matches[5],\n        methodName: matches[7]\n    };\n}\nfunction parseEventTarget(eventTargetName) {\n    if (eventTargetName == \"window\") {\n        return window;\n    }\n    else if (eventTargetName == \"document\") {\n        return document;\n    }\n}\nexport function stringifyEventTarget(eventTarget) {\n    if (eventTarget == window) {\n        return \"window\";\n    }\n    else if (eventTarget == document) {\n        return \"document\";\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uX2Rlc2NyaXB0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYWN0aW9uX2Rlc2NyaXB0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBT0EsdUVBQXVFO0FBQ3ZFLElBQU0saUJBQWlCLEdBQUcsZ0RBQWdELENBQUE7QUFFMUUsTUFBTSxnQ0FBZ0MsZ0JBQXdCO0lBQzVELElBQU0sTUFBTSxHQUFHLGdCQUFnQixDQUFDLElBQUksRUFBRSxDQUFBO0lBQ3RDLElBQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLENBQUE7SUFDckQsT0FBTztRQUNMLFdBQVcsRUFBRSxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsU0FBUyxFQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDdkIsVUFBVSxFQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDdkIsVUFBVSxFQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUM7S0FDeEIsQ0FBQTtBQUNILENBQUM7QUFFRCwwQkFBMEIsZUFBdUI7SUFDL0MsSUFBSSxlQUFlLElBQUksUUFBUSxFQUFFO1FBQy9CLE9BQU8sTUFBTSxDQUFBO0tBQ2Q7U0FBTSxJQUFJLGVBQWUsSUFBSSxVQUFVLEVBQUU7UUFDeEMsT0FBTyxRQUFRLENBQUE7S0FDaEI7QUFDSCxDQUFDO0FBRUQsTUFBTSwrQkFBK0IsV0FBd0I7SUFDM0QsSUFBSSxXQUFXLElBQUksTUFBTSxFQUFFO1FBQ3pCLE9BQU8sUUFBUSxDQUFBO0tBQ2hCO1NBQU0sSUFBSSxXQUFXLElBQUksUUFBUSxFQUFFO1FBQ2xDLE9BQU8sVUFBVSxDQUFBO0tBQ2xCO0FBQ0gsQ0FBQyJ9","import { parseDescriptorString, stringifyEventTarget } from \"./action_descriptor\";\nvar Action = /** @class */ (function () {\n    function Action(element, index, descriptor) {\n        this.element = element;\n        this.index = index;\n        this.eventTarget = descriptor.eventTarget || element;\n        this.eventName = descriptor.eventName || getDefaultEventNameForElement(element) || error(\"missing event name\");\n        this.identifier = descriptor.identifier || error(\"missing identifier\");\n        this.methodName = descriptor.methodName || error(\"missing method name\");\n    }\n    Action.forToken = function (token) {\n        return new this(token.element, token.index, parseDescriptorString(token.content));\n    };\n    Action.prototype.toString = function () {\n        var eventNameSuffix = this.eventTargetName ? \"@\" + this.eventTargetName : \"\";\n        return \"\" + this.eventName + eventNameSuffix + \"->\" + this.identifier + \"#\" + this.methodName;\n    };\n    Object.defineProperty(Action.prototype, \"eventTargetName\", {\n        get: function () {\n            return stringifyEventTarget(this.eventTarget);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Action;\n}());\nexport { Action };\nvar defaultEventNames = {\n    \"a\": function (e) { return \"click\"; },\n    \"button\": function (e) { return \"click\"; },\n    \"form\": function (e) { return \"submit\"; },\n    \"input\": function (e) { return e.getAttribute(\"type\") == \"submit\" ? \"click\" : \"change\"; },\n    \"select\": function (e) { return \"change\"; },\n    \"textarea\": function (e) { return \"change\"; }\n};\nexport function getDefaultEventNameForElement(element) {\n    var tagName = element.tagName.toLowerCase();\n    if (tagName in defaultEventNames) {\n        return defaultEventNames[tagName](element);\n    }\n}\nfunction error(message) {\n    throw new Error(message);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQW9CLHFCQUFxQixFQUFFLG9CQUFvQixFQUFFLE1BQU0scUJBQXFCLENBQUE7QUFHbkc7SUFZRSxnQkFBWSxPQUFnQixFQUFFLEtBQWEsRUFBRSxVQUFxQztRQUNoRixJQUFJLENBQUMsT0FBTyxHQUFPLE9BQU8sQ0FBQTtRQUMxQixJQUFJLENBQUMsS0FBSyxHQUFTLEtBQUssQ0FBQTtRQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQyxXQUFXLElBQUksT0FBTyxDQUFBO1FBQ3BELElBQUksQ0FBQyxTQUFTLEdBQUssVUFBVSxDQUFDLFNBQVMsSUFBSSw2QkFBNkIsQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQTtRQUNoSCxJQUFJLENBQUMsVUFBVSxHQUFJLFVBQVUsQ0FBQyxVQUFVLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUE7UUFDdkUsSUFBSSxDQUFDLFVBQVUsR0FBSSxVQUFVLENBQUMsVUFBVSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO0lBQzFFLENBQUM7SUFYTSxlQUFRLEdBQWYsVUFBZ0IsS0FBWTtRQUMxQixPQUFPLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUNuRixDQUFDO0lBV0QseUJBQVEsR0FBUjtRQUNFLElBQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLE1BQUksSUFBSSxDQUFDLGVBQWlCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtRQUM5RSxPQUFPLEtBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxlQUFlLFVBQUssSUFBSSxDQUFDLFVBQVUsU0FBSSxJQUFJLENBQUMsVUFBWSxDQUFBO0lBQ3JGLENBQUM7SUFFRCxzQkFBWSxtQ0FBZTthQUEzQjtZQUNFLE9BQU8sb0JBQW9CLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQy9DLENBQUM7OztPQUFBO0lBQ0gsYUFBQztBQUFELENBQUMsQUE3QkQsSUE2QkM7O0FBRUQsSUFBTSxpQkFBaUIsR0FBd0Q7SUFDN0UsR0FBRyxFQUFTLFVBQUEsQ0FBQyxJQUFJLE9BQUEsT0FBTyxFQUFQLENBQU87SUFDeEIsUUFBUSxFQUFJLFVBQUEsQ0FBQyxJQUFJLE9BQUEsT0FBTyxFQUFQLENBQU87SUFDeEIsTUFBTSxFQUFNLFVBQUEsQ0FBQyxJQUFJLE9BQUEsUUFBUSxFQUFSLENBQVE7SUFDekIsT0FBTyxFQUFLLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUF2RCxDQUF1RDtJQUN4RSxRQUFRLEVBQUksVUFBQSxDQUFDLElBQUksT0FBQSxRQUFRLEVBQVIsQ0FBUTtJQUN6QixVQUFVLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxRQUFRLEVBQVIsQ0FBUTtDQUMxQixDQUFBO0FBRUQsTUFBTSx3Q0FBd0MsT0FBZ0I7SUFDNUQsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUM3QyxJQUFJLE9BQU8sSUFBSSxpQkFBaUIsRUFBRTtRQUNoQyxPQUFPLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0tBQzNDO0FBQ0gsQ0FBQztBQUVELGVBQWUsT0FBZTtJQUM1QixNQUFNLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQzFCLENBQUMifQ==","var Binding = /** @class */ (function () {\n    function Binding(context, action) {\n        this.context = context;\n        this.action = action;\n    }\n    Object.defineProperty(Binding.prototype, \"index\", {\n        get: function () {\n            return this.action.index;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"eventTarget\", {\n        get: function () {\n            return this.action.eventTarget;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"identifier\", {\n        get: function () {\n            return this.context.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Binding.prototype.handleEvent = function (event) {\n        if (this.willBeInvokedByEvent(event)) {\n            this.invokeWithEvent(event);\n        }\n    };\n    Object.defineProperty(Binding.prototype, \"eventName\", {\n        get: function () {\n            return this.action.eventName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"method\", {\n        get: function () {\n            var method = this.controller[this.methodName];\n            if (typeof method == \"function\") {\n                return method;\n            }\n            throw new Error(\"Action \\\"\" + this.action + \"\\\" references undefined method \\\"\" + this.methodName + \"\\\"\");\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Binding.prototype.invokeWithEvent = function (event) {\n        try {\n            this.method.call(this.controller, event);\n        }\n        catch (error) {\n            var _a = this, identifier = _a.identifier, controller = _a.controller, element = _a.element, index = _a.index;\n            var detail = { identifier: identifier, controller: controller, element: element, index: index, event: event };\n            this.context.handleError(error, \"invoking action \\\"\" + this.action + \"\\\"\", detail);\n        }\n    };\n    Binding.prototype.willBeInvokedByEvent = function (event) {\n        var eventTarget = event.target;\n        if (this.element === eventTarget) {\n            return true;\n        }\n        else if (eventTarget instanceof Element && this.element.contains(eventTarget)) {\n            return this.scope.containsElement(eventTarget);\n        }\n        else {\n            return true;\n        }\n    };\n    Object.defineProperty(Binding.prototype, \"controller\", {\n        get: function () {\n            return this.context.controller;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"methodName\", {\n        get: function () {\n            return this.action.methodName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"scope\", {\n        get: function () {\n            return this.context.scope;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Binding;\n}());\nexport { Binding };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9iaW5kaW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBO0lBSUUsaUJBQVksT0FBZ0IsRUFBRSxNQUFjO1FBQzFDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO0lBQ3RCLENBQUM7SUFFRCxzQkFBSSwwQkFBSzthQUFUO1lBQ0UsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQTtRQUMxQixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLGdDQUFXO2FBQWY7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFBO1FBQ2hDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksK0JBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUE7UUFDaEMsQ0FBQzs7O09BQUE7SUFFRCw2QkFBVyxHQUFYLFVBQVksS0FBWTtRQUN0QixJQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNwQyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQzVCO0lBQ0gsQ0FBQztJQUVELHNCQUFJLDhCQUFTO2FBQWI7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFBO1FBQzlCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksMkJBQU07YUFBVjtZQUNFLElBQU0sTUFBTSxHQUFJLElBQUksQ0FBQyxVQUFrQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUN4RCxJQUFJLE9BQU8sTUFBTSxJQUFJLFVBQVUsRUFBRTtnQkFDL0IsT0FBTyxNQUFNLENBQUE7YUFDZDtZQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsY0FBVyxJQUFJLENBQUMsTUFBTSx5Q0FBa0MsSUFBSSxDQUFDLFVBQVUsT0FBRyxDQUFDLENBQUE7UUFDN0YsQ0FBQzs7O09BQUE7SUFFTyxpQ0FBZSxHQUF2QixVQUF3QixLQUFZO1FBQ2xDLElBQUk7WUFDRixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFBO1NBQ3pDO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDUixJQUFBLFNBQWlELEVBQS9DLDBCQUFVLEVBQUUsMEJBQVUsRUFBRSxvQkFBTyxFQUFFLGdCQUFLLENBQVM7WUFDdkQsSUFBTSxNQUFNLEdBQUcsRUFBRSxVQUFVLFlBQUEsRUFBRSxVQUFVLFlBQUEsRUFBRSxPQUFPLFNBQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFBO1lBQ2hFLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSx1QkFBb0IsSUFBSSxDQUFDLE1BQU0sT0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1NBQzVFO0lBQ0gsQ0FBQztJQUVPLHNDQUFvQixHQUE1QixVQUE2QixLQUFZO1FBQ3ZDLElBQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUE7UUFDaEMsSUFBSSxJQUFJLENBQUMsT0FBTyxLQUFLLFdBQVcsRUFBRTtZQUNoQyxPQUFPLElBQUksQ0FBQTtTQUNaO2FBQU0sSUFBSSxXQUFXLFlBQVksT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQy9FLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLENBQUE7U0FDL0M7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFBO1NBQ1o7SUFDSCxDQUFDO0lBRUQsc0JBQVksK0JBQVU7YUFBdEI7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFBO1FBQ2hDLENBQUM7OztPQUFBO0lBRUQsc0JBQVksK0JBQVU7YUFBdEI7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFBO1FBQy9CLENBQUM7OztPQUFBO0lBRUQsc0JBQVksNEJBQU87YUFBbkI7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBQzNCLENBQUM7OztPQUFBO0lBRUQsc0JBQVksMEJBQUs7YUFBakI7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFBO1FBQzNCLENBQUM7OztPQUFBO0lBQ0gsY0FBQztBQUFELENBQUMsQUEzRUQsSUEyRUMifQ==","var ElementObserver = /** @class */ (function () {\n    function ElementObserver(element, delegate) {\n        var _this = this;\n        this.element = element;\n        this.started = false;\n        this.delegate = delegate;\n        this.elements = new Set;\n        this.mutationObserver = new MutationObserver(function (mutations) { return _this.processMutations(mutations); });\n    }\n    ElementObserver.prototype.start = function () {\n        if (!this.started) {\n            this.started = true;\n            this.mutationObserver.observe(this.element, { attributes: true, childList: true, subtree: true });\n            this.refresh();\n        }\n    };\n    ElementObserver.prototype.stop = function () {\n        if (this.started) {\n            this.mutationObserver.takeRecords();\n            this.mutationObserver.disconnect();\n            this.started = false;\n        }\n    };\n    ElementObserver.prototype.refresh = function () {\n        if (this.started) {\n            var matches = new Set(this.matchElementsInTree());\n            for (var _i = 0, _a = Array.from(this.elements); _i < _a.length; _i++) {\n                var element = _a[_i];\n                if (!matches.has(element)) {\n                    this.removeElement(element);\n                }\n            }\n            for (var _b = 0, _c = Array.from(matches); _b < _c.length; _b++) {\n                var element = _c[_b];\n                this.addElement(element);\n            }\n        }\n    };\n    // Mutation record processing\n    ElementObserver.prototype.processMutations = function (mutations) {\n        if (this.started) {\n            for (var _i = 0, mutations_1 = mutations; _i < mutations_1.length; _i++) {\n                var mutation = mutations_1[_i];\n                this.processMutation(mutation);\n            }\n        }\n    };\n    ElementObserver.prototype.processMutation = function (mutation) {\n        if (mutation.type == \"attributes\") {\n            this.processAttributeChange(mutation.target, mutation.attributeName);\n        }\n        else if (mutation.type == \"childList\") {\n            this.processRemovedNodes(mutation.removedNodes);\n            this.processAddedNodes(mutation.addedNodes);\n        }\n    };\n    ElementObserver.prototype.processAttributeChange = function (node, attributeName) {\n        var element = node;\n        if (this.elements.has(element)) {\n            if (this.delegate.elementAttributeChanged && this.matchElement(element)) {\n                this.delegate.elementAttributeChanged(element, attributeName);\n            }\n            else {\n                this.removeElement(element);\n            }\n        }\n        else if (this.matchElement(element)) {\n            this.addElement(element);\n        }\n    };\n    ElementObserver.prototype.processRemovedNodes = function (nodes) {\n        for (var _i = 0, _a = Array.from(nodes); _i < _a.length; _i++) {\n            var node = _a[_i];\n            var element = this.elementFromNode(node);\n            if (element) {\n                this.processTree(element, this.removeElement);\n            }\n        }\n    };\n    ElementObserver.prototype.processAddedNodes = function (nodes) {\n        for (var _i = 0, _a = Array.from(nodes); _i < _a.length; _i++) {\n            var node = _a[_i];\n            var element = this.elementFromNode(node);\n            if (element && this.elementIsActive(element)) {\n                this.processTree(element, this.addElement);\n            }\n        }\n    };\n    // Element matching\n    ElementObserver.prototype.matchElement = function (element) {\n        return this.delegate.matchElement(element);\n    };\n    ElementObserver.prototype.matchElementsInTree = function (tree) {\n        if (tree === void 0) { tree = this.element; }\n        return this.delegate.matchElementsInTree(tree);\n    };\n    ElementObserver.prototype.processTree = function (tree, processor) {\n        for (var _i = 0, _a = this.matchElementsInTree(tree); _i < _a.length; _i++) {\n            var element = _a[_i];\n            processor.call(this, element);\n        }\n    };\n    ElementObserver.prototype.elementFromNode = function (node) {\n        if (node.nodeType == Node.ELEMENT_NODE) {\n            return node;\n        }\n    };\n    ElementObserver.prototype.elementIsActive = function (element) {\n        if (element.isConnected != this.element.isConnected) {\n            return false;\n        }\n        else {\n            return this.element.contains(element);\n        }\n    };\n    // Element tracking\n    ElementObserver.prototype.addElement = function (element) {\n        if (!this.elements.has(element)) {\n            if (this.elementIsActive(element)) {\n                this.elements.add(element);\n                if (this.delegate.elementMatched) {\n                    this.delegate.elementMatched(element);\n                }\n            }\n        }\n    };\n    ElementObserver.prototype.removeElement = function (element) {\n        if (this.elements.has(element)) {\n            this.elements.delete(element);\n            if (this.delegate.elementUnmatched) {\n                this.delegate.elementUnmatched(element);\n            }\n        }\n    };\n    return ElementObserver;\n}());\nexport { ElementObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudF9vYnNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lbGVtZW50X29ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVNBO0lBUUUseUJBQVksT0FBZ0IsRUFBRSxRQUFpQztRQUEvRCxpQkFPQztRQU5DLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFBO1FBQ3BCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBRXhCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxHQUFHLENBQUE7UUFDdkIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksZ0JBQWdCLENBQUMsVUFBQyxTQUFTLElBQUssT0FBQSxLQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLEVBQWhDLENBQWdDLENBQUMsQ0FBQTtJQUMvRixDQUFDO0lBRUQsK0JBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFBO1lBQ25CLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtZQUNqRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUE7U0FDZjtJQUNILENBQUM7SUFFRCw4QkFBSSxHQUFKO1FBQ0UsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNuQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLENBQUE7WUFDbEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUE7U0FDckI7SUFDSCxDQUFDO0lB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","import { ElementObserver } from \"./element_observer\";\nvar AttributeObserver = /** @class */ (function () {\n    function AttributeObserver(element, attributeName, delegate) {\n        this.attributeName = attributeName;\n        this.delegate = delegate;\n        this.elementObserver = new ElementObserver(element, this);\n    }\n    Object.defineProperty(AttributeObserver.prototype, \"element\", {\n        get: function () {\n            return this.elementObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AttributeObserver.prototype, \"selector\", {\n        get: function () {\n            return \"[\" + this.attributeName + \"]\";\n        },\n        enumerable: true,\n        configurable: true\n    });\n    AttributeObserver.prototype.start = function () {\n        this.elementObserver.start();\n    };\n    AttributeObserver.prototype.stop = function () {\n        this.elementObserver.stop();\n    };\n    AttributeObserver.prototype.refresh = function () {\n        this.elementObserver.refresh();\n    };\n    Object.defineProperty(AttributeObserver.prototype, \"started\", {\n        get: function () {\n            return this.elementObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Element observer delegate\n    AttributeObserver.prototype.matchElement = function (element) {\n        return element.hasAttribute(this.attributeName);\n    };\n    AttributeObserver.prototype.matchElementsInTree = function (tree) {\n        var match = this.matchElement(tree) ? [tree] : [];\n        var matches = Array.from(tree.querySelectorAll(this.selector));\n        return match.concat(matches);\n    };\n    AttributeObserver.prototype.elementMatched = function (element) {\n        if (this.delegate.elementMatchedAttribute) {\n            this.delegate.elementMatchedAttribute(element, this.attributeName);\n        }\n    };\n    AttributeObserver.prototype.elementUnmatched = function (element) {\n        if (this.delegate.elementUnmatchedAttribute) {\n            this.delegate.elementUnmatchedAttribute(element, this.attributeName);\n        }\n    };\n    AttributeObserver.prototype.elementAttributeChanged = function (element, attributeName) {\n        if (this.delegate.elementAttributeValueChanged && this.attributeName == attributeName) {\n            this.delegate.elementAttributeValueChanged(element, attributeName);\n        }\n    };\n    return AttributeObserver;\n}());\nexport { AttributeObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0cmlidXRlX29ic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2F0dHJpYnV0ZV9vYnNlcnZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUEyQixNQUFNLG9CQUFvQixDQUFBO0FBUTdFO0lBTUUsMkJBQVksT0FBZ0IsRUFBRSxhQUFxQixFQUFFLFFBQW1DO1FBQ3RGLElBQUksQ0FBQyxhQUFhLEdBQUcsYUFBYSxDQUFBO1FBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBRXhCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxlQUFlLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQzNELENBQUM7SUFFRCxzQkFBSSxzQ0FBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQTtRQUNyQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHVDQUFRO2FBQVo7WUFDRSxPQUFPLE1BQUksSUFBSSxDQUFDLGFBQWEsTUFBRyxDQUFBO1FBQ2xDLENBQUM7OztPQUFBO0lBRUQsaUNBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUE7SUFDOUIsQ0FBQztJQUVELGdDQUFJLEdBQUo7UUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxDQUFBO0lBQzdCLENBQUM7SUFFRCxtQ0FBTyxHQUFQO1FBQ0UsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUNoQyxDQUFDO0lBRUQsc0JBQUksc0NBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUE7UUFDckMsQ0FBQzs7O09BQUE7SUFFRCw0QkFBNEI7SUFFNUIsd0NBQVksR0FBWixVQUFhLE9BQWdCO1FBQzNCLE9BQU8sT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUE7SUFDakQsQ0FBQztJQUVELCtDQUFtQixHQUFuQixVQUFvQixJQUFhO1FBQy9CLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtRQUNuRCxJQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQTtRQUNoRSxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDOUIsQ0FBQztJQUVELDBDQUFjLEdBQWQsVUFBZSxPQUFnQjtRQUM3QixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsdUJBQXVCLEVBQUU7WUFDekMsSUFBSSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFBO1NBQ25FO0lBQ0gsQ0FBQztJQUVELDRDQUFnQixHQUFoQixVQUFpQixPQUFnQjtRQUMvQixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMseUJBQXlCLEVBQUU7WUFDM0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFBO1NBQ3JFO0lBQ0gsQ0FBQztJQUVELG1EQUF1QixHQUF2QixVQUF3QixPQUFnQixFQUFFLGFBQXFCO1FBQzdELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyw0QkFBNEIsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLGFBQWEsRUFBRTtZQUNyRixJQUFJLENBQUMsUUFBUSxDQUFDLDRCQUE0QixDQUFDLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQTtTQUNuRTtJQUNILENBQUM7SUFDSCx3QkFBQztBQUFELENBQUMsQUFsRUQsSUFrRUMifQ==","export function add(map, key, value) {\n    fetch(map, key).add(value);\n}\nexport function del(map, key, value) {\n    fetch(map, key).delete(value);\n    prune(map, key);\n}\nexport function fetch(map, key) {\n    var values = map.get(key);\n    if (!values) {\n        values = new Set();\n        map.set(key, values);\n    }\n    return values;\n}\nexport function prune(map, key) {\n    var values = map.get(key);\n    if (values != null && values.size == 0) {\n        map.delete(key);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0X29wZXJhdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2V0X29wZXJhdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxjQUFvQixHQUFtQixFQUFFLEdBQU0sRUFBRSxLQUFRO0lBQzdELEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQzVCLENBQUM7QUFFRCxNQUFNLGNBQW9CLEdBQW1CLEVBQUUsR0FBTSxFQUFFLEtBQVE7SUFDN0QsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDN0IsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtBQUNqQixDQUFDO0FBRUQsTUFBTSxnQkFBc0IsR0FBbUIsRUFBRSxHQUFNO0lBQ3JELElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDekIsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUNYLE1BQU0sR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFBO1FBQ2xCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFBO0tBQ3JCO0lBQ0QsT0FBTyxNQUFNLENBQUE7QUFDZixDQUFDO0FBRUQsTUFBTSxnQkFBc0IsR0FBbUIsRUFBRSxHQUFNO0lBQ3JELElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDM0IsSUFBSSxNQUFNLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxFQUFFO1FBQ3RDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7S0FDaEI7QUFDSCxDQUFDIn0=","import { add, del } from \"./set_operations\";\nvar Multimap = /** @class */ (function () {\n    function Multimap() {\n        this.valuesByKey = new Map();\n    }\n    Object.defineProperty(Multimap.prototype, \"values\", {\n        get: function () {\n            var sets = Array.from(this.valuesByKey.values());\n            return sets.reduce(function (values, set) { return values.concat(Array.from(set)); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Multimap.prototype, \"size\", {\n        get: function () {\n            var sets = Array.from(this.valuesByKey.values());\n            return sets.reduce(function (size, set) { return size + set.size; }, 0);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Multimap.prototype.add = function (key, value) {\n        add(this.valuesByKey, key, value);\n    };\n    Multimap.prototype.delete = function (key, value) {\n        del(this.valuesByKey, key, value);\n    };\n    Multimap.prototype.has = function (key, value) {\n        var values = this.valuesByKey.get(key);\n        return values != null && values.has(value);\n    };\n    Multimap.prototype.hasKey = function (key) {\n        return this.valuesByKey.has(key);\n    };\n    Multimap.prototype.hasValue = function (value) {\n        var sets = Array.from(this.valuesByKey.values());\n        return sets.some(function (set) { return set.has(value); });\n    };\n    Multimap.prototype.getValuesForKey = function (key) {\n        var values = this.valuesByKey.get(key);\n        return values ? Array.from(values) : [];\n    };\n    Multimap.prototype.getKeysForValue = function (value) {\n        return Array.from(this.valuesByKey)\n            .filter(function (_a) {\n            var key = _a[0], values = _a[1];\n            return values.has(value);\n        })\n            .map(function (_a) {\n            var key = _a[0], values = _a[1];\n            return key;\n        });\n    };\n    return Multimap;\n}());\nexport { Multimap };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGltYXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbXVsdGltYXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUUzQztJQUdFO1FBQ0UsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBYSxDQUFBO0lBQ3pDLENBQUM7SUFFRCxzQkFBSSw0QkFBTTthQUFWO1lBQ0UsSUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUE7WUFDbEQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSyxPQUFBLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUE5QixDQUE4QixFQUFRLEVBQUUsQ0FBQyxDQUFBO1FBQy9FLENBQUM7OztPQUFBO0lBRUQsc0JBQUksMEJBQUk7YUFBUjtZQUNFLElBQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFBO1lBQ2xELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFDLElBQUksRUFBRSxHQUFHLElBQUssT0FBQSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBZixDQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDdkQsQ0FBQzs7O09BQUE7SUFFRCxzQkFBRyxHQUFILFVBQUksR0FBTSxFQUFFLEtBQVE7UUFDbEIsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFRCx5QkFBTSxHQUFOLFVBQU8sR0FBTSxFQUFFLEtBQVE7UUFDckIsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFRCxzQkFBRyxHQUFILFVBQUksR0FBTSxFQUFFLEtBQVE7UUFDbEIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDeEMsT0FBTyxNQUFNLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDNUMsQ0FBQztJQUVELHlCQUFNLEdBQU4sVUFBTyxHQUFNO1FBQ1gsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUNsQyxDQUFDO0lBRUQsMkJBQVEsR0FBUixVQUFTLEtBQVE7UUFDZixJQUFNLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQTtRQUNsRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFkLENBQWMsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7SUFFRCxrQ0FBZSxHQUFmLFVBQWdCLEdBQU07UUFDcEIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDeEMsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtJQUN6QyxDQUFDO0lBRUQsa0NBQWUsR0FBZixVQUFnQixLQUFRO1FBQ3RCLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO2FBQ2hDLE1BQU0sQ0FBQyxVQUFDLEVBQWE7Z0JBQVosV0FBRyxFQUFFLGNBQU07WUFBTSxPQUFBLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQWpCLENBQWlCLENBQUM7YUFDNUMsR0FBRyxDQUFDLFVBQUMsRUFBYTtnQkFBWixXQUFHLEVBQUUsY0FBTTtZQUFNLE9BQUEsR0FBRztRQUFILENBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUM7SUFDSCxlQUFDO0FBQUQsQ0FBQyxBQWpERCxJQWlEQyJ9","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Multimap } from \"./multimap\";\nimport { add, del } from \"./set_operations\";\nvar IndexedMultimap = /** @class */ (function (_super) {\n    __extends(IndexedMultimap, _super);\n    function IndexedMultimap() {\n        var _this = _super.call(this) || this;\n        _this.keysByValue = new Map;\n        return _this;\n    }\n    Object.defineProperty(IndexedMultimap.prototype, \"values\", {\n        get: function () {\n            return Array.from(this.keysByValue.keys());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    IndexedMultimap.prototype.add = function (key, value) {\n        _super.prototype.add.call(this, key, value);\n        add(this.keysByValue, value, key);\n    };\n    IndexedMultimap.prototype.delete = function (key, value) {\n        _super.prototype.delete.call(this, key, value);\n        del(this.keysByValue, value, key);\n    };\n    IndexedMultimap.prototype.hasValue = function (value) {\n        return this.keysByValue.has(value);\n    };\n    IndexedMultimap.prototype.getKeysForValue = function (value) {\n        var set = this.keysByValue.get(value);\n        return set ? Array.from(set) : [];\n    };\n    return IndexedMultimap;\n}(Multimap));\nexport { IndexedMultimap };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXhlZF9tdWx0aW1hcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbmRleGVkX211bHRpbWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBQ3JDLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFFM0M7SUFBMkMsbUNBQWM7SUFHdkQ7UUFBQSxZQUNFLGlCQUFPLFNBRVI7UUFEQyxLQUFJLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxDQUFBOztJQUM1QixDQUFDO0lBRUQsc0JBQUksbUNBQU07YUFBVjtZQUNFLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7UUFDNUMsQ0FBQzs7O09BQUE7SUFFRCw2QkFBRyxHQUFILFVBQUksR0FBTSxFQUFFLEtBQVE7UUFDbEIsaUJBQU0sR0FBRyxZQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUNyQixHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVELGdDQUFNLEdBQU4sVUFBTyxHQUFNLEVBQUUsS0FBUTtRQUNyQixpQkFBTSxNQUFNLFlBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3hCLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRUQsa0NBQVEsR0FBUixVQUFTLEtBQVE7UUFDZixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ3BDLENBQUM7SUFFRCx5Q0FBZSxHQUFmLFVBQWdCLEtBQVE7UUFDdEIsSUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDdkMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtJQUNuQyxDQUFDO0lBQ0gsc0JBQUM7QUFBRCxDQUFDLEFBOUJELENBQTJDLFFBQVEsR0E4QmxEIn0=","import { AttributeObserver } from \"./attribute_observer\";\nimport { Multimap } from \"@stimulus/multimap\";\nvar TokenListObserver = /** @class */ (function () {\n    function TokenListObserver(element, attributeName, delegate) {\n        this.attributeObserver = new AttributeObserver(element, attributeName, this);\n        this.delegate = delegate;\n        this.tokensByElement = new Multimap;\n    }\n    Object.defineProperty(TokenListObserver.prototype, \"started\", {\n        get: function () {\n            return this.attributeObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TokenListObserver.prototype.start = function () {\n        this.attributeObserver.start();\n    };\n    TokenListObserver.prototype.stop = function () {\n        this.attributeObserver.stop();\n    };\n    TokenListObserver.prototype.refresh = function () {\n        this.attributeObserver.refresh();\n    };\n    Object.defineProperty(TokenListObserver.prototype, \"element\", {\n        get: function () {\n            return this.attributeObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TokenListObserver.prototype, \"attributeName\", {\n        get: function () {\n            return this.attributeObserver.attributeName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Attribute observer delegate\n    TokenListObserver.prototype.elementMatchedAttribute = function (element) {\n        this.tokensMatched(this.readTokensForElement(element));\n    };\n    TokenListObserver.prototype.elementAttributeValueChanged = function (element) {\n        var _a = this.refreshTokensForElement(element), unmatchedTokens = _a[0], matchedTokens = _a[1];\n        this.tokensUnmatched(unmatchedTokens);\n        this.tokensMatched(matchedTokens);\n    };\n    TokenListObserver.prototype.elementUnmatchedAttribute = function (element) {\n        this.tokensUnmatched(this.tokensByElement.getValuesForKey(element));\n    };\n    TokenListObserver.prototype.tokensMatched = function (tokens) {\n        var _this = this;\n        tokens.forEach(function (token) { return _this.tokenMatched(token); });\n    };\n    TokenListObserver.prototype.tokensUnmatched = function (tokens) {\n        var _this = this;\n        tokens.forEach(function (token) { return _this.tokenUnmatched(token); });\n    };\n    TokenListObserver.prototype.tokenMatched = function (token) {\n        this.delegate.tokenMatched(token);\n        this.tokensByElement.add(token.element, token);\n    };\n    TokenListObserver.prototype.tokenUnmatched = function (token) {\n        this.delegate.tokenUnmatched(token);\n        this.tokensByElement.delete(token.element, token);\n    };\n    TokenListObserver.prototype.refreshTokensForElement = function (element) {\n        var previousTokens = this.tokensByElement.getValuesForKey(element);\n        var currentTokens = this.readTokensForElement(element);\n        var firstDifferingIndex = zip(previousTokens, currentTokens)\n            .findIndex(function (_a) {\n            var previousToken = _a[0], currentToken = _a[1];\n            return !tokensAreEqual(previousToken, currentToken);\n        });\n        if (firstDifferingIndex == -1) {\n            return [[], []];\n        }\n        else {\n            return [previousTokens.slice(firstDifferingIndex), currentTokens.slice(firstDifferingIndex)];\n        }\n    };\n    TokenListObserver.prototype.readTokensForElement = function (element) {\n        var attributeName = this.attributeName;\n        var tokenString = element.getAttribute(attributeName) || \"\";\n        return parseTokenString(tokenString, element, attributeName);\n    };\n    return TokenListObserver;\n}());\nexport { TokenListObserver };\nfunction parseTokenString(tokenString, element, attributeName) {\n    return tokenString.trim().split(/\\s+/).filter(function (content) { return content.length; })\n        .map(function (content, index) { return ({ element: element, attributeName: attributeName, content: content, index: index }); });\n}\nfunction zip(left, right) {\n    var length = Math.max(left.length, right.length);\n    return Array.from({ length: length }, function (_, index) { return [left[index], right[index]]; });\n}\nfunction tokensAreEqual(left, right) {\n    return left && right && left.index == right.index && left.content == right.content;\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW5fbGlzdF9vYnNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90b2tlbl9saXN0X29ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBNkIsTUFBTSxzQkFBc0IsQ0FBQTtBQUNuRixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFjN0M7SUFLRSwyQkFBWSxPQUFnQixFQUFFLGFBQXFCLEVBQUUsUUFBbUM7UUFDdEYsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaUJBQWlCLENBQUMsT0FBTyxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUM1RSxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUN4QixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksUUFBUSxDQUFBO0lBQ3JDLENBQUM7SUFFRCxzQkFBSSxzQ0FBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFBO1FBQ3ZDLENBQUM7OztPQUFBO0lBRUQsaUNBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUNoQyxDQUFDO0lBRUQsZ0NBQUksR0FBSjtRQUNFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUMvQixDQUFDO0lBRUQsbUNBQU8sR0FBUDtRQUNFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUNsQyxDQUFDO0lBRUQsc0JBQUksc0NBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQTtRQUN2QyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDRDQUFhO2FBQWpCO1lBQ0UsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsYUFBYSxDQUFBO1FBQzdDLENBQUM7OztPQUFBO0lBRUQsOEJBQThCO0lB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","import { TokenListObserver } from \"./token_list_observer\";\nvar ValueListObserver = /** @class */ (function () {\n    function ValueListObserver(element, attributeName, delegate) {\n        this.tokenListObserver = new TokenListObserver(element, attributeName, this);\n        this.delegate = delegate;\n        this.parseResultsByToken = new WeakMap;\n        this.valuesByTokenByElement = new WeakMap;\n    }\n    Object.defineProperty(ValueListObserver.prototype, \"started\", {\n        get: function () {\n            return this.tokenListObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ValueListObserver.prototype.start = function () {\n        this.tokenListObserver.start();\n    };\n    ValueListObserver.prototype.stop = function () {\n        this.tokenListObserver.stop();\n    };\n    ValueListObserver.prototype.refresh = function () {\n        this.tokenListObserver.refresh();\n    };\n    Object.defineProperty(ValueListObserver.prototype, \"element\", {\n        get: function () {\n            return this.tokenListObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ValueListObserver.prototype, \"attributeName\", {\n        get: function () {\n            return this.tokenListObserver.attributeName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ValueListObserver.prototype.tokenMatched = function (token) {\n        var element = token.element;\n        var value = this.fetchParseResultForToken(token).value;\n        if (value) {\n            this.fetchValuesByTokenForElement(element).set(token, value);\n            this.delegate.elementMatchedValue(element, value);\n        }\n    };\n    ValueListObserver.prototype.tokenUnmatched = function (token) {\n        var element = token.element;\n        var value = this.fetchParseResultForToken(token).value;\n        if (value) {\n            this.fetchValuesByTokenForElement(element).delete(token);\n            this.delegate.elementUnmatchedValue(element, value);\n        }\n    };\n    ValueListObserver.prototype.fetchParseResultForToken = function (token) {\n        var parseResult = this.parseResultsByToken.get(token);\n        if (!parseResult) {\n            parseResult = this.parseToken(token);\n            this.parseResultsByToken.set(token, parseResult);\n        }\n        return parseResult;\n    };\n    ValueListObserver.prototype.fetchValuesByTokenForElement = function (element) {\n        var valuesByToken = this.valuesByTokenByElement.get(element);\n        if (!valuesByToken) {\n            valuesByToken = new Map;\n            this.valuesByTokenByElement.set(element, valuesByToken);\n        }\n        return valuesByToken;\n    };\n    ValueListObserver.prototype.parseToken = function (token) {\n        try {\n            var value = this.delegate.parseValueForToken(token);\n            return { value: value };\n        }\n        catch (error) {\n            return { error: error };\n        }\n    };\n    return ValueListObserver;\n}());\nexport { ValueListObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsdWVfbGlzdF9vYnNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92YWx1ZV9saXN0X29ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBUyxpQkFBaUIsRUFBNkIsTUFBTSx1QkFBdUIsQ0FBQTtBQWEzRjtJQU1FLDJCQUFZLE9BQWdCLEVBQUUsYUFBcUIsRUFBRSxRQUFzQztRQUN6RixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQzVFLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLE9BQU8sQ0FBQTtRQUN0QyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxPQUFPLENBQUE7SUFDM0MsQ0FBQztJQUVELHNCQUFJLHNDQUFPO2FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUE7UUFDdkMsQ0FBQzs7O09BQUE7SUFFRCxpQ0FBSyxHQUFMO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxDQUFBO0lBQ2hDLENBQUM7SUFFRCxnQ0FBSSxHQUFKO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxDQUFBO0lBQy9CLENBQUM7SUFFRCxtQ0FBTyxHQUFQO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sRUFBRSxDQUFBO0lBQ2xDLENBQUM7SUFFRCxzQkFBSSxzQ0FBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFBO1FBQ3ZDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksNENBQWE7YUFBakI7WUFDRSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLENBQUE7UUFDN0MsQ0FBQzs7O09BQUE7SUFFRCx3Q0FBWSxHQUFaLFVBQWEsS0FBWTtRQUNmLElBQUEsdUJBQU8sQ0FBVTtRQUNqQixJQUFBLGtEQUFLLENBQXlDO1FBQ3RELElBQUksS0FBSyxFQUFFO1lBQ1QsSUFBSSxDQUFDLDRCQUE0QixDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDNUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUE7U0FDbEQ7SUFDSCxDQUFDO0lBRUQsMENBQWMsR0FBZCxVQUFlLEtBQVk7UUFDakIsSUFBQSx1QkFBTyxDQUFVO1FBQ2pCLElBQUEsa0RBQUssQ0FBeUM7UUFDdEQsSUFBSSxLQUFLLEVBQUU7WUFDVCxJQUFJLENBQUMsNEJBQTRCLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQ3hELElBQUksQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFBO1NBQ3BEO0lBQ0gsQ0FBQztJQUVPLG9EQUF3QixHQUFoQyxVQUFpQyxLQUFZO1FBQzNDLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDckQsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNoQixXQUFXLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUNwQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxXQUFXLENBQUMsQ0FBQTtTQUNqRDtRQUNELE9BQU8sV0FBVyxDQUFBO0lBQ3BCLENBQUM7SUFFTyx3REFBNEIsR0FBcEMsVUFBcUMsT0FBZ0I7UUFDbkQsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUM1RCxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ2xCLGFBQWEsR0FBRyxJQUFJLEdBQUcsQ0FBQTtZQUN2QixJQUFJLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQTtTQUN4RDtRQUNELE9BQU8sYUFBYSxDQUFBO0lBQ3RCLENBQUM7SUFFTyxzQ0FBVSxHQUFsQixVQUFtQixLQUFZO1FBQzdCLElBQUk7WUFDRixJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQ3JELE9BQU8sRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFBO1NBQ2pCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLEVBQUUsS0FBSyxPQUFBLEVBQUUsQ0FBQTtTQUNqQjtJQUNILENBQUM7SUFDSCx3QkFBQztBQUFELENBQUMsQUFqRkQsSUFpRkMifQ==","import { Action } from \"./action\";\nimport { Binding } from \"./binding\";\nimport { ValueListObserver } from \"@stimulus/mutation-observers\";\nvar BindingObserver = /** @class */ (function () {\n    function BindingObserver(context, delegate) {\n        this.context = context;\n        this.delegate = delegate;\n        this.bindingsByAction = new Map;\n    }\n    BindingObserver.prototype.start = function () {\n        if (!this.valueListObserver) {\n            this.valueListObserver = new ValueListObserver(this.element, this.actionAttribute, this);\n            this.valueListObserver.start();\n        }\n    };\n    BindingObserver.prototype.stop = function () {\n        if (this.valueListObserver) {\n            this.valueListObserver.stop();\n            delete this.valueListObserver;\n            this.disconnectAllActions();\n        }\n    };\n    Object.defineProperty(BindingObserver.prototype, \"element\", {\n        get: function () {\n            return this.context.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"identifier\", {\n        get: function () {\n            return this.context.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"actionAttribute\", {\n        get: function () {\n            return this.schema.actionAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"schema\", {\n        get: function () {\n            return this.context.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"bindings\", {\n        get: function () {\n            return Array.from(this.bindingsByAction.values());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    BindingObserver.prototype.connectAction = function (action) {\n        var binding = new Binding(this.context, action);\n        this.bindingsByAction.set(action, binding);\n        this.delegate.bindingConnected(binding);\n    };\n    BindingObserver.prototype.disconnectAction = function (action) {\n        var binding = this.bindingsByAction.get(action);\n        if (binding) {\n            this.bindingsByAction.delete(action);\n            this.delegate.bindingDisconnected(binding);\n        }\n    };\n    BindingObserver.prototype.disconnectAllActions = function () {\n        var _this = this;\n        this.bindings.forEach(function (binding) { return _this.delegate.bindingDisconnected(binding); });\n        this.bindingsByAction.clear();\n    };\n    // Value observer delegate\n    BindingObserver.prototype.parseValueForToken = function (token) {\n        var action = Action.forToken(token);\n        if (action.identifier == this.identifier) {\n            return action;\n        }\n    };\n    BindingObserver.prototype.elementMatchedValue = function (element, action) {\n        this.connectAction(action);\n    };\n    BindingObserver.prototype.elementUnmatchedValue = function (element, action) {\n        this.disconnectAction(action);\n    };\n    return BindingObserver;\n}());\nexport { BindingObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19vYnNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9iaW5kaW5nX29ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDakMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUluQyxPQUFPLEVBQVMsaUJBQWlCLEVBQTZCLE1BQU0sOEJBQThCLENBQUE7QUFPbEc7SUFNRSx5QkFBWSxPQUFnQixFQUFFLFFBQWlDO1FBQzdELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsK0JBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDM0IsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFBO1lBQ3hGLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtTQUMvQjtJQUNILENBQUM7SUFFRCw4QkFBSSxHQUFKO1FBQ0UsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxDQUFBO1lBQzdCLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFBO1lBQzdCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFBO1NBQzVCO0lBQ0gsQ0FBQztJQUVELHNCQUFJLG9DQUFPO2FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFBO1FBQzdCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksdUNBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUE7UUFDaEMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw0Q0FBZTthQUFuQjtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUE7UUFDcEMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSxtQ0FBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQTtRQUM1QixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHFDQUFRO2FBQVo7WUFDRSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUE7UUFDbkQsQ0FBQzs7O09BQUE7SUFFTyx1Q0FBYSxHQUFyQixVQUFzQixNQUFjO1FBQ2xDLElBQU0sT0FBTyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDakQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUE7UUFDMUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUN6QyxDQUFDO0lBRU8sMENBQWdCLEdBQXhCLFVBQXlCLE1BQWM7UUFDckMsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNqRCxJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUE7WUFDcEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsQ0FBQTtTQUMzQztJQUNILENBQUM7SUFFTyw4Q0FBb0IsR0FBNUI7UUFBQSxpQkFHQztRQUZDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQUEsT0FBTyxJQUFJLE9BQUEsS0FBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsRUFBMUMsQ0FBMEMsQ0FBQyxDQUFBO1FBQzVFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUMvQixDQUFDO0lBRUQsMEJBQTBCO0lBRTFCLDRDQUFrQixHQUFsQixVQUFtQixLQUFZO1FBQzdCLElBQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDckMsSUFBSSxNQUFNLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDeEMsT0FBTyxNQUFNLENBQUE7U0FDZDtJQUNILENBQUM7SUFFRCw2Q0FBbUIsR0FBbkIsVUFBb0IsT0FBZ0IsRUFBRSxNQUFjO1FBQ2xELElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDNUIsQ0FBQztJQUVELCtDQUFxQixHQUFyQixVQUFzQixPQUFnQixFQUFFLE1BQWM7UUFDcEQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQy9CLENBQUM7SUFDSCxzQkFBQztBQUFELENBQUMsQUFsRkQsSUFrRkMifQ==","import { BindingObserver } from \"./binding_observer\";\nvar Context = /** @class */ (function () {\n    function Context(module, scope) {\n        this.module = module;\n        this.scope = scope;\n        this.controller = new module.controllerConstructor(this);\n        this.bindingObserver = new BindingObserver(this, this.dispatcher);\n        try {\n            this.controller.initialize();\n        }\n        catch (error) {\n            this.handleError(error, \"initializing controller\");\n        }\n    }\n    Context.prototype.connect = function () {\n        this.bindingObserver.start();\n        try {\n            this.controller.connect();\n        }\n        catch (error) {\n            this.handleError(error, \"connecting controller\");\n        }\n    };\n    Context.prototype.disconnect = function () {\n        try {\n            this.controller.disconnect();\n        }\n        catch (error) {\n            this.handleError(error, \"disconnecting controller\");\n        }\n        this.bindingObserver.stop();\n    };\n    Object.defineProperty(Context.prototype, \"application\", {\n        get: function () {\n            return this.module.application;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"identifier\", {\n        get: function () {\n            return this.module.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"schema\", {\n        get: function () {\n            return this.application.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"dispatcher\", {\n        get: function () {\n            return this.application.dispatcher;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"parentElement\", {\n        get: function () {\n            return this.element.parentElement;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Error handling\n    Context.prototype.handleError = function (error, message, detail) {\n        if (detail === void 0) { detail = {}; }\n        var _a = this, identifier = _a.identifier, controller = _a.controller, element = _a.element;\n        detail = Object.assign({ identifier: identifier, controller: controller, element: element }, detail);\n        this.application.handleError(error, \"Error \" + message, detail);\n    };\n    return Context;\n}());\nexport { Context };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250ZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQVFwRDtJQU1FLGlCQUFZLE1BQWMsRUFBRSxLQUFZO1FBQ3RDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO1FBQ2xCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxNQUFNLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDeEQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLGVBQWUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBRWpFLElBQUk7WUFDRixJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFBO1NBQzdCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSx5QkFBeUIsQ0FBQyxDQUFBO1NBQ25EO0lBQ0gsQ0FBQztJQUVELHlCQUFPLEdBQVA7UUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxDQUFBO1FBRTVCLElBQUk7WUFDRixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFBO1NBQzFCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSx1QkFBdUIsQ0FBQyxDQUFBO1NBQ2pEO0lBQ0gsQ0FBQztJQUVELDRCQUFVLEdBQVY7UUFDRSxJQUFJO1lBQ0YsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQTtTQUM3QjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsMEJBQTBCLENBQUMsQ0FBQTtTQUNwRDtRQUVELElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUE7SUFDN0IsQ0FBQztJQUVELHNCQUFJLGdDQUFXO2FBQWY7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFBO1FBQ2hDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksK0JBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUE7UUFDL0IsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwyQkFBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQTtRQUNoQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLCtCQUFVO2FBQWQ7WUFDRSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFBO1FBQ3BDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksNEJBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUE7UUFDM0IsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSxrQ0FBYTthQUFqQjtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUE7UUFDbkMsQ0FBQzs7O09BQUE7SUFFRCxpQkFBaUI7SUFFakIsNkJBQVcsR0FBWCxVQUFZLEtBQVksRUFBRSxPQUFlLEVBQUUsTUFBbUI7UUFBbkIsdUJBQUEsRUFBQSxXQUFtQjtRQUN0RCxJQUFBLFNBQTBDLEVBQXhDLDBCQUFVLEVBQUUsMEJBQVUsRUFBRSxvQkFBTyxDQUFTO1FBQ2hELE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsVUFBVSxZQUFBLEVBQUUsVUFBVSxZQUFBLEVBQUUsT0FBTyxTQUFBLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQTtRQUNuRSxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsV0FBUyxPQUFTLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDakUsQ0FBQztJQUNILGNBQUM7QUFBRCxDQUFDLEFBdEVELElBc0VDIn0=","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/** @hidden */\nexport function blessDefinition(definition) {\n    return {\n        identifier: definition.identifier,\n        controllerConstructor: blessControllerConstructor(definition.controllerConstructor)\n    };\n}\nfunction blessControllerConstructor(controllerConstructor) {\n    var constructor = extend(controllerConstructor);\n    constructor.bless();\n    return constructor;\n}\nvar extend = (function () {\n    function extendWithReflect(constructor) {\n        function Controller() {\n            var _newTarget = this && this instanceof Controller ? this.constructor : void 0;\n            return Reflect.construct(constructor, arguments, _newTarget);\n        }\n        Controller.prototype = Object.create(constructor.prototype, {\n            constructor: { value: Controller }\n        });\n        Reflect.setPrototypeOf(Controller, constructor);\n        return Controller;\n    }\n    function testReflectExtension() {\n        var a = function () { this.a.call(this); };\n        var b = extendWithReflect(a);\n        b.prototype.a = function () { };\n        return new b;\n    }\n    try {\n        testReflectExtension();\n        return extendWithReflect;\n    }\n    catch (error) {\n        return function (constructor) { return /** @class */ (function (_super) {\n            __extends(Controller, _super);\n            function Controller() {\n                return _super !== null && _super.apply(this, arguments) || this;\n            }\n            return Controller;\n        }(constructor)); };\n    }\n})();\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVmaW5pdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kZWZpbml0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFPQSxjQUFjO0FBQ2QsTUFBTSwwQkFBMEIsVUFBc0I7SUFDcEQsT0FBTztRQUNMLFVBQVUsRUFBRSxVQUFVLENBQUMsVUFBVTtRQUNqQyxxQkFBcUIsRUFBRSwwQkFBMEIsQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUM7S0FDcEYsQ0FBQTtBQUNILENBQUM7QUFFRCxvQ0FBb0MscUJBQTRDO0lBQzlFLElBQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO0lBQ2pELFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUNuQixPQUFPLFdBQVcsQ0FBQTtBQUNwQixDQUFDO0FBRUQsSUFBTSxNQUFNLEdBQUcsQ0FBQztJQUdkLDJCQUFzRCxXQUFjO1FBQ2xFOztZQUNFLE9BQU8sT0FBTyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsU0FBUyxhQUFhLENBQUE7UUFDOUQsQ0FBQztRQUVELFVBQVUsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsU0FBUyxFQUFFO1lBQzFELFdBQVcsRUFBRSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUU7U0FDbkMsQ0FBQyxDQUFBO1FBRUYsT0FBTyxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDL0MsT0FBTyxVQUFpQixDQUFBO0lBQzFCLENBQUM7SUFFRDtRQUNFLElBQU0sQ0FBQyxHQUFHLGNBQXNCLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUMsQ0FBUSxDQUFBO1FBQzFELElBQU0sQ0FBQyxHQUFHLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQzlCLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLGNBQVksQ0FBQyxDQUFBO1FBQzdCLE9BQU8sSUFBSSxDQUFDLENBQUE7SUFDZCxDQUFDO0lBRUQsSUFBSTtRQUNGLG9CQUFvQixFQUFFLENBQUE7UUFDdEIsT0FBTyxpQkFBaUIsQ0FBQTtLQUN6QjtJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxVQUE0QixXQUFjLElBQUs7WUFBeUIsOEJBQVc7WUFBcEM7O1lBQXNDLENBQUM7WUFBRCxpQkFBQztRQUFELENBQUMsQUFBdkMsQ0FBeUIsV0FBVyxJQUFwQyxDQUF1QyxDQUFBO0tBQzlGO0FBQ0gsQ0FBQyxDQUFDLEVBQUUsQ0FBQSJ9","import { Context } from \"./context\";\nimport { blessDefinition } from \"./definition\";\nvar Module = /** @class */ (function () {\n    function Module(application, definition) {\n        this.application = application;\n        this.definition = blessDefinition(definition);\n        this.contextsByScope = new WeakMap;\n        this.connectedContexts = new Set;\n    }\n    Object.defineProperty(Module.prototype, \"identifier\", {\n        get: function () {\n            return this.definition.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Module.prototype, \"controllerConstructor\", {\n        get: function () {\n            return this.definition.controllerConstructor;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Module.prototype, \"contexts\", {\n        get: function () {\n            return Array.from(this.connectedContexts);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Module.prototype.connectContextForScope = function (scope) {\n        var context = this.fetchContextForScope(scope);\n        this.connectedContexts.add(context);\n        context.connect();\n    };\n    Module.prototype.disconnectContextForScope = function (scope) {\n        var context = this.contextsByScope.get(scope);\n        if (context) {\n            this.connectedContexts.delete(context);\n            context.disconnect();\n        }\n    };\n    Module.prototype.fetchContextForScope = function (scope) {\n        var context = this.contextsByScope.get(scope);\n        if (!context) {\n            context = new Context(this, scope);\n            this.contextsByScope.set(scope, context);\n        }\n        return context;\n    };\n    return Module;\n}());\nexport { Module };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kdWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21vZHVsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBRW5DLE9BQU8sRUFBYyxlQUFlLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFHMUQ7SUFNRSxnQkFBWSxXQUF3QixFQUFFLFVBQXNCO1FBQzFELElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFBO1FBQzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQzdDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxPQUFPLENBQUE7UUFDbEMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksR0FBRyxDQUFBO0lBQ2xDLENBQUM7SUFFRCxzQkFBSSw4QkFBVTthQUFkO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQTtRQUNuQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHlDQUFxQjthQUF6QjtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxxQkFBcUIsQ0FBQTtRQUM5QyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDRCQUFRO2FBQVo7WUFDRSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFDM0MsQ0FBQzs7O09BQUE7SUFFRCx1Q0FBc0IsR0FBdEIsVUFBdUIsS0FBWTtRQUNqQyxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDaEQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNuQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDbkIsQ0FBQztJQUVELDBDQUF5QixHQUF6QixVQUEwQixLQUFZO1FBQ3BDLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQy9DLElBQUksT0FBTyxFQUFFO1lBQ1gsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUN0QyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUE7U0FDckI7SUFDSCxDQUFDO0lBRU8scUNBQW9CLEdBQTVCLFVBQTZCLEtBQVk7UUFDdkMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDN0MsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNaLE9BQU8sR0FBRyxJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDbEMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1NBQ3pDO1FBQ0QsT0FBTyxPQUFPLENBQUE7SUFDaEIsQ0FBQztJQUNILGFBQUM7QUFBRCxDQUFDLEFBL0NELElBK0NDIn0=","var DataMap = /** @class */ (function () {\n    function DataMap(scope) {\n        this.scope = scope;\n    }\n    Object.defineProperty(DataMap.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataMap.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DataMap.prototype.get = function (key) {\n        key = this.getFormattedKey(key);\n        return this.element.getAttribute(key);\n    };\n    DataMap.prototype.set = function (key, value) {\n        key = this.getFormattedKey(key);\n        this.element.setAttribute(key, value);\n        return this.get(key);\n    };\n    DataMap.prototype.has = function (key) {\n        key = this.getFormattedKey(key);\n        return this.element.hasAttribute(key);\n    };\n    DataMap.prototype.delete = function (key) {\n        if (this.has(key)) {\n            key = this.getFormattedKey(key);\n            this.element.removeAttribute(key);\n            return true;\n        }\n        else {\n            return false;\n        }\n    };\n    DataMap.prototype.getFormattedKey = function (key) {\n        return \"data-\" + this.identifier + \"-\" + dasherize(key);\n    };\n    return DataMap;\n}());\nexport { DataMap };\nfunction dasherize(value) {\n    return value.replace(/([A-Z])/g, function (_, char) { return \"-\" + char.toLowerCase(); });\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YV9tYXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGF0YV9tYXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUE7SUFHRSxpQkFBWSxLQUFZO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO0lBQ3BCLENBQUM7SUFFRCxzQkFBSSw0QkFBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQTtRQUMzQixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLCtCQUFVO2FBQWQ7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFBO1FBQzlCLENBQUM7OztPQUFBO0lBRUQscUJBQUcsR0FBSCxVQUFJLEdBQVc7UUFDYixHQUFHLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUMvQixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3ZDLENBQUM7SUFFRCxxQkFBRyxHQUFILFVBQUksR0FBVyxFQUFFLEtBQWE7UUFDNUIsR0FBRyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3JDLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUN0QixDQUFDO0lBRUQscUJBQUcsR0FBSCxVQUFJLEdBQVc7UUFDYixHQUFHLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUMvQixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3ZDLENBQUM7SUFFRCx3QkFBTSxHQUFOLFVBQU8sR0FBVztRQUNoQixJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDakIsR0FBRyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDakMsT0FBTyxJQUFJLENBQUE7U0FDWjthQUFNO1lBQ0wsT0FBTyxLQUFLLENBQUE7U0FDYjtJQUNILENBQUM7SUFFTyxpQ0FBZSxHQUF2QixVQUF3QixHQUFXO1FBQ2pDLE9BQU8sVUFBUSxJQUFJLENBQUMsVUFBVSxTQUFJLFNBQVMsQ0FBQyxHQUFHLENBQUcsQ0FBQTtJQUNwRCxDQUFDO0lBQ0gsY0FBQztBQUFELENBQUMsQUE1Q0QsSUE0Q0M7O0FBRUQsbUJBQW1CLEtBQWE7SUFDOUIsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxVQUFDLENBQUMsRUFBRSxJQUFJLElBQUssT0FBQSxNQUFJLElBQUksQ0FBQyxXQUFXLEVBQUksRUFBeEIsQ0FBd0IsQ0FBQyxDQUFBO0FBQ3pFLENBQUMifQ==","/** @hidden */\nexport function attributeValueContainsToken(attributeName, token) {\n    return \"[\" + attributeName + \"~=\\\"\" + token + \"\\\"]\";\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0b3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlbGVjdG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxjQUFjO0FBQ2QsTUFBTSxzQ0FBc0MsYUFBcUIsRUFBRSxLQUFhO0lBQzlFLE9BQU8sTUFBSSxhQUFhLFlBQU0sS0FBSyxRQUFJLENBQUE7QUFDekMsQ0FBQyJ9","import { attributeValueContainsToken } from \"./selectors\";\nvar TargetSet = /** @class */ (function () {\n    function TargetSet(scope) {\n        this.scope = scope;\n    }\n    Object.defineProperty(TargetSet.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TargetSet.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TargetSet.prototype, \"schema\", {\n        get: function () {\n            return this.scope.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TargetSet.prototype.has = function (targetName) {\n        return this.find(targetName) != null;\n    };\n    TargetSet.prototype.find = function () {\n        var targetNames = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            targetNames[_i] = arguments[_i];\n        }\n        var selector = this.getSelectorForTargetNames(targetNames);\n        return this.scope.findElement(selector);\n    };\n    TargetSet.prototype.findAll = function () {\n        var targetNames = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            targetNames[_i] = arguments[_i];\n        }\n        var selector = this.getSelectorForTargetNames(targetNames);\n        return this.scope.findAllElements(selector);\n    };\n    TargetSet.prototype.getSelectorForTargetNames = function (targetNames) {\n        var _this = this;\n        return targetNames.map(function (targetName) { return _this.getSelectorForTargetName(targetName); }).join(\", \");\n    };\n    TargetSet.prototype.getSelectorForTargetName = function (targetName) {\n        var targetDescriptor = this.identifier + \".\" + targetName;\n        return attributeValueContainsToken(this.schema.targetAttribute, targetDescriptor);\n    };\n    return TargetSet;\n}());\nexport { TargetSet };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFyZ2V0X3NldC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90YXJnZXRfc2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUV6RDtJQUdFLG1CQUFZLEtBQVk7UUFDdEIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUE7SUFDcEIsQ0FBQztJQUVELHNCQUFJLDhCQUFPO2FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBQzNCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksaUNBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUE7UUFDOUIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw2QkFBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQTtRQUMxQixDQUFDOzs7T0FBQTtJQUVELHVCQUFHLEdBQUgsVUFBSSxVQUFrQjtRQUNwQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksSUFBSSxDQUFBO0lBQ3RDLENBQUM7SUFFRCx3QkFBSSxHQUFKO1FBQUsscUJBQXdCO2FBQXhCLFVBQXdCLEVBQXhCLHFCQUF3QixFQUF4QixJQUF3QjtZQUF4QixnQ0FBd0I7O1FBQzNCLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUM1RCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7SUFFRCwyQkFBTyxHQUFQO1FBQVEscUJBQXdCO2FBQXhCLFVBQXdCLEVBQXhCLHFCQUF3QixFQUF4QixJQUF3QjtZQUF4QixnQ0FBd0I7O1FBQzlCLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUM1RCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQzdDLENBQUM7SUFFTyw2Q0FBeUIsR0FBakMsVUFBa0MsV0FBcUI7UUFBdkQsaUJBRUM7UUFEQyxPQUFPLFdBQVcsQ0FBQyxHQUFHLENBQUMsVUFBQSxVQUFVLElBQUksT0FBQSxLQUFJLENBQUMsd0JBQXdCLENBQUMsVUFBVSxDQUFDLEVBQXpDLENBQXlDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDNUYsQ0FBQztJQUVPLDRDQUF3QixHQUFoQyxVQUFpQyxVQUFrQjtRQUNqRCxJQUFNLGdCQUFnQixHQUFNLElBQUksQ0FBQyxVQUFVLFNBQUksVUFBWSxDQUFBO1FBQzNELE9BQU8sMkJBQTJCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQTtJQUNuRixDQUFDO0lBQ0gsZ0JBQUM7QUFBRCxDQUFDLEFBekNELElBeUNDIn0=","import { DataMap } from \"./data_map\";\nimport { TargetSet } from \"./target_set\";\nimport { attributeValueContainsToken } from \"./selectors\";\nvar Scope = /** @class */ (function () {\n    function Scope(schema, identifier, element) {\n        this.schema = schema;\n        this.identifier = identifier;\n        this.element = element;\n        this.targets = new TargetSet(this);\n        this.data = new DataMap(this);\n    }\n    Scope.prototype.findElement = function (selector) {\n        return this.findAllElements(selector)[0];\n    };\n    Scope.prototype.findAllElements = function (selector) {\n        var head = this.element.matches(selector) ? [this.element] : [];\n        var tail = this.filterElements(Array.from(this.element.querySelectorAll(selector)));\n        return head.concat(tail);\n    };\n    Scope.prototype.filterElements = function (elements) {\n        var _this = this;\n        return elements.filter(function (element) { return _this.containsElement(element); });\n    };\n    Scope.prototype.containsElement = function (element) {\n        return element.closest(this.controllerSelector) === this.element;\n    };\n    Object.defineProperty(Scope.prototype, \"controllerSelector\", {\n        get: function () {\n            return attributeValueContainsToken(this.schema.controllerAttribute, this.identifier);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Scope;\n}());\nexport { Scope };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NvcGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2NvcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUVwQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBQ3hDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUV6RDtJQU9FLGVBQVksTUFBYyxFQUFFLFVBQWtCLEVBQUUsT0FBZ0I7UUFDOUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUE7UUFDcEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUE7UUFDNUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7UUFDdEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUNsQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQy9CLENBQUM7SUFFRCwyQkFBVyxHQUFYLFVBQVksUUFBZ0I7UUFDMUIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQzFDLENBQUM7SUFFRCwrQkFBZSxHQUFmLFVBQWdCLFFBQWdCO1FBQzlCLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBO1FBQ2pFLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNyRixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDMUIsQ0FBQztJQUVELDhCQUFjLEdBQWQsVUFBZSxRQUFtQjtRQUFsQyxpQkFFQztRQURDLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLEtBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLEVBQTdCLENBQTZCLENBQUMsQ0FBQTtJQUNsRSxDQUFDO0lBRUQsK0JBQWUsR0FBZixVQUFnQixPQUFnQjtRQUM5QixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQTtJQUNsRSxDQUFDO0lBRUQsc0JBQVkscUNBQWtCO2FBQTlCO1lBQ0UsT0FBTywyQkFBMkIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUN0RixDQUFDOzs7T0FBQTtJQUNILFlBQUM7QUFBRCxDQUFDLEFBcENELElBb0NDIn0=","import { Scope } from \"./scope\";\nimport { ValueListObserver } from \"@stimulus/mutation-observers\";\nvar ScopeObserver = /** @class */ (function () {\n    function ScopeObserver(element, schema, delegate) {\n        this.element = element;\n        this.schema = schema;\n        this.delegate = delegate;\n        this.valueListObserver = new ValueListObserver(this.element, this.controllerAttribute, this);\n        this.scopesByIdentifierByElement = new WeakMap;\n        this.scopeReferenceCounts = new WeakMap;\n    }\n    ScopeObserver.prototype.start = function () {\n        this.valueListObserver.start();\n    };\n    ScopeObserver.prototype.stop = function () {\n        this.valueListObserver.stop();\n    };\n    Object.defineProperty(ScopeObserver.prototype, \"controllerAttribute\", {\n        get: function () {\n            return this.schema.controllerAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Value observer delegate\n    /** @hidden */\n    ScopeObserver.prototype.parseValueForToken = function (token) {\n        var element = token.element, identifier = token.content;\n        var scopesByIdentifier = this.fetchScopesByIdentifierForElement(element);\n        var scope = scopesByIdentifier.get(identifier);\n        if (!scope) {\n            scope = new Scope(this.schema, identifier, element);\n            scopesByIdentifier.set(identifier, scope);\n        }\n        return scope;\n    };\n    /** @hidden */\n    ScopeObserver.prototype.elementMatchedValue = function (element, value) {\n        var referenceCount = (this.scopeReferenceCounts.get(value) || 0) + 1;\n        this.scopeReferenceCounts.set(value, referenceCount);\n        if (referenceCount == 1) {\n            this.delegate.scopeConnected(value);\n        }\n    };\n    /** @hidden */\n    ScopeObserver.prototype.elementUnmatchedValue = function (element, value) {\n        var referenceCount = this.scopeReferenceCounts.get(value);\n        if (referenceCount) {\n            this.scopeReferenceCounts.set(value, referenceCount - 1);\n            if (referenceCount == 1) {\n                this.delegate.scopeDisconnected(value);\n            }\n        }\n    };\n    ScopeObserver.prototype.fetchScopesByIdentifierForElement = function (element) {\n        var scopesByIdentifier = this.scopesByIdentifierByElement.get(element);\n        if (!scopesByIdentifier) {\n            scopesByIdentifier = new Map;\n            this.scopesByIdentifierByElement.set(element, scopesByIdentifier);\n        }\n        return scopesByIdentifier;\n    };\n    return ScopeObserver;\n}());\nexport { ScopeObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NvcGVfb2JzZXJ2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2NvcGVfb2JzZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFNBQVMsQ0FBQTtBQUMvQixPQUFPLEVBQVMsaUJBQWlCLEVBQTZCLE1BQU0sOEJBQThCLENBQUE7QUFPbEc7SUFRRSx1QkFBWSxPQUFnQixFQUFFLE1BQWMsRUFBRSxRQUErQjtRQUMzRSxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQTtRQUN0QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtRQUNwQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUN4QixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUM1RixJQUFJLENBQUMsMkJBQTJCLEdBQUcsSUFBSSxPQUFPLENBQUE7UUFDOUMsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksT0FBTyxDQUFBO0lBQ3pDLENBQUM7SUFFRCw2QkFBSyxHQUFMO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxDQUFBO0lBQ2hDLENBQUM7SUFFRCw0QkFBSSxHQUFKO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxDQUFBO0lBQy9CLENBQUM7SUFFRCxzQkFBSSw4Q0FBbUI7YUFBdkI7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUE7UUFDeEMsQ0FBQzs7O09BQUE7SUFFRCwwQkFBMEI7SUFFMUIsY0FBYztJQUNkLDBDQUFrQixHQUFsQixVQUFtQixLQUFZO1FBQ3JCLElBQUEsdUJBQU8sRUFBRSwwQkFBbUIsQ0FBVTtRQUM5QyxJQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxpQ0FBaUMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUUxRSxJQUFJLEtBQUssR0FBRyxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDOUMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQTtZQUNuRCxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFBO1NBQzFDO1FBRUQsT0FBTyxLQUFLLENBQUE7SUFDZCxDQUFDO0lBRUQsY0FBYztJQUNkLDJDQUFtQixHQUFuQixVQUFvQixPQUFnQixFQUFFLEtBQVk7UUFDaEQsSUFBTSxjQUFjLEdBQUcsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN0RSxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxjQUFjLENBQUMsQ0FBQTtRQUNwRCxJQUFJLGNBQWMsSUFBSSxDQUFDLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDcEM7SUFDSCxDQUFDO0lBRUQsY0FBYztJQUNkLDZDQUFxQixHQUFyQixVQUFzQixPQUFnQixFQUFFLEtBQVk7UUFDbEQsSUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUMzRCxJQUFJLGNBQWMsRUFBRTtZQUNsQixJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxjQUFjLEdBQUcsQ0FBQyxDQUFDLENBQUE7WUFDeEQsSUFBSSxjQUFjLElBQUksQ0FBQyxFQUFFO2dCQUN2QixJQUFJLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3ZDO1NBQ0Y7SUFDSCxDQUFDO0lBRU8seURBQWlDLEdBQXpDLFVBQTBDLE9BQWdCO1FBQ3hELElBQUksa0JBQWtCLEdBQUcsSUFBSSxDQUFDLDJCQUEyQixDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUN0RSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDdkIsa0JBQWtCLEdBQUcsSUFBSSxHQUFHLENBQUE7WUFDNUIsSUFBSSxDQUFDLDJCQUEyQixDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLENBQUMsQ0FBQTtTQUNsRTtRQUNELE9BQU8sa0JBQWtCLENBQUE7SUFDM0IsQ0FBQztJQUNILG9CQUFDO0FBQUQsQ0FBQyxBQXpFRCxJQXlFQyJ9","import { Module } from \"./module\";\nimport { Multimap } from \"@stimulus/multimap\";\nimport { ScopeObserver } from \"./scope_observer\";\nvar Router = /** @class */ (function () {\n    function Router(application) {\n        this.application = application;\n        this.scopeObserver = new ScopeObserver(this.element, this.schema, this);\n        this.scopesByIdentifier = new Multimap;\n        this.modulesByIdentifier = new Map;\n    }\n    Object.defineProperty(Router.prototype, \"element\", {\n        get: function () {\n            return this.application.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"schema\", {\n        get: function () {\n            return this.application.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"controllerAttribute\", {\n        get: function () {\n            return this.schema.controllerAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"modules\", {\n        get: function () {\n            return Array.from(this.modulesByIdentifier.values());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"contexts\", {\n        get: function () {\n            return this.modules.reduce(function (contexts, module) { return contexts.concat(module.contexts); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Router.prototype.start = function () {\n        this.scopeObserver.start();\n    };\n    Router.prototype.stop = function () {\n        this.scopeObserver.stop();\n    };\n    Router.prototype.loadDefinition = function (definition) {\n        this.unloadIdentifier(definition.identifier);\n        var module = new Module(this.application, definition);\n        this.connectModule(module);\n    };\n    Router.prototype.unloadIdentifier = function (identifier) {\n        var module = this.modulesByIdentifier.get(identifier);\n        if (module) {\n            this.disconnectModule(module);\n        }\n    };\n    Router.prototype.getContextForElementAndIdentifier = function (element, identifier) {\n        var module = this.modulesByIdentifier.get(identifier);\n        if (module) {\n            return module.contexts.find(function (context) { return context.element == element; });\n        }\n    };\n    // Error handler delegate\n    /** @hidden */\n    Router.prototype.handleError = function (error, message, detail) {\n        this.application.handleError(error, message, detail);\n    };\n    // Scope observer delegate\n    /** @hidden */\n    Router.prototype.scopeConnected = function (scope) {\n        this.scopesByIdentifier.add(scope.identifier, scope);\n        var module = this.modulesByIdentifier.get(scope.identifier);\n        if (module) {\n            module.connectContextForScope(scope);\n        }\n    };\n    /** @hidden */\n    Router.prototype.scopeDisconnected = function (scope) {\n        this.scopesByIdentifier.delete(scope.identifier, scope);\n        var module = this.modulesByIdentifier.get(scope.identifier);\n        if (module) {\n            module.disconnectContextForScope(scope);\n        }\n    };\n    // Modules\n    Router.prototype.connectModule = function (module) {\n        this.modulesByIdentifier.set(module.identifier, module);\n        var scopes = this.scopesByIdentifier.getValuesForKey(module.identifier);\n        scopes.forEach(function (scope) { return module.connectContextForScope(scope); });\n    };\n    Router.prototype.disconnectModule = function (module) {\n        this.modulesByIdentifier.delete(module.identifier);\n        var scopes = this.scopesByIdentifier.getValuesForKey(module.identifier);\n        scopes.forEach(function (scope) { return module.disconnectContextForScope(scope); });\n    };\n    return Router;\n}());\nexport { Router };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JvdXRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2pDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUc3QyxPQUFPLEVBQUUsYUFBYSxFQUF5QixNQUFNLGtCQUFrQixDQUFBO0FBRXZFO0lBTUUsZ0JBQVksV0FBd0I7UUFDbEMsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUE7UUFDOUIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLGFBQWEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDdkUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksUUFBUSxDQUFBO1FBQ3RDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLEdBQUcsQ0FBQTtJQUNwQyxDQUFDO0lBRUQsc0JBQUksMkJBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUE7UUFDakMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwwQkFBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQTtRQUNoQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHVDQUFtQjthQUF2QjtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQTtRQUN4QyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDJCQUFPO2FBQVg7WUFDRSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUE7UUFDdEQsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw0QkFBUTthQUFaO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFDLFFBQVEsRUFBRSxNQUFNLElBQUssT0FBQSxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBaEMsQ0FBZ0MsRUFBRSxFQUFlLENBQUMsQ0FBQTtRQUNyRyxDQUFDOzs7T0FBQTtJQUVELHNCQUFLLEdBQUw7UUFDRSxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxDQUFBO0lBQzVCLENBQUM7SUFFRCxxQkFBSSxHQUFKO1FBQ0UsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUMzQixDQUFDO0lBRUQsK0JBQWMsR0FBZCxVQUFlLFVBQXNCO1FBQ25DLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDNUMsSUFBTSxNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxVQUFVLENBQUMsQ0FBQTtRQUN2RCxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQzVCLENBQUM7SUFFRCxpQ0FBZ0IsR0FBaEIsVUFBaUIsVUFBa0I7UUFDakMsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUN2RCxJQUFJLE1BQU0sRUFBRTtZQUNWLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQTtTQUM5QjtJQUNILENBQUM7SUFFRCxrREFBaUMsR0FBakMsVUFBa0MsT0FBZ0IsRUFBRSxVQUFrQjtRQUNwRSxJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQ3ZELElBQUksTUFBTSxFQUFFO1lBQ1YsT0FBTyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLE9BQU8sQ0FBQyxPQUFPLElBQUksT0FBTyxFQUExQixDQUEwQixDQUFDLENBQUE7U0FDbkU7SUFDSCxDQUFDO0lBRUQseUJBQXlCO0lBRXpCLGNBQWM7SUFDZCw0QkFBVyxHQUFYLFVBQVksS0FBWSxFQUFFLE9BQWUsRUFBRSxNQUFXO1FBQ3BELElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDdEQsQ0FBQztJQUVELDBCQUEwQjtJQUUxQixjQUFjO0lBQ2QsK0JBQWMsR0FBZCxVQUFlLEtBQVk7UUFDekIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3BELElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQzdELElBQUksTUFBTSxFQUFFO1lBQ1YsTUFBTSxDQUFDLHNCQUFzQixDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQ3JDO0lBQ0gsQ0FBQztJQUVELGNBQWM7SUFDZCxrQ0FBaUIsR0FBakIsVUFBa0IsS0FBWTtRQUM1QixJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDdkQsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDN0QsSUFBSSxNQUFNLEVBQUU7WUFDVixNQUFNLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDeEM7SUFDSCxDQUFDO0lBRUQsVUFBVTtJQUVGLDhCQUFhLEdBQXJCLFVBQXNCLE1BQWM7UUFDbEMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQ3ZELElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQ3pFLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxNQUFNLENBQUMsc0JBQXNCLENBQUMsS0FBSyxDQUFDLEVBQXBDLENBQW9DLENBQUMsQ0FBQTtJQUMvRCxDQUFDO0lBRU8saUNBQWdCLEdBQXhCLFVBQXlCLE1BQWM7UUFDckMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDbEQsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDekUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsRUFBdkMsQ0FBdUMsQ0FBQyxDQUFBO0lBQ2xFLENBQUM7SUFDSCxhQUFDO0FBQUQsQ0FBQyxBQXJHRCxJQXFHQyJ9","export var defaultSchema = {\n    controllerAttribute: \"data-controller\",\n    actionAttribute: \"data-action\",\n    targetAttribute: \"data-target\"\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZW1hLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NjaGVtYS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFNQSxNQUFNLENBQUMsSUFBTSxhQUFhLEdBQVc7SUFDbkMsbUJBQW1CLEVBQUUsaUJBQWlCO0lBQ3RDLGVBQWUsRUFBRSxhQUFhO0lBQzlCLGVBQWUsRUFBRSxhQUFhO0NBQy9CLENBQUEifQ==","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { Dispatcher } from \"./dispatcher\";\nimport { Router } from \"./router\";\nimport { defaultSchema } from \"./schema\";\nvar Application = /** @class */ (function () {\n    function Application(element, schema) {\n        if (element === void 0) { element = document.documentElement; }\n        if (schema === void 0) { schema = defaultSchema; }\n        this.element = element;\n        this.schema = schema;\n        this.dispatcher = new Dispatcher(this);\n        this.router = new Router(this);\n    }\n    Application.start = function (element, schema) {\n        var application = new Application(element, schema);\n        application.start();\n        return application;\n    };\n    Application.prototype.start = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, domReady()];\n                    case 1:\n                        _a.sent();\n                        this.router.start();\n                        this.dispatcher.start();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Application.prototype.stop = function () {\n        this.router.stop();\n        this.dispatcher.stop();\n    };\n    Application.prototype.register = function (identifier, controllerConstructor) {\n        this.load({ identifier: identifier, controllerConstructor: controllerConstructor });\n    };\n    Application.prototype.load = function (head) {\n        var _this = this;\n        var rest = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            rest[_i - 1] = arguments[_i];\n        }\n        var definitions = Array.isArray(head) ? head : [head].concat(rest);\n        definitions.forEach(function (definition) { return _this.router.loadDefinition(definition); });\n    };\n    Application.prototype.unload = function (head) {\n        var _this = this;\n        var rest = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            rest[_i - 1] = arguments[_i];\n        }\n        var identifiers = Array.isArray(head) ? head : [head].concat(rest);\n        identifiers.forEach(function (identifier) { return _this.router.unloadIdentifier(identifier); });\n    };\n    Object.defineProperty(Application.prototype, \"controllers\", {\n        // Controllers\n        get: function () {\n            return this.router.contexts.map(function (context) { return context.controller; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Application.prototype.getControllerForElementAndIdentifier = function (element, identifier) {\n        var context = this.router.getContextForElementAndIdentifier(element, identifier);\n        return context ? context.controller : null;\n    };\n    // Error handling\n    Application.prototype.handleError = function (error, message, detail) {\n        console.error(\"%s\\n\\n%o\\n\\n%o\", message, error, detail);\n    };\n    return Application;\n}());\nexport { Application };\nfunction domReady() {\n    return new Promise(function (resolve) {\n        if (document.readyState == \"loading\") {\n            document.addEventListener(\"DOMContentLoaded\", resolve);\n        }\n        else {\n            resolve();\n        }\n    });\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwbGljYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYXBwbGljYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBRXpDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDakMsT0FBTyxFQUFVLGFBQWEsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUVoRDtJQVlFLHFCQUFZLE9BQTJDLEVBQUUsTUFBOEI7UUFBM0Usd0JBQUEsRUFBQSxVQUFtQixRQUFRLENBQUMsZUFBZTtRQUFFLHVCQUFBLEVBQUEsc0JBQThCO1FBQ3JGLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDdEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNoQyxDQUFDO0lBWE0saUJBQUssR0FBWixVQUFhLE9BQWlCLEVBQUUsTUFBZTtRQUM3QyxJQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDcEQsV0FBVyxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQ25CLE9BQU8sV0FBVyxDQUFBO0lBQ3BCLENBQUM7SUFTSywyQkFBSyxHQUFYOzs7OzRCQUNFLHFCQUFNLFFBQVEsRUFBRSxFQUFBOzt3QkFBaEIsU0FBZ0IsQ0FBQTt3QkFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQTt3QkFDbkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQTs7Ozs7S0FDeEI7SUFFRCwwQkFBSSxHQUFKO1FB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","/** @hidden */\nexport function defineTargetProperties(constructor) {\n    var prototype = constructor.prototype;\n    var targetNames = getTargetNamesForConstructor(constructor);\n    targetNames.forEach(function (name) {\n        var _a;\n        return defineLinkedProperties(prototype, (_a = {},\n            _a[name + \"Target\"] = {\n                get: function () {\n                    var target = this.targets.find(name);\n                    if (target) {\n                        return target;\n                    }\n                    else {\n                        throw new Error(\"Missing target element \\\"\" + this.identifier + \".\" + name + \"\\\"\");\n                    }\n                }\n            },\n            _a[name + \"Targets\"] = {\n                get: function () {\n                    return this.targets.findAll(name);\n                }\n            },\n            _a[\"has\" + capitalize(name) + \"Target\"] = {\n                get: function () {\n                    return this.targets.has(name);\n                }\n            },\n            _a));\n    });\n}\nfunction getTargetNamesForConstructor(constructor) {\n    var ancestors = getAncestorsForConstructor(constructor);\n    return Array.from(ancestors.reduce(function (targetNames, constructor) {\n        getOwnTargetNamesForConstructor(constructor).forEach(function (name) { return targetNames.add(name); });\n        return targetNames;\n    }, new Set));\n}\nfunction getAncestorsForConstructor(constructor) {\n    var ancestors = [];\n    while (constructor) {\n        ancestors.push(constructor);\n        constructor = Object.getPrototypeOf(constructor);\n    }\n    return ancestors;\n}\nfunction getOwnTargetNamesForConstructor(constructor) {\n    var definition = constructor[\"targets\"];\n    return Array.isArray(definition) ? definition : [];\n}\nfunction defineLinkedProperties(object, properties) {\n    Object.keys(properties).forEach(function (name) {\n        if (!(name in object)) {\n            var descriptor = properties[name];\n            Object.defineProperty(object, name, descriptor);\n        }\n    });\n}\nfunction capitalize(name) {\n    return name.charAt(0).toUpperCase() + name.slice(1);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFyZ2V0X3Byb3BlcnRpZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGFyZ2V0X3Byb3BlcnRpZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsY0FBYztBQUNkLE1BQU0saUNBQWlDLFdBQXFCO0lBQzFELElBQU0sU0FBUyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUE7SUFDdkMsSUFBTSxXQUFXLEdBQUcsNEJBQTRCLENBQUMsV0FBVyxDQUFDLENBQUE7SUFDN0QsV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUk7O1FBQUksT0FBQSxzQkFBc0IsQ0FBQyxTQUFTO1lBQzFELEdBQUksSUFBSSxXQUFRLElBQUc7Z0JBQ2pCLEdBQUc7b0JBQ0QsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7b0JBQ3RDLElBQUksTUFBTSxFQUFFO3dCQUNWLE9BQU8sTUFBTSxDQUFBO3FCQUNkO3lCQUFNO3dCQUNMLE1BQU0sSUFBSSxLQUFLLENBQUMsOEJBQTJCLElBQUksQ0FBQyxVQUFVLFNBQUksSUFBSSxPQUFHLENBQUMsQ0FBQTtxQkFDdkU7Z0JBQ0gsQ0FBQzthQUNGO1lBQ0QsR0FBSSxJQUFJLFlBQVMsSUFBRztnQkFDbEIsR0FBRztvQkFDRCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO2dCQUNuQyxDQUFDO2FBQ0Y7WUFDRCxHQUFDLFFBQU0sVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFRLElBQUc7Z0JBQ2hDLEdBQUc7b0JBQ0QsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtnQkFDL0IsQ0FBQzthQUNGO2dCQUNEO0lBckIwQixDQXFCMUIsQ0FBQyxDQUFBO0FBQ0wsQ0FBQztBQUVELHNDQUFzQyxXQUFxQjtJQUN6RCxJQUFNLFNBQVMsR0FBRywwQkFBMEIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtJQUN6RCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFDLFdBQVcsRUFBRSxXQUFXO1FBQzFELCtCQUErQixDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQXJCLENBQXFCLENBQUMsQ0FBQTtRQUNuRixPQUFPLFdBQVcsQ0FBQTtJQUNwQixDQUFDLEVBQUUsSUFBSSxHQUFrQixDQUFDLENBQUMsQ0FBQTtBQUM3QixDQUFDO0FBRUQsb0NBQW9DLFdBQXFCO0lBQ3ZELElBQU0sU0FBUyxHQUFlLEVBQUUsQ0FBQTtJQUNoQyxPQUFPLFdBQVcsRUFBRTtRQUNsQixTQUFTLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQzNCLFdBQVcsR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFBO0tBQ2pEO0lBQ0QsT0FBTyxTQUFTLENBQUE7QUFDbEIsQ0FBQztBQUVELHlDQUF5QyxXQUFxQjtJQUM1RCxJQUFNLFVBQVUsR0FBSSxXQUFtQixDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBQ2xELE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUE7QUFDcEQsQ0FBQztBQUVELGdDQUFnQyxNQUFXLEVBQUUsVUFBaUM7SUFDNUUsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxJQUFJO1FBQ25DLElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxNQUFNLENBQUMsRUFBRTtZQUNyQixJQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDbkMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFBO1NBQ2hEO0lBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDO0FBRUQsb0JBQW9CLElBQVk7SUFDOUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDckQsQ0FBQyJ9","import { defineTargetProperties } from \"./target_properties\";\nvar Controller = /** @class */ (function () {\n    function Controller(context) {\n        this.context = context;\n    }\n    Controller.bless = function () {\n        defineTargetProperties(this);\n    };\n    Object.defineProperty(Controller.prototype, \"application\", {\n        get: function () {\n            return this.context.application;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"scope\", {\n        get: function () {\n            return this.context.scope;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"targets\", {\n        get: function () {\n            return this.scope.targets;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"data\", {\n        get: function () {\n            return this.scope.data;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Controller.prototype.initialize = function () {\n        // Override in your subclass to set up initial controller state\n    };\n    Controller.prototype.connect = function () {\n        // Override in your subclass to respond when the controller is connected to the DOM\n    };\n    Controller.prototype.disconnect = function () {\n        // Override in your subclass to respond when the controller is disconnected from the DOM\n    };\n    Controller.targets = [];\n    return Controller;\n}());\nexport { Controller };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBTzVEO0lBU0Usb0JBQVksT0FBZ0I7UUFDMUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7SUFDeEIsQ0FBQztJQU5NLGdCQUFLLEdBQVo7UUFDRSxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM5QixDQUFDO0lBTUQsc0JBQUksbUNBQVc7YUFBZjtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUE7UUFDakMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw2QkFBSzthQUFUO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQTtRQUMzQixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLCtCQUFPO2FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBQzNCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksa0NBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUE7UUFDOUIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwrQkFBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQTtRQUMzQixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDRCQUFJO2FBQVI7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFBO1FBQ3hCLENBQUM7OztPQUFBO0lBRUQsK0JBQVUsR0FBVjtRQUNFLCtEQUErRDtJQUNqRSxDQUFDO0lBRUQsNEJBQU8sR0FBUDtRQUNFLG1GQUFtRjtJQUNyRixDQUFDO0lBRUQsK0JBQVUsR0FBVjtRQUNFLHdGQUF3RjtJQUMxRixDQUFDO0lBOUNNLGtCQUFPLEdBQWEsRUFBRSxDQUFBO0lBK0MvQixpQkFBQztDQUFBLEFBaERELElBZ0RDO1NBaERZLFVBQVUifQ==","var DOCUMENT_FRAGMENT_NODE = 11;\n\nfunction morphAttrs(fromNode, toNode) {\n    var toNodeAttrs = toNode.attributes;\n    var attr;\n    var attrName;\n    var attrNamespaceURI;\n    var attrValue;\n    var fromValue;\n\n    // document-fragments dont have attributes so lets not do anything\n    if (toNode.nodeType === DOCUMENT_FRAGMENT_NODE || fromNode.nodeType === DOCUMENT_FRAGMENT_NODE) {\n      return;\n    }\n\n    // update attributes on original DOM element\n    for (var i = toNodeAttrs.length - 1; i >= 0; i--) {\n        attr = toNodeAttrs[i];\n        attrName = attr.name;\n        attrNamespaceURI = attr.namespaceURI;\n        attrValue = attr.value;\n\n        if (attrNamespaceURI) {\n            attrName = attr.localName || attrName;\n            fromValue = fromNode.getAttributeNS(attrNamespaceURI, attrName);\n\n            if (fromValue !== attrValue) {\n                if (attr.prefix === 'xmlns'){\n                    attrName = attr.name; // It's not allowed to set an attribute with the XMLNS namespace without specifying the `xmlns` prefix\n                }\n                fromNode.setAttributeNS(attrNamespaceURI, attrName, attrValue);\n            }\n        } else {\n            fromValue = fromNode.getAttribute(attrName);\n\n            if (fromValue !== attrValue) {\n                fromNode.setAttribute(attrName, attrValue);\n            }\n        }\n    }\n\n    // Remove any extra attributes found on the original DOM element that\n    // weren't found on the target element.\n    var fromNodeAttrs = fromNode.attributes;\n\n    for (var d = fromNodeAttrs.length - 1; d >= 0; d--) {\n        attr = fromNodeAttrs[d];\n        attrName = attr.name;\n        attrNamespaceURI = attr.namespaceURI;\n\n        if (attrNamespaceURI) {\n            attrName = attr.localName || attrName;\n\n            if (!toNode.hasAttributeNS(attrNamespaceURI, attrName)) {\n                fromNode.removeAttributeNS(attrNamespaceURI, attrName);\n            }\n        } else {\n            if (!toNode.hasAttribute(attrName)) {\n                fromNode.removeAttribute(attrName);\n            }\n        }\n    }\n}\n\nvar range; // Create a range object for efficently rendering strings to elements.\nvar NS_XHTML = 'http://www.w3.org/1999/xhtml';\n\nvar doc = typeof document === 'undefined' ? undefined : document;\nvar HAS_TEMPLATE_SUPPORT = !!doc && 'content' in doc.createElement('template');\nvar HAS_RANGE_SUPPORT = !!doc && doc.createRange && 'createContextualFragment' in doc.createRange();\n\nfunction createFragmentFromTemplate(str) {\n    var template = doc.createElement('template');\n    template.innerHTML = str;\n    return template.content.childNodes[0];\n}\n\nfunction createFragmentFromRange(str) {\n    if (!range) {\n        range = doc.createRange();\n        range.selectNode(doc.body);\n    }\n\n    var fragment = range.createContextualFragment(str);\n    return fragment.childNodes[0];\n}\n\nfunction createFragmentFromWrap(str) {\n    var fragment = doc.createElement('body');\n    fragment.innerHTML = str;\n    return fragment.childNodes[0];\n}\n\n/**\n * This is about the same\n * var html = new DOMParser().parseFromString(str, 'text/html');\n * return html.body.firstChild;\n *\n * @method toElement\n * @param {String} str\n */\nfunction toElement(str) {\n    str = str.trim();\n    if (HAS_TEMPLATE_SUPPORT) {\n      // avoid restrictions on content for things like `<tr><th>Hi</th></tr>` which\n      // createContextualFragment doesn't support\n      // <template> support not available in IE\n      return createFragmentFromTemplate(str);\n    } else if (HAS_RANGE_SUPPORT) {\n      return createFragmentFromRange(str);\n    }\n\n    return createFragmentFromWrap(str);\n}\n\n/**\n * Returns true if two node's names are the same.\n *\n * NOTE: We don't bother checking `namespaceURI` because you will never find two HTML elements with the same\n *       nodeName and different namespace URIs.\n *\n * @param {Element} a\n * @param {Element} b The target element\n * @return {boolean}\n */\nfunction compareNodeNames(fromEl, toEl) {\n    var fromNodeName = fromEl.nodeName;\n    var toNodeName = toEl.nodeName;\n    var fromCodeStart, toCodeStart;\n\n    if (fromNodeName === toNodeName) {\n        return true;\n    }\n\n    fromCodeStart = fromNodeName.charCodeAt(0);\n    toCodeStart = toNodeName.charCodeAt(0);\n\n    // If the target element is a virtual DOM node or SVG node then we may\n    // need to normalize the tag name before comparing. Normal HTML elements that are\n    // in the \"http://www.w3.org/1999/xhtml\"\n    // are converted to upper case\n    if (fromCodeStart <= 90 && toCodeStart >= 97) { // from is upper and to is lower\n        return fromNodeName === toNodeName.toUpperCase();\n    } else if (toCodeStart <= 90 && fromCodeStart >= 97) { // to is upper and from is lower\n        return toNodeName === fromNodeName.toUpperCase();\n    } else {\n        return false;\n    }\n}\n\n/**\n * Create an element, optionally with a known namespace URI.\n *\n * @param {string} name the element name, e.g. 'div' or 'svg'\n * @param {string} [namespaceURI] the element's namespace URI, i.e. the value of\n * its `xmlns` attribute or its inferred namespace.\n *\n * @return {Element}\n */\nfunction createElementNS(name, namespaceURI) {\n    return !namespaceURI || namespaceURI === NS_XHTML ?\n        doc.createElement(name) :\n        doc.createElementNS(namespaceURI, name);\n}\n\n/**\n * Copies the children of one DOM element to another DOM element\n */\nfunction moveChildren(fromEl, toEl) {\n    var curChild = fromEl.firstChild;\n    while (curChild) {\n        var nextChild = curChild.nextSibling;\n        toEl.appendChild(curChild);\n        curChild = nextChild;\n    }\n    return toEl;\n}\n\nfunction syncBooleanAttrProp(fromEl, toEl, name) {\n    if (fromEl[name] !== toEl[name]) {\n        fromEl[name] = toEl[name];\n        if (fromEl[name]) {\n            fromEl.setAttribute(name, '');\n        } else {\n            fromEl.removeAttribute(name);\n        }\n    }\n}\n\nvar specialElHandlers = {\n    OPTION: function(fromEl, toEl) {\n        var parentNode = fromEl.parentNode;\n        if (parentNode) {\n            var parentName = parentNode.nodeName.toUpperCase();\n            if (parentName === 'OPTGROUP') {\n                parentNode = parentNode.parentNode;\n                parentName = parentNode && parentNode.nodeName.toUpperCase();\n            }\n            if (parentName === 'SELECT' && !parentNode.hasAttribute('multiple')) {\n                if (fromEl.hasAttribute('selected') && !toEl.selected) {\n                    // Workaround for MS Edge bug where the 'selected' attribute can only be\n                    // removed if set to a non-empty value:\n                    // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/12087679/\n                    fromEl.setAttribute('selected', 'selected');\n                    fromEl.removeAttribute('selected');\n                }\n                // We have to reset select element's selectedIndex to -1, otherwise setting\n                // fromEl.selected using the syncBooleanAttrProp below has no effect.\n                // The correct selectedIndex will be set in the SELECT special handler below.\n                parentNode.selectedIndex = -1;\n            }\n        }\n        syncBooleanAttrProp(fromEl, toEl, 'selected');\n    },\n    /**\n     * The \"value\" attribute is special for the <input> element since it sets\n     * the initial value. Changing the \"value\" attribute without changing the\n     * \"value\" property will have no effect since it is only used to the set the\n     * initial value.  Similar for the \"checked\" attribute, and \"disabled\".\n     */\n    INPUT: function(fromEl, toEl) {\n        syncBooleanAttrProp(fromEl, toEl, 'checked');\n        syncBooleanAttrProp(fromEl, toEl, 'disabled');\n\n        if (fromEl.value !== toEl.value) {\n            fromEl.value = toEl.value;\n        }\n\n        if (!toEl.hasAttribute('value')) {\n            fromEl.removeAttribute('value');\n        }\n    },\n\n    TEXTAREA: function(fromEl, toEl) {\n        var newValue = toEl.value;\n        if (fromEl.value !== newValue) {\n            fromEl.value = newValue;\n        }\n\n        var firstChild = fromEl.firstChild;\n        if (firstChild) {\n            // Needed for IE. Apparently IE sets the placeholder as the\n            // node value and vise versa. This ignores an empty update.\n            var oldValue = firstChild.nodeValue;\n\n            if (oldValue == newValue || (!newValue && oldValue == fromEl.placeholder)) {\n                return;\n            }\n\n            firstChild.nodeValue = newValue;\n        }\n    },\n    SELECT: function(fromEl, toEl) {\n        if (!toEl.hasAttribute('multiple')) {\n            var selectedIndex = -1;\n            var i = 0;\n            // We have to loop through children of fromEl, not toEl since nodes can be moved\n            // from toEl to fromEl directly when morphing.\n            // At the time this special handler is invoked, all children have already been morphed\n            // and appended to / removed from fromEl, so using fromEl here is safe and correct.\n            var curChild = fromEl.firstChild;\n            var optgroup;\n            var nodeName;\n            while(curChild) {\n                nodeName = curChild.nodeName && curChild.nodeName.toUpperCase();\n                if (nodeName === 'OPTGROUP') {\n                    optgroup = curChild;\n                    curChild = optgroup.firstChild;\n                } else {\n                    if (nodeName === 'OPTION') {\n                        if (curChild.hasAttribute('selected')) {\n                            selectedIndex = i;\n                            break;\n                        }\n                        i++;\n                    }\n                    curChild = curChild.nextSibling;\n                    if (!curChild && optgroup) {\n                        curChild = optgroup.nextSibling;\n                        optgroup = null;\n                    }\n                }\n            }\n\n            fromEl.selectedIndex = selectedIndex;\n        }\n    }\n};\n\nvar ELEMENT_NODE = 1;\nvar DOCUMENT_FRAGMENT_NODE$1 = 11;\nvar TEXT_NODE = 3;\nvar COMMENT_NODE = 8;\n\nfunction noop() {}\n\nfunction defaultGetNodeKey(node) {\n  if (node) {\n      return (node.getAttribute && node.getAttribute('id')) || node.id;\n  }\n}\n\nfunction morphdomFactory(morphAttrs) {\n\n    return function morphdom(fromNode, toNode, options) {\n        if (!options) {\n            options = {};\n        }\n\n        if (typeof toNode === 'string') {\n            if (fromNode.nodeName === '#document' || fromNode.nodeName === 'HTML' || fromNode.nodeName === 'BODY') {\n                var toNodeHtml = toNode;\n                toNode = doc.createElement('html');\n                toNode.innerHTML = toNodeHtml;\n            } else {\n                toNode = toElement(toNode);\n            }\n        }\n\n        var getNodeKey = options.getNodeKey || defaultGetNodeKey;\n        var onBeforeNodeAdded = options.onBeforeNodeAdded || noop;\n        var onNodeAdded = options.onNodeAdded || noop;\n        var onBeforeElUpdated = options.onBeforeElUpdated || noop;\n        var onElUpdated = options.onElUpdated || noop;\n        var onBeforeNodeDiscarded = options.onBeforeNodeDiscarded || noop;\n        var onNodeDiscarded = options.onNodeDiscarded || noop;\n        var onBeforeElChildrenUpdated = options.onBeforeElChildrenUpdated || noop;\n        var childrenOnly = options.childrenOnly === true;\n\n        // This object is used as a lookup to quickly find all keyed elements in the original DOM tree.\n        var fromNodesLookup = Object.create(null);\n        var keyedRemovalList = [];\n\n        function addKeyedRemoval(key) {\n            keyedRemovalList.push(key);\n        }\n\n        function walkDiscardedChildNodes(node, skipKeyedNodes) {\n            if (node.nodeType === ELEMENT_NODE) {\n                var curChild = node.firstChild;\n                while (curChild) {\n\n                    var key = undefined;\n\n                    if (skipKeyedNodes && (key = getNodeKey(curChild))) {\n                        // If we are skipping keyed nodes then we add the key\n                        // to a list so that it can be handled at the very end.\n                        addKeyedRemoval(key);\n                    } else {\n                        // Only report the node as discarded if it is not keyed. We do this because\n                        // at the end we loop through all keyed elements that were unmatched\n                        // and then discard them in one final pass.\n                        onNodeDiscarded(curChild);\n                        if (curChild.firstChild) {\n                            walkDiscardedChildNodes(curChild, skipKeyedNodes);\n                        }\n                    }\n\n                    curChild = curChild.nextSibling;\n                }\n            }\n        }\n\n        /**\n         * Removes a DOM node out of the original DOM\n         *\n         * @param  {Node} node The node to remove\n         * @param  {Node} parentNode The nodes parent\n         * @param  {Boolean} skipKeyedNodes If true then elements with keys will be skipped and not discarded.\n         * @return {undefined}\n         */\n        function removeNode(node, parentNode, skipKeyedNodes) {\n            if (onBeforeNodeDiscarded(node) === false) {\n                return;\n            }\n\n            if (parentNode) {\n                parentNode.removeChild(node);\n            }\n\n            onNodeDiscarded(node);\n            walkDiscardedChildNodes(node, skipKeyedNodes);\n        }\n\n        // // TreeWalker implementation is no faster, but keeping this around in case this changes in the future\n        // function indexTree(root) {\n        //     var treeWalker = document.createTreeWalker(\n        //         root,\n        //         NodeFilter.SHOW_ELEMENT);\n        //\n        //     var el;\n        //     while((el = treeWalker.nextNode())) {\n        //         var key = getNodeKey(el);\n        //         if (key) {\n        //             fromNodesLookup[key] = el;\n        //         }\n        //     }\n        // }\n\n        // // NodeIterator implementation is no faster, but keeping this around in case this changes in the future\n        //\n        // function indexTree(node) {\n        //     var nodeIterator = document.createNodeIterator(node, NodeFilter.SHOW_ELEMENT);\n        //     var el;\n        //     while((el = nodeIterator.nextNode())) {\n        //         var key = getNodeKey(el);\n        //         if (key) {\n        //             fromNodesLookup[key] = el;\n        //         }\n        //     }\n        // }\n\n        function indexTree(node) {\n            if (node.nodeType === ELEMENT_NODE || node.nodeType === DOCUMENT_FRAGMENT_NODE$1) {\n                var curChild = node.firstChild;\n                while (curChild) {\n                    var key = getNodeKey(curChild);\n                    if (key) {\n                        fromNodesLookup[key] = curChild;\n                    }\n\n                    // Walk recursively\n                    indexTree(curChild);\n\n                    curChild = curChild.nextSibling;\n                }\n            }\n        }\n\n        indexTree(fromNode);\n\n        function handleNodeAdded(el) {\n            onNodeAdded(el);\n\n            var curChild = el.firstChild;\n            while (curChild) {\n                var nextSibling = curChild.nextSibling;\n\n                var key = getNodeKey(curChild);\n                if (key) {\n                    var unmatchedFromEl = fromNodesLookup[key];\n                    // if we find a duplicate #id node in cache, replace `el` with cache value\n                    // and morph it to the child node.\n                    if (unmatchedFromEl && compareNodeNames(curChild, unmatchedFromEl)) {\n                        curChild.parentNode.replaceChild(unmatchedFromEl, curChild);\n                        morphEl(unmatchedFromEl, curChild);\n                    } else {\n                      handleNodeAdded(curChild);\n                    }\n                } else {\n                  // recursively call for curChild and it's children to see if we find something in\n                  // fromNodesLookup\n                  handleNodeAdded(curChild);\n                }\n\n                curChild = nextSibling;\n            }\n        }\n\n        function cleanupFromEl(fromEl, curFromNodeChild, curFromNodeKey) {\n            // We have processed all of the \"to nodes\". If curFromNodeChild is\n            // non-null then we still have some from nodes left over that need\n            // to be removed\n            while (curFromNodeChild) {\n                var fromNextSibling = curFromNodeChild.nextSibling;\n                if ((curFromNodeKey = getNodeKey(curFromNodeChild))) {\n                    // Since the node is keyed it might be matched up later so we defer\n                    // the actual removal to later\n                    addKeyedRemoval(curFromNodeKey);\n                } else {\n                    // NOTE: we skip nested keyed nodes from being removed since there is\n                    //       still a chance they will be matched up later\n                    removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n                }\n                curFromNodeChild = fromNextSibling;\n            }\n        }\n\n        function morphEl(fromEl, toEl, childrenOnly) {\n            var toElKey = getNodeKey(toEl);\n\n            if (toElKey) {\n                // If an element with an ID is being morphed then it will be in the final\n                // DOM so clear it out of the saved elements collection\n                delete fromNodesLookup[toElKey];\n            }\n\n            if (!childrenOnly) {\n                // optional\n                if (onBeforeElUpdated(fromEl, toEl) === false) {\n                    return;\n                }\n\n                // update attributes on original DOM element first\n                morphAttrs(fromEl, toEl);\n                // optional\n                onElUpdated(fromEl);\n\n                if (onBeforeElChildrenUpdated(fromEl, toEl) === false) {\n                    return;\n                }\n            }\n\n            if (fromEl.nodeName !== 'TEXTAREA') {\n              morphChildren(fromEl, toEl);\n            } else {\n              specialElHandlers.TEXTAREA(fromEl, toEl);\n            }\n        }\n\n        function morphChildren(fromEl, toEl) {\n            var curToNodeChild = toEl.firstChild;\n            var curFromNodeChild = fromEl.firstChild;\n            var curToNodeKey;\n            var curFromNodeKey;\n\n            var fromNextSibling;\n            var toNextSibling;\n            var matchingFromEl;\n\n            // walk the children\n            outer: while (curToNodeChild) {\n                toNextSibling = curToNodeChild.nextSibling;\n                curToNodeKey = getNodeKey(curToNodeChild);\n\n                // walk the fromNode children all the way through\n                while (curFromNodeChild) {\n                    fromNextSibling = curFromNodeChild.nextSibling;\n\n                    if (curToNodeChild.isSameNode && curToNodeChild.isSameNode(curFromNodeChild)) {\n                        curToNodeChild = toNextSibling;\n                        curFromNodeChild = fromNextSibling;\n                        continue outer;\n                    }\n\n                    curFromNodeKey = getNodeKey(curFromNodeChild);\n\n                    var curFromNodeType = curFromNodeChild.nodeType;\n\n                    // this means if the curFromNodeChild doesnt have a match with the curToNodeChild\n                    var isCompatible = undefined;\n\n                    if (curFromNodeType === curToNodeChild.nodeType) {\n                        if (curFromNodeType === ELEMENT_NODE) {\n                            // Both nodes being compared are Element nodes\n\n                            if (curToNodeKey) {\n                                // The target node has a key so we want to match it up with the correct element\n                                // in the original DOM tree\n                                if (curToNodeKey !== curFromNodeKey) {\n                                    // The current element in the original DOM tree does not have a matching key so\n                                    // let's check our lookup to see if there is a matching element in the original\n                                    // DOM tree\n                                    if ((matchingFromEl = fromNodesLookup[curToNodeKey])) {\n                                        if (fromNextSibling === matchingFromEl) {\n                                            // Special case for single element removals. To avoid removing the original\n                                            // DOM node out of the tree (since that can break CSS transitions, etc.),\n                                            // we will instead discard the current node and wait until the next\n                                            // iteration to properly match up the keyed target element with its matching\n                                            // element in the original tree\n                                            isCompatible = false;\n                                        } else {\n                                            // We found a matching keyed element somewhere in the original DOM tree.\n                                            // Let's move the original DOM node into the current position and morph\n                                            // it.\n\n                                            // NOTE: We use insertBefore instead of replaceChild because we want to go through\n                                            // the `removeNode()` function for the node that is being discarded so that\n                                            // all lifecycle hooks are correctly invoked\n                                            fromEl.insertBefore(matchingFromEl, curFromNodeChild);\n\n                                            // fromNextSibling = curFromNodeChild.nextSibling;\n\n                                            if (curFromNodeKey) {\n                                                // Since the node is keyed it might be matched up later so we defer\n                                                // the actual removal to later\n                                                addKeyedRemoval(curFromNodeKey);\n                                            } else {\n                                                // NOTE: we skip nested keyed nodes from being removed since there is\n                                                //       still a chance they will be matched up later\n                                                removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n                                            }\n\n                                            curFromNodeChild = matchingFromEl;\n                                        }\n                                    } else {\n                                        // The nodes are not compatible since the \"to\" node has a key and there\n                                        // is no matching keyed node in the source tree\n                                        isCompatible = false;\n                                    }\n                                }\n                            } else if (curFromNodeKey) {\n                                // The original has a key\n                                isCompatible = false;\n                            }\n\n                            isCompatible = isCompatible !== false && compareNodeNames(curFromNodeChild, curToNodeChild);\n                            if (isCompatible) {\n                                // We found compatible DOM elements so transform\n                                // the current \"from\" node to match the current\n                                // target DOM node.\n                                // MORPH\n                                morphEl(curFromNodeChild, curToNodeChild);\n                            }\n\n                        } else if (curFromNodeType === TEXT_NODE || curFromNodeType == COMMENT_NODE) {\n                            // Both nodes being compared are Text or Comment nodes\n                            isCompatible = true;\n                            // Simply update nodeValue on the original node to\n                            // change the text value\n                            if (curFromNodeChild.nodeValue !== curToNodeChild.nodeValue) {\n                                curFromNodeChild.nodeValue = curToNodeChild.nodeValue;\n                            }\n\n                        }\n                    }\n\n                    if (isCompatible) {\n                        // Advance both the \"to\" child and the \"from\" child since we found a match\n                        // Nothing else to do as we already recursively called morphChildren above\n                        curToNodeChild = toNextSibling;\n                        curFromNodeChild = fromNextSibling;\n                        continue outer;\n                    }\n\n                    // No compatible match so remove the old node from the DOM and continue trying to find a\n                    // match in the original DOM. However, we only do this if the from node is not keyed\n                    // since it is possible that a keyed node might match up with a node somewhere else in the\n                    // target tree and we don't want to discard it just yet since it still might find a\n                    // home in the final DOM tree. After everything is done we will remove any keyed nodes\n                    // that didn't find a home\n                    if (curFromNodeKey) {\n                        // Since the node is keyed it might be matched up later so we defer\n                        // the actual removal to later\n                        addKeyedRemoval(curFromNodeKey);\n                    } else {\n                        // NOTE: we skip nested keyed nodes from being removed since there is\n                        //       still a chance they will be matched up later\n                        removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n                    }\n\n                    curFromNodeChild = fromNextSibling;\n                } // END: while(curFromNodeChild) {}\n\n                // If we got this far then we did not find a candidate match for\n                // our \"to node\" and we exhausted all of the children \"from\"\n                // nodes. Therefore, we will just append the current \"to\" node\n                // to the end\n                if (curToNodeKey && (matchingFromEl = fromNodesLookup[curToNodeKey]) && compareNodeNames(matchingFromEl, curToNodeChild)) {\n                    fromEl.appendChild(matchingFromEl);\n                    // MORPH\n                    morphEl(matchingFromEl, curToNodeChild);\n                } else {\n                    var onBeforeNodeAddedResult = onBeforeNodeAdded(curToNodeChild);\n                    if (onBeforeNodeAddedResult !== false) {\n                        if (onBeforeNodeAddedResult) {\n                            curToNodeChild = onBeforeNodeAddedResult;\n                        }\n\n                        if (curToNodeChild.actualize) {\n                            curToNodeChild = curToNodeChild.actualize(fromEl.ownerDocument || doc);\n                        }\n                        fromEl.appendChild(curToNodeChild);\n                        handleNodeAdded(curToNodeChild);\n                    }\n                }\n\n                curToNodeChild = toNextSibling;\n                curFromNodeChild = fromNextSibling;\n            }\n\n            cleanupFromEl(fromEl, curFromNodeChild, curFromNodeKey);\n\n            var specialElHandler = specialElHandlers[fromEl.nodeName];\n            if (specialElHandler) {\n                specialElHandler(fromEl, toEl);\n            }\n        } // END: morphChildren(...)\n\n        var morphedNode = fromNode;\n        var morphedNodeType = morphedNode.nodeType;\n        var toNodeType = toNode.nodeType;\n\n        if (!childrenOnly) {\n            // Handle the case where we are given two DOM nodes that are not\n            // compatible (e.g. <div> --> <span> or <div> --> TEXT)\n            if (morphedNodeType === ELEMENT_NODE) {\n                if (toNodeType === ELEMENT_NODE) {\n                    if (!compareNodeNames(fromNode, toNode)) {\n                        onNodeDiscarded(fromNode);\n                        morphedNode = moveChildren(fromNode, createElementNS(toNode.nodeName, toNode.namespaceURI));\n                    }\n                } else {\n                    // Going from an element node to a text node\n                    morphedNode = toNode;\n                }\n            } else if (morphedNodeType === TEXT_NODE || morphedNodeType === COMMENT_NODE) { // Text or comment node\n                if (toNodeType === morphedNodeType) {\n                    if (morphedNode.nodeValue !== toNode.nodeValue) {\n                        morphedNode.nodeValue = toNode.nodeValue;\n                    }\n\n                    return morphedNode;\n                } else {\n                    // Text node to something else\n                    morphedNode = toNode;\n                }\n            }\n        }\n\n        if (morphedNode === toNode) {\n            // The \"to node\" was not compatible with the \"from node\" so we had to\n            // toss out the \"from node\" and use the \"to node\"\n            onNodeDiscarded(fromNode);\n        } else {\n            if (toNode.isSameNode && toNode.isSameNode(morphedNode)) {\n                return;\n            }\n\n            morphEl(morphedNode, toNode, childrenOnly);\n\n            // We now need to loop over any keyed nodes that might need to be\n            // removed. We only do the removal if we know that the keyed node\n            // never found a match. When a keyed node is matched up we remove\n            // it out of fromNodesLookup and we use fromNodesLookup to determine\n            // if a keyed node has been matched up or not\n            if (keyedRemovalList) {\n                for (var i=0, len=keyedRemovalList.length; i<len; i++) {\n                    var elToRemove = fromNodesLookup[keyedRemovalList[i]];\n                    if (elToRemove) {\n                        removeNode(elToRemove, elToRemove.parentNode, false);\n                    }\n                }\n            }\n        }\n\n        if (!childrenOnly && morphedNode !== fromNode && fromNode.parentNode) {\n            if (morphedNode.actualize) {\n                morphedNode = morphedNode.actualize(fromNode.ownerDocument || doc);\n            }\n            // If we had to swap out the from node with a new node because the old\n            // node was not compatible with the target node then we need to\n            // replace the old DOM node in the original DOM tree. This is only\n            // possible if the original DOM node was part of a DOM tree which\n            // we know is the case if it has a parent node.\n            fromNode.parentNode.replaceChild(morphedNode, fromNode);\n        }\n\n        return morphedNode;\n    };\n}\n\nvar morphdom = morphdomFactory(morphAttrs);\n\nexport default morphdom;\n","import morphdom from 'morphdom'\n\nlet activeElement\n\nconst textInputTagNames = {\n  INPUT: true,\n  TEXTAREA: true,\n  SELECT: true\n}\n\nconst textInputTypes = {\n  'datetime-local': true,\n  'select-multiple': true,\n  'select-one': true,\n  color: true,\n  date: true,\n  datetime: true,\n  email: true,\n  month: true,\n  number: true,\n  password: true,\n  range: true,\n  search: true,\n  tel: true,\n  text: true,\n  textarea: true,\n  time: true,\n  url: true,\n  week: true\n}\n\n// Indicates if the passed element is considered a text input.\n//\nconst isTextInput = element => {\n  return textInputTagNames[element.tagName] && textInputTypes[element.type]\n}\n\n// Assigns focus to the appropriate element... preferring the explicitly passed focusSelector\n//\n// * focusSelector - a CSS selector for the element that should have focus\n//\nconst assignFocus = focusSelector => {\n  const focusElement = focusSelector\n    ? document.querySelector(focusSelector)\n    : activeElement\n  if (focusElement) focusElement.focus()\n}\n\n// Dispatches an event on the passed element\n//\n// * element - the element\n// * name - the name of the event\n// * detail - the event detail\n//\nconst dispatch = (element, name, detail = {}) => {\n  const init = { bubbles: true, cancelable: true }\n  const evt = new Event(name, init)\n  evt.detail = detail\n  element.dispatchEvent(evt)\n}\n\nconst xpathToElement = xpath => {\n  return document.evaluate(\n    xpath,\n    document,\n    null,\n    XPathResult.FIRST_ORDERED_NODE_TYPE,\n    null\n  ).singleNodeValue\n}\n\n// Return an array with the class names to be used\n//\n// * names - could be a string or an array of strings for multiple classes.\n//\nconst getClassNames = names => Array(names).flat()\n\n// Indicates whether or not we should morph an element\n// SEE: https://github.com/patrick-steele-idem/morphdom#morphdomfromnode-tonode-options--node\n//\nconst shouldMorph = permanentAttributeName => (fromEl, toEl) => {\n  // Skip nodes that are equal:\n  // https://github.com/patrick-steele-idem/morphdom#can-i-make-morphdom-blaze-through-the-dom-tree-even-faster-yes\n  if (fromEl.isEqualNode(toEl)) return false\n  if (!permanentAttributeName) return true\n\n  const permanent = fromEl.closest(`[${permanentAttributeName}]`)\n\n  // only morph attributes on the active non-permanent text input\n  if (!permanent && isTextInput(fromEl) && fromEl === activeElement) {\n    const ignore = { value: true }\n    Array.from(toEl.attributes).forEach(attribute => {\n      if (!ignore[attribute.name])\n        fromEl.setAttribute(attribute.name, attribute.value)\n    })\n    return false\n  }\n\n  return !permanent\n}\n\n// Morphdom Callbacks ........................................................................................\n\nconst DOMOperations = {\n  // Notifications\n\n  consoleLog: config => {\n    const { message, level } = config\n    level && ['warn', 'info', 'error'].includes(level)\n      ? console[level](message)\n      : console.log(message)\n  },\n\n  notification: config => {\n    const { title, options } = config\n    dispatch(document, 'cable-ready:before-notification', config)\n    let permission\n    Notification.requestPermission().then(result => {\n      permission = result\n      if (result === 'granted') new Notification(title || '', options)\n      dispatch(document, 'cable-ready:after-notification', {\n        ...config,\n        permission\n      })\n    })\n  },\n\n  // Cookies .................................................................................................\n\n  setCookie: config => {\n    const { cookie } = config\n    dispatch(document, 'cable-ready:before-set-cookie', config)\n    document.cookie = cookie\n    dispatch(document, 'cable-ready:after-set-cookie', config)\n  },\n\n  // DOM Events ..............................................................................................\n\n  dispatchEvent: config => {\n    const { element, name, detail } = config\n    dispatch(element, name, detail)\n  },\n\n  // Element Mutations .......................................................................................\n\n  morph: detail => {\n    activeElement = document.activeElement\n    const {\n      element,\n      html,\n      childrenOnly,\n      focusSelector,\n      permanentAttributeName\n    } = detail\n    const template = document.createElement('template')\n    template.innerHTML = String(html).trim()\n    dispatch(element, 'cable-ready:before-morph', {\n      ...detail,\n      content: template.content\n    })\n    const parent = element.parentElement\n    const ordinal = Array.from(parent.children).indexOf(element)\n    morphdom(element, template.content, {\n      childrenOnly: !!childrenOnly,\n      onBeforeElUpdated: shouldMorph(permanentAttributeName)\n    })\n    assignFocus(focusSelector)\n    dispatch(parent.children[ordinal], 'cable-ready:after-morph', {\n      ...detail,\n      content: template.content\n    })\n  },\n\n  innerHtml: detail => {\n    activeElement = document.activeElement\n    const { element, html, focusSelector } = detail\n    dispatch(element, 'cable-ready:before-inner-html', detail)\n    element.innerHTML = html\n    assignFocus(focusSelector)\n    dispatch(element, 'cable-ready:after-inner-html', detail)\n  },\n\n  outerHtml: detail => {\n    activeElement = document.activeElement\n    const { element, html, focusSelector } = detail\n    dispatch(element, 'cable-ready:before-outer-html', detail)\n    const parent = element.parentElement\n    const ordinal = Array.from(parent.children).indexOf(element)\n    element.outerHTML = html\n    assignFocus(focusSelector)\n    dispatch(parent.children[ordinal], 'cable-ready:after-outer-html', detail)\n  },\n\n  textContent: detail => {\n    const { element, text } = detail\n    dispatch(element, 'cable-ready:before-text-content', detail)\n    element.textContent = text\n    dispatch(element, 'cable-ready:after-text-content', detail)\n  },\n\n  insertAdjacentHtml: detail => {\n    activeElement = document.activeElement\n    const { element, html, position, focusSelector } = detail\n    dispatch(element, 'cable-ready:before-insert-adjacent-html', detail)\n    element.insertAdjacentHTML(position || 'beforeend', html)\n    assignFocus(focusSelector)\n    dispatch(element, 'cable-ready:after-insert-adjacent-html', detail)\n  },\n\n  insertAdjacentText: detail => {\n    const { element, text, position } = detail\n    dispatch(element, 'cable-ready:before-insert-adjacent-text', detail)\n    element.insertAdjacentText(position || 'beforeend', text)\n    dispatch(element, 'cable-ready:after-insert-adjacent-text', detail)\n  },\n\n  remove: detail => {\n    activeElement = document.activeElement\n    const { element, focusSelector } = detail\n    dispatch(element, 'cable-ready:before-remove', detail)\n    element.remove()\n    assignFocus(focusSelector)\n    dispatch(element, 'cable-ready:after-remove', detail)\n  },\n\n  setProperty: detail => {\n    const { element, name, value } = detail\n    dispatch(element, 'cable-ready:before-set-property', detail)\n    if (name in element) element[name] = value\n    dispatch(element, 'cable-ready:after-set-property', detail)\n  },\n\n  setValue: detail => {\n    const { element, value } = detail\n    dispatch(element, 'cable-ready:before-set-value', detail)\n    element.value = value\n    dispatch(element, 'cable-ready:after-set-value', detail)\n  },\n\n  // Attribute Mutations .....................................................................................\n\n  setAttribute: detail => {\n    const { element, name, value } = detail\n    dispatch(element, 'cable-ready:before-set-attribute', detail)\n    element.setAttribute(name, value)\n    dispatch(element, 'cable-ready:after-set-attribute', detail)\n  },\n\n  removeAttribute: detail => {\n    const { element, name } = detail\n    dispatch(element, 'cable-ready:before-remove-attribute', detail)\n    element.removeAttribute(name)\n    dispatch(element, 'cable-ready:after-remove-attribute', detail)\n  },\n\n  // CSS Class Mutations .....................................................................................\n\n  addCssClass: detail => {\n    const { element, name } = detail\n    dispatch(element, 'cable-ready:before-add-css-class', detail)\n    element.classList.add(...getClassNames(name))\n    dispatch(element, 'cable-ready:after-add-css-class', detail)\n  },\n\n  removeCssClass: detail => {\n    const { element, name } = detail\n    dispatch(element, 'cable-ready:before-remove-css-class', detail)\n    element.classList.remove(...getClassNames(name))\n    dispatch(element, 'cable-ready:after-remove-css-class', detail)\n  },\n\n  // Style Mutations .......................................................................................\n\n  setStyle: detail => {\n    const { element, name, value } = detail\n    dispatch(element, 'cable-ready:before-set-style', detail)\n    element.style[name] = value\n    dispatch(element, 'cable-ready:after-set-style', detail)\n  },\n\n  setStyles: detail => {\n    const { element, styles } = detail\n    dispatch(element, 'cable-ready:before-set-styles', detail)\n    for (let [name, value] of Object.entries(styles)) {\n      element.style[name] = value\n    }\n    dispatch(element, 'cable-ready:after-set-styles', detail)\n  },\n\n  // Dataset Mutations .......................................................................................\n\n  setDatasetProperty: detail => {\n    const { element, name, value } = detail\n    dispatch(element, 'cable-ready:before-set-dataset-property', detail)\n    element.dataset[name] = value\n    dispatch(element, 'cable-ready:after-set-dataset-property', detail)\n  }\n}\n\nconst perform = (\n  operations,\n  options = { emitMissingElementWarnings: true }\n) => {\n  for (let name in operations) {\n    if (operations.hasOwnProperty(name)) {\n      const entries = operations[name]\n      for (let i = 0; i < entries.length; i++) {\n        const detail = entries[i]\n        try {\n          if (detail.selector) {\n            detail.element = detail.xpath\n              ? xpathToElement(detail.selector)\n              : document.querySelector(detail.selector)\n          } else {\n            detail.element = document\n          }\n          if (detail.element || options.emitMissingElementWarnings)\n            DOMOperations[name](detail)\n        } catch (e) {\n          if (detail.element)\n            console.log(`CableReady detected an error in ${name}! ${e.message}`)\n          else\n            console.log(\n              `CableReady ${name} failed due to missing DOM element for selector: '${detail.selector}'`\n            )\n        }\n      }\n    }\n  }\n}\n\nexport default { perform, isTextInput, DOMOperations }\n","export const defaultSchema = {\n  reflexAttribute: 'data-reflex',\n  reflexPermanentAttribute: 'data-reflex-permanent',\n  reflexRootAttribute: 'data-reflex-root',\n  reflexDatasetAttribute: 'data-reflex-dataset'\n}\n","import { createConsumer } from '@rails/actioncable'\n\nfunction isConsumer (object) {\n  if (object) {\n    try {\n      return (\n        object.constructor.name === 'Consumer' &&\n        object.connect &&\n        object.disconnect &&\n        object.send\n      )\n    } catch (e) {}\n  }\n  return false\n}\n\nfunction findConsumer (object, depth = 0) {\n  if (!object) return null\n  if (depth > 3) return null\n  if (isConsumer(object)) return object\n  return Object.values(object)\n    .map(o => findConsumer(o, depth + 1))\n    .find(o => o)\n}\n\nexport function getConsumer () {\n  return findConsumer(window) || createConsumer()\n}\n","// uuid4 function taken from stackoverflow\n// https://stackoverflow.com/a/2117523/554903\nexport const uuidv4 = () => {\n  const crypto = window.crypto || window.msCrypto\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n    (\n      c ^\n      (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))\n    ).toString(16)\n  )\n}\n\nexport const camelize = (value, uppercaseFirstLetter = true) => {\n  if (typeof value !== 'string') return ''\n  value = value\n    .replace(/[\\s_](.)/g, $1 => $1.toUpperCase())\n    .replace(/[\\s_]/g, '')\n    .replace(/^(.)/, $1 => $1.toLowerCase())\n\n  if (uppercaseFirstLetter)\n    value = value.substr(0, 1).toUpperCase() + value.substr(1)\n\n  return value\n}\n\nexport const debounce = (callback, delay = 250) => {\n  let timeoutId\n  return (...args) => {\n    clearTimeout(timeoutId)\n    timeoutId = setTimeout(() => {\n      timeoutId = null\n      callback(...args)\n    }, delay)\n  }\n}\n\nexport const extractReflexName = reflexString => {\n  const match = reflexString.match(/(?:.*->)?(.*?)(?:Reflex)?#/)\n\n  return match ? match[1] : ''\n}\n\nexport const emitEvent = (event, detail) => {\n  document.dispatchEvent(\n    new CustomEvent(event, {\n      bubbles: true,\n      cancelable: false,\n      detail\n    })\n  )\n}\n","import { camelize } from './utils'\n\n// Invokes a lifecycle method on a StimulusReflex controller.\n//\n// - stage - the lifecycle stage\n//   * before\n//   * success\n//   * error\n//   * halted\n//   * after\n//\n// - element - the element that triggered the reflex (not necessarily the Stimulus controller's element)\n//\nconst invokeLifecycleMethod = (stage, element, reflexId) => {\n  if (!element || !element.reflexData) return\n  const controller = element.reflexController\n  const reflex = element.reflexData.target\n  const reflexMethodName = reflex.split('#')[1]\n\n  const specificLifecycleMethodName = ['before', 'after'].includes(stage)\n    ? `${stage}${camelize(reflexMethodName)}`\n    : `${camelize(reflexMethodName, false)}${camelize(stage)}`\n  const specificLifecycleMethod = controller[specificLifecycleMethodName]\n\n  const genericLifecycleMethodName = ['before', 'after'].includes(stage)\n    ? `${stage}Reflex`\n    : `reflex${camelize(stage)}`\n  const genericLifecycleMethod = controller[genericLifecycleMethodName]\n\n  if (typeof specificLifecycleMethod === 'function') {\n    setTimeout(() =>\n      specificLifecycleMethod.call(\n        controller,\n        element,\n        reflex,\n        element.reflexError,\n        reflexId\n      )\n    )\n  }\n\n  if (typeof genericLifecycleMethod === 'function') {\n    setTimeout(() =>\n      genericLifecycleMethod.call(\n        controller,\n        element,\n        reflex,\n        element.reflexError,\n        reflexId\n      )\n    )\n  }\n\n  // lifecycle cleanup\n  if (stage === 'after') {\n    delete element.reflexController\n    delete element.reflexData\n    delete element.reflexError\n  }\n}\n\ndocument.addEventListener(\n  'stimulus-reflex:before',\n  event => invokeLifecycleMethod('before', event.target, event.detail.reflexId),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:success',\n  event => {\n    invokeLifecycleMethod('success', event.target, event.detail.reflexId)\n    dispatchLifecycleEvent('after', event.target, event.detail.reflexId)\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:selector',\n  event => {\n    invokeLifecycleMethod('success', event.target, event.detail.reflexId)\n    dispatchLifecycleEvent('after', event.target, event.detail.reflexId)\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:nothing',\n  event => {\n    invokeLifecycleMethod('success', event.target, event.detail.reflexId)\n    dispatchLifecycleEvent('after', event.target, event.detail.reflexId)\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:error',\n  event => {\n    invokeLifecycleMethod('error', event.target, event.detail.reflexId)\n    dispatchLifecycleEvent('after', event.target, event.detail.reflexId)\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:halted',\n  event => invokeLifecycleMethod('halted', event.target, event.detail.reflexId),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:after',\n  event => invokeLifecycleMethod('after', event.target, event.detail.reflexId),\n  true\n)\n\n// Dispatches a lifecycle event on document\n//\n// - stage - the lifecycle stage\n//   * before\n//   * success\n//   * error\n//   * halted\n//   * after\n//\n// - element - the element that triggered the reflex (not necessarily the Stimulus controller's element)\n//\nexport const dispatchLifecycleEvent = (stage, element, reflexId) => {\n  if (!element) return\n  const { target } = element.reflexData || {}\n  element.dispatchEvent(\n    new CustomEvent(`stimulus-reflex:${stage}`, {\n      bubbles: true,\n      cancelable: false,\n      detail: {\n        reflex: target,\n        controller: element.reflexController,\n        reflexId\n      }\n    })\n  )\n}\n","import { defaultSchema } from './schema'\n\nconst multipleInstances = element =>\n  document.querySelectorAll(\n    `input[type=\"${element.type}\"][name=\"${element.name}\"]`\n  ).length > 1\n\nconst collectCheckedOptions = element => {\n  return Array.from(element.querySelectorAll('option:checked'))\n    .concat(\n      Array.from(\n        document.querySelectorAll(\n          `input[type=\"${element.type}\"][name=\"${element.name}\"]`\n        )\n      ).filter(elem => elem.checked)\n    )\n    .map(o => o.value)\n}\n\n// Returns a string value for the passed array.\n//\n//   attributeValue(['', 'one', null, 'two', 'three ']) // 'one two three'\n//\nexport const attributeValue = (values = []) => {\n  const value = values\n    .filter(v => v && String(v).length)\n    .map(v => v.trim())\n    .join(' ')\n    .trim()\n  return value.length ? value : null\n}\n\n// Returns an array for the passed string value by splitting on whitespace.\n//\n//   attributeValues('one two three ') // ['one', 'two', 'three']\n//\nexport const attributeValues = value => {\n  if (!value) return []\n  if (!value.length) return []\n  return value.split(' ').filter(v => v.trim().length)\n}\n\n// Extracts attributes from a DOM element.\n//\nexport const extractElementAttributes = element => {\n  let attrs = Array.from(element.attributes).reduce((memo, attr) => {\n    memo[attr.name] = attr.value\n    return memo\n  }, {})\n\n  attrs.checked = !!element.checked\n  attrs.selected = !!element.selected\n  attrs.tag_name = element.tagName\n\n  if (element.tagName.match(/select/i) || multipleInstances(element)) {\n    const collectedOptions = collectCheckedOptions(element)\n    attrs.values = collectedOptions\n    attrs.value = collectedOptions.join(',')\n  } else {\n    attrs.value = element.value\n    if (element.tagName.match(/select/i)) {\n      if (element.selectedIndex > -1) {\n        attrs.value = element.options[element.selectedIndex].value\n      }\n    }\n  }\n  return attrs\n}\n\n// Extracts the dataset of an element and combines it with the data attributes from all parents if requested.\n//\nexport const extractElementDataset = (element, datasetAttribute = null) => {\n  let attrs = extractDataAttributes(element) || {}\n  const dataset = datasetAttribute && element.attributes[datasetAttribute]\n\n  if (dataset && dataset.value === 'combined') {\n    let parent = element.parentElement\n\n    while (parent) {\n      attrs = { ...extractDataAttributes(parent), ...attrs }\n      parent = parent.parentElement\n    }\n  }\n\n  return attrs\n}\n\n// Extracts all data attributes from a DOM element.\n//\nexport const extractDataAttributes = element => {\n  let attrs = {}\n\n  if (element && element.attributes) {\n    Array.from(element.attributes).forEach(attr => {\n      if (attr.name.startsWith('data-')) {\n        attrs[attr.name] = attr.value\n      }\n    })\n  }\n\n  return attrs\n}\n\n// Finds an element based on the passed represention of the DOM element's attributes.\n//\n// NOTE: This is the same set of attributes extrated via extractElementAttributes and forwarded to the server side reflex.\n// SEE: stimulate()\n// SEE: StimulusReflex::Channel#broadcast_morph\n// SEE: StimulusReflex::Channel#broadcast_error\n//\nexport const findElement = attributes => {\n  attributes = attributes || {}\n  let elements = []\n  let selectors = []\n  if (attributes.id) {\n    elements = document.querySelectorAll(`#${attributes.id}`)\n  } else {\n    for (const key in attributes) {\n      if (key.includes('.')) continue\n      if (key === 'tagName') continue\n      if (key === 'value') continue\n      if (key === 'values') continue\n      if (key === 'checked') continue\n      if (key === 'selected') continue\n      if (key === 'data-controller' && attributes[key] === 'stimulus-reflex')\n        continue\n      if (key === 'data-action' && attributes[key].includes('#__perform'))\n        continue\n      if (!Object.prototype.hasOwnProperty.call(attributes, key)) continue\n      selectors.push(`[${key}=\"${attributes[key]}\"]`)\n    }\n    try {\n      elements = document.querySelectorAll(selectors.join(''))\n    } catch (error) {\n      console.error(\n        'StimulusReflex encountered an error identifying the Stimulus element. Consider adding an #id to the element.',\n        error,\n        { 'CSS selector': selectors.join(''), attributes }\n      )\n    }\n  }\n\n  if (elements.length === 0)\n    console.warn(\n      'StimulusReflex was unable to find an element that matches the signature of the element which triggered this Reflex. Lifecycle callbacks and events cannot be raised unless your elements have distinguishing characteristics. Consider adding an #id or a randomized data-key to the element.',\n      { 'CSS selector': selectors.join(''), attributes }\n    )\n\n  if (elements.length > 1)\n    console.warn(\n      'StimulusReflex found multiple identical elements that match the signature of the element which triggered this Reflex. Lifecycle callbacks and events cannot be raised unless your elements have distinguishing characteristics. Consider adding an #id or a randomized data-key to the element.',\n      { 'CSS selector': selectors.join(''), attributes }\n    )\n\n  return elements.length === 1 ? elements[0] : null\n}\n","import { attributeValues } from './attributes'\n\n// Returns StimulusReflex controllers local to the passed element based on the data-controller attribute.\n//\nconst localReflexControllers = (app, element) => {\n  return attributeValues(\n    element.getAttribute(app.schema.controllerAttribute)\n  ).reduce((memo, name) => {\n    const controller = app.getControllerForElementAndIdentifier(element, name)\n    if (controller && controller.StimulusReflex) memo.push(controller)\n    return memo\n  }, [])\n}\n\n// Returns all StimulusReflex controllers for the passed element.\n// Traverses DOM ancestors starting with element.\n//\nexport const allReflexControllers = (app, element) => {\n  let controllers = []\n  while (element) {\n    controllers = controllers.concat(localReflexControllers(app, element))\n    element = element.parentElement\n  }\n  return controllers\n}\n","const logs = {}\n\nfunction request (\n  reflexId,\n  target,\n  args,\n  stimulusControllerIdentifier,\n  element\n) {\n  logs[reflexId] = new Date()\n  console.log(`\\u2191 stimulus \\u2191 ${target}`, {\n    reflexId,\n    args,\n    stimulusControllerIdentifier,\n    element\n  })\n}\n\nfunction success (response, options = { halted: false }) {\n  const { event } = response\n  const { reflexId, target, broadcaster } = event.detail.stimulusReflex || {}\n\n  console.log(`\\u2193 reflex \\u2193 ${target}`, {\n    reflexId,\n    duration: `${new Date() - logs[reflexId]}ms`,\n    halted: options.halted,\n    broadcaster\n  })\n  delete logs[reflexId]\n}\n\nfunction error (response) {\n  const { event, element } = response || {}\n  const { detail } = event || {}\n  const { reflexId, target, error, broadcaster } = detail.stimulusReflex || {}\n  console.error(`\\u2193 reflex \\u2193 ${target}`, {\n    reflexId,\n    duration: `${new Date() - logs[reflexId]}ms`,\n    error,\n    broadcaster,\n    payload: event.detail.stimulusReflex,\n    element\n  })\n  if (detail.stimulusReflex.serverMessage.body)\n    console.error(\n      `\\u2193 reflex \\u2193 ${target}`,\n      detail.stimulusReflex.serverMessage.body\n    )\n  delete logs[reflexId]\n}\n\nexport default {\n  request,\n  success,\n  error\n}\n","import { Controller } from 'stimulus'\nimport CableReady from 'cable_ready'\nimport serializeForm from 'form-serialize'\nimport { defaultSchema } from './schema'\nimport { getConsumer } from './consumer'\nimport { dispatchLifecycleEvent } from './lifecycle'\nimport { allReflexControllers } from './controllers'\nimport { uuidv4, debounce, emitEvent } from './utils'\nimport Log from './log'\nimport {\n  attributeValue,\n  attributeValues,\n  extractElementAttributes,\n  extractElementDataset,\n  findElement\n} from './attributes'\nimport { extractReflexName } from './utils'\n\n// A lambda that does nothing. Very zen; we are made of stars\nconst NOOP = () => {}\n\n// A reference to the Stimulus application registered with: StimulusReflex.initialize\nlet stimulusApplication\n\n// A reference to the ActionCable consumer registered with: StimulusReflex.initialize or getConsumer\nlet actionCableConsumer\n\n// A reference to an optional object called params defined in the StimulusReflex.initialize and passed to channels\nlet actionCableParams\n\n// Flag which will be false if the server does not accept the channel subscription\nlet actionCableSubscriptionActive = false\n\n// A dictionary of promise data\nconst promises = {}\n\n// Indicates if we should log calls to stimulate, etc...\nlet debugging = false\n\n// Subscribes a StimulusReflex controller to an ActionCable channel.\n// controller - the StimulusReflex controller to subscribe\n//\nconst createSubscription = controller => {\n  actionCableConsumer = actionCableConsumer || getConsumer()\n  const { channel } = controller.StimulusReflex\n  const subscription = { channel, ...actionCableParams }\n  const identifier = JSON.stringify(subscription)\n  let totalOperations\n  let reflexId\n\n  controller.StimulusReflex.subscription =\n    actionCableConsumer.subscriptions.findAll(identifier)[0] ||\n    actionCableConsumer.subscriptions.create(subscription, {\n      received: data => {\n        if (!data.cableReady) return\n        totalOperations = 0\n        ;['morph', 'innerHtml'].forEach(operation => {\n          if (data.operations[operation] && data.operations[operation].length) {\n            if (data.operations[operation][0].stimulusReflex) {\n              const urls = Array.from(\n                new Set(\n                  data.operations[operation].map(m => m.stimulusReflex.url)\n                )\n              )\n              if (urls.length !== 1 || urls[0] !== location.href) return\n              totalOperations += data.operations[operation].length\n              reflexId = data.operations[operation][0].stimulusReflex.reflexId\n            }\n          }\n        })\n        if (promises[reflexId]) {\n          promises[reflexId].totalOperations = totalOperations\n          promises[reflexId].completedOperations = 0\n        }\n        CableReady.perform(data.operations)\n      },\n      connected: () => {\n        actionCableSubscriptionActive = true\n        emitEvent('stimulus-reflex:connected')\n      },\n      rejected: () => {\n        actionCableSubscriptionActive = false\n        emitEvent('stimulus-reflex:rejected')\n        if (debugging) console.warn('Channel subscription was rejected.')\n      },\n      disconnected: willAttemptReconnect => {\n        actionCableSubscriptionActive = false\n        emitEvent('stimulus-reflex:disconnected', willAttemptReconnect)\n      }\n    })\n}\n\n// Extends a regular Stimulus controller with StimulusReflex behavior.\n//\n// Methods added to the Stimulus controller:\n// - stimulate\n// - __perform\n//\nconst extendStimulusController = controller => {\n  Object.assign(controller, {\n    // Indicates if the ActionCable web socket connection is open.\n    // The connection must be open before calling stimulate.\n    //\n    isActionCableConnectionOpen () {\n      return this.StimulusReflex.subscription.consumer.connection.isOpen()\n    },\n\n    // Invokes a server side reflex method.\n    //\n    // - target - the reflex target (full name of the server side reflex) i.e. 'ReflexClassName#method'\n    // - element - [optional] the element that triggered the reflex, defaults to this.element\n    // - options - [optional] an object that contains at least one of attrs, reflexId, selectors\n    // - *args - remaining arguments are forwarded to the server side reflex method\n    //\n    stimulate () {\n      const url = location.href\n      const args = Array.from(arguments)\n      const target = args.shift() || 'StimulusReflex::Reflex#default_reflex'\n      const element =\n        args[0] && args[0].nodeType === Node.ELEMENT_NODE\n          ? args.shift()\n          : this.element\n      if (\n        element.type === 'number' &&\n        element.validity &&\n        element.validity.badInput\n      ) {\n        return\n      }\n      const options = {}\n      if (\n        args[0] &&\n        typeof args[0] == 'object' &&\n        Object.keys(args[0]).filter(key =>\n          ['attrs', 'selectors', 'reflexId'].includes(key)\n        ).length\n      ) {\n        const opts = args.shift()\n        Object.keys(opts).forEach(o => (options[o] = opts[o]))\n      }\n      const attrs = options['attrs'] || extractElementAttributes(element)\n      const reflexId = options['reflexId'] || uuidv4()\n      let selectors = options['selectors'] || getReflexRoots(element)\n      if (typeof selectors == 'string') selectors = [selectors]\n      const datasetAttribute = stimulusApplication.schema.reflexDatasetAttribute\n      const dataset = extractElementDataset(element, datasetAttribute)\n      const data = {\n        target,\n        args,\n        url,\n        attrs,\n        dataset,\n        selectors,\n        reflexId,\n        permanent_attribute_name:\n          stimulusApplication.schema.reflexPermanentAttribute\n      }\n      const { subscription } = this.StimulusReflex\n\n      if (!this.isActionCableConnectionOpen())\n        throw 'The ActionCable connection is not open! `this.isActionCableConnectionOpen()` must return true before calling `this.stimulate()`'\n\n      if (!actionCableSubscriptionActive)\n        throw 'The ActionCable channel subscription for StimulusReflex was rejected.'\n\n      // lifecycle setup\n      element.reflexController = this\n      element.reflexData = data\n\n      dispatchLifecycleEvent('before', element, reflexId)\n\n      setTimeout(() => {\n        const { params } = element.reflexData || {}\n        element.reflexData = {\n          ...data,\n          params: {\n            ...params,\n            ...serializeForm(element.closest('form'), {\n              hash: true,\n              empty: true\n            })\n          }\n        }\n\n        subscription.send(element.reflexData)\n      })\n\n      if (debugging) {\n        Log.request(\n          reflexId,\n          target,\n          args,\n          this.context.scope.identifier,\n          element\n        )\n      }\n\n      const promise = new Promise((resolve, reject) => {\n        promises[reflexId] = {\n          resolve,\n          reject,\n          data\n        }\n      })\n\n      promise.reflexId = reflexId\n\n      if (debugging) promise.catch(NOOP)\n      return promise\n    },\n\n    // Wraps the call to stimulate for any data-reflex elements.\n    // This is internal and should not be invoked directly.\n    __perform (event) {\n      let element = event.target\n      let reflex\n\n      while (element && !reflex) {\n        reflex = element.getAttribute(\n          stimulusApplication.schema.reflexAttribute\n        )\n        if (!reflex || !reflex.trim().length) element = element.parentElement\n      }\n\n      const match = attributeValues(reflex).find(\n        reflex => reflex.split('->')[0] === event.type\n      )\n\n      if (match) {\n        event.preventDefault()\n        event.stopPropagation()\n        this.stimulate(match.split('->')[1], element)\n      }\n    }\n  })\n}\n\n// Registers a Stimulus controller and extends it with StimulusReflex behavior\n//\n// controller - the Stimulus controller\n// options - [optional] configuration\n//\nconst register = (controller, options = {}) => {\n  const channel = 'StimulusReflex::Channel'\n  controller.StimulusReflex = { ...options, channel }\n  createSubscription(controller)\n  extendStimulusController(controller)\n}\n\n// Default StimulusReflexController that is implicitly wired up as data-controller for any DOM elements\n// that have configured data-reflex. Note that this default can be overridden when initializing the application.\n// i.e. StimulusReflex.initialize(myStimulusApplication, MyCustomDefaultController);\n//\nclass StimulusReflexController extends Controller {\n  constructor (...args) {\n    super(...args)\n    register(this)\n  }\n}\n\n// Sets up declarative reflex behavior.\n// Any elements that define data-reflex will automatically be wired up with the default StimulusReflexController.\n//\nconst setupDeclarativeReflexes = debounce(() => {\n  document\n    .querySelectorAll(`[${stimulusApplication.schema.reflexAttribute}]`)\n    .forEach(element => {\n      const controllers = attributeValues(\n        element.getAttribute(stimulusApplication.schema.controllerAttribute)\n      )\n      const reflexes = attributeValues(\n        element.getAttribute(stimulusApplication.schema.reflexAttribute)\n      )\n      const actions = attributeValues(\n        element.getAttribute(stimulusApplication.schema.actionAttribute)\n      )\n      reflexes.forEach(reflex => {\n        const controller = findControllerByReflexString(\n          reflex,\n          allReflexControllers(stimulusApplication, element)\n        )\n        let action\n        if (controller) {\n          action = `${reflex.split('->')[0]}->${\n            controller.identifier\n          }#__perform`\n          if (!actions.includes(action)) actions.push(action)\n        } else {\n          action = `${reflex.split('->')[0]}->stimulus-reflex#__perform`\n          if (!controllers.includes('stimulus-reflex')) {\n            controllers.push('stimulus-reflex')\n          }\n          if (!actions.includes(action)) actions.push(action)\n        }\n      })\n      const controllerValue = attributeValue(controllers)\n      const actionValue = attributeValue(actions)\n      if (\n        controllerValue &&\n        element.getAttribute(stimulusApplication.schema.controllerAttribute) !=\n          controllerValue\n      ) {\n        element.setAttribute(\n          stimulusApplication.schema.controllerAttribute,\n          controllerValue\n        )\n      }\n      if (\n        actionValue &&\n        element.getAttribute(stimulusApplication.schema.actionAttribute) !=\n          actionValue\n      )\n        element.setAttribute(\n          stimulusApplication.schema.actionAttribute,\n          actionValue\n        )\n    })\n  emitEvent('stimulus-reflex:ready')\n}, 20)\n\n// Given a reflex string such as 'click->TestReflex#create' and a list of\n// controllers. It will find the matching controller based on the controller's\n// identifier. e.g. Given these controller identifiers ['foo', 'bar', 'test'],\n// it would select the 'test' controller.\nconst findControllerByReflexString = (reflexString, controllers) => {\n  const controller = controllers.find(controller => {\n    if (!controller.identifier) return\n\n    return (\n      extractReflexName(reflexString).toLowerCase() ===\n      controller.identifier.toLowerCase()\n    )\n  })\n\n  return controller || controllers[0]\n}\n\n// compute the DOM element(s) which will be the morph root\n// use the data-reflex-root attribute on the reflex or the controller\n// optional value is a CSS selector(s); comma-separated list\n// order of preference is data-reflex, data-controller, document body (default)\nconst getReflexRoots = element => {\n  let list = []\n  while (list.length === 0 && element) {\n    const reflexRoot = element.getAttribute(\n      stimulusApplication.schema.reflexRootAttribute\n    )\n    if (reflexRoot) {\n      if (reflexRoot.length === 0 && element.id) reflexRoot = `#${element.id}`\n      const selectors = reflexRoot.split(',').filter(s => s.trim().length)\n      if (selectors.length === 0) {\n        console.error(\n          `No value found for ${stimulusApplication.schema.reflexRootAttribute}. Add an #id to the element or provide a value for ${stimulusApplication.schema.reflexRootAttribute}.`,\n          element\n        )\n      }\n      list = list.concat(selectors.filter(s => document.querySelector(s)))\n    }\n    element = element.parentElement\n      ? element.parentElement.closest(\n          `[${stimulusApplication.schema.reflexRootAttribute}]`\n        )\n      : null\n  }\n  return list\n}\n\n// Initializes StimulusReflex by registering the default Stimulus controller with the passed Stimulus application.\n//\n// - application - the Stimulus application\n// - options\n//   * controller - [optional] the default StimulusReflexController\n//   * consumer - [optional] the ActionCable consumer\n//\nconst initialize = (application, initializeOptions = {}) => {\n  const { controller, consumer, debug, params } = initializeOptions\n  actionCableConsumer = consumer\n  actionCableParams = params\n  stimulusApplication = application\n  stimulusApplication.schema = { ...defaultSchema, ...application.schema }\n  stimulusApplication.register(\n    'stimulus-reflex',\n    controller || StimulusReflexController\n  )\n  debugging = !!debug\n}\n\nif (!document.stimulusReflexInitialized) {\n  document.stimulusReflexInitialized = true\n\n  window.addEventListener('load', () => {\n    setupDeclarativeReflexes()\n    const observer = new MutationObserver(setupDeclarativeReflexes)\n    observer.observe(document.documentElement, {\n      attributes: true,\n      childList: true,\n      subtree: true\n    })\n  })\n\n  // Trigger success and after lifecycle methods from before events (before-morph, before-inner-html) to ensure we can find a reference\n  // to the source element in case it gets removed from the DOM via morph.\n  // This is safe because the server side reflex completed successfully.\n  const beforeDOMUpdateHandler = event => {\n    const { selector, stimulusReflex } = event.detail || {}\n    if (!stimulusReflex) return\n    const { reflexId, attrs } = stimulusReflex\n    const element = findElement(attrs)\n    const promise = promises[reflexId]\n\n    promise.completedOperations++\n    if (promise.completedOperations < promise.totalOperations) return\n\n    const response = {\n      element,\n      event,\n      data: promise && promise.data\n    }\n\n    if (promise) {\n      delete promises[reflexId]\n      promise.resolve(response)\n    }\n\n    dispatchLifecycleEvent('success', element, reflexId)\n    if (debugging) Log.success(response)\n  }\n\n  document.addEventListener(\n    'cable-ready:before-inner-html',\n    beforeDOMUpdateHandler\n  )\n  document.addEventListener('cable-ready:before-morph', beforeDOMUpdateHandler)\n  document.addEventListener('stimulus-reflex:server-message', event => {\n    const { reflexId, attrs, serverMessage } = event.detail.stimulusReflex || {}\n    const { subject, body } = serverMessage\n    const element = findElement(attrs)\n    const promise = promises[reflexId]\n    const subjects = {\n      error: true,\n      halted: true,\n      nothing: true,\n      success: true\n    }\n\n    if (element && subject == 'error') element.reflexError = body\n\n    const response = {\n      data: promise && promise.data,\n      element,\n      event,\n      toString: () => body\n    }\n\n    if (promise) {\n      delete promises[reflexId]\n\n      if (subject == 'error') {\n        promise.reject(response)\n      } else {\n        promise.resolve(response)\n      }\n    }\n\n    if (element && subjects[subject])\n      dispatchLifecycleEvent(subject, element, reflexId)\n\n    if (debugging) {\n      switch (subject) {\n        case 'error':\n          Log.error(response)\n          break\n        case 'selector':\n          Log.success(response)\n          break\n        case 'nothing':\n          Log.success(response)\n          break\n        case 'halted':\n          Log.success(response, { halted: true })\n          break\n        default:\n          Log.success(response)\n          break\n      }\n    }\n  })\n}\n\nexport default {\n  initialize,\n  register,\n  get debug () {\n    return debugging\n  },\n  set debug (value) {\n    debugging = !!value\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nfunction __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nfunction __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nfunction __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\n\nvar Event = /** @class */ (function () {\r\n    function Event(type, target) {\r\n        this.target = target;\r\n        this.type = type;\r\n    }\r\n    return Event;\r\n}());\r\nvar ErrorEvent = /** @class */ (function (_super) {\r\n    __extends(ErrorEvent, _super);\r\n    function ErrorEvent(error, target) {\r\n        var _this = _super.call(this, 'error', target) || this;\r\n        _this.message = error.message;\r\n        _this.error = error;\r\n        return _this;\r\n    }\r\n    return ErrorEvent;\r\n}(Event));\r\nvar CloseEvent = /** @class */ (function (_super) {\r\n    __extends(CloseEvent, _super);\r\n    function CloseEvent(code, reason, target) {\r\n        if (code === void 0) { code = 1000; }\r\n        if (reason === void 0) { reason = ''; }\r\n        var _this = _super.call(this, 'close', target) || this;\r\n        _this.wasClean = true;\r\n        _this.code = code;\r\n        _this.reason = reason;\r\n        return _this;\r\n    }\r\n    return CloseEvent;\r\n}(Event));\n\n/*!\r\n * Reconnecting WebSocket\r\n * by Pedro Ladaria <pedro.ladaria@gmail.com>\r\n * https://github.com/pladaria/reconnecting-websocket\r\n * License MIT\r\n */\r\nvar getGlobalWebSocket = function () {\r\n    if (typeof WebSocket !== 'undefined') {\r\n        // @ts-ignore\r\n        return WebSocket;\r\n    }\r\n};\r\n/**\r\n * Returns true if given argument looks like a WebSocket class\r\n */\r\nvar isWebSocket = function (w) { return typeof w !== 'undefined' && !!w && w.CLOSING === 2; };\r\nvar DEFAULT = {\r\n    maxReconnectionDelay: 10000,\r\n    minReconnectionDelay: 1000 + Math.random() * 4000,\r\n    minUptime: 5000,\r\n    reconnectionDelayGrowFactor: 1.3,\r\n    connectionTimeout: 4000,\r\n    maxRetries: Infinity,\r\n    maxEnqueuedMessages: Infinity,\r\n    startClosed: false,\r\n    debug: false,\r\n};\r\nvar ReconnectingWebSocket = /** @class */ (function () {\r\n    function ReconnectingWebSocket(url, protocols, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        this._listeners = {\r\n            error: [],\r\n            message: [],\r\n            open: [],\r\n            close: [],\r\n        };\r\n        this._retryCount = -1;\r\n        this._shouldReconnect = true;\r\n        this._connectLock = false;\r\n        this._binaryType = 'blob';\r\n        this._closeCalled = false;\r\n        this._messageQueue = [];\r\n        /**\r\n         * An event listener to be called when the WebSocket connection's readyState changes to CLOSED\r\n         */\r\n        this.onclose = null;\r\n        /**\r\n         * An event listener to be called when an error occurs\r\n         */\r\n        this.onerror = null;\r\n        /**\r\n         * An event listener to be called when a message is received from the server\r\n         */\r\n        this.onmessage = null;\r\n        /**\r\n         * An event listener to be called when the WebSocket connection's readyState changes to OPEN;\r\n         * this indicates that the connection is ready to send and receive data\r\n         */\r\n        this.onopen = null;\r\n        this._handleOpen = function (event) {\r\n            _this._debug('open event');\r\n            var _a = _this._options.minUptime, minUptime = _a === void 0 ? DEFAULT.minUptime : _a;\r\n            clearTimeout(_this._connectTimeout);\r\n            _this._uptimeTimeout = setTimeout(function () { return _this._acceptOpen(); }, minUptime);\r\n            _this._ws.binaryType = _this._binaryType;\r\n            // send enqueued messages (messages sent before websocket open event)\r\n            _this._messageQueue.forEach(function (message) { return _this._ws.send(message); });\r\n            _this._messageQueue = [];\r\n            if (_this.onopen) {\r\n                _this.onopen(event);\r\n            }\r\n            _this._listeners.open.forEach(function (listener) { return _this._callEventListener(event, listener); });\r\n        };\r\n        this._handleMessage = function (event) {\r\n            _this._debug('message event');\r\n            if (_this.onmessage) {\r\n                _this.onmessage(event);\r\n            }\r\n            _this._listeners.message.forEach(function (listener) { return _this._callEventListener(event, listener); });\r\n        };\r\n        this._handleError = function (event) {\r\n            _this._debug('error event', event.message);\r\n            _this._disconnect(undefined, event.message === 'TIMEOUT' ? 'timeout' : undefined);\r\n            if (_this.onerror) {\r\n                _this.onerror(event);\r\n            }\r\n            _this._debug('exec error listeners');\r\n            _this._listeners.error.forEach(function (listener) { return _this._callEventListener(event, listener); });\r\n            _this._connect();\r\n        };\r\n        this._handleClose = function (event) {\r\n            _this._debug('close event');\r\n            _this._clearTimeouts();\r\n            if (_this._shouldReconnect) {\r\n                _this._connect();\r\n            }\r\n            if (_this.onclose) {\r\n                _this.onclose(event);\r\n            }\r\n            _this._listeners.close.forEach(function (listener) { return _this._callEventListener(event, listener); });\r\n        };\r\n        this._url = url;\r\n        this._protocols = protocols;\r\n        this._options = options;\r\n        if (this._options.startClosed) {\r\n            this._shouldReconnect = false;\r\n        }\r\n        this._connect();\r\n    }\r\n    Object.defineProperty(ReconnectingWebSocket, \"CONNECTING\", {\r\n        get: function () {\r\n            return 0;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket, \"OPEN\", {\r\n        get: function () {\r\n            return 1;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket, \"CLOSING\", {\r\n        get: function () {\r\n            return 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket, \"CLOSED\", {\r\n        get: function () {\r\n            return 3;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"CONNECTING\", {\r\n        get: function () {\r\n            return ReconnectingWebSocket.CONNECTING;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"OPEN\", {\r\n        get: function () {\r\n            return ReconnectingWebSocket.OPEN;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"CLOSING\", {\r\n        get: function () {\r\n            return ReconnectingWebSocket.CLOSING;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"CLOSED\", {\r\n        get: function () {\r\n            return ReconnectingWebSocket.CLOSED;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"binaryType\", {\r\n        get: function () {\r\n            return this._ws ? this._ws.binaryType : this._binaryType;\r\n        },\r\n        set: function (value) {\r\n            this._binaryType = value;\r\n            if (this._ws) {\r\n                this._ws.binaryType = value;\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"retryCount\", {\r\n        /**\r\n         * Returns the number or connection retries\r\n         */\r\n        get: function () {\r\n            return Math.max(this._retryCount, 0);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"bufferedAmount\", {\r\n        /**\r\n         * The number of bytes of data that have been queued using calls to send() but not yet\r\n         * transmitted to the network. This value resets to zero once all queued data has been sent.\r\n         * This value does not reset to zero when the connection is closed; if you keep calling send(),\r\n         * this will continue to climb. Read only\r\n         */\r\n        get: function () {\r\n            var bytes = this._messageQueue.reduce(function (acc, message) {\r\n                if (typeof message === 'string') {\r\n                    acc += message.length; // not byte size\r\n                }\r\n                else if (message instanceof Blob) {\r\n                    acc += message.size;\r\n                }\r\n                else {\r\n                    acc += message.byteLength;\r\n                }\r\n                return acc;\r\n            }, 0);\r\n            return bytes + (this._ws ? this._ws.bufferedAmount : 0);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"extensions\", {\r\n        /**\r\n         * The extensions selected by the server. This is currently only the empty string or a list of\r\n         * extensions as negotiated by the connection\r\n         */\r\n        get: function () {\r\n            return this._ws ? this._ws.extensions : '';\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"protocol\", {\r\n        /**\r\n         * A string indicating the name of the sub-protocol the server selected;\r\n         * this will be one of the strings specified in the protocols parameter when creating the\r\n         * WebSocket object\r\n         */\r\n        get: function () {\r\n            return this._ws ? this._ws.protocol : '';\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"readyState\", {\r\n        /**\r\n         * The current state of the connection; this is one of the Ready state constants\r\n         */\r\n        get: function () {\r\n            if (this._ws) {\r\n                return this._ws.readyState;\r\n            }\r\n            return this._options.startClosed\r\n                ? ReconnectingWebSocket.CLOSED\r\n                : ReconnectingWebSocket.CONNECTING;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"url\", {\r\n        /**\r\n         * The URL as resolved by the constructor\r\n         */\r\n        get: function () {\r\n            return this._ws ? this._ws.url : '';\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Closes the WebSocket connection or connection attempt, if any. If the connection is already\r\n     * CLOSED, this method does nothing\r\n     */\r\n    ReconnectingWebSocket.prototype.close = function (code, reason) {\r\n        if (code === void 0) { code = 1000; }\r\n        this._closeCalled = true;\r\n        this._shouldReconnect = false;\r\n        this._clearTimeouts();\r\n        if (!this._ws) {\r\n            this._debug('close enqueued: no ws instance');\r\n            return;\r\n        }\r\n        if (this._ws.readyState === this.CLOSED) {\r\n            this._debug('close: already closed');\r\n            return;\r\n        }\r\n        this._ws.close(code, reason);\r\n    };\r\n    /**\r\n     * Closes the WebSocket connection or connection attempt and connects again.\r\n     * Resets retry counter;\r\n     */\r\n    ReconnectingWebSocket.prototype.reconnect = function (code, reason) {\r\n        this._shouldReconnect = true;\r\n        this._closeCalled = false;\r\n        this._retryCount = -1;\r\n        if (!this._ws || this._ws.readyState === this.CLOSED) {\r\n            this._connect();\r\n        }\r\n        else {\r\n            this._disconnect(code, reason);\r\n            this._connect();\r\n        }\r\n    };\r\n    /**\r\n     * Enqueue specified data to be transmitted to the server over the WebSocket connection\r\n     */\r\n    ReconnectingWebSocket.prototype.send = function (data) {\r\n        if (this._ws && this._ws.readyState === this.OPEN) {\r\n            this._debug('send', data);\r\n            this._ws.send(data);\r\n        }\r\n        else {\r\n            var _a = this._options.maxEnqueuedMessages, maxEnqueuedMessages = _a === void 0 ? DEFAULT.maxEnqueuedMessages : _a;\r\n            if (this._messageQueue.length < maxEnqueuedMessages) {\r\n                this._debug('enqueue', data);\r\n                this._messageQueue.push(data);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Register an event handler of a specific event type\r\n     */\r\n    ReconnectingWebSocket.prototype.addEventListener = function (type, listener) {\r\n        if (this._listeners[type]) {\r\n            // @ts-ignore\r\n            this._listeners[type].push(listener);\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype.dispatchEvent = function (event) {\r\n        var e_1, _a;\r\n        var listeners = this._listeners[event.type];\r\n        if (listeners) {\r\n            try {\r\n                for (var listeners_1 = __values(listeners), listeners_1_1 = listeners_1.next(); !listeners_1_1.done; listeners_1_1 = listeners_1.next()) {\r\n                    var listener = listeners_1_1.value;\r\n                    this._callEventListener(event, listener);\r\n                }\r\n            }\r\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n            finally {\r\n                try {\r\n                    if (listeners_1_1 && !listeners_1_1.done && (_a = listeners_1.return)) _a.call(listeners_1);\r\n                }\r\n                finally { if (e_1) throw e_1.error; }\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * Removes an event listener\r\n     */\r\n    ReconnectingWebSocket.prototype.removeEventListener = function (type, listener) {\r\n        if (this._listeners[type]) {\r\n            // @ts-ignore\r\n            this._listeners[type] = this._listeners[type].filter(function (l) { return l !== listener; });\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype._debug = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (this._options.debug) {\r\n            // not using spread because compiled version uses Symbols\r\n            // tslint:disable-next-line\r\n            console.log.apply(console, __spread(['RWS>'], args));\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype._getNextDelay = function () {\r\n        var _a = this._options, _b = _a.reconnectionDelayGrowFactor, reconnectionDelayGrowFactor = _b === void 0 ? DEFAULT.reconnectionDelayGrowFactor : _b, _c = _a.minReconnectionDelay, minReconnectionDelay = _c === void 0 ? DEFAULT.minReconnectionDelay : _c, _d = _a.maxReconnectionDelay, maxReconnectionDelay = _d === void 0 ? DEFAULT.maxReconnectionDelay : _d;\r\n        var delay = 0;\r\n        if (this._retryCount > 0) {\r\n            delay =\r\n                minReconnectionDelay * Math.pow(reconnectionDelayGrowFactor, this._retryCount - 1);\r\n            if (delay > maxReconnectionDelay) {\r\n                delay = maxReconnectionDelay;\r\n            }\r\n        }\r\n        this._debug('next delay', delay);\r\n        return delay;\r\n    };\r\n    ReconnectingWebSocket.prototype._wait = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            setTimeout(resolve, _this._getNextDelay());\r\n        });\r\n    };\r\n    ReconnectingWebSocket.prototype._getNextUrl = function (urlProvider) {\r\n        if (typeof urlProvider === 'string') {\r\n            return Promise.resolve(urlProvider);\r\n        }\r\n        if (typeof urlProvider === 'function') {\r\n            var url = urlProvider();\r\n            if (typeof url === 'string') {\r\n                return Promise.resolve(url);\r\n            }\r\n            if (!!url.then) {\r\n                return url;\r\n            }\r\n        }\r\n        throw Error('Invalid URL');\r\n    };\r\n    ReconnectingWebSocket.prototype._connect = function () {\r\n        var _this = this;\r\n        if (this._connectLock || !this._shouldReconnect) {\r\n            return;\r\n        }\r\n        this._connectLock = true;\r\n        var _a = this._options, _b = _a.maxRetries, maxRetries = _b === void 0 ? DEFAULT.maxRetries : _b, _c = _a.connectionTimeout, connectionTimeout = _c === void 0 ? DEFAULT.connectionTimeout : _c, _d = _a.WebSocket, WebSocket = _d === void 0 ? getGlobalWebSocket() : _d;\r\n        if (this._retryCount >= maxRetries) {\r\n            this._debug('max retries reached', this._retryCount, '>=', maxRetries);\r\n            return;\r\n        }\r\n        this._retryCount++;\r\n        this._debug('connect', this._retryCount);\r\n        this._removeListeners();\r\n        if (!isWebSocket(WebSocket)) {\r\n            throw Error('No valid WebSocket class provided');\r\n        }\r\n        this._wait()\r\n            .then(function () { return _this._getNextUrl(_this._url); })\r\n            .then(function (url) {\r\n            // close could be called before creating the ws\r\n            if (_this._closeCalled) {\r\n                return;\r\n            }\r\n            _this._debug('connect', { url: url, protocols: _this._protocols });\r\n            _this._ws = _this._protocols\r\n                ? new WebSocket(url, _this._protocols)\r\n                : new WebSocket(url);\r\n            _this._ws.binaryType = _this._binaryType;\r\n            _this._connectLock = false;\r\n            _this._addListeners();\r\n            _this._connectTimeout = setTimeout(function () { return _this._handleTimeout(); }, connectionTimeout);\r\n        });\r\n    };\r\n    ReconnectingWebSocket.prototype._handleTimeout = function () {\r\n        this._debug('timeout event');\r\n        this._handleError(new ErrorEvent(Error('TIMEOUT'), this));\r\n    };\r\n    ReconnectingWebSocket.prototype._disconnect = function (code, reason) {\r\n        if (code === void 0) { code = 1000; }\r\n        this._clearTimeouts();\r\n        if (!this._ws) {\r\n            return;\r\n        }\r\n        this._removeListeners();\r\n        try {\r\n            this._ws.close(code, reason);\r\n            this._handleClose(new CloseEvent(code, reason, this));\r\n        }\r\n        catch (error) {\r\n            // ignore\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype._acceptOpen = function () {\r\n        this._debug('accept open');\r\n        this._retryCount = 0;\r\n    };\r\n    ReconnectingWebSocket.prototype._callEventListener = function (event, listener) {\r\n        if ('handleEvent' in listener) {\r\n            // @ts-ignore\r\n            listener.handleEvent(event);\r\n        }\r\n        else {\r\n            // @ts-ignore\r\n            listener(event);\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype._removeListeners = function () {\r\n        if (!this._ws) {\r\n            return;\r\n        }\r\n        this._debug('removeListeners');\r\n        this._ws.removeEventListener('open', this._handleOpen);\r\n        this._ws.removeEventListener('close', this._handleClose);\r\n        this._ws.removeEventListener('message', this._handleMessage);\r\n        // @ts-ignore\r\n        this._ws.removeEventListener('error', this._handleError);\r\n    };\r\n    ReconnectingWebSocket.prototype._addListeners = function () {\r\n        if (!this._ws) {\r\n            return;\r\n        }\r\n        this._debug('addListeners');\r\n        this._ws.addEventListener('open', this._handleOpen);\r\n        this._ws.addEventListener('close', this._handleClose);\r\n        this._ws.addEventListener('message', this._handleMessage);\r\n        // @ts-ignore\r\n        this._ws.addEventListener('error', this._handleError);\r\n    };\r\n    ReconnectingWebSocket.prototype._clearTimeouts = function () {\r\n        clearTimeout(this._connectTimeout);\r\n        clearTimeout(this._uptimeTimeout);\r\n    };\r\n    return ReconnectingWebSocket;\r\n}());\n\nexport default ReconnectingWebSocket;\n","import ReconnectingWebSocket from \"reconnecting-websocket\"\n\n// read up on the default options that actioncable has for websockets.\n\nfunction createWebSocketURL(url) {\n    if (typeof url === \"function\") {\n      url = url()\n    }\n\n    if (url && !/^wss?:/i.test(url)) {\n      const a = document.createElement(\"a\")\n      a.href = url\n      // Fix populating Location properties in IE. Otherwise, protocol will be blank.\n      a.href = a.href\n      a.protocol = a.protocol.replace(\"http\", \"ws\")\n      return a.href\n    } else {\n      return url\n    }\n}\n\nconst extend = function(object, properties) {\n    if (properties != null) {\n      for (let key in properties) {\n        const value = properties[key]\n        object[key] = value\n      }\n    }\n    return object\n}\n\nclass Subscription {\n    constructor(consumer, params = {}, mixin) {\n        this.consumer = consumer\n        this.identifier = JSON.stringify(params)\n        extend(this, mixin)\n    }\n\n    send(data) {\n        return this.consumer.send(data, this.identifier)\n      }\n\n    unsubscribe() {\n        return this.consumer.subscriptions.remove(this)\n    }\n}\n\nclass Subscriptions {\n    constructor(consumer) {\n        this.consumer = consumer\n        this.subscriptions = []\n    }\n\n    findAll(identifier) {\n        return this.subscriptions.filter((s) => s.identifier === identifier)\n    }\n\n    add(subscription) {\n        this.subscriptions.push(subscription)\n        this.consumer.connection.send(JSON.stringify({\n            type: 'subscribe',\n            channelName: subscription.identifier\n        }))\n        return subscription\n    }\n\n    create(channelName, mixin) {\n        const channel = channelName\n        const params = typeof channel === \"object\" ? channel : {channel}\n        const subscription = new Subscription(this.consumer, params, mixin)\n        return this.add(subscription)\n    }\n\n    forget(subscription) {\n      this.subscriptions = (this.subscriptions.filter((s) => s !== subscription))\n      return subscription\n    }\n\n    remove(subscription) {\n      this.forget(subscription)\n      if (this.findAll(subscription.identifier).length == 0) {\n        this.consumer.connection.send(JSON.stringify({\n            type: 'unsubscribe',\n            channelName: subscription.identifier\n        }))\n      }\n      return subscription\n    }\n\n    notify(subscription, callbackName, ...args) {\n      let subscriptions\n      if (typeof subscription === \"string\") {\n        subscriptions = this.findAll(subscription)\n      } else {\n        subscriptions = [subscription]\n      }\n\n      return subscriptions.map((subscription) =>\n        (typeof subscription[callbackName] === \"function\" ? subscription[callbackName](...args) : undefined))\n    }\n\n    notifyAll(callbackName, ...args) {\n      return this.subscriptions.map((subscription) =>\n        this.notify(subscription, callbackName, ...args))\n    }\n}\n\nexport default class WebsocketConsumer {\n    constructor(url, options = {}) {\n        this._url = url\n        this.subscriptions = new Subscriptions(this)\n\n        options = {maxRetries: 3, ...options}\n        this.connection = new ReconnectingWebSocket(url, [], options)\n        this.connection.isOpen = function open() {\n            return this.readyState === ReconnectingWebSocket.OPEN;\n        }\n\n        this.connection.addEventListener('open', (event) => {\n          this.subscriptions.notifyAll('connected')\n        })\n\n        this.connection.addEventListener(\"message\", (event) => {\n            let data = JSON.parse(event.data)\n            if (data.meta_type === 'cookie') {\n              document.cookie = `${data.key}=${data.value||\"\"}; max-age=${data.max_age}; path=/`;\n              return\n            }\n            this.subscriptions.notify(data.identifier, 'received', data)\n        })\n    }\n\n    get url() {\n        return createWebSocketURL(this._url)\n    }\n\n    send(data, identifier) {\n        data.identifier = identifier\n        return this.connection.send(JSON.stringify(data))\n    }\n\n    connect() {\n        return this.connection.open()\n    }\n\n    disconnect() {\n        return this.connection.close()\n    }\n}\n","import { Application } from 'stimulus'\nimport StimulusReflex from 'stimulus_reflex'\n// because travis had issues with 'sockpuppet-js' we had to do this.\nimport WebsocketConsumer from '../../javascript/stimulus-websocket/index'\n\nconst application = Application.start()\nconst consumer = new WebsocketConsumer(\n  `ws://${window.location.host}/ws/sockpuppet-sync`, {debug: false}\n)\n\nStimulusReflex.initialize(application, { consumer })\n"],"sourceRoot":""}