{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/@stimulus/core/dist/src/event_listener.js","webpack:///./node_modules/@stimulus/core/dist/src/dispatcher.js","webpack:///./node_modules/@stimulus/core/dist/src/action_descriptor.js","webpack:///./node_modules/@stimulus/core/dist/src/action.js","webpack:///./node_modules/@stimulus/core/dist/src/binding.js","webpack:///./node_modules/@stimulus/mutation-observers/dist/src/element_observer.js","webpack:///./node_modules/@stimulus/mutation-observers/dist/src/attribute_observer.js","webpack:///./node_modules/@stimulus/multimap/dist/src/set_operations.js","webpack:///./node_modules/@stimulus/multimap/dist/src/multimap.js","webpack:///./node_modules/@stimulus/multimap/dist/src/indexed_multimap.js","webpack:///./node_modules/@stimulus/mutation-observers/dist/src/token_list_observer.js","webpack:///./node_modules/@stimulus/mutation-observers/dist/src/value_list_observer.js","webpack:///./node_modules/@stimulus/core/dist/src/binding_observer.js","webpack:///./node_modules/@stimulus/core/dist/src/context.js","webpack:///./node_modules/@stimulus/core/dist/src/definition.js","webpack:///./node_modules/@stimulus/core/dist/src/module.js","webpack:///./node_modules/@stimulus/core/dist/src/data_map.js","webpack:///./node_modules/@stimulus/core/dist/src/selectors.js","webpack:///./node_modules/@stimulus/core/dist/src/target_set.js","webpack:///./node_modules/@stimulus/core/dist/src/scope.js","webpack:///./node_modules/@stimulus/core/dist/src/scope_observer.js","webpack:///./node_modules/@stimulus/core/dist/src/router.js","webpack:///./node_modules/@stimulus/core/dist/src/schema.js","webpack:///./node_modules/@stimulus/core/dist/src/application.js","webpack:///./node_modules/@stimulus/core/dist/src/target_properties.js","webpack:///./node_modules/@stimulus/core/dist/src/controller.js","webpack:///./node_modules/stimulus_reflex/javascript/schema.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/enums.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/active_element.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/utils.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/morph_callbacks.js","webpack:///./node_modules/morphdom/dist/morphdom-esm.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/operation_store.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/operations.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/action_cable.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/cable_ready.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/stream_from_element.js","webpack:///./node_modules/stimulus_reflex/node_modules/cable_ready/javascript/index.js","webpack:///./node_modules/stimulus_reflex/javascript/debug.js","webpack:///./node_modules/stimulus_reflex/javascript/utils.js","webpack:///./node_modules/stimulus_reflex/javascript/lifecycle.js","webpack:///./node_modules/stimulus_reflex/javascript/transports/action_cable.js","webpack:///./node_modules/stimulus_reflex/javascript/deprecate.js","webpack:///./node_modules/stimulus_reflex/javascript/attributes.js","webpack:///./node_modules/stimulus_reflex/javascript/controllers.js","webpack:///./node_modules/stimulus_reflex/javascript/isolation_mode.js","webpack:///./node_modules/stimulus_reflex/javascript/log.js","webpack:///./node_modules/stimulus_reflex/javascript/reflexes.js","webpack:///./node_modules/stimulus_reflex/javascript/callbacks.js","webpack:///./node_modules/stimulus_reflex/javascript/stimulus_reflex.js","webpack:///./node_modules/reconnecting-websocket/dist/reconnecting-websocket-mjs.js","webpack:///./javascript/stimulus-websocket/websocket.js","webpack:///./javascript/stimulus-websocket/index.js","webpack:///./sockpuppet/js/sockpuppet.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","EventListener","eventTarget","eventName","this","unorderedBindings","Set","connect","addEventListener","disconnect","removeEventListener","bindingConnected","binding","add","bindingDisconnected","delete","handleEvent","event","extendedEvent","stopImmediatePropagation_1","stopImmediatePropagation","assign","immediatePropagationStopped","extendEvent","_i","_a","bindings","length","Array","from","sort","left","right","leftIndex","index","rightIndex","configurable","Dispatcher","application","eventListenerMaps","Map","started","start","eventListeners","forEach","eventListener","stop","values","reduce","listeners","map","concat","fetchEventListenerForBinding","handleError","error","message","detail","fetchEventListener","eventListenerMap","fetchEventListenerMapForEventTarget","createEventListener","set","descriptorPattern","Action","element","descriptor","tagName","toLowerCase","defaultEventNames","getDefaultEventNameForElement","identifier","methodName","forToken","token","descriptorString","content","matches","trim","match","eventTargetName","window","document","toString","eventNameSuffix","e","getAttribute","Error","Binding","context","action","willBeInvokedByEvent","invokeWithEvent","method","controller","target","Element","contains","scope","containsElement","ElementObserver","delegate","_this","elements","mutationObserver","MutationObserver","mutations","processMutations","observe","attributes","childList","subtree","refresh","takeRecords","matchElementsInTree","has","removeElement","_b","_c","addElement","mutations_1","mutation","processMutation","type","processAttributeChange","attributeName","processRemovedNodes","removedNodes","processAddedNodes","addedNodes","node","elementAttributeChanged","matchElement","nodes","elementFromNode","processTree","elementIsActive","tree","processor","nodeType","Node","ELEMENT_NODE","isConnected","elementMatched","elementUnmatched","AttributeObserver","elementObserver","hasAttribute","querySelectorAll","selector","elementMatchedAttribute","elementUnmatchedAttribute","elementAttributeValueChanged","fetch","del","size","prune","Multimap","valuesByKey","hasKey","hasValue","some","getValuesForKey","getKeysForValue","filter","__extends","extendStatics","setPrototypeOf","__proto__","b","__","constructor","_super","IndexedMultimap","keysByValue","keys","TokenListObserver","attributeObserver","tokensByElement","tokensMatched","readTokensForElement","refreshTokensForElement","unmatchedTokens","matchedTokens","tokensUnmatched","tokens","tokenMatched","tokenUnmatched","previousTokens","currentTokens","firstDifferingIndex","Math","max","_","findIndex","tokensAreEqual","slice","tokenString","split","parseTokenString","ValueListObserver","tokenListObserver","parseResultsByToken","WeakMap","valuesByTokenByElement","fetchParseResultForToken","fetchValuesByTokenForElement","elementMatchedValue","elementUnmatchedValue","parseResult","parseToken","valuesByToken","parseValueForToken","BindingObserver","bindingsByAction","valueListObserver","actionAttribute","disconnectAllActions","schema","connectAction","disconnectAction","clear","Context","controllerConstructor","bindingObserver","dispatcher","initialize","parentElement","blessControllerConstructor","extend","bless","extendWithReflect","Controller","_newTarget","Reflect","construct","arguments","a","apply","Module","definition","blessDefinition","contextsByScope","connectedContexts","connectContextForScope","fetchContextForScope","disconnectContextForScope","DataMap","getFormattedKey","setAttribute","removeAttribute","replace","char","attributeValueContainsToken","TargetSet","targetName","find","targetNames","getSelectorForTargetNames","findElement","findAll","findAllElements","getSelectorForTargetName","join","targetDescriptor","targetAttribute","Scope","targets","data","head","tail","filterElements","closest","controllerSelector","controllerAttribute","ScopeObserver","scopesByIdentifierByElement","scopeReferenceCounts","scopesByIdentifier","fetchScopesByIdentifierForElement","referenceCount","scopeConnected","scopeDisconnected","Router","scopeObserver","modulesByIdentifier","contexts","loadDefinition","unloadIdentifier","connectModule","disconnectModule","getContextForElementAndIdentifier","defaultSchema","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","rejected","result","done","then","__generator","body","f","y","g","label","sent","trys","ops","verb","iterator","v","op","TypeError","pop","push","Application","documentElement","router","readyState","register","load","rest","definitions","isArray","unload","identifiers","getControllerForElementAndIdentifier","console","defineTargetProperties","ancestors","getPrototypeOf","getAncestorsForConstructor","getOwnTargetNamesForConstructor","getTargetNamesForConstructor","properties","charAt","toUpperCase","capitalize","reflexAttribute","reflexPermanentAttribute","reflexRootAttribute","reflexDatasetAttribute","reflexDatasetAllAttribute","reflexSerializeFormAttribute","inputTags","INPUT","TEXTAREA","SELECT","mutableTags","OPTION","textInputTypes","color","date","datetime","email","month","number","password","range","search","tel","text","textarea","time","url","week","activeElement","assignFocus","focusElement","querySelector","focus","dispatch","evt","CustomEvent","bubbles","cancelable","dispatchEvent","jQuery","trigger","getClassNames","names","flat","processElements","operation","callback","selectAll","kebabize","str","letter","idx","operate","cancel","delay","setTimeout","before","after","shouldMorph","fromEl","toEl","shouldMorphCallbacks","includes","didMorph","el","didMorphCallbacks","isEqualNode","permanentAttributeName","permanent","ignore","attribute","doc","undefined","HAS_TEMPLATE_SUPPORT","createElement","HAS_RANGE_SUPPORT","createRange","toElement","template","innerHTML","childNodes","createFragmentFromTemplate","selectNode","createContextualFragment","createFragmentFromRange","fragment","createFragmentFromWrap","compareNodeNames","fromCodeStart","toCodeStart","fromNodeName","nodeName","toNodeName","charCodeAt","syncBooleanAttrProp","specialElHandlers","parentNode","parentName","selected","selectedIndex","newValue","firstChild","oldValue","nodeValue","placeholder","optgroup","curChild","nextSibling","noop","defaultGetNodeKey","id","morphAttrs","fromNode","toNode","options","toNodeHtml","getNodeKey","onBeforeNodeAdded","onNodeAdded","onBeforeElUpdated","onElUpdated","onBeforeNodeDiscarded","onNodeDiscarded","onBeforeElChildrenUpdated","childrenOnly","fromNodesLookup","keyedRemovalList","addKeyedRemoval","removeNode","skipKeyedNodes","removeChild","walkDiscardedChildNodes","handleNodeAdded","unmatchedFromEl","replaceChild","morphEl","toElKey","curToNodeKey","curFromNodeKey","fromNextSibling","toNextSibling","matchingFromEl","curToNodeChild","curFromNodeChild","outer","isSameNode","curFromNodeType","isCompatible","insertBefore","appendChild","onBeforeNodeAddedResult","actualize","ownerDocument","cleanupFromEl","specialElHandler","morphChildren","indexTree","namespaceURI","morphedNode","morphedNodeType","toNodeType","nextChild","moveChildren","createElementNS","len","elToRemove","morphdomFactory","attr","attrName","attrNamespaceURI","attrValue","toNodeAttrs","localName","getAttributeNS","prefix","setAttributeNS","fromNodeAttrs","hasAttributeNS","removeAttributeNS","append","callee","html","focusSelector","insertAdjacentHTML","graft","parent","innerHtml","insertAdjacentHtml","position","insertAdjacentText","morph","String","ordinal","children","indexOf","outerHtml","outerHTML","prepend","remove","textContent","addCssClass","classList","removeCssClass","setDatasetProperty","dataset","setProperty","setStyle","style","setStyles","styles","entries","setValue","setMeta","meta","clearStorage","sessionStorage","localStorage","go","delta","history","pushState","state","title","removeStorageItem","removeItem","replaceState","scrollIntoView","setCookie","cookie","setFocus","setStorageItem","setItem","consoleLog","level","log","consoleTable","columns","table","notification","Notification","requestPermission","permission","newOperations","perform","operations","emitMissingElementWarnings","xpath","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","cableReadyOperation","all","HTMLElement","preview","channel","subscriptions","cableReady","unsubscribe","customElements","define","performAsync","err","initializeOptions","consumer","setConsumer","addOperation","addOperations","warn","debugging","uuidv4","crypto","msCrypto","getRandomValues","Uint8Array","camelize","uppercaseFirstLetter","$1","substr","emitEvent","elementToXPath","ix","siblings","sibling","XPathToElement","XPathToArray","reverse","snapshotList","ORDERED_NODE_SNAPSHOT_TYPE","snapshots","snapshotLength","snapshotItem","invokeLifecycleMethod","stage","reflexElement","controllerElement","reflexId","payload","reflexData","reflexController","reflex","reflexMethodName","specificLifecycleMethod","genericLifecycleMethod","reflexError","finalStage","deleteProperty","dispatchLifecycleEvent","enabled","warned","subscriptionActive","connected","Debug","disconnected","willAttemptReconnect","params","createSubscription","StimulusReflex","subscription","JSON","stringify","received","consumerValue","paramsValue","deprecationWarnings","attributeValue","attributeValues","extractElementAttributes","attrs","memo","checked","tag_name","multipleInstances","collectedOptions","elem","collectCheckedOptions","getElementsFromTokens","xPath","extractDataAttributes","startsWith","localReflexControllers","app","isolationMode","request","args","timestamp","Date","success","serverMessage","stimulusReflex","progress","totalOperations","completedOperations","duration","halted","subject","reflexes","tabId","reflexOperations","splice","urls","location","href","disabled","xpathController","xpathElement","registerReflex","pendingOperations","piggybackOperations","promise","catch","setupDeclarativeReflexes","timeoutId","clearTimeout","debounce","controllers","reflexAttributeNames","actions","reflexName","reflexString","extractReflexName","findControllerByReflexName","allReflexControllers","controllerValue","actionValue","reflexControllerMethods","connection","isOpen","shift","validity","badInput","opts","selectors","list","reflexRoot","getReflexRoots","resolveLate","allDataset","allTokens","datasetElements","datasetAllElements","datasetAttributes","acc","ele","elementDataset","datasetAll","elementAttributes","extractElementDataset","isActionCableConnectionOpen","serializeAttribute","form","formData","w","FormData","encodeURIComponent","submitButton","serializeForm","send","preventDefault","stopPropagation","stimulate","beforeDOMUpdate","afterDOMUpdate","super","nothing","debug","isolate","deprecate","attributeFilter","useReflex","__read","ar","__spread","Event","ErrorEvent","CloseEvent","code","reason","wasClean","getGlobalWebSocket","WebSocket","DEFAULT","maxReconnectionDelay","minReconnectionDelay","random","minUptime","reconnectionDelayGrowFactor","connectionTimeout","maxRetries","Infinity","maxEnqueuedMessages","startClosed","ReconnectingWebSocket","protocols","_listeners","open","close","_retryCount","_shouldReconnect","_connectLock","_binaryType","_closeCalled","_messageQueue","onclose","onerror","onmessage","onopen","_handleOpen","_debug","_options","_connectTimeout","_uptimeTimeout","_acceptOpen","_ws","binaryType","listener","_callEventListener","_handleMessage","_handleError","_disconnect","_connect","_handleClose","_clearTimeouts","_url","_protocols","CONNECTING","OPEN","CLOSING","CLOSED","Blob","byteLength","bufferedAmount","extensions","protocol","reconnect","e_1","listeners_1","__values","listeners_1_1","e_1_1","return","_getNextDelay","_d","pow","_wait","_getNextUrl","urlProvider","_removeListeners","_addListeners","_handleTimeout","Subscription","mixin","Subscriptions","channelName","forget","callbackName","notify","globalConsumer","Sockpuppet","self","notifyAll","sub","parse","meta_type","max_age","test","createWebSocketURL","host"],"mappings":"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","file":"sockpuppet.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","var EventListener = /** @class */ (function () {\n    function EventListener(eventTarget, eventName) {\n        this.eventTarget = eventTarget;\n        this.eventName = eventName;\n        this.unorderedBindings = new Set;\n    }\n    EventListener.prototype.connect = function () {\n        this.eventTarget.addEventListener(this.eventName, this, false);\n    };\n    EventListener.prototype.disconnect = function () {\n        this.eventTarget.removeEventListener(this.eventName, this, false);\n    };\n    // Binding observer delegate\n    /** @hidden */\n    EventListener.prototype.bindingConnected = function (binding) {\n        this.unorderedBindings.add(binding);\n    };\n    /** @hidden */\n    EventListener.prototype.bindingDisconnected = function (binding) {\n        this.unorderedBindings.delete(binding);\n    };\n    EventListener.prototype.handleEvent = function (event) {\n        var extendedEvent = extendEvent(event);\n        for (var _i = 0, _a = this.bindings; _i < _a.length; _i++) {\n            var binding = _a[_i];\n            if (extendedEvent.immediatePropagationStopped) {\n                break;\n            }\n            else {\n                binding.handleEvent(extendedEvent);\n            }\n        }\n    };\n    Object.defineProperty(EventListener.prototype, \"bindings\", {\n        get: function () {\n            return Array.from(this.unorderedBindings).sort(function (left, right) {\n                var leftIndex = left.index, rightIndex = right.index;\n                return leftIndex < rightIndex ? -1 : leftIndex > rightIndex ? 1 : 0;\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return EventListener;\n}());\nexport { EventListener };\nfunction extendEvent(event) {\n    if (\"immediatePropagationStopped\" in event) {\n        return event;\n    }\n    else {\n        var stopImmediatePropagation_1 = event.stopImmediatePropagation;\n        return Object.assign(event, {\n            immediatePropagationStopped: false,\n            stopImmediatePropagation: function () {\n                this.immediatePropagationStopped = true;\n                stopImmediatePropagation_1.call(this);\n            }\n        });\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnRfbGlzdGVuZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXZlbnRfbGlzdGVuZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUE7SUFLRSx1QkFBWSxXQUF3QixFQUFFLFNBQWlCO1FBQ3JELElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFBO1FBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFBO1FBQzFCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsQ0FBQTtJQUNsQyxDQUFDO0lBRUQsK0JBQU8sR0FBUDtRQUNFLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUE7SUFDaEUsQ0FBQztJQUVELGtDQUFVLEdBQVY7UUFDRSxJQUFJLENBQUMsV0FBVyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ25FLENBQUM7SUFFRCw0QkFBNEI7SUFFNUIsY0FBYztJQUNkLHdDQUFnQixHQUFoQixVQUFpQixPQUFnQjtRQUMvQixJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3JDLENBQUM7SUFFRCxjQUFjO0lBQ2QsMkNBQW1CLEdBQW5CLFVBQW9CLE9BQWdCO1FBQ2xDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDeEMsQ0FBQztJQUVELG1DQUFXLEdBQVgsVUFBWSxLQUFZO1FBQ3RCLElBQU0sYUFBYSxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUN4QyxLQUFzQixVQUFhLEVBQWIsS0FBQSxJQUFJLENBQUMsUUFBUSxFQUFiLGNBQWEsRUFBYixJQUFhLEVBQUU7WUFBaEMsSUFBTSxPQUFPLFNBQUE7WUFDaEIsSUFBSSxhQUFhLENBQUMsMkJBQTJCLEVBQUU7Z0JBQzdDLE1BQUs7YUFDTjtpQkFBTTtnQkFDTCxPQUFPLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFBO2FBQ25DO1NBQ0Y7SUFDSCxDQUFDO0lBRUQsc0JBQUksbUNBQVE7YUFBWjtZQUNFLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxJQUFJLEVBQUUsS0FBSztnQkFDekQsSUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxVQUFVLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQTtnQkFDdEQsT0FBTyxTQUFTLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDckUsQ0FBQyxDQUFDLENBQUE7UUFDSixDQUFDOzs7T0FBQTtJQUNILG9CQUFDO0FBQUQsQ0FBQyxBQWhERCxJQWdEQzs7QUFFRCxxQkFBcUIsS0FBWTtJQUMvQixJQUFJLDZCQUE2QixJQUFJLEtBQUssRUFBRTtRQUMxQyxPQUFPLEtBQUssQ0FBQTtLQUNiO1NBQU07UUFDRyxJQUFBLDJEQUF3QixDQUFVO1FBQzFDLE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUU7WUFDMUIsMkJBQTJCLEVBQUUsS0FBSztZQUNsQyx3QkFBd0I7Z0JBQ3RCLElBQUksQ0FBQywyQkFBMkIsR0FBRyxJQUFJLENBQUE7Z0JBQ3ZDLDBCQUF3QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUNyQyxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0tBQ0g7QUFDSCxDQUFDIn0=","import { EventListener } from \"./event_listener\";\nvar Dispatcher = /** @class */ (function () {\n    function Dispatcher(application) {\n        this.application = application;\n        this.eventListenerMaps = new Map;\n        this.started = false;\n    }\n    Dispatcher.prototype.start = function () {\n        if (!this.started) {\n            this.started = true;\n            this.eventListeners.forEach(function (eventListener) { return eventListener.connect(); });\n        }\n    };\n    Dispatcher.prototype.stop = function () {\n        if (this.started) {\n            this.started = false;\n            this.eventListeners.forEach(function (eventListener) { return eventListener.disconnect(); });\n        }\n    };\n    Object.defineProperty(Dispatcher.prototype, \"eventListeners\", {\n        get: function () {\n            return Array.from(this.eventListenerMaps.values())\n                .reduce(function (listeners, map) { return listeners.concat(Array.from(map.values())); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Binding observer delegate\n    /** @hidden */\n    Dispatcher.prototype.bindingConnected = function (binding) {\n        this.fetchEventListenerForBinding(binding).bindingConnected(binding);\n    };\n    /** @hidden */\n    Dispatcher.prototype.bindingDisconnected = function (binding) {\n        this.fetchEventListenerForBinding(binding).bindingDisconnected(binding);\n    };\n    // Error handling\n    Dispatcher.prototype.handleError = function (error, message, detail) {\n        if (detail === void 0) { detail = {}; }\n        this.application.handleError(error, \"Error \" + message, detail);\n    };\n    Dispatcher.prototype.fetchEventListenerForBinding = function (binding) {\n        var eventTarget = binding.eventTarget, eventName = binding.eventName;\n        return this.fetchEventListener(eventTarget, eventName);\n    };\n    Dispatcher.prototype.fetchEventListener = function (eventTarget, eventName) {\n        var eventListenerMap = this.fetchEventListenerMapForEventTarget(eventTarget);\n        var eventListener = eventListenerMap.get(eventName);\n        if (!eventListener) {\n            eventListener = this.createEventListener(eventTarget, eventName);\n            eventListenerMap.set(eventName, eventListener);\n        }\n        return eventListener;\n    };\n    Dispatcher.prototype.createEventListener = function (eventTarget, eventName) {\n        var eventListener = new EventListener(eventTarget, eventName);\n        if (this.started) {\n            eventListener.connect();\n        }\n        return eventListener;\n    };\n    Dispatcher.prototype.fetchEventListenerMapForEventTarget = function (eventTarget) {\n        var eventListenerMap = this.eventListenerMaps.get(eventTarget);\n        if (!eventListenerMap) {\n            eventListenerMap = new Map;\n            this.eventListenerMaps.set(eventTarget, eventListenerMap);\n        }\n        return eventListenerMap;\n    };\n    return Dispatcher;\n}());\nexport { Dispatcher };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlzcGF0Y2hlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kaXNwYXRjaGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUVoRDtJQUtFLG9CQUFZLFdBQXdCO1FBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFBO1FBQzlCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLEdBQUcsQ0FBQTtRQUNoQyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQTtJQUN0QixDQUFDO0lBRUQsMEJBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFBO1lBQ25CLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLFVBQUEsYUFBYSxJQUFJLE9BQUEsYUFBYSxDQUFDLE9BQU8sRUFBRSxFQUF2QixDQUF1QixDQUFDLENBQUE7U0FDdEU7SUFDSCxDQUFDO0lBRUQseUJBQUksR0FBSjtRQUNFLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQTtZQUNwQixJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxVQUFBLGFBQWEsSUFBSSxPQUFBLGFBQWEsQ0FBQyxVQUFVLEVBQUUsRUFBMUIsQ0FBMEIsQ0FBQyxDQUFBO1NBQ3pFO0lBQ0gsQ0FBQztJQUVELHNCQUFJLHNDQUFjO2FBQWxCO1lBQ0UsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsQ0FBQztpQkFDL0MsTUFBTSxDQUFDLFVBQUMsU0FBUyxFQUFFLEdBQUcsSUFBSyxPQUFBLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUExQyxDQUEwQyxFQUFFLEVBQXFCLENBQUMsQ0FBQTtRQUNsRyxDQUFDOzs7T0FBQTtJQUVELDRCQUE0QjtJQUU1QixjQUFjO0lBQ2QscUNBQWdCLEdBQWhCLFVBQWlCLE9BQWdCO1FBQy9CLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxPQUFPLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUN0RSxDQUFDO0lBRUQsY0FBYztJQUNkLHdDQUFtQixHQUFuQixVQUFvQixPQUFnQjtRQUNsQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsT0FBTyxDQUFDLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDekUsQ0FBQztJQUVELGlCQUFpQjtJQUVqQixnQ0FBVyxHQUFYLFVBQVksS0FBWSxFQUFFLE9BQWUsRUFBRSxNQUFtQjtRQUFuQix1QkFBQSxFQUFBLFdBQW1CO1FBQzVELElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxXQUFTLE9BQVMsRUFBRSxNQUFNLENBQUMsQ0FBQTtJQUNqRSxDQUFDO0lBRU8saURBQTRCLEdBQXBDLFVBQXFDLE9BQWdCO1FBQzNDLElBQUEsaUNBQVcsRUFBRSw2QkFBUyxDQUFZO1FBQzFDLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUN4RCxDQUFDO0lBRU8sdUNBQWtCLEdBQTFCLFVBQTJCLFdBQXdCLEVBQUUsU0FBaUI7UUFDcEUsSUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsbUNBQW1DLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDOUUsSUFBSSxhQUFhLEdBQUcsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ25ELElBQUksQ0FBQyxhQUFhLEVBQUU7WUFDbEIsYUFBYSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUE7WUFDaEUsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUMsQ0FBQTtTQUMvQztRQUNELE9BQU8sYUFBYSxDQUFBO0lBQ3RCLENBQUM7SUFFTyx3Q0FBbUIsR0FBM0IsVUFBNEIsV0FBd0IsRUFBRSxTQUFpQjtRQUNyRSxJQUFNLGFBQWEsR0FBRyxJQUFJLGFBQWEsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUE7UUFDL0QsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtTQUN4QjtRQUNELE9BQU8sYUFBYSxDQUFBO0lBQ3RCLENBQUM7SUFFTyx3REFBbUMsR0FBM0MsVUFBNEMsV0FBd0I7UUFDbEUsSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQzlELElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUNyQixnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQTtZQUMxQixJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO1NBQzFEO1FBQ0QsT0FBTyxnQkFBZ0IsQ0FBQTtJQUN6QixDQUFDO0lBQ0gsaUJBQUM7QUFBRCxDQUFDLEFBL0VELElBK0VDIn0=","// capture nos.:            12   23 4               43   1 5   56 7  76\nvar descriptorPattern = /^((.+?)(@(window|document))?->)?(.+?)(#(.+))?$/;\nexport function parseDescriptorString(descriptorString) {\n    var source = descriptorString.trim();\n    var matches = source.match(descriptorPattern) || [];\n    return {\n        eventTarget: parseEventTarget(matches[4]),\n        eventName: matches[2],\n        identifier: matches[5],\n        methodName: matches[7]\n    };\n}\nfunction parseEventTarget(eventTargetName) {\n    if (eventTargetName == \"window\") {\n        return window;\n    }\n    else if (eventTargetName == \"document\") {\n        return document;\n    }\n}\nexport function stringifyEventTarget(eventTarget) {\n    if (eventTarget == window) {\n        return \"window\";\n    }\n    else if (eventTarget == document) {\n        return \"document\";\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uX2Rlc2NyaXB0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYWN0aW9uX2Rlc2NyaXB0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBT0EsdUVBQXVFO0FBQ3ZFLElBQU0saUJBQWlCLEdBQUcsZ0RBQWdELENBQUE7QUFFMUUsTUFBTSxnQ0FBZ0MsZ0JBQXdCO0lBQzVELElBQU0sTUFBTSxHQUFHLGdCQUFnQixDQUFDLElBQUksRUFBRSxDQUFBO0lBQ3RDLElBQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLENBQUE7SUFDckQsT0FBTztRQUNMLFdBQVcsRUFBRSxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsU0FBUyxFQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDdkIsVUFBVSxFQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDdkIsVUFBVSxFQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUM7S0FDeEIsQ0FBQTtBQUNILENBQUM7QUFFRCwwQkFBMEIsZUFBdUI7SUFDL0MsSUFBSSxlQUFlLElBQUksUUFBUSxFQUFFO1FBQy9CLE9BQU8sTUFBTSxDQUFBO0tBQ2Q7U0FBTSxJQUFJLGVBQWUsSUFBSSxVQUFVLEVBQUU7UUFDeEMsT0FBTyxRQUFRLENBQUE7S0FDaEI7QUFDSCxDQUFDO0FBRUQsTUFBTSwrQkFBK0IsV0FBd0I7SUFDM0QsSUFBSSxXQUFXLElBQUksTUFBTSxFQUFFO1FBQ3pCLE9BQU8sUUFBUSxDQUFBO0tBQ2hCO1NBQU0sSUFBSSxXQUFXLElBQUksUUFBUSxFQUFFO1FBQ2xDLE9BQU8sVUFBVSxDQUFBO0tBQ2xCO0FBQ0gsQ0FBQyJ9","import { parseDescriptorString, stringifyEventTarget } from \"./action_descriptor\";\nvar Action = /** @class */ (function () {\n    function Action(element, index, descriptor) {\n        this.element = element;\n        this.index = index;\n        this.eventTarget = descriptor.eventTarget || element;\n        this.eventName = descriptor.eventName || getDefaultEventNameForElement(element) || error(\"missing event name\");\n        this.identifier = descriptor.identifier || error(\"missing identifier\");\n        this.methodName = descriptor.methodName || error(\"missing method name\");\n    }\n    Action.forToken = function (token) {\n        return new this(token.element, token.index, parseDescriptorString(token.content));\n    };\n    Action.prototype.toString = function () {\n        var eventNameSuffix = this.eventTargetName ? \"@\" + this.eventTargetName : \"\";\n        return \"\" + this.eventName + eventNameSuffix + \"->\" + this.identifier + \"#\" + this.methodName;\n    };\n    Object.defineProperty(Action.prototype, \"eventTargetName\", {\n        get: function () {\n            return stringifyEventTarget(this.eventTarget);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Action;\n}());\nexport { Action };\nvar defaultEventNames = {\n    \"a\": function (e) { return \"click\"; },\n    \"button\": function (e) { return \"click\"; },\n    \"form\": function (e) { return \"submit\"; },\n    \"input\": function (e) { return e.getAttribute(\"type\") == \"submit\" ? \"click\" : \"change\"; },\n    \"select\": function (e) { return \"change\"; },\n    \"textarea\": function (e) { return \"change\"; }\n};\nexport function getDefaultEventNameForElement(element) {\n    var tagName = element.tagName.toLowerCase();\n    if (tagName in defaultEventNames) {\n        return defaultEventNames[tagName](element);\n    }\n}\nfunction error(message) {\n    throw new Error(message);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQW9CLHFCQUFxQixFQUFFLG9CQUFvQixFQUFFLE1BQU0scUJBQXFCLENBQUE7QUFHbkc7SUFZRSxnQkFBWSxPQUFnQixFQUFFLEtBQWEsRUFBRSxVQUFxQztRQUNoRixJQUFJLENBQUMsT0FBTyxHQUFPLE9BQU8sQ0FBQTtRQUMxQixJQUFJLENBQUMsS0FBSyxHQUFTLEtBQUssQ0FBQTtRQUN4QixJQUFJLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQyxXQUFXLElBQUksT0FBTyxDQUFBO1FBQ3BELElBQUksQ0FBQyxTQUFTLEdBQUssVUFBVSxDQUFDLFNBQVMsSUFBSSw2QkFBNkIsQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQTtRQUNoSCxJQUFJLENBQUMsVUFBVSxHQUFJLFVBQVUsQ0FBQyxVQUFVLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUE7UUFDdkUsSUFBSSxDQUFDLFVBQVUsR0FBSSxVQUFVLENBQUMsVUFBVSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO0lBQzFFLENBQUM7SUFYTSxlQUFRLEdBQWYsVUFBZ0IsS0FBWTtRQUMxQixPQUFPLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxxQkFBcUIsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUNuRixDQUFDO0lBV0QseUJBQVEsR0FBUjtRQUNFLElBQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLE1BQUksSUFBSSxDQUFDLGVBQWlCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtRQUM5RSxPQUFPLEtBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxlQUFlLFVBQUssSUFBSSxDQUFDLFVBQVUsU0FBSSxJQUFJLENBQUMsVUFBWSxDQUFBO0lBQ3JGLENBQUM7SUFFRCxzQkFBWSxtQ0FBZTthQUEzQjtZQUNFLE9BQU8sb0JBQW9CLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQy9DLENBQUM7OztPQUFBO0lBQ0gsYUFBQztBQUFELENBQUMsQUE3QkQsSUE2QkM7O0FBRUQsSUFBTSxpQkFBaUIsR0FBd0Q7SUFDN0UsR0FBRyxFQUFTLFVBQUEsQ0FBQyxJQUFJLE9BQUEsT0FBTyxFQUFQLENBQU87SUFDeEIsUUFBUSxFQUFJLFVBQUEsQ0FBQyxJQUFJLE9BQUEsT0FBTyxFQUFQLENBQU87SUFDeEIsTUFBTSxFQUFNLFVBQUEsQ0FBQyxJQUFJLE9BQUEsUUFBUSxFQUFSLENBQVE7SUFDekIsT0FBTyxFQUFLLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUF2RCxDQUF1RDtJQUN4RSxRQUFRLEVBQUksVUFBQSxDQUFDLElBQUksT0FBQSxRQUFRLEVBQVIsQ0FBUTtJQUN6QixVQUFVLEVBQUUsVUFBQSxDQUFDLElBQUksT0FBQSxRQUFRLEVBQVIsQ0FBUTtDQUMxQixDQUFBO0FBRUQsTUFBTSx3Q0FBd0MsT0FBZ0I7SUFDNUQsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUM3QyxJQUFJLE9BQU8sSUFBSSxpQkFBaUIsRUFBRTtRQUNoQyxPQUFPLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0tBQzNDO0FBQ0gsQ0FBQztBQUVELGVBQWUsT0FBZTtJQUM1QixNQUFNLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQzFCLENBQUMifQ==","var Binding = /** @class */ (function () {\n    function Binding(context, action) {\n        this.context = context;\n        this.action = action;\n    }\n    Object.defineProperty(Binding.prototype, \"index\", {\n        get: function () {\n            return this.action.index;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"eventTarget\", {\n        get: function () {\n            return this.action.eventTarget;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"identifier\", {\n        get: function () {\n            return this.context.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Binding.prototype.handleEvent = function (event) {\n        if (this.willBeInvokedByEvent(event)) {\n            this.invokeWithEvent(event);\n        }\n    };\n    Object.defineProperty(Binding.prototype, \"eventName\", {\n        get: function () {\n            return this.action.eventName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"method\", {\n        get: function () {\n            var method = this.controller[this.methodName];\n            if (typeof method == \"function\") {\n                return method;\n            }\n            throw new Error(\"Action \\\"\" + this.action + \"\\\" references undefined method \\\"\" + this.methodName + \"\\\"\");\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Binding.prototype.invokeWithEvent = function (event) {\n        try {\n            this.method.call(this.controller, event);\n        }\n        catch (error) {\n            var _a = this, identifier = _a.identifier, controller = _a.controller, element = _a.element, index = _a.index;\n            var detail = { identifier: identifier, controller: controller, element: element, index: index, event: event };\n            this.context.handleError(error, \"invoking action \\\"\" + this.action + \"\\\"\", detail);\n        }\n    };\n    Binding.prototype.willBeInvokedByEvent = function (event) {\n        var eventTarget = event.target;\n        if (this.element === eventTarget) {\n            return true;\n        }\n        else if (eventTarget instanceof Element && this.element.contains(eventTarget)) {\n            return this.scope.containsElement(eventTarget);\n        }\n        else {\n            return true;\n        }\n    };\n    Object.defineProperty(Binding.prototype, \"controller\", {\n        get: function () {\n            return this.context.controller;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"methodName\", {\n        get: function () {\n            return this.action.methodName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Binding.prototype, \"scope\", {\n        get: function () {\n            return this.context.scope;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Binding;\n}());\nexport { Binding };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9iaW5kaW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBO0lBSUUsaUJBQVksT0FBZ0IsRUFBRSxNQUFjO1FBQzFDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO0lBQ3RCLENBQUM7SUFFRCxzQkFBSSwwQkFBSzthQUFUO1lBQ0UsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQTtRQUMxQixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLGdDQUFXO2FBQWY7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFBO1FBQ2hDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksK0JBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUE7UUFDaEMsQ0FBQzs7O09BQUE7SUFFRCw2QkFBVyxHQUFYLFVBQVksS0FBWTtRQUN0QixJQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNwQyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQzVCO0lBQ0gsQ0FBQztJQUVELHNCQUFJLDhCQUFTO2FBQWI7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFBO1FBQzlCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksMkJBQU07YUFBVjtZQUNFLElBQU0sTUFBTSxHQUFJLElBQUksQ0FBQyxVQUFrQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUN4RCxJQUFJLE9BQU8sTUFBTSxJQUFJLFVBQVUsRUFBRTtnQkFDL0IsT0FBTyxNQUFNLENBQUE7YUFDZDtZQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsY0FBVyxJQUFJLENBQUMsTUFBTSx5Q0FBa0MsSUFBSSxDQUFDLFVBQVUsT0FBRyxDQUFDLENBQUE7UUFDN0YsQ0FBQzs7O09BQUE7SUFFTyxpQ0FBZSxHQUF2QixVQUF3QixLQUFZO1FBQ2xDLElBQUk7WUFDRixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFBO1NBQ3pDO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDUixJQUFBLFNBQWlELEVBQS9DLDBCQUFVLEVBQUUsMEJBQVUsRUFBRSxvQkFBTyxFQUFFLGdCQUFLLENBQVM7WUFDdkQsSUFBTSxNQUFNLEdBQUcsRUFBRSxVQUFVLFlBQUEsRUFBRSxVQUFVLFlBQUEsRUFBRSxPQUFPLFNBQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFBO1lBQ2hFLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSx1QkFBb0IsSUFBSSxDQUFDLE1BQU0sT0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1NBQzVFO0lBQ0gsQ0FBQztJQUVPLHNDQUFvQixHQUE1QixVQUE2QixLQUFZO1FBQ3ZDLElBQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUE7UUFDaEMsSUFBSSxJQUFJLENBQUMsT0FBTyxLQUFLLFdBQVcsRUFBRTtZQUNoQyxPQUFPLElBQUksQ0FBQTtTQUNaO2FBQU0sSUFBSSxXQUFXLFlBQVksT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxFQUFFO1lBQy9FLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLENBQUE7U0FDL0M7YUFBTTtZQUNMLE9BQU8sSUFBSSxDQUFBO1NBQ1o7SUFDSCxDQUFDO0lBRUQsc0JBQVksK0JBQVU7YUFBdEI7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFBO1FBQ2hDLENBQUM7OztPQUFBO0lBRUQsc0JBQVksK0JBQVU7YUFBdEI7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFBO1FBQy9CLENBQUM7OztPQUFBO0lBRUQsc0JBQVksNEJBQU87YUFBbkI7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBQzNCLENBQUM7OztPQUFBO0lBRUQsc0JBQVksMEJBQUs7YUFBakI7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFBO1FBQzNCLENBQUM7OztPQUFBO0lBQ0gsY0FBQztBQUFELENBQUMsQUEzRUQsSUEyRUMifQ==","var ElementObserver = /** @class */ (function () {\n    function ElementObserver(element, delegate) {\n        var _this = this;\n        this.element = element;\n        this.started = false;\n        this.delegate = delegate;\n        this.elements = new Set;\n        this.mutationObserver = new MutationObserver(function (mutations) { return _this.processMutations(mutations); });\n    }\n    ElementObserver.prototype.start = function () {\n        if (!this.started) {\n            this.started = true;\n            this.mutationObserver.observe(this.element, { attributes: true, childList: true, subtree: true });\n            this.refresh();\n        }\n    };\n    ElementObserver.prototype.stop = function () {\n        if (this.started) {\n            this.mutationObserver.takeRecords();\n            this.mutationObserver.disconnect();\n            this.started = false;\n        }\n    };\n    ElementObserver.prototype.refresh = function () {\n        if (this.started) {\n            var matches = new Set(this.matchElementsInTree());\n            for (var _i = 0, _a = Array.from(this.elements); _i < _a.length; _i++) {\n                var element = _a[_i];\n                if (!matches.has(element)) {\n                    this.removeElement(element);\n                }\n            }\n            for (var _b = 0, _c = Array.from(matches); _b < _c.length; _b++) {\n                var element = _c[_b];\n                this.addElement(element);\n            }\n        }\n    };\n    // Mutation record processing\n    ElementObserver.prototype.processMutations = function (mutations) {\n        if (this.started) {\n            for (var _i = 0, mutations_1 = mutations; _i < mutations_1.length; _i++) {\n                var mutation = mutations_1[_i];\n                this.processMutation(mutation);\n            }\n        }\n    };\n    ElementObserver.prototype.processMutation = function (mutation) {\n        if (mutation.type == \"attributes\") {\n            this.processAttributeChange(mutation.target, mutation.attributeName);\n        }\n        else if (mutation.type == \"childList\") {\n            this.processRemovedNodes(mutation.removedNodes);\n            this.processAddedNodes(mutation.addedNodes);\n        }\n    };\n    ElementObserver.prototype.processAttributeChange = function (node, attributeName) {\n        var element = node;\n        if (this.elements.has(element)) {\n            if (this.delegate.elementAttributeChanged && this.matchElement(element)) {\n                this.delegate.elementAttributeChanged(element, attributeName);\n            }\n            else {\n                this.removeElement(element);\n            }\n        }\n        else if (this.matchElement(element)) {\n            this.addElement(element);\n        }\n    };\n    ElementObserver.prototype.processRemovedNodes = function (nodes) {\n        for (var _i = 0, _a = Array.from(nodes); _i < _a.length; _i++) {\n            var node = _a[_i];\n            var element = this.elementFromNode(node);\n            if (element) {\n                this.processTree(element, this.removeElement);\n            }\n        }\n    };\n    ElementObserver.prototype.processAddedNodes = function (nodes) {\n        for (var _i = 0, _a = Array.from(nodes); _i < _a.length; _i++) {\n            var node = _a[_i];\n            var element = this.elementFromNode(node);\n            if (element && this.elementIsActive(element)) {\n                this.processTree(element, this.addElement);\n            }\n        }\n    };\n    // Element matching\n    ElementObserver.prototype.matchElement = function (element) {\n        return this.delegate.matchElement(element);\n    };\n    ElementObserver.prototype.matchElementsInTree = function (tree) {\n        if (tree === void 0) { tree = this.element; }\n        return this.delegate.matchElementsInTree(tree);\n    };\n    ElementObserver.prototype.processTree = function (tree, processor) {\n        for (var _i = 0, _a = this.matchElementsInTree(tree); _i < _a.length; _i++) {\n            var element = _a[_i];\n            processor.call(this, element);\n        }\n    };\n    ElementObserver.prototype.elementFromNode = function (node) {\n        if (node.nodeType == Node.ELEMENT_NODE) {\n            return node;\n        }\n    };\n    ElementObserver.prototype.elementIsActive = function (element) {\n        if (element.isConnected != this.element.isConnected) {\n            return false;\n        }\n        else {\n            return this.element.contains(element);\n        }\n    };\n    // Element tracking\n    ElementObserver.prototype.addElement = function (element) {\n        if (!this.elements.has(element)) {\n            if (this.elementIsActive(element)) {\n                this.elements.add(element);\n                if (this.delegate.elementMatched) {\n                    this.delegate.elementMatched(element);\n                }\n            }\n        }\n    };\n    ElementObserver.prototype.removeElement = function (element) {\n        if (this.elements.has(element)) {\n            this.elements.delete(element);\n            if (this.delegate.elementUnmatched) {\n                this.delegate.elementUnmatched(element);\n            }\n        }\n    };\n    return ElementObserver;\n}());\nexport { ElementObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlbWVudF9vYnNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lbGVtZW50X29ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVNBO0lBUUUseUJBQVksT0FBZ0IsRUFBRSxRQUFpQztRQUEvRCxpQkFPQztRQU5DLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFBO1FBQ3BCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBRXhCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxHQUFHLENBQUE7UUFDdkIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksZ0JBQWdCLENBQUMsVUFBQyxTQUFTLElBQUssT0FBQSxLQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLEVBQWhDLENBQWdDLENBQUMsQ0FBQTtJQUMvRixDQUFDO0lBRUQsK0JBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFBO1lBQ25CLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtZQUNqRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUE7U0FDZjtJQUNILENBQUM7SUFFRCw4QkFBSSxHQUFKO1FBQ0UsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2hCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNuQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLENBQUE7WUFDbEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUE7U0FDckI7SUFDSCxDQUFDO0lB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","import { ElementObserver } from \"./element_observer\";\nvar AttributeObserver = /** @class */ (function () {\n    function AttributeObserver(element, attributeName, delegate) {\n        this.attributeName = attributeName;\n        this.delegate = delegate;\n        this.elementObserver = new ElementObserver(element, this);\n    }\n    Object.defineProperty(AttributeObserver.prototype, \"element\", {\n        get: function () {\n            return this.elementObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(AttributeObserver.prototype, \"selector\", {\n        get: function () {\n            return \"[\" + this.attributeName + \"]\";\n        },\n        enumerable: true,\n        configurable: true\n    });\n    AttributeObserver.prototype.start = function () {\n        this.elementObserver.start();\n    };\n    AttributeObserver.prototype.stop = function () {\n        this.elementObserver.stop();\n    };\n    AttributeObserver.prototype.refresh = function () {\n        this.elementObserver.refresh();\n    };\n    Object.defineProperty(AttributeObserver.prototype, \"started\", {\n        get: function () {\n            return this.elementObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Element observer delegate\n    AttributeObserver.prototype.matchElement = function (element) {\n        return element.hasAttribute(this.attributeName);\n    };\n    AttributeObserver.prototype.matchElementsInTree = function (tree) {\n        var match = this.matchElement(tree) ? [tree] : [];\n        var matches = Array.from(tree.querySelectorAll(this.selector));\n        return match.concat(matches);\n    };\n    AttributeObserver.prototype.elementMatched = function (element) {\n        if (this.delegate.elementMatchedAttribute) {\n            this.delegate.elementMatchedAttribute(element, this.attributeName);\n        }\n    };\n    AttributeObserver.prototype.elementUnmatched = function (element) {\n        if (this.delegate.elementUnmatchedAttribute) {\n            this.delegate.elementUnmatchedAttribute(element, this.attributeName);\n        }\n    };\n    AttributeObserver.prototype.elementAttributeChanged = function (element, attributeName) {\n        if (this.delegate.elementAttributeValueChanged && this.attributeName == attributeName) {\n            this.delegate.elementAttributeValueChanged(element, attributeName);\n        }\n    };\n    return AttributeObserver;\n}());\nexport { AttributeObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0cmlidXRlX29ic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2F0dHJpYnV0ZV9vYnNlcnZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUEyQixNQUFNLG9CQUFvQixDQUFBO0FBUTdFO0lBTUUsMkJBQVksT0FBZ0IsRUFBRSxhQUFxQixFQUFFLFFBQW1DO1FBQ3RGLElBQUksQ0FBQyxhQUFhLEdBQUcsYUFBYSxDQUFBO1FBQ2xDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBRXhCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxlQUFlLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQzNELENBQUM7SUFFRCxzQkFBSSxzQ0FBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQTtRQUNyQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHVDQUFRO2FBQVo7WUFDRSxPQUFPLE1BQUksSUFBSSxDQUFDLGFBQWEsTUFBRyxDQUFBO1FBQ2xDLENBQUM7OztPQUFBO0lBRUQsaUNBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUE7SUFDOUIsQ0FBQztJQUVELGdDQUFJLEdBQUo7UUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxDQUFBO0lBQzdCLENBQUM7SUFFRCxtQ0FBTyxHQUFQO1FBQ0UsSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUNoQyxDQUFDO0lBRUQsc0JBQUksc0NBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUE7UUFDckMsQ0FBQzs7O09BQUE7SUFFRCw0QkFBNEI7SUFFNUIsd0NBQVksR0FBWixVQUFhLE9BQWdCO1FBQzNCLE9BQU8sT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUE7SUFDakQsQ0FBQztJQUVELCtDQUFtQixHQUFuQixVQUFvQixJQUFhO1FBQy9CLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtRQUNuRCxJQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQTtRQUNoRSxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDOUIsQ0FBQztJQUVELDBDQUFjLEdBQWQsVUFBZSxPQUFnQjtRQUM3QixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsdUJBQXVCLEVBQUU7WUFDekMsSUFBSSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFBO1NBQ25FO0lBQ0gsQ0FBQztJQUVELDRDQUFnQixHQUFoQixVQUFpQixPQUFnQjtRQUMvQixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMseUJBQXlCLEVBQUU7WUFDM0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFBO1NBQ3JFO0lBQ0gsQ0FBQztJQUVELG1EQUF1QixHQUF2QixVQUF3QixPQUFnQixFQUFFLGFBQXFCO1FBQzdELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyw0QkFBNEIsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLGFBQWEsRUFBRTtZQUNyRixJQUFJLENBQUMsUUFBUSxDQUFDLDRCQUE0QixDQUFDLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQTtTQUNuRTtJQUNILENBQUM7SUFDSCx3QkFBQztBQUFELENBQUMsQUFsRUQsSUFrRUMifQ==","export function add(map, key, value) {\n    fetch(map, key).add(value);\n}\nexport function del(map, key, value) {\n    fetch(map, key).delete(value);\n    prune(map, key);\n}\nexport function fetch(map, key) {\n    var values = map.get(key);\n    if (!values) {\n        values = new Set();\n        map.set(key, values);\n    }\n    return values;\n}\nexport function prune(map, key) {\n    var values = map.get(key);\n    if (values != null && values.size == 0) {\n        map.delete(key);\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0X29wZXJhdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2V0X29wZXJhdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxjQUFvQixHQUFtQixFQUFFLEdBQU0sRUFBRSxLQUFRO0lBQzdELEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQzVCLENBQUM7QUFFRCxNQUFNLGNBQW9CLEdBQW1CLEVBQUUsR0FBTSxFQUFFLEtBQVE7SUFDN0QsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDN0IsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtBQUNqQixDQUFDO0FBRUQsTUFBTSxnQkFBc0IsR0FBbUIsRUFBRSxHQUFNO0lBQ3JELElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDekIsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUNYLE1BQU0sR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFBO1FBQ2xCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFBO0tBQ3JCO0lBQ0QsT0FBTyxNQUFNLENBQUE7QUFDZixDQUFDO0FBRUQsTUFBTSxnQkFBc0IsR0FBbUIsRUFBRSxHQUFNO0lBQ3JELElBQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDM0IsSUFBSSxNQUFNLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxFQUFFO1FBQ3RDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7S0FDaEI7QUFDSCxDQUFDIn0=","import { add, del } from \"./set_operations\";\nvar Multimap = /** @class */ (function () {\n    function Multimap() {\n        this.valuesByKey = new Map();\n    }\n    Object.defineProperty(Multimap.prototype, \"values\", {\n        get: function () {\n            var sets = Array.from(this.valuesByKey.values());\n            return sets.reduce(function (values, set) { return values.concat(Array.from(set)); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Multimap.prototype, \"size\", {\n        get: function () {\n            var sets = Array.from(this.valuesByKey.values());\n            return sets.reduce(function (size, set) { return size + set.size; }, 0);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Multimap.prototype.add = function (key, value) {\n        add(this.valuesByKey, key, value);\n    };\n    Multimap.prototype.delete = function (key, value) {\n        del(this.valuesByKey, key, value);\n    };\n    Multimap.prototype.has = function (key, value) {\n        var values = this.valuesByKey.get(key);\n        return values != null && values.has(value);\n    };\n    Multimap.prototype.hasKey = function (key) {\n        return this.valuesByKey.has(key);\n    };\n    Multimap.prototype.hasValue = function (value) {\n        var sets = Array.from(this.valuesByKey.values());\n        return sets.some(function (set) { return set.has(value); });\n    };\n    Multimap.prototype.getValuesForKey = function (key) {\n        var values = this.valuesByKey.get(key);\n        return values ? Array.from(values) : [];\n    };\n    Multimap.prototype.getKeysForValue = function (value) {\n        return Array.from(this.valuesByKey)\n            .filter(function (_a) {\n            var key = _a[0], values = _a[1];\n            return values.has(value);\n        })\n            .map(function (_a) {\n            var key = _a[0], values = _a[1];\n            return key;\n        });\n    };\n    return Multimap;\n}());\nexport { Multimap };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGltYXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbXVsdGltYXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUUzQztJQUdFO1FBQ0UsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBYSxDQUFBO0lBQ3pDLENBQUM7SUFFRCxzQkFBSSw0QkFBTTthQUFWO1lBQ0UsSUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUE7WUFDbEQsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSyxPQUFBLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUE5QixDQUE4QixFQUFRLEVBQUUsQ0FBQyxDQUFBO1FBQy9FLENBQUM7OztPQUFBO0lBRUQsc0JBQUksMEJBQUk7YUFBUjtZQUNFLElBQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFBO1lBQ2xELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFDLElBQUksRUFBRSxHQUFHLElBQUssT0FBQSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBZixDQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDdkQsQ0FBQzs7O09BQUE7SUFFRCxzQkFBRyxHQUFILFVBQUksR0FBTSxFQUFFLEtBQVE7UUFDbEIsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFRCx5QkFBTSxHQUFOLFVBQU8sR0FBTSxFQUFFLEtBQVE7UUFDckIsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFRCxzQkFBRyxHQUFILFVBQUksR0FBTSxFQUFFLEtBQVE7UUFDbEIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDeEMsT0FBTyxNQUFNLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDNUMsQ0FBQztJQUVELHlCQUFNLEdBQU4sVUFBTyxHQUFNO1FBQ1gsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUNsQyxDQUFDO0lBRUQsMkJBQVEsR0FBUixVQUFTLEtBQVE7UUFDZixJQUFNLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQTtRQUNsRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBQSxHQUFHLElBQUksT0FBQSxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFkLENBQWMsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7SUFFRCxrQ0FBZSxHQUFmLFVBQWdCLEdBQU07UUFDcEIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDeEMsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtJQUN6QyxDQUFDO0lBRUQsa0NBQWUsR0FBZixVQUFnQixLQUFRO1FBQ3RCLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO2FBQ2hDLE1BQU0sQ0FBQyxVQUFDLEVBQWE7Z0JBQVosV0FBRyxFQUFFLGNBQU07WUFBTSxPQUFBLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQWpCLENBQWlCLENBQUM7YUFDNUMsR0FBRyxDQUFDLFVBQUMsRUFBYTtnQkFBWixXQUFHLEVBQUUsY0FBTTtZQUFNLE9BQUEsR0FBRztRQUFILENBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUM7SUFDSCxlQUFDO0FBQUQsQ0FBQyxBQWpERCxJQWlEQyJ9","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Multimap } from \"./multimap\";\nimport { add, del } from \"./set_operations\";\nvar IndexedMultimap = /** @class */ (function (_super) {\n    __extends(IndexedMultimap, _super);\n    function IndexedMultimap() {\n        var _this = _super.call(this) || this;\n        _this.keysByValue = new Map;\n        return _this;\n    }\n    Object.defineProperty(IndexedMultimap.prototype, \"values\", {\n        get: function () {\n            return Array.from(this.keysByValue.keys());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    IndexedMultimap.prototype.add = function (key, value) {\n        _super.prototype.add.call(this, key, value);\n        add(this.keysByValue, value, key);\n    };\n    IndexedMultimap.prototype.delete = function (key, value) {\n        _super.prototype.delete.call(this, key, value);\n        del(this.keysByValue, value, key);\n    };\n    IndexedMultimap.prototype.hasValue = function (value) {\n        return this.keysByValue.has(value);\n    };\n    IndexedMultimap.prototype.getKeysForValue = function (value) {\n        var set = this.keysByValue.get(value);\n        return set ? Array.from(set) : [];\n    };\n    return IndexedMultimap;\n}(Multimap));\nexport { IndexedMultimap };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXhlZF9tdWx0aW1hcC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbmRleGVkX211bHRpbWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFBO0FBQ3JDLE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFFM0M7SUFBMkMsbUNBQWM7SUFHdkQ7UUFBQSxZQUNFLGlCQUFPLFNBRVI7UUFEQyxLQUFJLENBQUMsV0FBVyxHQUFHLElBQUksR0FBRyxDQUFBOztJQUM1QixDQUFDO0lBRUQsc0JBQUksbUNBQU07YUFBVjtZQUNFLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7UUFDNUMsQ0FBQzs7O09BQUE7SUFFRCw2QkFBRyxHQUFILFVBQUksR0FBTSxFQUFFLEtBQVE7UUFDbEIsaUJBQU0sR0FBRyxZQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUNyQixHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVELGdDQUFNLEdBQU4sVUFBTyxHQUFNLEVBQUUsS0FBUTtRQUNyQixpQkFBTSxNQUFNLFlBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3hCLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRUQsa0NBQVEsR0FBUixVQUFTLEtBQVE7UUFDZixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ3BDLENBQUM7SUFFRCx5Q0FBZSxHQUFmLFVBQWdCLEtBQVE7UUFDdEIsSUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDdkMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtJQUNuQyxDQUFDO0lBQ0gsc0JBQUM7QUFBRCxDQUFDLEFBOUJELENBQTJDLFFBQVEsR0E4QmxEIn0=","import { AttributeObserver } from \"./attribute_observer\";\nimport { Multimap } from \"@stimulus/multimap\";\nvar TokenListObserver = /** @class */ (function () {\n    function TokenListObserver(element, attributeName, delegate) {\n        this.attributeObserver = new AttributeObserver(element, attributeName, this);\n        this.delegate = delegate;\n        this.tokensByElement = new Multimap;\n    }\n    Object.defineProperty(TokenListObserver.prototype, \"started\", {\n        get: function () {\n            return this.attributeObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TokenListObserver.prototype.start = function () {\n        this.attributeObserver.start();\n    };\n    TokenListObserver.prototype.stop = function () {\n        this.attributeObserver.stop();\n    };\n    TokenListObserver.prototype.refresh = function () {\n        this.attributeObserver.refresh();\n    };\n    Object.defineProperty(TokenListObserver.prototype, \"element\", {\n        get: function () {\n            return this.attributeObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TokenListObserver.prototype, \"attributeName\", {\n        get: function () {\n            return this.attributeObserver.attributeName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Attribute observer delegate\n    TokenListObserver.prototype.elementMatchedAttribute = function (element) {\n        this.tokensMatched(this.readTokensForElement(element));\n    };\n    TokenListObserver.prototype.elementAttributeValueChanged = function (element) {\n        var _a = this.refreshTokensForElement(element), unmatchedTokens = _a[0], matchedTokens = _a[1];\n        this.tokensUnmatched(unmatchedTokens);\n        this.tokensMatched(matchedTokens);\n    };\n    TokenListObserver.prototype.elementUnmatchedAttribute = function (element) {\n        this.tokensUnmatched(this.tokensByElement.getValuesForKey(element));\n    };\n    TokenListObserver.prototype.tokensMatched = function (tokens) {\n        var _this = this;\n        tokens.forEach(function (token) { return _this.tokenMatched(token); });\n    };\n    TokenListObserver.prototype.tokensUnmatched = function (tokens) {\n        var _this = this;\n        tokens.forEach(function (token) { return _this.tokenUnmatched(token); });\n    };\n    TokenListObserver.prototype.tokenMatched = function (token) {\n        this.delegate.tokenMatched(token);\n        this.tokensByElement.add(token.element, token);\n    };\n    TokenListObserver.prototype.tokenUnmatched = function (token) {\n        this.delegate.tokenUnmatched(token);\n        this.tokensByElement.delete(token.element, token);\n    };\n    TokenListObserver.prototype.refreshTokensForElement = function (element) {\n        var previousTokens = this.tokensByElement.getValuesForKey(element);\n        var currentTokens = this.readTokensForElement(element);\n        var firstDifferingIndex = zip(previousTokens, currentTokens)\n            .findIndex(function (_a) {\n            var previousToken = _a[0], currentToken = _a[1];\n            return !tokensAreEqual(previousToken, currentToken);\n        });\n        if (firstDifferingIndex == -1) {\n            return [[], []];\n        }\n        else {\n            return [previousTokens.slice(firstDifferingIndex), currentTokens.slice(firstDifferingIndex)];\n        }\n    };\n    TokenListObserver.prototype.readTokensForElement = function (element) {\n        var attributeName = this.attributeName;\n        var tokenString = element.getAttribute(attributeName) || \"\";\n        return parseTokenString(tokenString, element, attributeName);\n    };\n    return TokenListObserver;\n}());\nexport { TokenListObserver };\nfunction parseTokenString(tokenString, element, attributeName) {\n    return tokenString.trim().split(/\\s+/).filter(function (content) { return content.length; })\n        .map(function (content, index) { return ({ element: element, attributeName: attributeName, content: content, index: index }); });\n}\nfunction zip(left, right) {\n    var length = Math.max(left.length, right.length);\n    return Array.from({ length: length }, function (_, index) { return [left[index], right[index]]; });\n}\nfunction tokensAreEqual(left, right) {\n    return left && right && left.index == right.index && left.content == right.content;\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW5fbGlzdF9vYnNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90b2tlbl9saXN0X29ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBNkIsTUFBTSxzQkFBc0IsQ0FBQTtBQUNuRixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFjN0M7SUFLRSwyQkFBWSxPQUFnQixFQUFFLGFBQXFCLEVBQUUsUUFBbUM7UUFDdEYsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaUJBQWlCLENBQUMsT0FBTyxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUM1RSxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUN4QixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksUUFBUSxDQUFBO0lBQ3JDLENBQUM7SUFFRCxzQkFBSSxzQ0FBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFBO1FBQ3ZDLENBQUM7OztPQUFBO0lBRUQsaUNBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUNoQyxDQUFDO0lBRUQsZ0NBQUksR0FBSjtRQUNFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUMvQixDQUFDO0lBRUQsbUNBQU8sR0FBUDtRQUNFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUNsQyxDQUFDO0lBRUQsc0JBQUksc0NBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQTtRQUN2QyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDRDQUFhO2FBQWpCO1lBQ0UsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsYUFBYSxDQUFBO1FBQzdDLENBQUM7OztPQUFBO0lBRUQsOEJBQThCO0lB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","import { TokenListObserver } from \"./token_list_observer\";\nvar ValueListObserver = /** @class */ (function () {\n    function ValueListObserver(element, attributeName, delegate) {\n        this.tokenListObserver = new TokenListObserver(element, attributeName, this);\n        this.delegate = delegate;\n        this.parseResultsByToken = new WeakMap;\n        this.valuesByTokenByElement = new WeakMap;\n    }\n    Object.defineProperty(ValueListObserver.prototype, \"started\", {\n        get: function () {\n            return this.tokenListObserver.started;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ValueListObserver.prototype.start = function () {\n        this.tokenListObserver.start();\n    };\n    ValueListObserver.prototype.stop = function () {\n        this.tokenListObserver.stop();\n    };\n    ValueListObserver.prototype.refresh = function () {\n        this.tokenListObserver.refresh();\n    };\n    Object.defineProperty(ValueListObserver.prototype, \"element\", {\n        get: function () {\n            return this.tokenListObserver.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ValueListObserver.prototype, \"attributeName\", {\n        get: function () {\n            return this.tokenListObserver.attributeName;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ValueListObserver.prototype.tokenMatched = function (token) {\n        var element = token.element;\n        var value = this.fetchParseResultForToken(token).value;\n        if (value) {\n            this.fetchValuesByTokenForElement(element).set(token, value);\n            this.delegate.elementMatchedValue(element, value);\n        }\n    };\n    ValueListObserver.prototype.tokenUnmatched = function (token) {\n        var element = token.element;\n        var value = this.fetchParseResultForToken(token).value;\n        if (value) {\n            this.fetchValuesByTokenForElement(element).delete(token);\n            this.delegate.elementUnmatchedValue(element, value);\n        }\n    };\n    ValueListObserver.prototype.fetchParseResultForToken = function (token) {\n        var parseResult = this.parseResultsByToken.get(token);\n        if (!parseResult) {\n            parseResult = this.parseToken(token);\n            this.parseResultsByToken.set(token, parseResult);\n        }\n        return parseResult;\n    };\n    ValueListObserver.prototype.fetchValuesByTokenForElement = function (element) {\n        var valuesByToken = this.valuesByTokenByElement.get(element);\n        if (!valuesByToken) {\n            valuesByToken = new Map;\n            this.valuesByTokenByElement.set(element, valuesByToken);\n        }\n        return valuesByToken;\n    };\n    ValueListObserver.prototype.parseToken = function (token) {\n        try {\n            var value = this.delegate.parseValueForToken(token);\n            return { value: value };\n        }\n        catch (error) {\n            return { error: error };\n        }\n    };\n    return ValueListObserver;\n}());\nexport { ValueListObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsdWVfbGlzdF9vYnNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92YWx1ZV9saXN0X29ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBUyxpQkFBaUIsRUFBNkIsTUFBTSx1QkFBdUIsQ0FBQTtBQWEzRjtJQU1FLDJCQUFZLE9BQWdCLEVBQUUsYUFBcUIsRUFBRSxRQUFzQztRQUN6RixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQzVFLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLE9BQU8sQ0FBQTtRQUN0QyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxPQUFPLENBQUE7SUFDM0MsQ0FBQztJQUVELHNCQUFJLHNDQUFPO2FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUE7UUFDdkMsQ0FBQzs7O09BQUE7SUFFRCxpQ0FBSyxHQUFMO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxDQUFBO0lBQ2hDLENBQUM7SUFFRCxnQ0FBSSxHQUFKO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxDQUFBO0lBQy9CLENBQUM7SUFFRCxtQ0FBTyxHQUFQO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sRUFBRSxDQUFBO0lBQ2xDLENBQUM7SUFFRCxzQkFBSSxzQ0FBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFBO1FBQ3ZDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksNENBQWE7YUFBakI7WUFDRSxPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLENBQUE7UUFDN0MsQ0FBQzs7O09BQUE7SUFFRCx3Q0FBWSxHQUFaLFVBQWEsS0FBWTtRQUNmLElBQUEsdUJBQU8sQ0FBVTtRQUNqQixJQUFBLGtEQUFLLENBQXlDO1FBQ3RELElBQUksS0FBSyxFQUFFO1lBQ1QsSUFBSSxDQUFDLDRCQUE0QixDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDNUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUE7U0FDbEQ7SUFDSCxDQUFDO0lBRUQsMENBQWMsR0FBZCxVQUFlLEtBQVk7UUFDakIsSUFBQSx1QkFBTyxDQUFVO1FBQ2pCLElBQUEsa0RBQUssQ0FBeUM7UUFDdEQsSUFBSSxLQUFLLEVBQUU7WUFDVCxJQUFJLENBQUMsNEJBQTRCLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQ3hELElBQUksQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFBO1NBQ3BEO0lBQ0gsQ0FBQztJQUVPLG9EQUF3QixHQUFoQyxVQUFpQyxLQUFZO1FBQzNDLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDckQsSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNoQixXQUFXLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUNwQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxXQUFXLENBQUMsQ0FBQTtTQUNqRDtRQUNELE9BQU8sV0FBVyxDQUFBO0lBQ3BCLENBQUM7SUFFTyx3REFBNEIsR0FBcEMsVUFBcUMsT0FBZ0I7UUFDbkQsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUM1RCxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ2xCLGFBQWEsR0FBRyxJQUFJLEdBQUcsQ0FBQTtZQUN2QixJQUFJLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQTtTQUN4RDtRQUNELE9BQU8sYUFBYSxDQUFBO0lBQ3RCLENBQUM7SUFFTyxzQ0FBVSxHQUFsQixVQUFtQixLQUFZO1FBQzdCLElBQUk7WUFDRixJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQ3JELE9BQU8sRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFBO1NBQ2pCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLEVBQUUsS0FBSyxPQUFBLEVBQUUsQ0FBQTtTQUNqQjtJQUNILENBQUM7SUFDSCx3QkFBQztBQUFELENBQUMsQUFqRkQsSUFpRkMifQ==","import { Action } from \"./action\";\nimport { Binding } from \"./binding\";\nimport { ValueListObserver } from \"@stimulus/mutation-observers\";\nvar BindingObserver = /** @class */ (function () {\n    function BindingObserver(context, delegate) {\n        this.context = context;\n        this.delegate = delegate;\n        this.bindingsByAction = new Map;\n    }\n    BindingObserver.prototype.start = function () {\n        if (!this.valueListObserver) {\n            this.valueListObserver = new ValueListObserver(this.element, this.actionAttribute, this);\n            this.valueListObserver.start();\n        }\n    };\n    BindingObserver.prototype.stop = function () {\n        if (this.valueListObserver) {\n            this.valueListObserver.stop();\n            delete this.valueListObserver;\n            this.disconnectAllActions();\n        }\n    };\n    Object.defineProperty(BindingObserver.prototype, \"element\", {\n        get: function () {\n            return this.context.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"identifier\", {\n        get: function () {\n            return this.context.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"actionAttribute\", {\n        get: function () {\n            return this.schema.actionAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"schema\", {\n        get: function () {\n            return this.context.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(BindingObserver.prototype, \"bindings\", {\n        get: function () {\n            return Array.from(this.bindingsByAction.values());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    BindingObserver.prototype.connectAction = function (action) {\n        var binding = new Binding(this.context, action);\n        this.bindingsByAction.set(action, binding);\n        this.delegate.bindingConnected(binding);\n    };\n    BindingObserver.prototype.disconnectAction = function (action) {\n        var binding = this.bindingsByAction.get(action);\n        if (binding) {\n            this.bindingsByAction.delete(action);\n            this.delegate.bindingDisconnected(binding);\n        }\n    };\n    BindingObserver.prototype.disconnectAllActions = function () {\n        var _this = this;\n        this.bindings.forEach(function (binding) { return _this.delegate.bindingDisconnected(binding); });\n        this.bindingsByAction.clear();\n    };\n    // Value observer delegate\n    BindingObserver.prototype.parseValueForToken = function (token) {\n        var action = Action.forToken(token);\n        if (action.identifier == this.identifier) {\n            return action;\n        }\n    };\n    BindingObserver.prototype.elementMatchedValue = function (element, action) {\n        this.connectAction(action);\n    };\n    BindingObserver.prototype.elementUnmatchedValue = function (element, action) {\n        this.disconnectAction(action);\n    };\n    return BindingObserver;\n}());\nexport { BindingObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGluZ19vYnNlcnZlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9iaW5kaW5nX29ic2VydmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDakMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFdBQVcsQ0FBQTtBQUluQyxPQUFPLEVBQVMsaUJBQWlCLEVBQTZCLE1BQU0sOEJBQThCLENBQUE7QUFPbEc7SUFNRSx5QkFBWSxPQUFnQixFQUFFLFFBQWlDO1FBQzdELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsK0JBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDM0IsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksaUJBQWlCLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFBO1lBQ3hGLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtTQUMvQjtJQUNILENBQUM7SUFFRCw4QkFBSSxHQUFKO1FBQ0UsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDMUIsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxDQUFBO1lBQzdCLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFBO1lBQzdCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFBO1NBQzVCO0lBQ0gsQ0FBQztJQUVELHNCQUFJLG9DQUFPO2FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFBO1FBQzdCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksdUNBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUE7UUFDaEMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw0Q0FBZTthQUFuQjtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUE7UUFDcEMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSxtQ0FBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQTtRQUM1QixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHFDQUFRO2FBQVo7WUFDRSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUE7UUFDbkQsQ0FBQzs7O09BQUE7SUFFTyx1Q0FBYSxHQUFyQixVQUFzQixNQUFjO1FBQ2xDLElBQU0sT0FBTyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDakQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUE7UUFDMUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUN6QyxDQUFDO0lBRU8sMENBQWdCLEdBQXhCLFVBQXlCLE1BQWM7UUFDckMsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNqRCxJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUE7WUFDcEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsQ0FBQTtTQUMzQztJQUNILENBQUM7SUFFTyw4Q0FBb0IsR0FBNUI7UUFBQSxpQkFHQztRQUZDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQUEsT0FBTyxJQUFJLE9BQUEsS0FBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsRUFBMUMsQ0FBMEMsQ0FBQyxDQUFBO1FBQzVFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUMvQixDQUFDO0lBRUQsMEJBQTBCO0lBRTFCLDRDQUFrQixHQUFsQixVQUFtQixLQUFZO1FBQzdCLElBQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDckMsSUFBSSxNQUFNLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDeEMsT0FBTyxNQUFNLENBQUE7U0FDZDtJQUNILENBQUM7SUFFRCw2Q0FBbUIsR0FBbkIsVUFBb0IsT0FBZ0IsRUFBRSxNQUFjO1FBQ2xELElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDNUIsQ0FBQztJQUVELCtDQUFxQixHQUFyQixVQUFzQixPQUFnQixFQUFFLE1BQWM7UUFDcEQsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQy9CLENBQUM7SUFDSCxzQkFBQztBQUFELENBQUMsQUFsRkQsSUFrRkMifQ==","import { BindingObserver } from \"./binding_observer\";\nvar Context = /** @class */ (function () {\n    function Context(module, scope) {\n        this.module = module;\n        this.scope = scope;\n        this.controller = new module.controllerConstructor(this);\n        this.bindingObserver = new BindingObserver(this, this.dispatcher);\n        try {\n            this.controller.initialize();\n        }\n        catch (error) {\n            this.handleError(error, \"initializing controller\");\n        }\n    }\n    Context.prototype.connect = function () {\n        this.bindingObserver.start();\n        try {\n            this.controller.connect();\n        }\n        catch (error) {\n            this.handleError(error, \"connecting controller\");\n        }\n    };\n    Context.prototype.disconnect = function () {\n        try {\n            this.controller.disconnect();\n        }\n        catch (error) {\n            this.handleError(error, \"disconnecting controller\");\n        }\n        this.bindingObserver.stop();\n    };\n    Object.defineProperty(Context.prototype, \"application\", {\n        get: function () {\n            return this.module.application;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"identifier\", {\n        get: function () {\n            return this.module.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"schema\", {\n        get: function () {\n            return this.application.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"dispatcher\", {\n        get: function () {\n            return this.application.dispatcher;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Context.prototype, \"parentElement\", {\n        get: function () {\n            return this.element.parentElement;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Error handling\n    Context.prototype.handleError = function (error, message, detail) {\n        if (detail === void 0) { detail = {}; }\n        var _a = this, identifier = _a.identifier, controller = _a.controller, element = _a.element;\n        detail = Object.assign({ identifier: identifier, controller: controller, element: element }, detail);\n        this.application.handleError(error, \"Error \" + message, detail);\n    };\n    return Context;\n}());\nexport { Context };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGV4dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250ZXh0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQVFwRDtJQU1FLGlCQUFZLE1BQWMsRUFBRSxLQUFZO1FBQ3RDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO1FBQ2xCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxNQUFNLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDeEQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLGVBQWUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBRWpFLElBQUk7WUFDRixJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFBO1NBQzdCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSx5QkFBeUIsQ0FBQyxDQUFBO1NBQ25EO0lBQ0gsQ0FBQztJQUVELHlCQUFPLEdBQVA7UUFDRSxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxDQUFBO1FBRTVCLElBQUk7WUFDRixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFBO1NBQzFCO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSx1QkFBdUIsQ0FBQyxDQUFBO1NBQ2pEO0lBQ0gsQ0FBQztJQUVELDRCQUFVLEdBQVY7UUFDRSxJQUFJO1lBQ0YsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQTtTQUM3QjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsMEJBQTBCLENBQUMsQ0FBQTtTQUNwRDtRQUVELElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUE7SUFDN0IsQ0FBQztJQUVELHNCQUFJLGdDQUFXO2FBQWY7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFBO1FBQ2hDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksK0JBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUE7UUFDL0IsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwyQkFBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQTtRQUNoQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLCtCQUFVO2FBQWQ7WUFDRSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFBO1FBQ3BDLENBQUM7OztPQUFBO0lBRUQsc0JBQUksNEJBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUE7UUFDM0IsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSxrQ0FBYTthQUFqQjtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUE7UUFDbkMsQ0FBQzs7O09BQUE7SUFFRCxpQkFBaUI7SUFFakIsNkJBQVcsR0FBWCxVQUFZLEtBQVksRUFBRSxPQUFlLEVBQUUsTUFBbUI7UUFBbkIsdUJBQUEsRUFBQSxXQUFtQjtRQUN0RCxJQUFBLFNBQTBDLEVBQXhDLDBCQUFVLEVBQUUsMEJBQVUsRUFBRSxvQkFBTyxDQUFTO1FBQ2hELE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsVUFBVSxZQUFBLEVBQUUsVUFBVSxZQUFBLEVBQUUsT0FBTyxTQUFBLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQTtRQUNuRSxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsV0FBUyxPQUFTLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDakUsQ0FBQztJQUNILGNBQUM7QUFBRCxDQUFDLEFBdEVELElBc0VDIn0=","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/** @hidden */\nexport function blessDefinition(definition) {\n    return {\n        identifier: definition.identifier,\n        controllerConstructor: blessControllerConstructor(definition.controllerConstructor)\n    };\n}\nfunction blessControllerConstructor(controllerConstructor) {\n    var constructor = extend(controllerConstructor);\n    constructor.bless();\n    return constructor;\n}\nvar extend = (function () {\n    function extendWithReflect(constructor) {\n        function Controller() {\n            var _newTarget = this && this instanceof Controller ? this.constructor : void 0;\n            return Reflect.construct(constructor, arguments, _newTarget);\n        }\n        Controller.prototype = Object.create(constructor.prototype, {\n            constructor: { value: Controller }\n        });\n        Reflect.setPrototypeOf(Controller, constructor);\n        return Controller;\n    }\n    function testReflectExtension() {\n        var a = function () { this.a.call(this); };\n        var b = extendWithReflect(a);\n        b.prototype.a = function () { };\n        return new b;\n    }\n    try {\n        testReflectExtension();\n        return extendWithReflect;\n    }\n    catch (error) {\n        return function (constructor) { return /** @class */ (function (_super) {\n            __extends(Controller, _super);\n            function Controller() {\n                return _super !== null && _super.apply(this, arguments) || this;\n            }\n            return Controller;\n        }(constructor)); };\n    }\n})();\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVmaW5pdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kZWZpbml0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFPQSxjQUFjO0FBQ2QsTUFBTSwwQkFBMEIsVUFBc0I7SUFDcEQsT0FBTztRQUNMLFVBQVUsRUFBRSxVQUFVLENBQUMsVUFBVTtRQUNqQyxxQkFBcUIsRUFBRSwwQkFBMEIsQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUM7S0FDcEYsQ0FBQTtBQUNILENBQUM7QUFFRCxvQ0FBb0MscUJBQTRDO0lBQzlFLElBQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO0lBQ2pELFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUNuQixPQUFPLFdBQVcsQ0FBQTtBQUNwQixDQUFDO0FBRUQsSUFBTSxNQUFNLEdBQUcsQ0FBQztJQUdkLDJCQUFzRCxXQUFjO1FBQ2xFOztZQUNFLE9BQU8sT0FBTyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsU0FBUyxhQUFhLENBQUE7UUFDOUQsQ0FBQztRQUVELFVBQVUsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsU0FBUyxFQUFFO1lBQzFELFdBQVcsRUFBRSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUU7U0FDbkMsQ0FBQyxDQUFBO1FBRUYsT0FBTyxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDL0MsT0FBTyxVQUFpQixDQUFBO0lBQzFCLENBQUM7SUFFRDtRQUNFLElBQU0sQ0FBQyxHQUFHLGNBQXNCLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUMsQ0FBUSxDQUFBO1FBQzFELElBQU0sQ0FBQyxHQUFHLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQzlCLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLGNBQVksQ0FBQyxDQUFBO1FBQzdCLE9BQU8sSUFBSSxDQUFDLENBQUE7SUFDZCxDQUFDO0lBRUQsSUFBSTtRQUNGLG9CQUFvQixFQUFFLENBQUE7UUFDdEIsT0FBTyxpQkFBaUIsQ0FBQTtLQUN6QjtJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxVQUE0QixXQUFjLElBQUs7WUFBeUIsOEJBQVc7WUFBcEM7O1lBQXNDLENBQUM7WUFBRCxpQkFBQztRQUFELENBQUMsQUFBdkMsQ0FBeUIsV0FBVyxJQUFwQyxDQUF1QyxDQUFBO0tBQzlGO0FBQ0gsQ0FBQyxDQUFDLEVBQUUsQ0FBQSJ9","import { Context } from \"./context\";\nimport { blessDefinition } from \"./definition\";\nvar Module = /** @class */ (function () {\n    function Module(application, definition) {\n        this.application = application;\n        this.definition = blessDefinition(definition);\n        this.contextsByScope = new WeakMap;\n        this.connectedContexts = new Set;\n    }\n    Object.defineProperty(Module.prototype, \"identifier\", {\n        get: function () {\n            return this.definition.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Module.prototype, \"controllerConstructor\", {\n        get: function () {\n            return this.definition.controllerConstructor;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Module.prototype, \"contexts\", {\n        get: function () {\n            return Array.from(this.connectedContexts);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Module.prototype.connectContextForScope = function (scope) {\n        var context = this.fetchContextForScope(scope);\n        this.connectedContexts.add(context);\n        context.connect();\n    };\n    Module.prototype.disconnectContextForScope = function (scope) {\n        var context = this.contextsByScope.get(scope);\n        if (context) {\n            this.connectedContexts.delete(context);\n            context.disconnect();\n        }\n    };\n    Module.prototype.fetchContextForScope = function (scope) {\n        var context = this.contextsByScope.get(scope);\n        if (!context) {\n            context = new Context(this, scope);\n            this.contextsByScope.set(scope, context);\n        }\n        return context;\n    };\n    return Module;\n}());\nexport { Module };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kdWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21vZHVsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sV0FBVyxDQUFBO0FBRW5DLE9BQU8sRUFBYyxlQUFlLEVBQUUsTUFBTSxjQUFjLENBQUE7QUFHMUQ7SUFNRSxnQkFBWSxXQUF3QixFQUFFLFVBQXNCO1FBQzFELElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFBO1FBQzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQzdDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxPQUFPLENBQUE7UUFDbEMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksR0FBRyxDQUFBO0lBQ2xDLENBQUM7SUFFRCxzQkFBSSw4QkFBVTthQUFkO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQTtRQUNuQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHlDQUFxQjthQUF6QjtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxxQkFBcUIsQ0FBQTtRQUM5QyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDRCQUFRO2FBQVo7WUFDRSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFDM0MsQ0FBQzs7O09BQUE7SUFFRCx1Q0FBc0IsR0FBdEIsVUFBdUIsS0FBWTtRQUNqQyxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDaEQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUNuQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDbkIsQ0FBQztJQUVELDBDQUF5QixHQUF6QixVQUEwQixLQUFZO1FBQ3BDLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQy9DLElBQUksT0FBTyxFQUFFO1lBQ1gsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUN0QyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUE7U0FDckI7SUFDSCxDQUFDO0lBRU8scUNBQW9CLEdBQTVCLFVBQTZCLEtBQVk7UUFDdkMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDN0MsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNaLE9BQU8sR0FBRyxJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUE7WUFDbEMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1NBQ3pDO1FBQ0QsT0FBTyxPQUFPLENBQUE7SUFDaEIsQ0FBQztJQUNILGFBQUM7QUFBRCxDQUFDLEFBL0NELElBK0NDIn0=","var DataMap = /** @class */ (function () {\n    function DataMap(scope) {\n        this.scope = scope;\n    }\n    Object.defineProperty(DataMap.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataMap.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DataMap.prototype.get = function (key) {\n        key = this.getFormattedKey(key);\n        return this.element.getAttribute(key);\n    };\n    DataMap.prototype.set = function (key, value) {\n        key = this.getFormattedKey(key);\n        this.element.setAttribute(key, value);\n        return this.get(key);\n    };\n    DataMap.prototype.has = function (key) {\n        key = this.getFormattedKey(key);\n        return this.element.hasAttribute(key);\n    };\n    DataMap.prototype.delete = function (key) {\n        if (this.has(key)) {\n            key = this.getFormattedKey(key);\n            this.element.removeAttribute(key);\n            return true;\n        }\n        else {\n            return false;\n        }\n    };\n    DataMap.prototype.getFormattedKey = function (key) {\n        return \"data-\" + this.identifier + \"-\" + dasherize(key);\n    };\n    return DataMap;\n}());\nexport { DataMap };\nfunction dasherize(value) {\n    return value.replace(/([A-Z])/g, function (_, char) { return \"-\" + char.toLowerCase(); });\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YV9tYXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZGF0YV9tYXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUE7SUFHRSxpQkFBWSxLQUFZO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO0lBQ3BCLENBQUM7SUFFRCxzQkFBSSw0QkFBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQTtRQUMzQixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLCtCQUFVO2FBQWQ7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFBO1FBQzlCLENBQUM7OztPQUFBO0lBRUQscUJBQUcsR0FBSCxVQUFJLEdBQVc7UUFDYixHQUFHLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUMvQixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3ZDLENBQUM7SUFFRCxxQkFBRyxHQUFILFVBQUksR0FBVyxFQUFFLEtBQWE7UUFDNUIsR0FBRyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQ3JDLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUN0QixDQUFDO0lBRUQscUJBQUcsR0FBSCxVQUFJLEdBQVc7UUFDYixHQUFHLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUMvQixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3ZDLENBQUM7SUFFRCx3QkFBTSxHQUFOLFVBQU8sR0FBVztRQUNoQixJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDakIsR0FBRyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDakMsT0FBTyxJQUFJLENBQUE7U0FDWjthQUFNO1lBQ0wsT0FBTyxLQUFLLENBQUE7U0FDYjtJQUNILENBQUM7SUFFTyxpQ0FBZSxHQUF2QixVQUF3QixHQUFXO1FBQ2pDLE9BQU8sVUFBUSxJQUFJLENBQUMsVUFBVSxTQUFJLFNBQVMsQ0FBQyxHQUFHLENBQUcsQ0FBQTtJQUNwRCxDQUFDO0lBQ0gsY0FBQztBQUFELENBQUMsQUE1Q0QsSUE0Q0M7O0FBRUQsbUJBQW1CLEtBQWE7SUFDOUIsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxVQUFDLENBQUMsRUFBRSxJQUFJLElBQUssT0FBQSxNQUFJLElBQUksQ0FBQyxXQUFXLEVBQUksRUFBeEIsQ0FBd0IsQ0FBQyxDQUFBO0FBQ3pFLENBQUMifQ==","/** @hidden */\nexport function attributeValueContainsToken(attributeName, token) {\n    return \"[\" + attributeName + \"~=\\\"\" + token + \"\\\"]\";\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0b3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlbGVjdG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxjQUFjO0FBQ2QsTUFBTSxzQ0FBc0MsYUFBcUIsRUFBRSxLQUFhO0lBQzlFLE9BQU8sTUFBSSxhQUFhLFlBQU0sS0FBSyxRQUFJLENBQUE7QUFDekMsQ0FBQyJ9","import { attributeValueContainsToken } from \"./selectors\";\nvar TargetSet = /** @class */ (function () {\n    function TargetSet(scope) {\n        this.scope = scope;\n    }\n    Object.defineProperty(TargetSet.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TargetSet.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TargetSet.prototype, \"schema\", {\n        get: function () {\n            return this.scope.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TargetSet.prototype.has = function (targetName) {\n        return this.find(targetName) != null;\n    };\n    TargetSet.prototype.find = function () {\n        var targetNames = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            targetNames[_i] = arguments[_i];\n        }\n        var selector = this.getSelectorForTargetNames(targetNames);\n        return this.scope.findElement(selector);\n    };\n    TargetSet.prototype.findAll = function () {\n        var targetNames = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            targetNames[_i] = arguments[_i];\n        }\n        var selector = this.getSelectorForTargetNames(targetNames);\n        return this.scope.findAllElements(selector);\n    };\n    TargetSet.prototype.getSelectorForTargetNames = function (targetNames) {\n        var _this = this;\n        return targetNames.map(function (targetName) { return _this.getSelectorForTargetName(targetName); }).join(\", \");\n    };\n    TargetSet.prototype.getSelectorForTargetName = function (targetName) {\n        var targetDescriptor = this.identifier + \".\" + targetName;\n        return attributeValueContainsToken(this.schema.targetAttribute, targetDescriptor);\n    };\n    return TargetSet;\n}());\nexport { TargetSet };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFyZ2V0X3NldC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90YXJnZXRfc2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUV6RDtJQUdFLG1CQUFZLEtBQVk7UUFDdEIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUE7SUFDcEIsQ0FBQztJQUVELHNCQUFJLDhCQUFPO2FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBQzNCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksaUNBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUE7UUFDOUIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw2QkFBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQTtRQUMxQixDQUFDOzs7T0FBQTtJQUVELHVCQUFHLEdBQUgsVUFBSSxVQUFrQjtRQUNwQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksSUFBSSxDQUFBO0lBQ3RDLENBQUM7SUFFRCx3QkFBSSxHQUFKO1FBQUsscUJBQXdCO2FBQXhCLFVBQXdCLEVBQXhCLHFCQUF3QixFQUF4QixJQUF3QjtZQUF4QixnQ0FBd0I7O1FBQzNCLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUM1RCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7SUFFRCwyQkFBTyxHQUFQO1FBQVEscUJBQXdCO2FBQXhCLFVBQXdCLEVBQXhCLHFCQUF3QixFQUF4QixJQUF3QjtZQUF4QixnQ0FBd0I7O1FBQzlCLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUM1RCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQzdDLENBQUM7SUFFTyw2Q0FBeUIsR0FBakMsVUFBa0MsV0FBcUI7UUFBdkQsaUJBRUM7UUFEQyxPQUFPLFdBQVcsQ0FBQyxHQUFHLENBQUMsVUFBQSxVQUFVLElBQUksT0FBQSxLQUFJLENBQUMsd0JBQXdCLENBQUMsVUFBVSxDQUFDLEVBQXpDLENBQXlDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDNUYsQ0FBQztJQUVPLDRDQUF3QixHQUFoQyxVQUFpQyxVQUFrQjtRQUNqRCxJQUFNLGdCQUFnQixHQUFNLElBQUksQ0FBQyxVQUFVLFNBQUksVUFBWSxDQUFBO1FBQzNELE9BQU8sMkJBQTJCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQTtJQUNuRixDQUFDO0lBQ0gsZ0JBQUM7QUFBRCxDQUFDLEFBekNELElBeUNDIn0=","import { DataMap } from \"./data_map\";\nimport { TargetSet } from \"./target_set\";\nimport { attributeValueContainsToken } from \"./selectors\";\nvar Scope = /** @class */ (function () {\n    function Scope(schema, identifier, element) {\n        this.schema = schema;\n        this.identifier = identifier;\n        this.element = element;\n        this.targets = new TargetSet(this);\n        this.data = new DataMap(this);\n    }\n    Scope.prototype.findElement = function (selector) {\n        return this.findAllElements(selector)[0];\n    };\n    Scope.prototype.findAllElements = function (selector) {\n        var head = this.element.matches(selector) ? [this.element] : [];\n        var tail = this.filterElements(Array.from(this.element.querySelectorAll(selector)));\n        return head.concat(tail);\n    };\n    Scope.prototype.filterElements = function (elements) {\n        var _this = this;\n        return elements.filter(function (element) { return _this.containsElement(element); });\n    };\n    Scope.prototype.containsElement = function (element) {\n        return element.closest(this.controllerSelector) === this.element;\n    };\n    Object.defineProperty(Scope.prototype, \"controllerSelector\", {\n        get: function () {\n            return attributeValueContainsToken(this.schema.controllerAttribute, this.identifier);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Scope;\n}());\nexport { Scope };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NvcGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2NvcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUVwQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBQ3hDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUV6RDtJQU9FLGVBQVksTUFBYyxFQUFFLFVBQWtCLEVBQUUsT0FBZ0I7UUFDOUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUE7UUFDcEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUE7UUFDNUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7UUFDdEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUNsQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQy9CLENBQUM7SUFFRCwyQkFBVyxHQUFYLFVBQVksUUFBZ0I7UUFDMUIsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQzFDLENBQUM7SUFFRCwrQkFBZSxHQUFmLFVBQWdCLFFBQWdCO1FBQzlCLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBO1FBQ2pFLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNyRixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDMUIsQ0FBQztJQUVELDhCQUFjLEdBQWQsVUFBZSxRQUFtQjtRQUFsQyxpQkFFQztRQURDLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFBLE9BQU8sSUFBSSxPQUFBLEtBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLEVBQTdCLENBQTZCLENBQUMsQ0FBQTtJQUNsRSxDQUFDO0lBRUQsK0JBQWUsR0FBZixVQUFnQixPQUFnQjtRQUM5QixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQTtJQUNsRSxDQUFDO0lBRUQsc0JBQVkscUNBQWtCO2FBQTlCO1lBQ0UsT0FBTywyQkFBMkIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUN0RixDQUFDOzs7T0FBQTtJQUNILFlBQUM7QUFBRCxDQUFDLEFBcENELElBb0NDIn0=","import { Scope } from \"./scope\";\nimport { ValueListObserver } from \"@stimulus/mutation-observers\";\nvar ScopeObserver = /** @class */ (function () {\n    function ScopeObserver(element, schema, delegate) {\n        this.element = element;\n        this.schema = schema;\n        this.delegate = delegate;\n        this.valueListObserver = new ValueListObserver(this.element, this.controllerAttribute, this);\n        this.scopesByIdentifierByElement = new WeakMap;\n        this.scopeReferenceCounts = new WeakMap;\n    }\n    ScopeObserver.prototype.start = function () {\n        this.valueListObserver.start();\n    };\n    ScopeObserver.prototype.stop = function () {\n        this.valueListObserver.stop();\n    };\n    Object.defineProperty(ScopeObserver.prototype, \"controllerAttribute\", {\n        get: function () {\n            return this.schema.controllerAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // Value observer delegate\n    /** @hidden */\n    ScopeObserver.prototype.parseValueForToken = function (token) {\n        var element = token.element, identifier = token.content;\n        var scopesByIdentifier = this.fetchScopesByIdentifierForElement(element);\n        var scope = scopesByIdentifier.get(identifier);\n        if (!scope) {\n            scope = new Scope(this.schema, identifier, element);\n            scopesByIdentifier.set(identifier, scope);\n        }\n        return scope;\n    };\n    /** @hidden */\n    ScopeObserver.prototype.elementMatchedValue = function (element, value) {\n        var referenceCount = (this.scopeReferenceCounts.get(value) || 0) + 1;\n        this.scopeReferenceCounts.set(value, referenceCount);\n        if (referenceCount == 1) {\n            this.delegate.scopeConnected(value);\n        }\n    };\n    /** @hidden */\n    ScopeObserver.prototype.elementUnmatchedValue = function (element, value) {\n        var referenceCount = this.scopeReferenceCounts.get(value);\n        if (referenceCount) {\n            this.scopeReferenceCounts.set(value, referenceCount - 1);\n            if (referenceCount == 1) {\n                this.delegate.scopeDisconnected(value);\n            }\n        }\n    };\n    ScopeObserver.prototype.fetchScopesByIdentifierForElement = function (element) {\n        var scopesByIdentifier = this.scopesByIdentifierByElement.get(element);\n        if (!scopesByIdentifier) {\n            scopesByIdentifier = new Map;\n            this.scopesByIdentifierByElement.set(element, scopesByIdentifier);\n        }\n        return scopesByIdentifier;\n    };\n    return ScopeObserver;\n}());\nexport { ScopeObserver };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NvcGVfb2JzZXJ2ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2NvcGVfb2JzZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFNBQVMsQ0FBQTtBQUMvQixPQUFPLEVBQVMsaUJBQWlCLEVBQTZCLE1BQU0sOEJBQThCLENBQUE7QUFPbEc7SUFRRSx1QkFBWSxPQUFnQixFQUFFLE1BQWMsRUFBRSxRQUErQjtRQUMzRSxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQTtRQUN0QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQTtRQUNwQixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUN4QixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUM1RixJQUFJLENBQUMsMkJBQTJCLEdBQUcsSUFBSSxPQUFPLENBQUE7UUFDOUMsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksT0FBTyxDQUFBO0lBQ3pDLENBQUM7SUFFRCw2QkFBSyxHQUFMO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxDQUFBO0lBQ2hDLENBQUM7SUFFRCw0QkFBSSxHQUFKO1FBQ0UsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxDQUFBO0lBQy9CLENBQUM7SUFFRCxzQkFBSSw4Q0FBbUI7YUFBdkI7WUFDRSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUE7UUFDeEMsQ0FBQzs7O09BQUE7SUFFRCwwQkFBMEI7SUFFMUIsY0FBYztJQUNkLDBDQUFrQixHQUFsQixVQUFtQixLQUFZO1FBQ3JCLElBQUEsdUJBQU8sRUFBRSwwQkFBbUIsQ0FBVTtRQUM5QyxJQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxpQ0FBaUMsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUUxRSxJQUFJLEtBQUssR0FBRyxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDOUMsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQTtZQUNuRCxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFBO1NBQzFDO1FBRUQsT0FBTyxLQUFLLENBQUE7SUFDZCxDQUFDO0lBRUQsY0FBYztJQUNkLDJDQUFtQixHQUFuQixVQUFvQixPQUFnQixFQUFFLEtBQVk7UUFDaEQsSUFBTSxjQUFjLEdBQUcsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN0RSxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxjQUFjLENBQUMsQ0FBQTtRQUNwRCxJQUFJLGNBQWMsSUFBSSxDQUFDLEVBQUU7WUFDdkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDcEM7SUFDSCxDQUFDO0lBRUQsY0FBYztJQUNkLDZDQUFxQixHQUFyQixVQUFzQixPQUFnQixFQUFFLEtBQVk7UUFDbEQsSUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUMzRCxJQUFJLGNBQWMsRUFBRTtZQUNsQixJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxjQUFjLEdBQUcsQ0FBQyxDQUFDLENBQUE7WUFDeEQsSUFBSSxjQUFjLElBQUksQ0FBQyxFQUFFO2dCQUN2QixJQUFJLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3ZDO1NBQ0Y7SUFDSCxDQUFDO0lBRU8seURBQWlDLEdBQXpDLFVBQTBDLE9BQWdCO1FBQ3hELElBQUksa0JBQWtCLEdBQUcsSUFBSSxDQUFDLDJCQUEyQixDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUN0RSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDdkIsa0JBQWtCLEdBQUcsSUFBSSxHQUFHLENBQUE7WUFDNUIsSUFBSSxDQUFDLDJCQUEyQixDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLENBQUMsQ0FBQTtTQUNsRTtRQUNELE9BQU8sa0JBQWtCLENBQUE7SUFDM0IsQ0FBQztJQUNILG9CQUFDO0FBQUQsQ0FBQyxBQXpFRCxJQXlFQyJ9","import { Module } from \"./module\";\nimport { Multimap } from \"@stimulus/multimap\";\nimport { ScopeObserver } from \"./scope_observer\";\nvar Router = /** @class */ (function () {\n    function Router(application) {\n        this.application = application;\n        this.scopeObserver = new ScopeObserver(this.element, this.schema, this);\n        this.scopesByIdentifier = new Multimap;\n        this.modulesByIdentifier = new Map;\n    }\n    Object.defineProperty(Router.prototype, \"element\", {\n        get: function () {\n            return this.application.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"schema\", {\n        get: function () {\n            return this.application.schema;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"controllerAttribute\", {\n        get: function () {\n            return this.schema.controllerAttribute;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"modules\", {\n        get: function () {\n            return Array.from(this.modulesByIdentifier.values());\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Router.prototype, \"contexts\", {\n        get: function () {\n            return this.modules.reduce(function (contexts, module) { return contexts.concat(module.contexts); }, []);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Router.prototype.start = function () {\n        this.scopeObserver.start();\n    };\n    Router.prototype.stop = function () {\n        this.scopeObserver.stop();\n    };\n    Router.prototype.loadDefinition = function (definition) {\n        this.unloadIdentifier(definition.identifier);\n        var module = new Module(this.application, definition);\n        this.connectModule(module);\n    };\n    Router.prototype.unloadIdentifier = function (identifier) {\n        var module = this.modulesByIdentifier.get(identifier);\n        if (module) {\n            this.disconnectModule(module);\n        }\n    };\n    Router.prototype.getContextForElementAndIdentifier = function (element, identifier) {\n        var module = this.modulesByIdentifier.get(identifier);\n        if (module) {\n            return module.contexts.find(function (context) { return context.element == element; });\n        }\n    };\n    // Error handler delegate\n    /** @hidden */\n    Router.prototype.handleError = function (error, message, detail) {\n        this.application.handleError(error, message, detail);\n    };\n    // Scope observer delegate\n    /** @hidden */\n    Router.prototype.scopeConnected = function (scope) {\n        this.scopesByIdentifier.add(scope.identifier, scope);\n        var module = this.modulesByIdentifier.get(scope.identifier);\n        if (module) {\n            module.connectContextForScope(scope);\n        }\n    };\n    /** @hidden */\n    Router.prototype.scopeDisconnected = function (scope) {\n        this.scopesByIdentifier.delete(scope.identifier, scope);\n        var module = this.modulesByIdentifier.get(scope.identifier);\n        if (module) {\n            module.disconnectContextForScope(scope);\n        }\n    };\n    // Modules\n    Router.prototype.connectModule = function (module) {\n        this.modulesByIdentifier.set(module.identifier, module);\n        var scopes = this.scopesByIdentifier.getValuesForKey(module.identifier);\n        scopes.forEach(function (scope) { return module.connectContextForScope(scope); });\n    };\n    Router.prototype.disconnectModule = function (module) {\n        this.modulesByIdentifier.delete(module.identifier);\n        var scopes = this.scopesByIdentifier.getValuesForKey(module.identifier);\n        scopes.forEach(function (scope) { return module.disconnectContextForScope(scope); });\n    };\n    return Router;\n}());\nexport { Router };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JvdXRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFHQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ2pDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUc3QyxPQUFPLEVBQUUsYUFBYSxFQUF5QixNQUFNLGtCQUFrQixDQUFBO0FBRXZFO0lBTUUsZ0JBQVksV0FBd0I7UUFDbEMsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUE7UUFDOUIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLGFBQWEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDdkUsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksUUFBUSxDQUFBO1FBQ3RDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLEdBQUcsQ0FBQTtJQUNwQyxDQUFDO0lBRUQsc0JBQUksMkJBQU87YUFBWDtZQUNFLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUE7UUFDakMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwwQkFBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQTtRQUNoQyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLHVDQUFtQjthQUF2QjtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQTtRQUN4QyxDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDJCQUFPO2FBQVg7WUFDRSxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUE7UUFDdEQsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw0QkFBUTthQUFaO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FB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","export var defaultSchema = {\n    controllerAttribute: \"data-controller\",\n    actionAttribute: \"data-action\",\n    targetAttribute: \"data-target\"\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZW1hLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NjaGVtYS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFNQSxNQUFNLENBQUMsSUFBTSxhQUFhLEdBQVc7SUFDbkMsbUJBQW1CLEVBQUUsaUJBQWlCO0lBQ3RDLGVBQWUsRUFBRSxhQUFhO0lBQzlCLGVBQWUsRUFBRSxhQUFhO0NBQy9CLENBQUEifQ==","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { Dispatcher } from \"./dispatcher\";\nimport { Router } from \"./router\";\nimport { defaultSchema } from \"./schema\";\nvar Application = /** @class */ (function () {\n    function Application(element, schema) {\n        if (element === void 0) { element = document.documentElement; }\n        if (schema === void 0) { schema = defaultSchema; }\n        this.element = element;\n        this.schema = schema;\n        this.dispatcher = new Dispatcher(this);\n        this.router = new Router(this);\n    }\n    Application.start = function (element, schema) {\n        var application = new Application(element, schema);\n        application.start();\n        return application;\n    };\n    Application.prototype.start = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, domReady()];\n                    case 1:\n                        _a.sent();\n                        this.router.start();\n                        this.dispatcher.start();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Application.prototype.stop = function () {\n        this.router.stop();\n        this.dispatcher.stop();\n    };\n    Application.prototype.register = function (identifier, controllerConstructor) {\n        this.load({ identifier: identifier, controllerConstructor: controllerConstructor });\n    };\n    Application.prototype.load = function (head) {\n        var _this = this;\n        var rest = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            rest[_i - 1] = arguments[_i];\n        }\n        var definitions = Array.isArray(head) ? head : [head].concat(rest);\n        definitions.forEach(function (definition) { return _this.router.loadDefinition(definition); });\n    };\n    Application.prototype.unload = function (head) {\n        var _this = this;\n        var rest = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            rest[_i - 1] = arguments[_i];\n        }\n        var identifiers = Array.isArray(head) ? head : [head].concat(rest);\n        identifiers.forEach(function (identifier) { return _this.router.unloadIdentifier(identifier); });\n    };\n    Object.defineProperty(Application.prototype, \"controllers\", {\n        // Controllers\n        get: function () {\n            return this.router.contexts.map(function (context) { return context.controller; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Application.prototype.getControllerForElementAndIdentifier = function (element, identifier) {\n        var context = this.router.getContextForElementAndIdentifier(element, identifier);\n        return context ? context.controller : null;\n    };\n    // Error handling\n    Application.prototype.handleError = function (error, message, detail) {\n        console.error(\"%s\\n\\n%o\\n\\n%o\", message, error, detail);\n    };\n    return Application;\n}());\nexport { Application };\nfunction domReady() {\n    return new Promise(function (resolve) {\n        if (document.readyState == \"loading\") {\n            document.addEventListener(\"DOMContentLoaded\", resolve);\n        }\n        else {\n            resolve();\n        }\n    });\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwbGljYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYXBwbGljYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sY0FBYyxDQUFBO0FBRXpDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDakMsT0FBTyxFQUFVLGFBQWEsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUVoRDtJQVlFLHFCQUFZLE9BQTJDLEVBQUUsTUFBOEI7UUFBM0Usd0JBQUEsRUFBQSxVQUFtQixRQUFRLENBQUMsZUFBZTtRQUFFLHVCQUFBLEVBQUEsc0JBQThCO1FBQ3JGLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO1FBQ3BCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDdEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNoQyxDQUFDO0lBWE0saUJBQUssR0FBWixVQUFhLE9BQWlCLEVBQUUsTUFBZTtRQUM3QyxJQUFNLFdBQVcsR0FBRyxJQUFJLFdBQVcsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDcEQsV0FBVyxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQ25CLE9BQU8sV0FBVyxDQUFBO0lBQ3BCLENBQUM7SUFTSywyQkFBSyxHQUFYOzs7OzRCQUNFLHFCQUFNLFFBQVEsRUFBRSxFQUFBOzt3QkFBaEIsU0FBZ0IsQ0FBQTt3QkFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQTt3QkFDbkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQTs7Ozs7S0FDeEI7SUFFRCwwQkFBSSxHQUFKO1FB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","/** @hidden */\nexport function defineTargetProperties(constructor) {\n    var prototype = constructor.prototype;\n    var targetNames = getTargetNamesForConstructor(constructor);\n    targetNames.forEach(function (name) {\n        var _a;\n        return defineLinkedProperties(prototype, (_a = {},\n            _a[name + \"Target\"] = {\n                get: function () {\n                    var target = this.targets.find(name);\n                    if (target) {\n                        return target;\n                    }\n                    else {\n                        throw new Error(\"Missing target element \\\"\" + this.identifier + \".\" + name + \"\\\"\");\n                    }\n                }\n            },\n            _a[name + \"Targets\"] = {\n                get: function () {\n                    return this.targets.findAll(name);\n                }\n            },\n            _a[\"has\" + capitalize(name) + \"Target\"] = {\n                get: function () {\n                    return this.targets.has(name);\n                }\n            },\n            _a));\n    });\n}\nfunction getTargetNamesForConstructor(constructor) {\n    var ancestors = getAncestorsForConstructor(constructor);\n    return Array.from(ancestors.reduce(function (targetNames, constructor) {\n        getOwnTargetNamesForConstructor(constructor).forEach(function (name) { return targetNames.add(name); });\n        return targetNames;\n    }, new Set));\n}\nfunction getAncestorsForConstructor(constructor) {\n    var ancestors = [];\n    while (constructor) {\n        ancestors.push(constructor);\n        constructor = Object.getPrototypeOf(constructor);\n    }\n    return ancestors;\n}\nfunction getOwnTargetNamesForConstructor(constructor) {\n    var definition = constructor[\"targets\"];\n    return Array.isArray(definition) ? definition : [];\n}\nfunction defineLinkedProperties(object, properties) {\n    Object.keys(properties).forEach(function (name) {\n        if (!(name in object)) {\n            var descriptor = properties[name];\n            Object.defineProperty(object, name, descriptor);\n        }\n    });\n}\nfunction capitalize(name) {\n    return name.charAt(0).toUpperCase() + name.slice(1);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFyZ2V0X3Byb3BlcnRpZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdGFyZ2V0X3Byb3BlcnRpZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsY0FBYztBQUNkLE1BQU0saUNBQWlDLFdBQXFCO0lBQzFELElBQU0sU0FBUyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUE7SUFDdkMsSUFBTSxXQUFXLEdBQUcsNEJBQTRCLENBQUMsV0FBVyxDQUFDLENBQUE7SUFDN0QsV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUk7O1FBQUksT0FBQSxzQkFBc0IsQ0FBQyxTQUFTO1lBQzFELEdBQUksSUFBSSxXQUFRLElBQUc7Z0JBQ2pCLEdBQUc7b0JBQ0QsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7b0JBQ3RDLElBQUksTUFBTSxFQUFFO3dCQUNWLE9BQU8sTUFBTSxDQUFBO3FCQUNkO3lCQUFNO3dCQUNMLE1BQU0sSUFBSSxLQUFLLENBQUMsOEJBQTJCLElBQUksQ0FBQyxVQUFVLFNBQUksSUFBSSxPQUFHLENBQUMsQ0FBQTtxQkFDdkU7Z0JBQ0gsQ0FBQzthQUNGO1lBQ0QsR0FBSSxJQUFJLFlBQVMsSUFBRztnQkFDbEIsR0FBRztvQkFDRCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO2dCQUNuQyxDQUFDO2FBQ0Y7WUFDRCxHQUFDLFFBQU0sVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFRLElBQUc7Z0JBQ2hDLEdBQUc7b0JBQ0QsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtnQkFDL0IsQ0FBQzthQUNGO2dCQUNEO0lBckIwQixDQXFCMUIsQ0FBQyxDQUFBO0FBQ0wsQ0FBQztBQUVELHNDQUFzQyxXQUFxQjtJQUN6RCxJQUFNLFNBQVMsR0FBRywwQkFBMEIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtJQUN6RCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFDLFdBQVcsRUFBRSxXQUFXO1FBQzFELCtCQUErQixDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQXJCLENBQXFCLENBQUMsQ0FBQTtRQUNuRixPQUFPLFdBQVcsQ0FBQTtJQUNwQixDQUFDLEVBQUUsSUFBSSxHQUFrQixDQUFDLENBQUMsQ0FBQTtBQUM3QixDQUFDO0FBRUQsb0NBQW9DLFdBQXFCO0lBQ3ZELElBQU0sU0FBUyxHQUFlLEVBQUUsQ0FBQTtJQUNoQyxPQUFPLFdBQVcsRUFBRTtRQUNsQixTQUFTLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQzNCLFdBQVcsR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFBO0tBQ2pEO0lBQ0QsT0FBTyxTQUFTLENBQUE7QUFDbEIsQ0FBQztBQUVELHlDQUF5QyxXQUFxQjtJQUM1RCxJQUFNLFVBQVUsR0FBSSxXQUFtQixDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBQ2xELE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUE7QUFDcEQsQ0FBQztBQUVELGdDQUFnQyxNQUFXLEVBQUUsVUFBaUM7SUFDNUUsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBQyxJQUFJO1FBQ25DLElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxNQUFNLENBQUMsRUFBRTtZQUNyQixJQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUE7WUFDbkMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFBO1NBQ2hEO0lBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDO0FBRUQsb0JBQW9CLElBQVk7SUFDOUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDckQsQ0FBQyJ9","import { defineTargetProperties } from \"./target_properties\";\nvar Controller = /** @class */ (function () {\n    function Controller(context) {\n        this.context = context;\n    }\n    Controller.bless = function () {\n        defineTargetProperties(this);\n    };\n    Object.defineProperty(Controller.prototype, \"application\", {\n        get: function () {\n            return this.context.application;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"scope\", {\n        get: function () {\n            return this.context.scope;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"element\", {\n        get: function () {\n            return this.scope.element;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"identifier\", {\n        get: function () {\n            return this.scope.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"targets\", {\n        get: function () {\n            return this.scope.targets;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Controller.prototype, \"data\", {\n        get: function () {\n            return this.scope.data;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Controller.prototype.initialize = function () {\n        // Override in your subclass to set up initial controller state\n    };\n    Controller.prototype.connect = function () {\n        // Override in your subclass to respond when the controller is connected to the DOM\n    };\n    Controller.prototype.disconnect = function () {\n        // Override in your subclass to respond when the controller is disconnected from the DOM\n    };\n    Controller.targets = [];\n    return Controller;\n}());\nexport { Controller };\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUtBLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHFCQUFxQixDQUFBO0FBTzVEO0lBU0Usb0JBQVksT0FBZ0I7UUFDMUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7SUFDeEIsQ0FBQztJQU5NLGdCQUFLLEdBQVo7UUFDRSxzQkFBc0IsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM5QixDQUFDO0lBTUQsc0JBQUksbUNBQVc7YUFBZjtZQUNFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUE7UUFDakMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSw2QkFBSzthQUFUO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQTtRQUMzQixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLCtCQUFPO2FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFBO1FBQzNCLENBQUM7OztPQUFBO0lBRUQsc0JBQUksa0NBQVU7YUFBZDtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUE7UUFDOUIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwrQkFBTzthQUFYO1lBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQTtRQUMzQixDQUFDOzs7T0FBQTtJQUVELHNCQUFJLDRCQUFJO2FBQVI7WUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFBO1FBQ3hCLENBQUM7OztPQUFBO0lBRUQsK0JBQVUsR0FBVjtRQUNFLCtEQUErRDtJQUNqRSxDQUFDO0lBRUQsNEJBQU8sR0FBUDtRQUNFLG1GQUFtRjtJQUNyRixDQUFDO0lBRUQsK0JBQVUsR0FBVjtRQUNFLHdGQUF3RjtJQUMxRixDQUFDO0lBOUNNLGtCQUFPLEdBQWEsRUFBRSxDQUFBO0lBK0MvQixpQkFBQztDQUFBLEFBaERELElBZ0RDO1NBaERZLFVBQVUifQ==","export const defaultSchema = {\n  reflexAttribute: 'data-reflex',\n  reflexPermanentAttribute: 'data-reflex-permanent',\n  reflexRootAttribute: 'data-reflex-root',\n  reflexDatasetAttribute: 'data-reflex-dataset',\n  reflexDatasetAllAttribute: 'data-reflex-dataset-all',\n  reflexSerializeFormAttribute: 'data-reflex-serialize-form'\n}\n","export const inputTags = {\n  INPUT: true,\n  TEXTAREA: true,\n  SELECT: true\n}\n\nexport const mutableTags = {\n  INPUT: true,\n  TEXTAREA: true,\n  OPTION: true\n}\n\nexport const textInputTypes = {\n  'datetime-local': true,\n  'select-multiple': true,\n  'select-one': true,\n  color: true,\n  date: true,\n  datetime: true,\n  email: true,\n  month: true,\n  number: true,\n  password: true,\n  range: true,\n  search: true,\n  tel: true,\n  text: true,\n  textarea: true,\n  time: true,\n  url: true,\n  week: true\n}\n","let activeElement\n\nexport default {\n  get element () {\n    return activeElement\n  },\n  set (element) {\n    activeElement = element\n  }\n}\n","import { inputTags, textInputTypes } from './enums'\nimport activeElement from './active_element'\n\n// Indicates if the passed element is considered a text input.\n//\nconst isTextInput = element => {\n  return inputTags[element.tagName] && textInputTypes[element.type]\n}\n\n// Assigns focus to the appropriate element... preferring the explicitly passed selector\n//\n// * selector - a CSS selector for the element that should have focus\n//\nconst assignFocus = selector => {\n  const element =\n    selector && selector.nodeType === Node.ELEMENT_NODE\n      ? selector\n      : document.querySelector(selector)\n  const focusElement = element || activeElement.element\n  if (focusElement && focusElement.focus) focusElement.focus()\n}\n\n// Dispatches an event on the passed element\n//\n// * element - the element\n// * name - the name of the event\n// * detail - the event detail\n//\nconst dispatch = (element, name, detail = {}) => {\n  const init = { bubbles: true, cancelable: true, detail: detail }\n  const evt = new CustomEvent(name, init)\n  element.dispatchEvent(evt)\n  if (window.jQuery) window.jQuery(element).trigger(name, detail)\n}\n\n// Accepts an xPath query and returns the element found at that position in the DOM\n//\nconst xpathToElement = xpath => {\n  return document.evaluate(\n    xpath,\n    document,\n    null,\n    XPathResult.FIRST_ORDERED_NODE_TYPE,\n    null\n  ).singleNodeValue\n}\n\n// Return an array with the class names to be used\n//\n// * names - could be a string or an array of strings for multiple classes.\n//\nconst getClassNames = names => Array(names).flat()\n\n// Perform operation for either the first or all of the elements returned by CSS selector\n//\n// * operation - the instruction payload from perform\n// * callback - the operation function to run for each element\n//\nconst processElements = (operation, callback) => {\n  Array.from(\n    operation.selectAll ? operation.element : [operation.element]\n  ).forEach(callback)\n}\n\n// camelCase to kebab-case\n//\nconst kebabize = str => {\n  return str\n    .split('')\n    .map((letter, idx) => {\n      return letter.toUpperCase() === letter\n        ? `${idx !== 0 ? '-' : ''}${letter.toLowerCase()}`\n        : letter\n    })\n    .join('')\n}\n\n// Provide a standardized pipeline of checks and modifications to all operations based on provided options\n// Currently skips execution if cancelled and implements an optional delay\n//\nconst operate = (operation, callback) => {\n  if (!operation.cancel) {\n    operation.delay ? setTimeout(callback, operation.delay) : callback()\n    return true\n  }\n  return false\n}\n\n// Dispatch life-cycle events with standardized naming\nconst before = (target, name, operation) =>\n  dispatch(target, `cable-ready:before-${kebabize(name)}`, operation)\n\nconst after = (target, name, operation) =>\n  dispatch(target, `cable-ready:after-${kebabize(name)}`, operation)\n\nexport {\n  isTextInput,\n  assignFocus,\n  dispatch,\n  xpathToElement,\n  getClassNames,\n  processElements,\n  operate,\n  before,\n  after\n}\n","import { mutableTags } from './enums'\nimport { isTextInput } from './utils'\nimport activeElement from './active_element'\n\n// Indicates whether or not we should morph an element via onBeforeElUpdated callback\n// SEE: https://github.com/patrick-steele-idem/morphdom#morphdomfromnode-tonode-options--node\n//\nconst shouldMorph = operation => (fromEl, toEl) => {\n  return !shouldMorphCallbacks\n    .map(callback => {\n      return typeof callback === 'function'\n        ? callback(operation, fromEl, toEl)\n        : true\n    })\n    .includes(false)\n}\n\n// Execute any pluggable functions that modify elements after morphing via onElUpdated callback\n//\nconst didMorph = operation => el => {\n  didMorphCallbacks.forEach(callback => {\n    if (typeof callback === 'function') callback(operation, el)\n  })\n}\n\nconst verifyNotMutable = (detail, fromEl, toEl) => {\n  // Skip nodes that are equal:\n  // https://github.com/patrick-steele-idem/morphdom#can-i-make-morphdom-blaze-through-the-dom-tree-even-faster-yes\n  if (!mutableTags[fromEl.tagName] && fromEl.isEqualNode(toEl)) return false\n  return true\n}\n\nconst verifyNotPermanent = (detail, fromEl, toEl) => {\n  const { permanentAttributeName } = detail\n  if (!permanentAttributeName) return true\n\n  const permanent = fromEl.closest(`[${permanentAttributeName}]`)\n\n  // only morph attributes on the active non-permanent text input\n  if (!permanent && isTextInput(fromEl) && fromEl === activeElement.element) {\n    const ignore = { value: true }\n    Array.from(toEl.attributes).forEach(attribute => {\n      if (!ignore[attribute.name])\n        fromEl.setAttribute(attribute.name, attribute.value)\n    })\n    return false\n  }\n\n  return !permanent\n}\n\nconst shouldMorphCallbacks = [verifyNotMutable, verifyNotPermanent]\nconst didMorphCallbacks = []\n\nexport {\n  shouldMorphCallbacks,\n  didMorphCallbacks,\n  shouldMorph,\n  didMorph,\n  verifyNotMutable,\n  verifyNotPermanent\n}\n","var DOCUMENT_FRAGMENT_NODE = 11;\n\nfunction morphAttrs(fromNode, toNode) {\n    var toNodeAttrs = toNode.attributes;\n    var attr;\n    var attrName;\n    var attrNamespaceURI;\n    var attrValue;\n    var fromValue;\n\n    // document-fragments dont have attributes so lets not do anything\n    if (toNode.nodeType === DOCUMENT_FRAGMENT_NODE || fromNode.nodeType === DOCUMENT_FRAGMENT_NODE) {\n      return;\n    }\n\n    // update attributes on original DOM element\n    for (var i = toNodeAttrs.length - 1; i >= 0; i--) {\n        attr = toNodeAttrs[i];\n        attrName = attr.name;\n        attrNamespaceURI = attr.namespaceURI;\n        attrValue = attr.value;\n\n        if (attrNamespaceURI) {\n            attrName = attr.localName || attrName;\n            fromValue = fromNode.getAttributeNS(attrNamespaceURI, attrName);\n\n            if (fromValue !== attrValue) {\n                if (attr.prefix === 'xmlns'){\n                    attrName = attr.name; // It's not allowed to set an attribute with the XMLNS namespace without specifying the `xmlns` prefix\n                }\n                fromNode.setAttributeNS(attrNamespaceURI, attrName, attrValue);\n            }\n        } else {\n            fromValue = fromNode.getAttribute(attrName);\n\n            if (fromValue !== attrValue) {\n                fromNode.setAttribute(attrName, attrValue);\n            }\n        }\n    }\n\n    // Remove any extra attributes found on the original DOM element that\n    // weren't found on the target element.\n    var fromNodeAttrs = fromNode.attributes;\n\n    for (var d = fromNodeAttrs.length - 1; d >= 0; d--) {\n        attr = fromNodeAttrs[d];\n        attrName = attr.name;\n        attrNamespaceURI = attr.namespaceURI;\n\n        if (attrNamespaceURI) {\n            attrName = attr.localName || attrName;\n\n            if (!toNode.hasAttributeNS(attrNamespaceURI, attrName)) {\n                fromNode.removeAttributeNS(attrNamespaceURI, attrName);\n            }\n        } else {\n            if (!toNode.hasAttribute(attrName)) {\n                fromNode.removeAttribute(attrName);\n            }\n        }\n    }\n}\n\nvar range; // Create a range object for efficently rendering strings to elements.\nvar NS_XHTML = 'http://www.w3.org/1999/xhtml';\n\nvar doc = typeof document === 'undefined' ? undefined : document;\nvar HAS_TEMPLATE_SUPPORT = !!doc && 'content' in doc.createElement('template');\nvar HAS_RANGE_SUPPORT = !!doc && doc.createRange && 'createContextualFragment' in doc.createRange();\n\nfunction createFragmentFromTemplate(str) {\n    var template = doc.createElement('template');\n    template.innerHTML = str;\n    return template.content.childNodes[0];\n}\n\nfunction createFragmentFromRange(str) {\n    if (!range) {\n        range = doc.createRange();\n        range.selectNode(doc.body);\n    }\n\n    var fragment = range.createContextualFragment(str);\n    return fragment.childNodes[0];\n}\n\nfunction createFragmentFromWrap(str) {\n    var fragment = doc.createElement('body');\n    fragment.innerHTML = str;\n    return fragment.childNodes[0];\n}\n\n/**\n * This is about the same\n * var html = new DOMParser().parseFromString(str, 'text/html');\n * return html.body.firstChild;\n *\n * @method toElement\n * @param {String} str\n */\nfunction toElement(str) {\n    str = str.trim();\n    if (HAS_TEMPLATE_SUPPORT) {\n      // avoid restrictions on content for things like `<tr><th>Hi</th></tr>` which\n      // createContextualFragment doesn't support\n      // <template> support not available in IE\n      return createFragmentFromTemplate(str);\n    } else if (HAS_RANGE_SUPPORT) {\n      return createFragmentFromRange(str);\n    }\n\n    return createFragmentFromWrap(str);\n}\n\n/**\n * Returns true if two node's names are the same.\n *\n * NOTE: We don't bother checking `namespaceURI` because you will never find two HTML elements with the same\n *       nodeName and different namespace URIs.\n *\n * @param {Element} a\n * @param {Element} b The target element\n * @return {boolean}\n */\nfunction compareNodeNames(fromEl, toEl) {\n    var fromNodeName = fromEl.nodeName;\n    var toNodeName = toEl.nodeName;\n    var fromCodeStart, toCodeStart;\n\n    if (fromNodeName === toNodeName) {\n        return true;\n    }\n\n    fromCodeStart = fromNodeName.charCodeAt(0);\n    toCodeStart = toNodeName.charCodeAt(0);\n\n    // If the target element is a virtual DOM node or SVG node then we may\n    // need to normalize the tag name before comparing. Normal HTML elements that are\n    // in the \"http://www.w3.org/1999/xhtml\"\n    // are converted to upper case\n    if (fromCodeStart <= 90 && toCodeStart >= 97) { // from is upper and to is lower\n        return fromNodeName === toNodeName.toUpperCase();\n    } else if (toCodeStart <= 90 && fromCodeStart >= 97) { // to is upper and from is lower\n        return toNodeName === fromNodeName.toUpperCase();\n    } else {\n        return false;\n    }\n}\n\n/**\n * Create an element, optionally with a known namespace URI.\n *\n * @param {string} name the element name, e.g. 'div' or 'svg'\n * @param {string} [namespaceURI] the element's namespace URI, i.e. the value of\n * its `xmlns` attribute or its inferred namespace.\n *\n * @return {Element}\n */\nfunction createElementNS(name, namespaceURI) {\n    return !namespaceURI || namespaceURI === NS_XHTML ?\n        doc.createElement(name) :\n        doc.createElementNS(namespaceURI, name);\n}\n\n/**\n * Copies the children of one DOM element to another DOM element\n */\nfunction moveChildren(fromEl, toEl) {\n    var curChild = fromEl.firstChild;\n    while (curChild) {\n        var nextChild = curChild.nextSibling;\n        toEl.appendChild(curChild);\n        curChild = nextChild;\n    }\n    return toEl;\n}\n\nfunction syncBooleanAttrProp(fromEl, toEl, name) {\n    if (fromEl[name] !== toEl[name]) {\n        fromEl[name] = toEl[name];\n        if (fromEl[name]) {\n            fromEl.setAttribute(name, '');\n        } else {\n            fromEl.removeAttribute(name);\n        }\n    }\n}\n\nvar specialElHandlers = {\n    OPTION: function(fromEl, toEl) {\n        var parentNode = fromEl.parentNode;\n        if (parentNode) {\n            var parentName = parentNode.nodeName.toUpperCase();\n            if (parentName === 'OPTGROUP') {\n                parentNode = parentNode.parentNode;\n                parentName = parentNode && parentNode.nodeName.toUpperCase();\n            }\n            if (parentName === 'SELECT' && !parentNode.hasAttribute('multiple')) {\n                if (fromEl.hasAttribute('selected') && !toEl.selected) {\n                    // Workaround for MS Edge bug where the 'selected' attribute can only be\n                    // removed if set to a non-empty value:\n                    // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/12087679/\n                    fromEl.setAttribute('selected', 'selected');\n                    fromEl.removeAttribute('selected');\n                }\n                // We have to reset select element's selectedIndex to -1, otherwise setting\n                // fromEl.selected using the syncBooleanAttrProp below has no effect.\n                // The correct selectedIndex will be set in the SELECT special handler below.\n                parentNode.selectedIndex = -1;\n            }\n        }\n        syncBooleanAttrProp(fromEl, toEl, 'selected');\n    },\n    /**\n     * The \"value\" attribute is special for the <input> element since it sets\n     * the initial value. Changing the \"value\" attribute without changing the\n     * \"value\" property will have no effect since it is only used to the set the\n     * initial value.  Similar for the \"checked\" attribute, and \"disabled\".\n     */\n    INPUT: function(fromEl, toEl) {\n        syncBooleanAttrProp(fromEl, toEl, 'checked');\n        syncBooleanAttrProp(fromEl, toEl, 'disabled');\n\n        if (fromEl.value !== toEl.value) {\n            fromEl.value = toEl.value;\n        }\n\n        if (!toEl.hasAttribute('value')) {\n            fromEl.removeAttribute('value');\n        }\n    },\n\n    TEXTAREA: function(fromEl, toEl) {\n        var newValue = toEl.value;\n        if (fromEl.value !== newValue) {\n            fromEl.value = newValue;\n        }\n\n        var firstChild = fromEl.firstChild;\n        if (firstChild) {\n            // Needed for IE. Apparently IE sets the placeholder as the\n            // node value and vise versa. This ignores an empty update.\n            var oldValue = firstChild.nodeValue;\n\n            if (oldValue == newValue || (!newValue && oldValue == fromEl.placeholder)) {\n                return;\n            }\n\n            firstChild.nodeValue = newValue;\n        }\n    },\n    SELECT: function(fromEl, toEl) {\n        if (!toEl.hasAttribute('multiple')) {\n            var selectedIndex = -1;\n            var i = 0;\n            // We have to loop through children of fromEl, not toEl since nodes can be moved\n            // from toEl to fromEl directly when morphing.\n            // At the time this special handler is invoked, all children have already been morphed\n            // and appended to / removed from fromEl, so using fromEl here is safe and correct.\n            var curChild = fromEl.firstChild;\n            var optgroup;\n            var nodeName;\n            while(curChild) {\n                nodeName = curChild.nodeName && curChild.nodeName.toUpperCase();\n                if (nodeName === 'OPTGROUP') {\n                    optgroup = curChild;\n                    curChild = optgroup.firstChild;\n                } else {\n                    if (nodeName === 'OPTION') {\n                        if (curChild.hasAttribute('selected')) {\n                            selectedIndex = i;\n                            break;\n                        }\n                        i++;\n                    }\n                    curChild = curChild.nextSibling;\n                    if (!curChild && optgroup) {\n                        curChild = optgroup.nextSibling;\n                        optgroup = null;\n                    }\n                }\n            }\n\n            fromEl.selectedIndex = selectedIndex;\n        }\n    }\n};\n\nvar ELEMENT_NODE = 1;\nvar DOCUMENT_FRAGMENT_NODE$1 = 11;\nvar TEXT_NODE = 3;\nvar COMMENT_NODE = 8;\n\nfunction noop() {}\n\nfunction defaultGetNodeKey(node) {\n  if (node) {\n      return (node.getAttribute && node.getAttribute('id')) || node.id;\n  }\n}\n\nfunction morphdomFactory(morphAttrs) {\n\n    return function morphdom(fromNode, toNode, options) {\n        if (!options) {\n            options = {};\n        }\n\n        if (typeof toNode === 'string') {\n            if (fromNode.nodeName === '#document' || fromNode.nodeName === 'HTML' || fromNode.nodeName === 'BODY') {\n                var toNodeHtml = toNode;\n                toNode = doc.createElement('html');\n                toNode.innerHTML = toNodeHtml;\n            } else {\n                toNode = toElement(toNode);\n            }\n        }\n\n        var getNodeKey = options.getNodeKey || defaultGetNodeKey;\n        var onBeforeNodeAdded = options.onBeforeNodeAdded || noop;\n        var onNodeAdded = options.onNodeAdded || noop;\n        var onBeforeElUpdated = options.onBeforeElUpdated || noop;\n        var onElUpdated = options.onElUpdated || noop;\n        var onBeforeNodeDiscarded = options.onBeforeNodeDiscarded || noop;\n        var onNodeDiscarded = options.onNodeDiscarded || noop;\n        var onBeforeElChildrenUpdated = options.onBeforeElChildrenUpdated || noop;\n        var childrenOnly = options.childrenOnly === true;\n\n        // This object is used as a lookup to quickly find all keyed elements in the original DOM tree.\n        var fromNodesLookup = Object.create(null);\n        var keyedRemovalList = [];\n\n        function addKeyedRemoval(key) {\n            keyedRemovalList.push(key);\n        }\n\n        function walkDiscardedChildNodes(node, skipKeyedNodes) {\n            if (node.nodeType === ELEMENT_NODE) {\n                var curChild = node.firstChild;\n                while (curChild) {\n\n                    var key = undefined;\n\n                    if (skipKeyedNodes && (key = getNodeKey(curChild))) {\n                        // If we are skipping keyed nodes then we add the key\n                        // to a list so that it can be handled at the very end.\n                        addKeyedRemoval(key);\n                    } else {\n                        // Only report the node as discarded if it is not keyed. We do this because\n                        // at the end we loop through all keyed elements that were unmatched\n                        // and then discard them in one final pass.\n                        onNodeDiscarded(curChild);\n                        if (curChild.firstChild) {\n                            walkDiscardedChildNodes(curChild, skipKeyedNodes);\n                        }\n                    }\n\n                    curChild = curChild.nextSibling;\n                }\n            }\n        }\n\n        /**\n         * Removes a DOM node out of the original DOM\n         *\n         * @param  {Node} node The node to remove\n         * @param  {Node} parentNode The nodes parent\n         * @param  {Boolean} skipKeyedNodes If true then elements with keys will be skipped and not discarded.\n         * @return {undefined}\n         */\n        function removeNode(node, parentNode, skipKeyedNodes) {\n            if (onBeforeNodeDiscarded(node) === false) {\n                return;\n            }\n\n            if (parentNode) {\n                parentNode.removeChild(node);\n            }\n\n            onNodeDiscarded(node);\n            walkDiscardedChildNodes(node, skipKeyedNodes);\n        }\n\n        // // TreeWalker implementation is no faster, but keeping this around in case this changes in the future\n        // function indexTree(root) {\n        //     var treeWalker = document.createTreeWalker(\n        //         root,\n        //         NodeFilter.SHOW_ELEMENT);\n        //\n        //     var el;\n        //     while((el = treeWalker.nextNode())) {\n        //         var key = getNodeKey(el);\n        //         if (key) {\n        //             fromNodesLookup[key] = el;\n        //         }\n        //     }\n        // }\n\n        // // NodeIterator implementation is no faster, but keeping this around in case this changes in the future\n        //\n        // function indexTree(node) {\n        //     var nodeIterator = document.createNodeIterator(node, NodeFilter.SHOW_ELEMENT);\n        //     var el;\n        //     while((el = nodeIterator.nextNode())) {\n        //         var key = getNodeKey(el);\n        //         if (key) {\n        //             fromNodesLookup[key] = el;\n        //         }\n        //     }\n        // }\n\n        function indexTree(node) {\n            if (node.nodeType === ELEMENT_NODE || node.nodeType === DOCUMENT_FRAGMENT_NODE$1) {\n                var curChild = node.firstChild;\n                while (curChild) {\n                    var key = getNodeKey(curChild);\n                    if (key) {\n                        fromNodesLookup[key] = curChild;\n                    }\n\n                    // Walk recursively\n                    indexTree(curChild);\n\n                    curChild = curChild.nextSibling;\n                }\n            }\n        }\n\n        indexTree(fromNode);\n\n        function handleNodeAdded(el) {\n            onNodeAdded(el);\n\n            var curChild = el.firstChild;\n            while (curChild) {\n                var nextSibling = curChild.nextSibling;\n\n                var key = getNodeKey(curChild);\n                if (key) {\n                    var unmatchedFromEl = fromNodesLookup[key];\n                    // if we find a duplicate #id node in cache, replace `el` with cache value\n                    // and morph it to the child node.\n                    if (unmatchedFromEl && compareNodeNames(curChild, unmatchedFromEl)) {\n                        curChild.parentNode.replaceChild(unmatchedFromEl, curChild);\n                        morphEl(unmatchedFromEl, curChild);\n                    } else {\n                      handleNodeAdded(curChild);\n                    }\n                } else {\n                  // recursively call for curChild and it's children to see if we find something in\n                  // fromNodesLookup\n                  handleNodeAdded(curChild);\n                }\n\n                curChild = nextSibling;\n            }\n        }\n\n        function cleanupFromEl(fromEl, curFromNodeChild, curFromNodeKey) {\n            // We have processed all of the \"to nodes\". If curFromNodeChild is\n            // non-null then we still have some from nodes left over that need\n            // to be removed\n            while (curFromNodeChild) {\n                var fromNextSibling = curFromNodeChild.nextSibling;\n                if ((curFromNodeKey = getNodeKey(curFromNodeChild))) {\n                    // Since the node is keyed it might be matched up later so we defer\n                    // the actual removal to later\n                    addKeyedRemoval(curFromNodeKey);\n                } else {\n                    // NOTE: we skip nested keyed nodes from being removed since there is\n                    //       still a chance they will be matched up later\n                    removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n                }\n                curFromNodeChild = fromNextSibling;\n            }\n        }\n\n        function morphEl(fromEl, toEl, childrenOnly) {\n            var toElKey = getNodeKey(toEl);\n\n            if (toElKey) {\n                // If an element with an ID is being morphed then it will be in the final\n                // DOM so clear it out of the saved elements collection\n                delete fromNodesLookup[toElKey];\n            }\n\n            if (!childrenOnly) {\n                // optional\n                if (onBeforeElUpdated(fromEl, toEl) === false) {\n                    return;\n                }\n\n                // update attributes on original DOM element first\n                morphAttrs(fromEl, toEl);\n                // optional\n                onElUpdated(fromEl);\n\n                if (onBeforeElChildrenUpdated(fromEl, toEl) === false) {\n                    return;\n                }\n            }\n\n            if (fromEl.nodeName !== 'TEXTAREA') {\n              morphChildren(fromEl, toEl);\n            } else {\n              specialElHandlers.TEXTAREA(fromEl, toEl);\n            }\n        }\n\n        function morphChildren(fromEl, toEl) {\n            var curToNodeChild = toEl.firstChild;\n            var curFromNodeChild = fromEl.firstChild;\n            var curToNodeKey;\n            var curFromNodeKey;\n\n            var fromNextSibling;\n            var toNextSibling;\n            var matchingFromEl;\n\n            // walk the children\n            outer: while (curToNodeChild) {\n                toNextSibling = curToNodeChild.nextSibling;\n                curToNodeKey = getNodeKey(curToNodeChild);\n\n                // walk the fromNode children all the way through\n                while (curFromNodeChild) {\n                    fromNextSibling = curFromNodeChild.nextSibling;\n\n                    if (curToNodeChild.isSameNode && curToNodeChild.isSameNode(curFromNodeChild)) {\n                        curToNodeChild = toNextSibling;\n                        curFromNodeChild = fromNextSibling;\n                        continue outer;\n                    }\n\n                    curFromNodeKey = getNodeKey(curFromNodeChild);\n\n                    var curFromNodeType = curFromNodeChild.nodeType;\n\n                    // this means if the curFromNodeChild doesnt have a match with the curToNodeChild\n                    var isCompatible = undefined;\n\n                    if (curFromNodeType === curToNodeChild.nodeType) {\n                        if (curFromNodeType === ELEMENT_NODE) {\n                            // Both nodes being compared are Element nodes\n\n                            if (curToNodeKey) {\n                                // The target node has a key so we want to match it up with the correct element\n                                // in the original DOM tree\n                                if (curToNodeKey !== curFromNodeKey) {\n                                    // The current element in the original DOM tree does not have a matching key so\n                                    // let's check our lookup to see if there is a matching element in the original\n                                    // DOM tree\n                                    if ((matchingFromEl = fromNodesLookup[curToNodeKey])) {\n                                        if (fromNextSibling === matchingFromEl) {\n                                            // Special case for single element removals. To avoid removing the original\n                                            // DOM node out of the tree (since that can break CSS transitions, etc.),\n                                            // we will instead discard the current node and wait until the next\n                                            // iteration to properly match up the keyed target element with its matching\n                                            // element in the original tree\n                                            isCompatible = false;\n                                        } else {\n                                            // We found a matching keyed element somewhere in the original DOM tree.\n                                            // Let's move the original DOM node into the current position and morph\n                                            // it.\n\n                                            // NOTE: We use insertBefore instead of replaceChild because we want to go through\n                                            // the `removeNode()` function for the node that is being discarded so that\n                                            // all lifecycle hooks are correctly invoked\n                                            fromEl.insertBefore(matchingFromEl, curFromNodeChild);\n\n                                            // fromNextSibling = curFromNodeChild.nextSibling;\n\n                                            if (curFromNodeKey) {\n                                                // Since the node is keyed it might be matched up later so we defer\n                                                // the actual removal to later\n                                                addKeyedRemoval(curFromNodeKey);\n                                            } else {\n                                                // NOTE: we skip nested keyed nodes from being removed since there is\n                                                //       still a chance they will be matched up later\n                                                removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n                                            }\n\n                                            curFromNodeChild = matchingFromEl;\n                                        }\n                                    } else {\n                                        // The nodes are not compatible since the \"to\" node has a key and there\n                                        // is no matching keyed node in the source tree\n                                        isCompatible = false;\n                                    }\n                                }\n                            } else if (curFromNodeKey) {\n                                // The original has a key\n                                isCompatible = false;\n                            }\n\n                            isCompatible = isCompatible !== false && compareNodeNames(curFromNodeChild, curToNodeChild);\n                            if (isCompatible) {\n                                // We found compatible DOM elements so transform\n                                // the current \"from\" node to match the current\n                                // target DOM node.\n                                // MORPH\n                                morphEl(curFromNodeChild, curToNodeChild);\n                            }\n\n                        } else if (curFromNodeType === TEXT_NODE || curFromNodeType == COMMENT_NODE) {\n                            // Both nodes being compared are Text or Comment nodes\n                            isCompatible = true;\n                            // Simply update nodeValue on the original node to\n                            // change the text value\n                            if (curFromNodeChild.nodeValue !== curToNodeChild.nodeValue) {\n                                curFromNodeChild.nodeValue = curToNodeChild.nodeValue;\n                            }\n\n                        }\n                    }\n\n                    if (isCompatible) {\n                        // Advance both the \"to\" child and the \"from\" child since we found a match\n                        // Nothing else to do as we already recursively called morphChildren above\n                        curToNodeChild = toNextSibling;\n                        curFromNodeChild = fromNextSibling;\n                        continue outer;\n                    }\n\n                    // No compatible match so remove the old node from the DOM and continue trying to find a\n                    // match in the original DOM. However, we only do this if the from node is not keyed\n                    // since it is possible that a keyed node might match up with a node somewhere else in the\n                    // target tree and we don't want to discard it just yet since it still might find a\n                    // home in the final DOM tree. After everything is done we will remove any keyed nodes\n                    // that didn't find a home\n                    if (curFromNodeKey) {\n                        // Since the node is keyed it might be matched up later so we defer\n                        // the actual removal to later\n                        addKeyedRemoval(curFromNodeKey);\n                    } else {\n                        // NOTE: we skip nested keyed nodes from being removed since there is\n                        //       still a chance they will be matched up later\n                        removeNode(curFromNodeChild, fromEl, true /* skip keyed nodes */);\n                    }\n\n                    curFromNodeChild = fromNextSibling;\n                } // END: while(curFromNodeChild) {}\n\n                // If we got this far then we did not find a candidate match for\n                // our \"to node\" and we exhausted all of the children \"from\"\n                // nodes. Therefore, we will just append the current \"to\" node\n                // to the end\n                if (curToNodeKey && (matchingFromEl = fromNodesLookup[curToNodeKey]) && compareNodeNames(matchingFromEl, curToNodeChild)) {\n                    fromEl.appendChild(matchingFromEl);\n                    // MORPH\n                    morphEl(matchingFromEl, curToNodeChild);\n                } else {\n                    var onBeforeNodeAddedResult = onBeforeNodeAdded(curToNodeChild);\n                    if (onBeforeNodeAddedResult !== false) {\n                        if (onBeforeNodeAddedResult) {\n                            curToNodeChild = onBeforeNodeAddedResult;\n                        }\n\n                        if (curToNodeChild.actualize) {\n                            curToNodeChild = curToNodeChild.actualize(fromEl.ownerDocument || doc);\n                        }\n                        fromEl.appendChild(curToNodeChild);\n                        handleNodeAdded(curToNodeChild);\n                    }\n                }\n\n                curToNodeChild = toNextSibling;\n                curFromNodeChild = fromNextSibling;\n            }\n\n            cleanupFromEl(fromEl, curFromNodeChild, curFromNodeKey);\n\n            var specialElHandler = specialElHandlers[fromEl.nodeName];\n            if (specialElHandler) {\n                specialElHandler(fromEl, toEl);\n            }\n        } // END: morphChildren(...)\n\n        var morphedNode = fromNode;\n        var morphedNodeType = morphedNode.nodeType;\n        var toNodeType = toNode.nodeType;\n\n        if (!childrenOnly) {\n            // Handle the case where we are given two DOM nodes that are not\n            // compatible (e.g. <div> --> <span> or <div> --> TEXT)\n            if (morphedNodeType === ELEMENT_NODE) {\n                if (toNodeType === ELEMENT_NODE) {\n                    if (!compareNodeNames(fromNode, toNode)) {\n                        onNodeDiscarded(fromNode);\n                        morphedNode = moveChildren(fromNode, createElementNS(toNode.nodeName, toNode.namespaceURI));\n                    }\n                } else {\n                    // Going from an element node to a text node\n                    morphedNode = toNode;\n                }\n            } else if (morphedNodeType === TEXT_NODE || morphedNodeType === COMMENT_NODE) { // Text or comment node\n                if (toNodeType === morphedNodeType) {\n                    if (morphedNode.nodeValue !== toNode.nodeValue) {\n                        morphedNode.nodeValue = toNode.nodeValue;\n                    }\n\n                    return morphedNode;\n                } else {\n                    // Text node to something else\n                    morphedNode = toNode;\n                }\n            }\n        }\n\n        if (morphedNode === toNode) {\n            // The \"to node\" was not compatible with the \"from node\" so we had to\n            // toss out the \"from node\" and use the \"to node\"\n            onNodeDiscarded(fromNode);\n        } else {\n            if (toNode.isSameNode && toNode.isSameNode(morphedNode)) {\n                return;\n            }\n\n            morphEl(morphedNode, toNode, childrenOnly);\n\n            // We now need to loop over any keyed nodes that might need to be\n            // removed. We only do the removal if we know that the keyed node\n            // never found a match. When a keyed node is matched up we remove\n            // it out of fromNodesLookup and we use fromNodesLookup to determine\n            // if a keyed node has been matched up or not\n            if (keyedRemovalList) {\n                for (var i=0, len=keyedRemovalList.length; i<len; i++) {\n                    var elToRemove = fromNodesLookup[keyedRemovalList[i]];\n                    if (elToRemove) {\n                        removeNode(elToRemove, elToRemove.parentNode, false);\n                    }\n                }\n            }\n        }\n\n        if (!childrenOnly && morphedNode !== fromNode && fromNode.parentNode) {\n            if (morphedNode.actualize) {\n                morphedNode = morphedNode.actualize(fromNode.ownerDocument || doc);\n            }\n            // If we had to swap out the from node with a new node because the old\n            // node was not compatible with the target node then we need to\n            // replace the old DOM node in the original DOM tree. This is only\n            // possible if the original DOM node was part of a DOM tree which\n            // we know is the case if it has a parent node.\n            fromNode.parentNode.replaceChild(morphedNode, fromNode);\n        }\n\n        return morphedNode;\n    };\n}\n\nvar morphdom = morphdomFactory(morphAttrs);\n\nexport default morphdom;\n","import Operations from './operations'\n\nlet operations = Operations\n\nconst add = newOperations => {\n  operations = { ...operations, ...newOperations }\n}\n\nconst addOperations = operations => {\n  add(operations)\n}\n\nconst addOperation = (name, operation) => {\n  const operations = {}\n  operations[name] = operation\n\n  add(operations)\n}\n\nexport { addOperation, addOperations }\n\nexport default {\n  get all () {\n    return operations\n  }\n}\n","import morphdom from 'morphdom'\nimport { shouldMorph, didMorph } from './morph_callbacks'\nimport {\n  assignFocus,\n  dispatch,\n  getClassNames,\n  processElements,\n  before,\n  after,\n  operate\n} from './utils'\n\nexport default {\n  // DOM Mutations\n\n  append: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.insertAdjacentHTML('beforeend', html || '')\n        assignFocus(focusSelector)\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  graft: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { parent, focusSelector } = operation\n        const parentElement = document.querySelector(parent)\n        if (parentElement) {\n          parentElement.appendChild(element)\n          assignFocus(focusSelector)\n        }\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  innerHtml: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.innerHTML = html || ''\n        assignFocus(focusSelector)\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  insertAdjacentHtml: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { html, position, focusSelector } = operation\n        element.insertAdjacentHTML(position || 'beforeend', html || '')\n        assignFocus(focusSelector)\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  insertAdjacentText: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { text, position, focusSelector } = operation\n        element.insertAdjacentText(position || 'beforeend', text || '')\n        assignFocus(focusSelector)\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  morph: (operation, callee) => {\n    processElements(operation, element => {\n      const { html } = operation\n      const template = document.createElement('template')\n      template.innerHTML = String(html).trim()\n      operation.content = template.content\n      const parent = element.parentElement\n      const ordinal = Array.from(parent.children).indexOf(element)\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { childrenOnly, focusSelector } = operation\n        morphdom(\n          element,\n          childrenOnly ? template.content : template.innerHTML,\n          {\n            childrenOnly: !!childrenOnly,\n            onBeforeElUpdated: shouldMorph(operation),\n            onElUpdated: didMorph(operation)\n          }\n        )\n        assignFocus(focusSelector)\n      })\n      after(parent.children[ordinal], callee, operation)\n    })\n  },\n\n  outerHtml: (operation, callee) => {\n    processElements(operation, element => {\n      const parent = element.parentElement\n      const ordinal = Array.from(parent.children).indexOf(element)\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.outerHTML = html || ''\n        assignFocus(focusSelector)\n      })\n      after(parent.children[ordinal], callee, operation)\n    })\n  },\n\n  prepend: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.insertAdjacentHTML('afterbegin', html || '')\n        assignFocus(focusSelector)\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  remove: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { focusSelector } = operation\n        element.remove()\n        assignFocus(focusSelector)\n      })\n      after(document, callee, operation)\n    })\n  },\n\n  replace: (operation, callee) => {\n    processElements(operation, element => {\n      const parent = element.parentElement\n      const ordinal = Array.from(parent.children).indexOf(element)\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { html, focusSelector } = operation\n        element.outerHTML = html || ''\n        assignFocus(focusSelector)\n      })\n      after(parent.children[ordinal], callee, operation)\n    })\n  },\n\n  textContent: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { text, focusSelector } = operation\n        element.textContent = text || ''\n        assignFocus(focusSelector)\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  // Element Property Mutations\n\n  addCssClass: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { name } = operation\n        element.classList.add(...getClassNames(name || ''))\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  removeAttribute: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { name } = operation\n        element.removeAttribute(name)\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  removeCssClass: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { name } = operation\n        element.classList.remove(...getClassNames(name))\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  setAttribute: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { name, value } = operation\n        element.setAttribute(name, value || '')\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  setDatasetProperty: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { name, value } = operation\n        element.dataset[name] = value || ''\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  setProperty: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { name, value } = operation\n        if (name in element) element[name] = value || ''\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  setStyle: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { name, value } = operation\n        element.style[name] = value || ''\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  setStyles: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { styles } = operation\n        for (let [name, value] of Object.entries(styles))\n          element.style[name] = value || ''\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  setValue: (operation, callee) => {\n    processElements(operation, element => {\n      before(element, callee, operation)\n      operate(operation, () => {\n        const { value } = operation\n        element.value = value || ''\n      })\n      after(element, callee, operation)\n    })\n  },\n\n  // DOM Events\n\n  dispatchEvent: (operation, callee) => {\n    processElements(operation, element => {\n      operate(operation, () => {\n        const { name, detail } = operation\n        dispatch(element, name, detail)\n      })\n    })\n  },\n\n  setMeta: (operation, callee) => {\n    before(document, callee, operation)\n    operate(operation, () => {\n      const { name, content } = operation\n      let meta = document.head.querySelector(`meta[name='${name}']`)\n      if (!meta) {\n        meta = document.createElement('meta')\n        meta.name = name\n        document.head.appendChild(meta)\n      }\n      meta.content = content\n    })\n    after(document, callee, operation)\n  },\n\n  // Browser Manipulations\n\n  clearStorage: (operation, callee) => {\n    before(document, callee, operation)\n    operate(operation, () => {\n      const { type } = operation\n      const storage = type === 'session' ? sessionStorage : localStorage\n      storage.clear()\n    })\n    after(document, callee, operation)\n  },\n\n  go: (operation, callee) => {\n    before(window, callee, operation)\n    operate(operation, () => {\n      const { delta } = operation\n      history.go(delta)\n    })\n    after(window, callee, operation)\n  },\n\n  pushState: (operation, callee) => {\n    before(window, callee, operation)\n    operate(operation, () => {\n      const { state, title, url } = operation\n      history.pushState(state || {}, title || '', url)\n    })\n    after(window, callee, operation)\n  },\n\n  removeStorageItem: (operation, callee) => {\n    before(document, callee, operation)\n    operate(operation, () => {\n      const { key, type } = operation\n      const storage = type === 'session' ? sessionStorage : localStorage\n      storage.removeItem(key)\n    })\n    after(document, callee, operation)\n  },\n\n  replaceState: (operation, callee) => {\n    before(window, callee, operation)\n    operate(operation, () => {\n      const { state, title, url } = operation\n      history.replaceState(state || {}, title || '', url)\n    })\n    after(window, callee, operation)\n  },\n\n  scrollIntoView: (operation, callee) => {\n    const { element } = operation\n    before(element, callee, operation)\n    operate(operation, () => {\n      element.scrollIntoView(operation)\n    })\n    after(element, callee, operation)\n  },\n\n  setCookie: (operation, callee) => {\n    before(document, callee, operation)\n    operate(operation, () => {\n      const { cookie } = operation\n      document.cookie = cookie || ''\n    })\n    after(document, callee, operation)\n  },\n\n  setFocus: (operation, callee) => {\n    const { element } = operation\n    before(element, callee, operation)\n    operate(operation, () => {\n      assignFocus(element)\n    })\n    after(element, callee, operation)\n  },\n\n  setStorageItem: (operation, callee) => {\n    before(document, callee, operation)\n    operate(operation, () => {\n      const { key, value, type } = operation\n      const storage = type === 'session' ? sessionStorage : localStorage\n      storage.setItem(key, value || '')\n    })\n    after(document, callee, operation)\n  },\n\n  // Notifications\n\n  consoleLog: (operation, callee) => {\n    operate(operation, () => {\n      const { message, level } = operation\n      level && ['warn', 'info', 'error'].includes(level)\n        ? console[level](message || '')\n        : console.log(message || '')\n    })\n  },\n\n  consoleTable: (operation, callee) => {\n    operate(operation, () => {\n      const { data, columns } = operation\n      console.table(data, columns || [])\n    })\n  },\n\n  notification: (operation, callee) => {\n    before(document, callee, operation)\n    operate(operation, () => {\n      const { title, options } = operation\n      Notification.requestPermission().then(result => {\n        operation.permission = result\n        if (result === 'granted') new Notification(title || '', options)\n      })\n    })\n    after(document, callee, operation)\n  }\n}\n","export let consumer\n\nexport default {\n  setConsumer (value) {\n    consumer = value\n  }\n}\n","import { xpathToElement } from './utils'\nimport activeElement from './active_element'\nimport OperationStore from './operation_store'\nimport actionCable from './action_cable'\n\nconst perform = (\n  operations,\n  options = { emitMissingElementWarnings: true }\n) => {\n  for (let name in operations) {\n    if (operations.hasOwnProperty(name)) {\n      const entries = operations[name]\n      for (let i = 0; i < entries.length; i++) {\n        const operation = entries[i]\n        try {\n          if (operation.selector) {\n            operation.element = operation.xpath\n              ? xpathToElement(operation.selector)\n              : document[\n                  operation.selectAll ? 'querySelectorAll' : 'querySelector'\n                ](operation.selector)\n          } else {\n            operation.element = document\n          }\n          if (operation.element || options.emitMissingElementWarnings) {\n            activeElement.set(document.activeElement)\n            const cableReadyOperation = OperationStore.all[name]\n\n            if (cableReadyOperation) {\n              cableReadyOperation(operation, name)\n            } else {\n              console.error(\n                `CableReady couldn't find the \"${name}\" operation. Make sure you haven't misspelled the operation name and that you've added all required operations.`\n              )\n            }\n          }\n        } catch (e) {\n          if (operation.element) {\n            console.error(\n              `CableReady detected an error in ${name}: ${e.message}. If you need to support older browsers make sure you've included the corresponding polyfills. https://docs.stimulusreflex.com/setup#polyfills-for-ie11.`\n            )\n            console.error(e)\n          } else {\n            console.log(\n              `CableReady ${name} failed due to missing DOM element for selector: '${operation.selector}'`\n            )\n          }\n        }\n      }\n    }\n  }\n}\n\nconst performAsync = (\n  operations,\n  options = { emitMissingElementWarnings: true }\n) => {\n  return new Promise((resolve, reject) => {\n    try {\n      resolve(perform(operations, options))\n    } catch (err) {\n      reject(err)\n    }\n  })\n}\n\nconst initialize = (initializeOptions = {}) => {\n  const { consumer } = initializeOptions\n  actionCable.setConsumer(consumer)\n}\n\nexport { perform, performAsync, initialize }\n","import CableReady from 'cable_ready'\nimport { consumer } from './action_cable'\n\nclass StreamFromElement extends HTMLElement {\n  connectedCallback () {\n    if (this.preview) return\n    if (consumer) {\n      this.channel = consumer.subscriptions.create(\n        {\n          channel: 'CableReady::Stream',\n          identifier: this.getAttribute('identifier')\n        },\n        {\n          received (data) {\n            if (data.cableReady) CableReady.perform(data.operations)\n          }\n        }\n      )\n    } else {\n      console.error(\n        'The `stream_from` helper cannot connect without an ActionCable consumer.\\nPlease run `rails generate cable_ready:stream_from` to fix this.'\n      )\n    }\n  }\n\n  disconnectedCallback () {\n    if (this.channel) this.channel.unsubscribe()\n  }\n\n  get preview () {\n    return (\n      document.documentElement.hasAttribute('data-turbolinks-preview') ||\n      document.documentElement.hasAttribute('data-turbo-preview')\n    )\n  }\n}\n\nif (!window.customElements.get('stream-from')) {\n  window.customElements.define('stream-from', StreamFromElement)\n}\n","import * as MorphCallbacks from './morph_callbacks'\nimport { shouldMorphCallbacks, didMorphCallbacks } from './morph_callbacks'\nimport * as Utils from './utils'\nimport OperationStore, { addOperation, addOperations } from './operation_store'\nimport { perform, performAsync, initialize } from './cable_ready'\nimport './stream_from_element'\n\nexport { Utils, MorphCallbacks }\n\nexport default {\n  perform,\n  performAsync,\n  shouldMorphCallbacks,\n  didMorphCallbacks,\n  initialize,\n  addOperation,\n  addOperations,\n  get DOMOperations () {\n    console.warn(\n      'DEPRECATED: Please use `CableReady.operations.jazzHands = ...` instead of `CableReady.DOMOperations.jazzHands = ...`'\n    )\n    return OperationStore.all\n  },\n  get operations () {\n    return OperationStore.all\n  }\n}\n","let debugging = false\n\nexport default {\n  get enabled () {\n    return debugging\n  },\n  get disabled () {\n    return !debugging\n  },\n  get value () {\n    return debugging\n  },\n  set (value) {\n    debugging = !!value\n  },\n  set debug (value) {\n    debugging = !!value\n  }\n}\n","// uuid4 function taken from stackoverflow\n// https://stackoverflow.com/a/2117523/554903\n\nexport const uuidv4 = () => {\n  const crypto = window.crypto || window.msCrypto\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n    (\n      c ^\n      (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))\n    ).toString(16)\n  )\n}\n\nexport const serializeForm = (form, options = {}) => {\n  if (!form) return ''\n\n  const w = options.w || window\n  const { element } = options\n  const formData = new w.FormData(form)\n  const data = Array.from(formData, e => e.map(encodeURIComponent).join('='))\n  const submitButton = form.querySelector('input[type=submit]')\n  if (\n    element &&\n    element.name &&\n    element.nodeName === 'INPUT' &&\n    element.type === 'submit'\n  ) {\n    data.push(\n      `${encodeURIComponent(element.name)}=${encodeURIComponent(element.value)}`\n    )\n  } else if (submitButton && submitButton.name) {\n    data.push(\n      `${encodeURIComponent(submitButton.name)}=${encodeURIComponent(\n        submitButton.value\n      )}`\n    )\n  }\n\n  return Array.from(new Set(data)).join('&')\n}\n\nexport const camelize = (value, uppercaseFirstLetter = true) => {\n  if (typeof value !== 'string') return ''\n  value = value\n    .replace(/[\\s_](.)/g, $1 => $1.toUpperCase())\n    .replace(/[\\s_]/g, '')\n    .replace(/^(.)/, $1 => $1.toLowerCase())\n\n  if (uppercaseFirstLetter)\n    value = value.substr(0, 1).toUpperCase() + value.substr(1)\n\n  return value\n}\n\nexport const debounce = (callback, delay = 250) => {\n  let timeoutId\n  return (...args) => {\n    clearTimeout(timeoutId)\n    timeoutId = setTimeout(() => {\n      timeoutId = null\n      callback(...args)\n    }, delay)\n  }\n}\n\nexport const extractReflexName = reflexString => {\n  const match = reflexString.match(/(?:.*->)?(.*?)(?:Reflex)?#/)\n\n  return match ? match[1] : ''\n}\n\nexport const emitEvent = (event, detail) => {\n  document.dispatchEvent(\n    new CustomEvent(event, {\n      bubbles: true,\n      cancelable: false,\n      detail\n    })\n  )\n  if (window.jQuery) window.jQuery(document).trigger(event, detail)\n}\n\n// construct a valid xPath for an element in the DOM\nexport const elementToXPath = element => {\n  if (element.id !== '') return \"//*[@id='\" + element.id + \"']\"\n  if (element === document.body) return '/html/body'\n\n  let ix = 0\n  const siblings = element.parentNode.childNodes\n\n  for (var i = 0; i < siblings.length; i++) {\n    const sibling = siblings[i]\n    if (sibling === element) {\n      const computedPath = elementToXPath(element.parentNode)\n      const tagName = element.tagName.toLowerCase()\n      const ixInc = ix + 1\n      return `${computedPath}/${tagName}[${ixInc}]`\n    }\n\n    if (sibling.nodeType === 1 && sibling.tagName === element.tagName) {\n      ix++\n    }\n  }\n}\n\nexport const XPathToElement = xpath => {\n  return document.evaluate(\n    xpath,\n    document,\n    null,\n    XPathResult.FIRST_ORDERED_NODE_TYPE,\n    null\n  ).singleNodeValue\n}\n\nexport const XPathToArray = (xpath, reverse = false) => {\n  const snapshotList = document.evaluate(\n    xpath,\n    document,\n    null,\n    XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,\n    null\n  )\n\n  const snapshots = []\n\n  for (let i = 0; i < snapshotList.snapshotLength; i++) {\n    snapshots.push(snapshotList.snapshotItem(i))\n  }\n\n  return reverse ? snapshots.reverse() : snapshots\n}\n","import { camelize } from './utils'\nimport Debug from './debug'\nimport reflexes from './reflexes'\n\n// Invokes a lifecycle method on a StimulusReflex controller.\n//\n// - stage - the lifecycle stage\n//   * before\n//   * success\n//   * error\n//   * halted\n//   * after\n//   * finalize\n//\n// - reflexElement - the element that triggered the Reflex (not necessarily the StimulusReflex Controller Element)\n//\n// - controllerElement - the element holding the StimulusReflex Controller\n//\n// - reflexId - the UUIDv4 which uniquely identifies the Reflex\n//\nconst invokeLifecycleMethod = (\n  stage,\n  reflexElement,\n  controllerElement,\n  reflexId,\n  payload\n) => {\n  if (!controllerElement || !controllerElement.reflexData[reflexId]) return\n\n  const controller = controllerElement.reflexController[reflexId]\n  const reflex = controllerElement.reflexData[reflexId].target\n  const reflexMethodName = reflex.split('#')[1]\n\n  const specificLifecycleMethodName = ['before', 'after', 'finalize'].includes(\n    stage\n  )\n    ? `${stage}${camelize(reflexMethodName)}`\n    : `${camelize(reflexMethodName, false)}${camelize(stage)}`\n  const specificLifecycleMethod = controller[specificLifecycleMethodName]\n\n  const genericLifecycleMethodName = ['before', 'after', 'finalize'].includes(\n    stage\n  )\n    ? `${stage}Reflex`\n    : `reflex${camelize(stage)}`\n  const genericLifecycleMethod = controller[genericLifecycleMethodName]\n\n  if (typeof specificLifecycleMethod === 'function') {\n    specificLifecycleMethod.call(\n      controller,\n      reflexElement,\n      reflex,\n      controllerElement.reflexError[reflexId],\n      reflexId,\n      payload\n    )\n  }\n\n  if (typeof genericLifecycleMethod === 'function') {\n    genericLifecycleMethod.call(\n      controller,\n      reflexElement,\n      reflex,\n      controllerElement.reflexError[reflexId],\n      reflexId,\n      payload\n    )\n  }\n\n  if (reflexes[reflexId] && stage === reflexes[reflexId].finalStage) {\n    Reflect.deleteProperty(controllerElement.reflexController, reflexId)\n    Reflect.deleteProperty(controllerElement.reflexData, reflexId)\n    Reflect.deleteProperty(controllerElement.reflexError, reflexId)\n    // Removing this on a trial basis\n    // 1. Prevents race condition with CR broadcasts\n    // 2. Planning to remove it for v4 as part of queueing refactor\n    // 3. Removing reflexes shouldn't be the responsibility of the lifecycle subsystem\n    // Reflect.deleteProperty(reflexes, reflexId)\n  }\n}\n\ndocument.addEventListener(\n  'stimulus-reflex:before',\n  event =>\n    invokeLifecycleMethod(\n      'before',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    ),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:success',\n  event => {\n    invokeLifecycleMethod(\n      'success',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    )\n    dispatchLifecycleEvent(\n      'after',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    )\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:nothing',\n  event => {\n    invokeLifecycleMethod(\n      'success',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    )\n    dispatchLifecycleEvent(\n      'after',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    )\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:error',\n  event => {\n    invokeLifecycleMethod(\n      'error',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    )\n    dispatchLifecycleEvent(\n      'after',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    )\n  },\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:halted',\n  event =>\n    invokeLifecycleMethod(\n      'halted',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    ),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:after',\n  event =>\n    invokeLifecycleMethod(\n      'after',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    ),\n  true\n)\n\ndocument.addEventListener(\n  'stimulus-reflex:finalize',\n  event =>\n    invokeLifecycleMethod(\n      'finalize',\n      event.detail.element,\n      event.detail.controller.element,\n      event.detail.reflexId,\n      event.detail.payload\n    ),\n  true\n)\n\n// Dispatches a lifecycle event on document\n//\n// - stage - the lifecycle stage\n//   * before\n//   * success\n//   * error\n//   * halted\n//   * after\n//   * finalize\n//\n// - reflexElement - the element that triggered the Reflex (not necessarily the StimulusReflex Controller Element)\n//\n// - controllerElement - the element holding the StimulusReflex Controller\n//\n// - reflexId - the UUIDv4 which uniquely identifies the Reflex\n//\nexport const dispatchLifecycleEvent = (\n  stage,\n  reflexElement,\n  controllerElement,\n  reflexId,\n  payload\n) => {\n  if (!controllerElement) {\n    if (Debug.enabled && !reflexes[reflexId].warned) {\n      console.warn(\n        `StimulusReflex was not able execute callbacks or emit events for \"${stage}\" or later life-cycle stages for this Reflex. The StimulusReflex Controller Element is no longer present in the DOM. Could you move the StimulusReflex Controller to an element higher in your DOM?`\n      )\n      reflexes[reflexId].warned = true\n    }\n    return\n  }\n\n  if (\n    !controllerElement.reflexController ||\n    (controllerElement.reflexController &&\n      !controllerElement.reflexController[reflexId])\n  ) {\n    if (Debug.enabled && !reflexes[reflexId].warned) {\n      console.warn(\n        `StimulusReflex detected that the StimulusReflex Controller responsible for this Reflex has been replaced with a new instance. Callbacks and events for \"${stage}\" or later life-cycle stages cannot be executed.`\n      )\n      reflexes[reflexId].warned = true\n    }\n    return\n  }\n\n  const { target } = controllerElement.reflexData[reflexId] || {}\n  const controller = controllerElement.reflexController[reflexId] || {}\n  const event = `stimulus-reflex:${stage}`\n  const detail = {\n    reflex: target,\n    controller,\n    reflexId,\n    element: reflexElement,\n    payload\n  }\n\n  controllerElement.dispatchEvent(\n    new CustomEvent(event, { bubbles: true, cancelable: false, detail })\n  )\n  if (window.jQuery) window.jQuery(controllerElement).trigger(event, detail)\n}\n","import { received } from '../reflexes'\r\nimport { emitEvent } from '../utils'\r\n\r\nlet consumer\r\nlet params\r\nlet subscriptionActive\r\n\r\nconst createSubscription = controller => {\r\n  consumer = consumer || controller.application.consumer\r\n  const { channel } = controller.StimulusReflex\r\n  const subscription = { channel, ...params }\r\n  const identifier = JSON.stringify(subscription)\r\n\r\n  controller.StimulusReflex.subscription =\r\n    consumer.subscriptions.findAll(identifier)[0] ||\r\n    consumer.subscriptions.create(subscription, {\r\n      received,\r\n      connected,\r\n      rejected,\r\n      disconnected\r\n    })\r\n}\r\n\r\nconst connected = () => {\r\n  subscriptionActive = true\r\n  emitEvent('stimulus-reflex:connected')\r\n}\r\n\r\nconst rejected = () => {\r\n  subscriptionActive = false\r\n  emitEvent('stimulus-reflex:rejected')\r\n  if (Debug.enabled) console.warn('Channel subscription was rejected.')\r\n}\r\n\r\nconst disconnected = willAttemptReconnect => {\r\n  subscriptionActive = false\r\n  emitEvent('stimulus-reflex:disconnected', willAttemptReconnect)\r\n}\r\n\r\nexport default {\r\n  consumer,\r\n  params,\r\n  get subscriptionActive () {\r\n    return subscriptionActive\r\n  },\r\n  createSubscription,\r\n  connected,\r\n  rejected,\r\n  disconnected,\r\n  set (consumerValue, paramsValue) {\r\n    consumer = consumerValue\r\n    params = paramsValue\r\n  }\r\n}\r\n","let deprecationWarnings = true\r\n\r\nexport default {\r\n  get enabled () {\r\n    return deprecationWarnings\r\n  },\r\n  get disabled () {\r\n    return !deprecationWarnings\r\n  },\r\n  get value () {\r\n    return deprecationWarnings\r\n  },\r\n  set (value) {\r\n    deprecationWarnings = !!value\r\n  },\r\n  set deprecate (value) {\r\n    deprecationWarnings = !!value\r\n  }\r\n}\r\n","import reflexes from './reflexes'\nimport { elementToXPath, XPathToArray } from './utils'\nimport Debug from './debug'\nimport Deprecate from './deprecate'\n\nconst multipleInstances = element => {\n  if (['checkbox', 'radio'].includes(element.type)) {\n    return (\n      document.querySelectorAll(\n        `input[type=\"${element.type}\"][name=\"${element.name}\"]`\n      ).length > 1\n    )\n  }\n  return false\n}\nconst collectCheckedOptions = element => {\n  return Array.from(element.querySelectorAll('option:checked'))\n    .concat(\n      Array.from(\n        document.querySelectorAll(\n          `input[type=\"${element.type}\"][name=\"${element.name}\"]`\n        )\n      ).filter(elem => elem.checked)\n    )\n    .map(o => o.value)\n}\n\n// Returns a string value for the passed array.\n//\n//   attributeValue(['', 'one', null, 'two', 'three ']) // 'one two three'\n//\nexport const attributeValue = (values = []) => {\n  const value = values\n    .filter(v => v && String(v).length)\n    .map(v => v.trim())\n    .join(' ')\n    .trim()\n  return value.length ? value : null\n}\n\n// Returns an array for the passed string value by splitting on whitespace.\n//\n//   attributeValues('one two three ') // ['one', 'two', 'three']\n//\nexport const attributeValues = value => {\n  if (!value) return []\n  if (!value.length) return []\n  return value.split(' ').filter(v => v.trim().length)\n}\n\n// Extracts attributes from a DOM element.\n//\nexport const extractElementAttributes = element => {\n  let attrs = Array.from(element.attributes).reduce((memo, attr) => {\n    memo[attr.name] = attr.value\n    return memo\n  }, {})\n\n  attrs.checked = !!element.checked\n  attrs.selected = !!element.selected\n  attrs.tag_name = element.tagName\n\n  if (element.tagName.match(/select/i) || multipleInstances(element)) {\n    const collectedOptions = collectCheckedOptions(element)\n    attrs.values = collectedOptions\n    attrs.value = collectedOptions.join(',')\n  } else {\n    attrs.value = element.value\n  }\n  return attrs\n}\n\n// Returns an array of elements for the provided tokens.\n// Tokens is an array of space separated string coming from the `data-reflex-dataset`\n// or `data-reflex-dataset-all` attribute.\n//\nconst getElementsFromTokens = (element, tokens) => {\n  if (!tokens || tokens.length === 0) return []\n\n  let elements = [element]\n\n  const xPath = elementToXPath(element)\n\n  tokens.forEach(token => {\n    try {\n      switch (token) {\n        case 'combined':\n          if (Deprecate.enabled)\n            console.warn(\n              \"In the next version of StimulusReflex, the 'combined' option to data-reflex-dataset will become 'ancestors'.\"\n            )\n          elements = [\n            ...elements,\n            ...XPathToArray(`${xPath}/ancestor::*`, true)\n          ]\n          break\n        case 'ancestors':\n          elements = [\n            ...elements,\n            ...XPathToArray(`${xPath}/ancestor::*`, true)\n          ]\n          break\n        case 'parent':\n          elements = [...elements, ...XPathToArray(`${xPath}/parent::*`)]\n          break\n        case 'siblings':\n          elements = [\n            ...elements,\n            ...XPathToArray(\n              `${xPath}/preceding-sibling::*|${xPath}/following-sibling::*`\n            )\n          ]\n          break\n        case 'children':\n          elements = [...elements, ...XPathToArray(`${xPath}/child::*`)]\n          break\n        case 'descendants':\n          elements = [...elements, ...XPathToArray(`${xPath}/descendant::*`)]\n          break\n        default:\n          elements = [...elements, ...document.querySelectorAll(token)]\n      }\n    } catch (error) {\n      if (Debug.enabled) console.error(error)\n    }\n  })\n\n  return elements\n}\n\n// Extracts the dataset of an element and combines it with the data attributes from all specified tokens\n//\nexport const extractElementDataset = element => {\n  const dataset = element.attributes[reflexes.app.schema.reflexDatasetAttribute]\n  const allDataset =\n    element.attributes[reflexes.app.schema.reflexDatasetAllAttribute]\n\n  const tokens = (dataset && dataset.value.split(' ')) || []\n  const allTokens = (allDataset && allDataset.value.split(' ')) || []\n\n  const datasetElements = getElementsFromTokens(element, tokens)\n  const datasetAllElements = getElementsFromTokens(element, allTokens)\n\n  const datasetAttributes = datasetElements.reduce((acc, ele) => {\n    return { ...extractDataAttributes(ele), ...acc }\n  }, {})\n\n  const reflexElementAttributes = extractDataAttributes(element)\n\n  const elementDataset = {\n    dataset: { ...reflexElementAttributes, ...datasetAttributes },\n    datasetAll: {}\n  }\n\n  datasetAllElements.forEach(element => {\n    const elementAttributes = extractDataAttributes(element)\n\n    Object.keys(elementAttributes).forEach(key => {\n      const value = elementAttributes[key]\n\n      if (\n        elementDataset.datasetAll[key] &&\n        Array.isArray(elementDataset.datasetAll[key])\n      ) {\n        elementDataset.datasetAll[key].push(value)\n      } else {\n        elementDataset.datasetAll[key] = [value]\n      }\n    })\n  })\n\n  return elementDataset\n}\n\n// Extracts all data attributes from a DOM element.\n//\nexport const extractDataAttributes = element => {\n  let attrs = {}\n\n  if (element && element.attributes) {\n    Array.from(element.attributes).forEach(attr => {\n      if (attr.name.startsWith('data-')) {\n        attrs[attr.name] = attr.value\n      }\n    })\n  }\n\n  return attrs\n}\n","import { attributeValues } from './attributes'\nimport { extractReflexName } from './utils'\n\n// Returns StimulusReflex controllers local to the passed element based on the data-controller attribute.\n//\nconst localReflexControllers = (app, element) => {\n  return attributeValues(\n    element.getAttribute(app.schema.controllerAttribute)\n  ).reduce((memo, name) => {\n    const controller = app.getControllerForElementAndIdentifier(element, name)\n    if (controller && controller.StimulusReflex) memo.push(controller)\n    return memo\n  }, [])\n}\n\n// Returns all StimulusReflex controllers for the passed element.\n// Traverses DOM ancestors starting with element.\n//\nexport const allReflexControllers = (app, element) => {\n  let controllers = []\n  while (element) {\n    controllers = controllers.concat(localReflexControllers(app, element))\n    element = element.parentElement\n  }\n  return controllers\n}\n\n// Given a reflex string such as 'click->TestReflex#create' and a list of\n// controllers. It will find the matching controller based on the controller's\n// identifier. e.g. Given these controller identifiers ['foo', 'bar', 'test'],\n// it would select the 'test' controller.\nexport const findControllerByReflexName = (reflexName, controllers) => {\n  const controller = controllers.find(controller => {\n    if (!controller.identifier) return\n\n    return (\n      extractReflexName(reflexName).toLowerCase() ===\n      controller.identifier.toLowerCase()\n    )\n  })\n\n  return controller || controllers[0]\n}\n","let isolationMode = false\r\n\r\nexport default {\r\n  get disabled () {\r\n    return !isolationMode\r\n  },\r\n  set (value) {\r\n    isolationMode = value\r\n  }\r\n}\r\n","import reflexes from './reflexes'\n\nfunction request (\n  reflexId,\n  target,\n  args,\n  controller,\n  element,\n  controllerElement\n) {\n  reflexes[reflexId].timestamp = new Date()\n  console.log(`\\u2191 stimulus \\u2191 ${target}`, {\n    reflexId,\n    args,\n    controller,\n    element,\n    controllerElement\n  })\n}\n\nfunction success (event) {\n  const { detail } = event || {}\n  const { selector, payload } = detail || {}\n  const { reflexId, target, morph, serverMessage } = detail.stimulusReflex || {}\n  const reflex = reflexes[reflexId]\n  const progress =\n    reflex.totalOperations > 1\n      ? ` ${reflex.completedOperations}/${reflex.totalOperations}`\n      : ''\n  const duration = reflex.timestamp\n    ? `in ${new Date() - reflex.timestamp}ms`\n    : 'CLONED'\n  const operation = event.type\n    .split(':')[1]\n    .split('-')\n    .slice(1)\n    .join('_')\n  const halted = (serverMessage && serverMessage.subject === 'halted') || false\n  console.log(\n    `\\u2193 reflex \\u2193 ${target} \\u2192 ${selector ||\n      '\\u221E'}${progress} ${duration}`,\n    { reflexId, morph, operation, halted, payload }\n  )\n}\n\nfunction error (event) {\n  const { detail } = event || {}\n  const { reflexId, target, serverMessage } = detail.stimulusReflex || {}\n  const reflex = reflexes[reflexId]\n  const duration = reflex.timestamp\n    ? `in ${new Date() - reflex.timestamp}ms`\n    : 'CLONED'\n  const payload = detail.stimulusReflex\n  console.log(\n    `\\u2193 reflex \\u2193 ${target} ${duration} %cERROR: ${serverMessage.body}`,\n    'color: #f00;',\n    { reflexId, payload }\n  )\n}\n\nexport default { request, success, error }\n","import CableReady from 'cable_ready'\r\nimport Debug from './debug'\r\nimport { dispatchLifecycleEvent } from './lifecycle'\r\nimport actionCable from './transports/action_cable'\r\nimport Deprecate from './deprecate'\r\nimport {\r\n  debounce,\r\n  elementToXPath,\r\n  emitEvent,\r\n  serializeForm,\r\n  XPathToElement\r\n} from './utils'\r\nimport { allReflexControllers, findControllerByReflexName } from './controllers'\r\nimport {\r\n  attributeValue,\r\n  attributeValues,\r\n  extractElementAttributes,\r\n  extractElementDataset\r\n} from './attributes'\r\nimport isolationMode from './isolation_mode'\r\nimport Log from './log'\r\nimport { uuidv4 } from './utils'\r\n\r\nconst reflexes = {}\r\n\r\n// Uniquely identify this browser tab in each Reflex\r\nconst tabId = uuidv4()\r\n\r\nexport default reflexes\r\n\r\nexport const received = data => {\r\n  if (!data.cableReady) return\r\n\r\n  let reflexOperations = {}\r\n\r\n  for (let name in data.operations) {\r\n    if (data.operations.hasOwnProperty(name)) {\r\n      for (let i = data.operations[name].length - 1; i >= 0; i--) {\r\n        if (\r\n          data.operations[name][i].stimulusReflex ||\r\n          (data.operations[name][i].detail &&\r\n            data.operations[name][i].detail.stimulusReflex)\r\n        ) {\r\n          reflexOperations[name] = reflexOperations[name] || []\r\n          reflexOperations[name].push(data.operations[name][i])\r\n          data.operations[name].splice(i, 1)\r\n        }\r\n      }\r\n      if (!data.operations[name].length)\r\n        Reflect.deleteProperty(data.operations, name)\r\n    }\r\n  }\r\n\r\n  let totalOperations = 0\r\n  let reflexData\r\n\r\n  const dispatchEvent = reflexOperations['dispatchEvent']\r\n  const morph = reflexOperations['morph']\r\n  const innerHtml = reflexOperations['innerHtml']\r\n\r\n  ;[dispatchEvent, morph, innerHtml].forEach(operation => {\r\n    if (operation && operation.length) {\r\n      const urls = Array.from(\r\n        new Set(\r\n          operation.map(m =>\r\n            m.detail ? m.detail.stimulusReflex.url : m.stimulusReflex.url\r\n          )\r\n        )\r\n      )\r\n\r\n      if (urls.length !== 1 || urls[0] !== location.href) return\r\n      totalOperations += operation.length\r\n\r\n      if (!reflexData) {\r\n        if (operation[0].detail) {\r\n          reflexData = operation[0].detail.stimulusReflex\r\n          reflexData.payload = operation[0].detail.payload\r\n          reflexData.reflexId = operation[0].detail.reflexId\r\n        } else {\r\n          reflexData = operation[0].stimulusReflex\r\n          reflexData.payload = operation[0].payload\r\n        }\r\n      }\r\n    }\r\n  })\r\n\r\n  if (reflexData) {\r\n    const { reflexId, payload } = reflexData\r\n\r\n    if (!reflexes[reflexId] && isolationMode.disabled) {\r\n      const controllerElement = XPathToElement(reflexData.xpathController)\r\n      const reflexElement = XPathToElement(reflexData.xpathElement)\r\n      controllerElement.reflexController =\r\n        controllerElement.reflexController || {}\r\n      controllerElement.reflexData = controllerElement.reflexData || {}\r\n      controllerElement.reflexError = controllerElement.reflexError || {}\r\n\r\n      controllerElement.reflexController[\r\n        reflexId\r\n      ] = reflexes.app.getControllerForElementAndIdentifier(\r\n        controllerElement,\r\n        reflexData.reflexController\r\n      )\r\n\r\n      controllerElement.reflexData[reflexId] = reflexData\r\n      dispatchLifecycleEvent(\r\n        'before',\r\n        reflexElement,\r\n        controllerElement,\r\n        reflexId,\r\n        payload\r\n      )\r\n      registerReflex(reflexData)\r\n    }\r\n\r\n    if (reflexes[reflexId]) {\r\n      reflexes[reflexId].totalOperations = totalOperations\r\n      reflexes[reflexId].pendingOperations = totalOperations\r\n      reflexes[reflexId].completedOperations = 0\r\n      reflexes[reflexId].piggybackOperations = data.operations\r\n      CableReady.perform(reflexOperations)\r\n    }\r\n  } else {\r\n    const operations = Object.entries(data.operations)\r\n    if (operations.length && reflexes[operations[0][1][0].reflexId])\r\n      CableReady.perform(data.operations)\r\n  }\r\n}\r\n\r\nexport const registerReflex = data => {\r\n  const { reflexId } = data\r\n  reflexes[reflexId] = { finalStage: 'finalize' }\r\n\r\n  const promise = new Promise((resolve, reject) => {\r\n    reflexes[reflexId].promise = {\r\n      resolve,\r\n      reject,\r\n      data\r\n    }\r\n  })\r\n\r\n  promise.reflexId = reflexId\r\n\r\n  if (Debug.enabled) promise.catch(() => {})\r\n\r\n  return promise\r\n}\r\n\r\n// compute the DOM element(s) which will be the morph root\r\n// use the data-reflex-root attribute on the reflex or the controller\r\n// optional value is a CSS selector(s); comma-separated list\r\n// order of preference is data-reflex, data-controller, document body (default)\r\nexport const getReflexRoots = element => {\r\n  let list = []\r\n  while (list.length === 0 && element) {\r\n    let reflexRoot = element.getAttribute(\r\n      reflexes.app.schema.reflexRootAttribute\r\n    )\r\n    if (reflexRoot) {\r\n      if (reflexRoot.length === 0 && element.id) reflexRoot = `#${element.id}`\r\n      const selectors = reflexRoot.split(',').filter(s => s.trim().length)\r\n      if (Debug.enabled && selectors.length === 0) {\r\n        console.error(\r\n          `No value found for ${reflexes.app.schema.reflexRootAttribute}. Add an #id to the element or provide a value for ${application.schema.reflexRootAttribute}.`,\r\n          element\r\n        )\r\n      }\r\n      list = list.concat(selectors.filter(s => document.querySelector(s)))\r\n    }\r\n    element = element.parentElement\r\n      ? element.parentElement.closest(\r\n          `[${reflexes.app.schema.reflexRootAttribute}]`\r\n        )\r\n      : null\r\n  }\r\n  return list\r\n}\r\n\r\n// Sets up declarative reflex behavior.\r\n// Any elements that define data-reflex will automatically be wired up with the default StimulusReflexController.\r\n//\r\nexport const setupDeclarativeReflexes = debounce(() => {\r\n  document\r\n    .querySelectorAll(`[${reflexes.app.schema.reflexAttribute}]`)\r\n    .forEach(element => {\r\n      const controllers = attributeValues(\r\n        element.getAttribute(reflexes.app.schema.controllerAttribute)\r\n      )\r\n      const reflexAttributeNames = attributeValues(\r\n        element.getAttribute(reflexes.app.schema.reflexAttribute)\r\n      )\r\n      const actions = attributeValues(\r\n        element.getAttribute(reflexes.app.schema.actionAttribute)\r\n      )\r\n      reflexAttributeNames.forEach(reflexName => {\r\n        const controller = findControllerByReflexName(\r\n          reflexName,\r\n          allReflexControllers(reflexes.app, element)\r\n        )\r\n        let action\r\n        if (controller) {\r\n          action = `${reflexName.split('->')[0]}->${\r\n            controller.identifier\r\n          }#__perform`\r\n          if (!actions.includes(action)) actions.push(action)\r\n        } else {\r\n          action = `${reflexName.split('->')[0]}->stimulus-reflex#__perform`\r\n          if (!controllers.includes('stimulus-reflex')) {\r\n            controllers.push('stimulus-reflex')\r\n          }\r\n          if (!actions.includes(action)) actions.push(action)\r\n        }\r\n      })\r\n      const controllerValue = attributeValue(controllers)\r\n      const actionValue = attributeValue(actions)\r\n      if (\r\n        controllerValue &&\r\n        element.getAttribute(reflexes.app.schema.controllerAttribute) !=\r\n          controllerValue\r\n      ) {\r\n        element.setAttribute(\r\n          reflexes.app.schema.controllerAttribute,\r\n          controllerValue\r\n        )\r\n      }\r\n      if (\r\n        actionValue &&\r\n        element.getAttribute(reflexes.app.schema.actionAttribute) != actionValue\r\n      )\r\n        element.setAttribute(reflexes.app.schema.actionAttribute, actionValue)\r\n    })\r\n  emitEvent('stimulus-reflex:ready')\r\n}, 20)\r\n\r\nexport const reflexControllerMethods = {\r\n  // Indicates if the ActionCable web socket connection is open.\r\n  // The connection must be open before calling stimulate.\r\n  //\r\n  isActionCableConnectionOpen () {\r\n    return this.StimulusReflex.subscription.consumer.connection.isOpen()\r\n  },\r\n\r\n  // Invokes a server side reflex method.\r\n  //\r\n  // - target - the reflex target (full name of the server side reflex) i.e. 'ReflexClassName#method'\r\n  // - controllerElement - [optional] the element that triggered the reflex, defaults to this.element\r\n  // - options - [optional] an object that contains at least one of attrs, reflexId, selectors, resolveLate, serializeForm\r\n  // - *args - remaining arguments are forwarded to the server side reflex method\r\n  //\r\n  stimulate () {\r\n    const url = location.href\r\n    const args = Array.from(arguments)\r\n    const target = args.shift() || 'StimulusReflex::Reflex#default_reflex'\r\n    const controllerElement = this.element\r\n    const reflexElement =\r\n      args[0] && args[0].nodeType === Node.ELEMENT_NODE\r\n        ? args.shift()\r\n        : controllerElement\r\n    if (\r\n      reflexElement.type === 'number' &&\r\n      reflexElement.validity &&\r\n      reflexElement.validity.badInput\r\n    ) {\r\n      if (Debug.enabled) console.warn('Reflex aborted: invalid numeric input')\r\n      return\r\n    }\r\n    const options = {}\r\n    if (\r\n      args[0] &&\r\n      typeof args[0] === 'object' &&\r\n      Object.keys(args[0]).filter(key =>\r\n        [\r\n          'attrs',\r\n          'selectors',\r\n          'reflexId',\r\n          'resolveLate',\r\n          'serializeForm'\r\n        ].includes(key)\r\n      ).length\r\n    ) {\r\n      const opts = args.shift()\r\n      Object.keys(opts).forEach(o => (options[o] = opts[o]))\r\n    }\r\n    const attrs = options['attrs'] || extractElementAttributes(reflexElement)\r\n    const reflexId = options['reflexId'] || uuidv4()\r\n    let selectors = options['selectors'] || getReflexRoots(reflexElement)\r\n    if (typeof selectors === 'string') selectors = [selectors]\r\n    const resolveLate = options['resolveLate'] || false\r\n    const dataset = extractElementDataset(reflexElement)\r\n    const xpathController = elementToXPath(controllerElement)\r\n    const xpathElement = elementToXPath(reflexElement)\r\n    const data = {\r\n      target,\r\n      args,\r\n      url,\r\n      tabId,\r\n      attrs,\r\n      dataset,\r\n      selectors,\r\n      reflexId,\r\n      resolveLate,\r\n      xpathController,\r\n      xpathElement,\r\n      reflexController: this.identifier,\r\n      permanentAttributeName: reflexes.app.schema.reflexPermanentAttribute\r\n    }\r\n    const { subscription } = this.StimulusReflex\r\n\r\n    if (!this.isActionCableConnectionOpen())\r\n      throw 'The ActionCable connection is not open! `this.isActionCableConnectionOpen()` must return true before calling `this.stimulate()`'\r\n\r\n    if (!actionCable.subscriptionActive)\r\n      throw 'The ActionCable channel subscription for StimulusReflex was rejected.'\r\n\r\n    // lifecycle setup\r\n    controllerElement.reflexController =\r\n      controllerElement.reflexController || {}\r\n    controllerElement.reflexData = controllerElement.reflexData || {}\r\n    controllerElement.reflexError = controllerElement.reflexError || {}\r\n\r\n    controllerElement.reflexController[reflexId] = this\r\n    controllerElement.reflexData[reflexId] = data\r\n\r\n    dispatchLifecycleEvent('before', reflexElement, controllerElement, reflexId)\r\n\r\n    setTimeout(() => {\r\n      const { params } = controllerElement.reflexData[reflexId] || {}\r\n      const serializeAttribute =\r\n        reflexElement.attributes[\r\n          reflexes.app.schema.reflexSerializeFormAttribute\r\n        ]\r\n      if (serializeAttribute) {\r\n        // not needed after v4 because this is only here for the deprecation warning\r\n        options['serializeForm'] = false\r\n        if (serializeAttribute.value === 'true') options['serializeForm'] = true\r\n      }\r\n\r\n      const form = reflexElement.closest('form')\r\n\r\n      if (Deprecate.enabled && options['serializeForm'] === undefined && form)\r\n        console.warn(\r\n          `Deprecation warning: the next version of StimulusReflex will not serialize forms by default.\\nPlease set ${reflexes.app.schema.reflexSerializeFormAttribute}=\\\"true\\\" on your Reflex Controller Element or pass { serializeForm: true } as an option to stimulate.`\r\n        )\r\n      const formData =\r\n        options['serializeForm'] === false\r\n          ? ''\r\n          : serializeForm(form, {\r\n              element: reflexElement\r\n            })\r\n\r\n      controllerElement.reflexData[reflexId] = {\r\n        ...data,\r\n        params,\r\n        formData\r\n      }\r\n\r\n      subscription.send(controllerElement.reflexData[reflexId])\r\n    })\r\n\r\n    const promise = registerReflex(data)\r\n\r\n    if (Debug.enabled) {\r\n      Log.request(\r\n        reflexId,\r\n        target,\r\n        args,\r\n        this.context.scope.identifier,\r\n        reflexElement,\r\n        controllerElement\r\n      )\r\n    }\r\n\r\n    return promise\r\n  },\r\n\r\n  // Wraps the call to stimulate for any data-reflex elements.\r\n  // This is internal and should not be invoked directly.\r\n  __perform (event) {\r\n    let element = event.target\r\n    let reflex\r\n\r\n    while (element && !reflex) {\r\n      reflex = element.getAttribute(reflexes.app.schema.reflexAttribute)\r\n      if (!reflex || !reflex.trim().length) element = element.parentElement\r\n    }\r\n\r\n    const match = attributeValues(reflex).find(\r\n      reflex => reflex.split('->')[0] === event.type\r\n    )\r\n\r\n    if (match) {\r\n      event.preventDefault()\r\n      event.stopPropagation()\r\n      this.stimulate(match.split('->')[1], element)\r\n    }\r\n  }\r\n}\r\n","import CableReady from 'cable_ready'\r\nimport reflexes from './reflexes'\r\nimport { XPathToElement } from './utils'\r\nimport { dispatchLifecycleEvent } from './lifecycle'\r\nimport Log from './log'\r\nimport Debug from './debug'\r\n\r\nexport const beforeDOMUpdate = event => {\r\n  const { stimulusReflex } = event.detail || {}\r\n  if (!stimulusReflex) return\r\n  const { reflexId, xpathElement, xpathController } = stimulusReflex\r\n  const controllerElement = XPathToElement(xpathController)\r\n  const reflexElement = XPathToElement(xpathElement)\r\n  const reflex = reflexes[reflexId]\r\n  const promise = reflex.promise\r\n  const payload = event.detail.payload\r\n\r\n  reflex.pendingOperations--\r\n\r\n  if (reflex.pendingOperations > 0) return\r\n\r\n  if (!stimulusReflex.resolveLate)\r\n    setTimeout(() =>\r\n      promise.resolve({\r\n        element: reflexElement,\r\n        event,\r\n        data: promise.data,\r\n        payload\r\n      })\r\n    )\r\n\r\n  setTimeout(() =>\r\n    dispatchLifecycleEvent(\r\n      'success',\r\n      reflexElement,\r\n      controllerElement,\r\n      reflexId,\r\n      payload\r\n    )\r\n  )\r\n}\r\n\r\nexport const afterDOMUpdate = event => {\r\n  const { stimulusReflex } = event.detail || {}\r\n  if (!stimulusReflex) return\r\n  const { reflexId, xpathElement, xpathController } = stimulusReflex\r\n  const controllerElement = XPathToElement(xpathController)\r\n  const reflexElement = XPathToElement(xpathElement)\r\n  const reflex = reflexes[reflexId]\r\n  const promise = reflex.promise\r\n  const payload = event.detail.payload\r\n\r\n  reflex.completedOperations++\r\n\r\n  if (Debug.enabled) Log.success(event)\r\n\r\n  if (reflex.completedOperations < reflex.totalOperations) return\r\n\r\n  if (stimulusReflex.resolveLate)\r\n    setTimeout(() =>\r\n      promise.resolve({\r\n        element: reflexElement,\r\n        event,\r\n        data: promise.data,\r\n        payload\r\n      })\r\n    )\r\n\r\n  setTimeout(() =>\r\n    dispatchLifecycleEvent(\r\n      'finalize',\r\n      reflexElement,\r\n      controllerElement,\r\n      reflexId,\r\n      payload\r\n    )\r\n  )\r\n\r\n  CableReady.perform(reflex.piggybackOperations)\r\n}\r\n\r\nexport const serverMessage = event => {\r\n  const { reflexId, serverMessage, xpathController, xpathElement } =\r\n    event.detail.stimulusReflex || {}\r\n  const { subject, body } = serverMessage\r\n  const controllerElement = XPathToElement(xpathController)\r\n  const reflexElement = XPathToElement(xpathElement)\r\n  const reflex = reflexes[reflexId]\r\n  const promise = reflex.promise\r\n  const subjects = { error: true, halted: true, nothing: true, success: true }\r\n  const payload = event.detail.payload\r\n\r\n  if (controllerElement) {\r\n    controllerElement.reflexError = controllerElement.reflexError || {}\r\n    if (subject === 'error') controllerElement.reflexError[reflexId] = body\r\n  }\r\n\r\n  promise[subject === 'error' ? 'reject' : 'resolve']({\r\n    data: promise.data,\r\n    element: reflexElement,\r\n    event,\r\n    toString: () => body,\r\n    payload\r\n  })\r\n\r\n  reflex.finalStage = subject === 'halted' ? 'halted' : 'after'\r\n\r\n  if (Debug.enabled) Log[subject === 'error' ? 'error' : 'success'](event)\r\n\r\n  if (subjects[subject])\r\n    dispatchLifecycleEvent(\r\n      subject,\r\n      reflexElement,\r\n      controllerElement,\r\n      reflexId,\r\n      payload\r\n    )\r\n\r\n  CableReady.perform(reflex.piggybackOperations)\r\n}\r\n","import { Controller } from 'stimulus'\nimport { defaultSchema } from './schema'\nimport { beforeDOMUpdate, afterDOMUpdate, serverMessage } from './callbacks'\nimport { setupDeclarativeReflexes, reflexControllerMethods } from './reflexes'\nimport Debug from './debug'\nimport Deprecate from './deprecate'\nimport reflexes from './reflexes'\nimport isolationMode from './isolation_mode'\nimport actionCable from './transports/action_cable'\n\n// Default StimulusReflexController that is implicitly wired up as data-controller for any DOM elements\n// that have configured data-reflex. Note that this default can be overridden when initializing the application.\n// i.e. StimulusReflex.initialize(myStimulusApplication, MyCustomDefaultController);\n//\nclass StimulusReflexController extends Controller {\n  constructor (...args) {\n    super(...args)\n    register(this)\n  }\n}\n\n// Initializes StimulusReflex by registering the default Stimulus controller with the passed Stimulus application.\n//\n// - application  - the Stimulus application\n// - options\n//   * controller - [optional] the default StimulusReflexController\n//   * consumer   - [optional] the ActionCable consumer\n//   * debug      - [false] log all Reflexes to the console\n//   * params     - [{}] key/value parameters to send during channel subscription\n//   * isolate    - [false] restrict Reflex playback to the tab which initiated it\n//   * deprecate  - [true] show warnings regarding upcoming changes to the library\n//\nconst initialize = (application, {\n    controller = StimulusReflexController,\n    consumer,\n    debug,\n    params,\n    isolate,\n    deprecate\n  } = {}) => {\n  actionCable.set(consumer, params)\n  setTimeout(() => {\n    if (Deprecate.enabled && consumer)\n      console.warn(\n        \"Deprecation warning: the next version of StimulusReflex will obtain a reference to consumer via the Stimulus application object.\\nPlease add 'application.consumer = consumer' to your index.js after your Stimulus application has been established, and remove the consumer key from your StimulusReflex initialize() options object.\"\n      )\n  })\n  isolationMode.set(!!isolate)\n  setTimeout(() => {\n    if (Deprecate.enabled && isolationMode.disabled)\n      console.warn(\n        'Deprecation warning: the next version of StimulusReflex will standardize isolation mode, and the isolate option will be removed.\\nPlease update your applications to assume that every tab will be isolated.'\n      )\n  })\n  reflexes.app = application\n  reflexes.app.schema = { ...defaultSchema, ...application.schema }\n  reflexes.app.register(\n    'stimulus-reflex',\n    controller || StimulusReflexController\n  )\n  Debug.set(!!debug)\n  if (typeof deprecate !== 'undefined') Deprecate.set(deprecate)\n  const observer = new MutationObserver(setupDeclarativeReflexes)\n  observer.observe(document.documentElement, {\n    attributeFilter: [\n      reflexes.app.schema.reflexAttribute,\n      reflexes.app.schema.actionAttribute\n    ],\n    childList: true,\n    subtree: true\n  })\n}\n\n// Registers a Stimulus controller and extends it with StimulusReflex behavior\n//\n// controller - the Stimulus controller\n// options - [optional] configuration\n//\nconst register = (controller, options = {}) => {\n  const channel = 'StimulusReflex::Channel'\n  controller.StimulusReflex = { ...options, channel }\n  actionCable.createSubscription(controller)\n  Object.assign(controller, reflexControllerMethods)\n}\n\nconst useReflex = (controller, options = {}) => {\n  register(controller, options)\n}\n\ndocument.addEventListener('stimulus-reflex:server-message', serverMessage)\ndocument.addEventListener('cable-ready:before-inner-html', beforeDOMUpdate)\ndocument.addEventListener('cable-ready:before-morph', beforeDOMUpdate)\ndocument.addEventListener('cable-ready:after-inner-html', afterDOMUpdate)\ndocument.addEventListener('cable-ready:after-morph', afterDOMUpdate)\nwindow.addEventListener('load', setupDeclarativeReflexes)\n\nexport default {\n  initialize,\n  register,\n  useReflex,\n  get debug () {\n    return Debug.value\n  },\n  set debug (value) {\n    Debug.set(!!value)\n  },\n  get deprecate () {\n    return Deprecate.value\n  },\n  set deprecate (value) {\n    Deprecate.set(!!value)\n  }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nfunction __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nfunction __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nfunction __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\n\nvar Event = /** @class */ (function () {\r\n    function Event(type, target) {\r\n        this.target = target;\r\n        this.type = type;\r\n    }\r\n    return Event;\r\n}());\r\nvar ErrorEvent = /** @class */ (function (_super) {\r\n    __extends(ErrorEvent, _super);\r\n    function ErrorEvent(error, target) {\r\n        var _this = _super.call(this, 'error', target) || this;\r\n        _this.message = error.message;\r\n        _this.error = error;\r\n        return _this;\r\n    }\r\n    return ErrorEvent;\r\n}(Event));\r\nvar CloseEvent = /** @class */ (function (_super) {\r\n    __extends(CloseEvent, _super);\r\n    function CloseEvent(code, reason, target) {\r\n        if (code === void 0) { code = 1000; }\r\n        if (reason === void 0) { reason = ''; }\r\n        var _this = _super.call(this, 'close', target) || this;\r\n        _this.wasClean = true;\r\n        _this.code = code;\r\n        _this.reason = reason;\r\n        return _this;\r\n    }\r\n    return CloseEvent;\r\n}(Event));\n\n/*!\r\n * Reconnecting WebSocket\r\n * by Pedro Ladaria <pedro.ladaria@gmail.com>\r\n * https://github.com/pladaria/reconnecting-websocket\r\n * License MIT\r\n */\r\nvar getGlobalWebSocket = function () {\r\n    if (typeof WebSocket !== 'undefined') {\r\n        // @ts-ignore\r\n        return WebSocket;\r\n    }\r\n};\r\n/**\r\n * Returns true if given argument looks like a WebSocket class\r\n */\r\nvar isWebSocket = function (w) { return typeof w !== 'undefined' && !!w && w.CLOSING === 2; };\r\nvar DEFAULT = {\r\n    maxReconnectionDelay: 10000,\r\n    minReconnectionDelay: 1000 + Math.random() * 4000,\r\n    minUptime: 5000,\r\n    reconnectionDelayGrowFactor: 1.3,\r\n    connectionTimeout: 4000,\r\n    maxRetries: Infinity,\r\n    maxEnqueuedMessages: Infinity,\r\n    startClosed: false,\r\n    debug: false,\r\n};\r\nvar ReconnectingWebSocket = /** @class */ (function () {\r\n    function ReconnectingWebSocket(url, protocols, options) {\r\n        var _this = this;\r\n        if (options === void 0) { options = {}; }\r\n        this._listeners = {\r\n            error: [],\r\n            message: [],\r\n            open: [],\r\n            close: [],\r\n        };\r\n        this._retryCount = -1;\r\n        this._shouldReconnect = true;\r\n        this._connectLock = false;\r\n        this._binaryType = 'blob';\r\n        this._closeCalled = false;\r\n        this._messageQueue = [];\r\n        /**\r\n         * An event listener to be called when the WebSocket connection's readyState changes to CLOSED\r\n         */\r\n        this.onclose = null;\r\n        /**\r\n         * An event listener to be called when an error occurs\r\n         */\r\n        this.onerror = null;\r\n        /**\r\n         * An event listener to be called when a message is received from the server\r\n         */\r\n        this.onmessage = null;\r\n        /**\r\n         * An event listener to be called when the WebSocket connection's readyState changes to OPEN;\r\n         * this indicates that the connection is ready to send and receive data\r\n         */\r\n        this.onopen = null;\r\n        this._handleOpen = function (event) {\r\n            _this._debug('open event');\r\n            var _a = _this._options.minUptime, minUptime = _a === void 0 ? DEFAULT.minUptime : _a;\r\n            clearTimeout(_this._connectTimeout);\r\n            _this._uptimeTimeout = setTimeout(function () { return _this._acceptOpen(); }, minUptime);\r\n            _this._ws.binaryType = _this._binaryType;\r\n            // send enqueued messages (messages sent before websocket open event)\r\n            _this._messageQueue.forEach(function (message) { return _this._ws.send(message); });\r\n            _this._messageQueue = [];\r\n            if (_this.onopen) {\r\n                _this.onopen(event);\r\n            }\r\n            _this._listeners.open.forEach(function (listener) { return _this._callEventListener(event, listener); });\r\n        };\r\n        this._handleMessage = function (event) {\r\n            _this._debug('message event');\r\n            if (_this.onmessage) {\r\n                _this.onmessage(event);\r\n            }\r\n            _this._listeners.message.forEach(function (listener) { return _this._callEventListener(event, listener); });\r\n        };\r\n        this._handleError = function (event) {\r\n            _this._debug('error event', event.message);\r\n            _this._disconnect(undefined, event.message === 'TIMEOUT' ? 'timeout' : undefined);\r\n            if (_this.onerror) {\r\n                _this.onerror(event);\r\n            }\r\n            _this._debug('exec error listeners');\r\n            _this._listeners.error.forEach(function (listener) { return _this._callEventListener(event, listener); });\r\n            _this._connect();\r\n        };\r\n        this._handleClose = function (event) {\r\n            _this._debug('close event');\r\n            _this._clearTimeouts();\r\n            if (_this._shouldReconnect) {\r\n                _this._connect();\r\n            }\r\n            if (_this.onclose) {\r\n                _this.onclose(event);\r\n            }\r\n            _this._listeners.close.forEach(function (listener) { return _this._callEventListener(event, listener); });\r\n        };\r\n        this._url = url;\r\n        this._protocols = protocols;\r\n        this._options = options;\r\n        if (this._options.startClosed) {\r\n            this._shouldReconnect = false;\r\n        }\r\n        this._connect();\r\n    }\r\n    Object.defineProperty(ReconnectingWebSocket, \"CONNECTING\", {\r\n        get: function () {\r\n            return 0;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket, \"OPEN\", {\r\n        get: function () {\r\n            return 1;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket, \"CLOSING\", {\r\n        get: function () {\r\n            return 2;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket, \"CLOSED\", {\r\n        get: function () {\r\n            return 3;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"CONNECTING\", {\r\n        get: function () {\r\n            return ReconnectingWebSocket.CONNECTING;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"OPEN\", {\r\n        get: function () {\r\n            return ReconnectingWebSocket.OPEN;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"CLOSING\", {\r\n        get: function () {\r\n            return ReconnectingWebSocket.CLOSING;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"CLOSED\", {\r\n        get: function () {\r\n            return ReconnectingWebSocket.CLOSED;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"binaryType\", {\r\n        get: function () {\r\n            return this._ws ? this._ws.binaryType : this._binaryType;\r\n        },\r\n        set: function (value) {\r\n            this._binaryType = value;\r\n            if (this._ws) {\r\n                this._ws.binaryType = value;\r\n            }\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"retryCount\", {\r\n        /**\r\n         * Returns the number or connection retries\r\n         */\r\n        get: function () {\r\n            return Math.max(this._retryCount, 0);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"bufferedAmount\", {\r\n        /**\r\n         * The number of bytes of data that have been queued using calls to send() but not yet\r\n         * transmitted to the network. This value resets to zero once all queued data has been sent.\r\n         * This value does not reset to zero when the connection is closed; if you keep calling send(),\r\n         * this will continue to climb. Read only\r\n         */\r\n        get: function () {\r\n            var bytes = this._messageQueue.reduce(function (acc, message) {\r\n                if (typeof message === 'string') {\r\n                    acc += message.length; // not byte size\r\n                }\r\n                else if (message instanceof Blob) {\r\n                    acc += message.size;\r\n                }\r\n                else {\r\n                    acc += message.byteLength;\r\n                }\r\n                return acc;\r\n            }, 0);\r\n            return bytes + (this._ws ? this._ws.bufferedAmount : 0);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"extensions\", {\r\n        /**\r\n         * The extensions selected by the server. This is currently only the empty string or a list of\r\n         * extensions as negotiated by the connection\r\n         */\r\n        get: function () {\r\n            return this._ws ? this._ws.extensions : '';\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"protocol\", {\r\n        /**\r\n         * A string indicating the name of the sub-protocol the server selected;\r\n         * this will be one of the strings specified in the protocols parameter when creating the\r\n         * WebSocket object\r\n         */\r\n        get: function () {\r\n            return this._ws ? this._ws.protocol : '';\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"readyState\", {\r\n        /**\r\n         * The current state of the connection; this is one of the Ready state constants\r\n         */\r\n        get: function () {\r\n            if (this._ws) {\r\n                return this._ws.readyState;\r\n            }\r\n            return this._options.startClosed\r\n                ? ReconnectingWebSocket.CLOSED\r\n                : ReconnectingWebSocket.CONNECTING;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ReconnectingWebSocket.prototype, \"url\", {\r\n        /**\r\n         * The URL as resolved by the constructor\r\n         */\r\n        get: function () {\r\n            return this._ws ? this._ws.url : '';\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Closes the WebSocket connection or connection attempt, if any. If the connection is already\r\n     * CLOSED, this method does nothing\r\n     */\r\n    ReconnectingWebSocket.prototype.close = function (code, reason) {\r\n        if (code === void 0) { code = 1000; }\r\n        this._closeCalled = true;\r\n        this._shouldReconnect = false;\r\n        this._clearTimeouts();\r\n        if (!this._ws) {\r\n            this._debug('close enqueued: no ws instance');\r\n            return;\r\n        }\r\n        if (this._ws.readyState === this.CLOSED) {\r\n            this._debug('close: already closed');\r\n            return;\r\n        }\r\n        this._ws.close(code, reason);\r\n    };\r\n    /**\r\n     * Closes the WebSocket connection or connection attempt and connects again.\r\n     * Resets retry counter;\r\n     */\r\n    ReconnectingWebSocket.prototype.reconnect = function (code, reason) {\r\n        this._shouldReconnect = true;\r\n        this._closeCalled = false;\r\n        this._retryCount = -1;\r\n        if (!this._ws || this._ws.readyState === this.CLOSED) {\r\n            this._connect();\r\n        }\r\n        else {\r\n            this._disconnect(code, reason);\r\n            this._connect();\r\n        }\r\n    };\r\n    /**\r\n     * Enqueue specified data to be transmitted to the server over the WebSocket connection\r\n     */\r\n    ReconnectingWebSocket.prototype.send = function (data) {\r\n        if (this._ws && this._ws.readyState === this.OPEN) {\r\n            this._debug('send', data);\r\n            this._ws.send(data);\r\n        }\r\n        else {\r\n            var _a = this._options.maxEnqueuedMessages, maxEnqueuedMessages = _a === void 0 ? DEFAULT.maxEnqueuedMessages : _a;\r\n            if (this._messageQueue.length < maxEnqueuedMessages) {\r\n                this._debug('enqueue', data);\r\n                this._messageQueue.push(data);\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Register an event handler of a specific event type\r\n     */\r\n    ReconnectingWebSocket.prototype.addEventListener = function (type, listener) {\r\n        if (this._listeners[type]) {\r\n            // @ts-ignore\r\n            this._listeners[type].push(listener);\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype.dispatchEvent = function (event) {\r\n        var e_1, _a;\r\n        var listeners = this._listeners[event.type];\r\n        if (listeners) {\r\n            try {\r\n                for (var listeners_1 = __values(listeners), listeners_1_1 = listeners_1.next(); !listeners_1_1.done; listeners_1_1 = listeners_1.next()) {\r\n                    var listener = listeners_1_1.value;\r\n                    this._callEventListener(event, listener);\r\n                }\r\n            }\r\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n            finally {\r\n                try {\r\n                    if (listeners_1_1 && !listeners_1_1.done && (_a = listeners_1.return)) _a.call(listeners_1);\r\n                }\r\n                finally { if (e_1) throw e_1.error; }\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n    /**\r\n     * Removes an event listener\r\n     */\r\n    ReconnectingWebSocket.prototype.removeEventListener = function (type, listener) {\r\n        if (this._listeners[type]) {\r\n            // @ts-ignore\r\n            this._listeners[type] = this._listeners[type].filter(function (l) { return l !== listener; });\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype._debug = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (this._options.debug) {\r\n            // not using spread because compiled version uses Symbols\r\n            // tslint:disable-next-line\r\n            console.log.apply(console, __spread(['RWS>'], args));\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype._getNextDelay = function () {\r\n        var _a = this._options, _b = _a.reconnectionDelayGrowFactor, reconnectionDelayGrowFactor = _b === void 0 ? DEFAULT.reconnectionDelayGrowFactor : _b, _c = _a.minReconnectionDelay, minReconnectionDelay = _c === void 0 ? DEFAULT.minReconnectionDelay : _c, _d = _a.maxReconnectionDelay, maxReconnectionDelay = _d === void 0 ? DEFAULT.maxReconnectionDelay : _d;\r\n        var delay = 0;\r\n        if (this._retryCount > 0) {\r\n            delay =\r\n                minReconnectionDelay * Math.pow(reconnectionDelayGrowFactor, this._retryCount - 1);\r\n            if (delay > maxReconnectionDelay) {\r\n                delay = maxReconnectionDelay;\r\n            }\r\n        }\r\n        this._debug('next delay', delay);\r\n        return delay;\r\n    };\r\n    ReconnectingWebSocket.prototype._wait = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            setTimeout(resolve, _this._getNextDelay());\r\n        });\r\n    };\r\n    ReconnectingWebSocket.prototype._getNextUrl = function (urlProvider) {\r\n        if (typeof urlProvider === 'string') {\r\n            return Promise.resolve(urlProvider);\r\n        }\r\n        if (typeof urlProvider === 'function') {\r\n            var url = urlProvider();\r\n            if (typeof url === 'string') {\r\n                return Promise.resolve(url);\r\n            }\r\n            if (!!url.then) {\r\n                return url;\r\n            }\r\n        }\r\n        throw Error('Invalid URL');\r\n    };\r\n    ReconnectingWebSocket.prototype._connect = function () {\r\n        var _this = this;\r\n        if (this._connectLock || !this._shouldReconnect) {\r\n            return;\r\n        }\r\n        this._connectLock = true;\r\n        var _a = this._options, _b = _a.maxRetries, maxRetries = _b === void 0 ? DEFAULT.maxRetries : _b, _c = _a.connectionTimeout, connectionTimeout = _c === void 0 ? DEFAULT.connectionTimeout : _c, _d = _a.WebSocket, WebSocket = _d === void 0 ? getGlobalWebSocket() : _d;\r\n        if (this._retryCount >= maxRetries) {\r\n            this._debug('max retries reached', this._retryCount, '>=', maxRetries);\r\n            return;\r\n        }\r\n        this._retryCount++;\r\n        this._debug('connect', this._retryCount);\r\n        this._removeListeners();\r\n        if (!isWebSocket(WebSocket)) {\r\n            throw Error('No valid WebSocket class provided');\r\n        }\r\n        this._wait()\r\n            .then(function () { return _this._getNextUrl(_this._url); })\r\n            .then(function (url) {\r\n            // close could be called before creating the ws\r\n            if (_this._closeCalled) {\r\n                return;\r\n            }\r\n            _this._debug('connect', { url: url, protocols: _this._protocols });\r\n            _this._ws = _this._protocols\r\n                ? new WebSocket(url, _this._protocols)\r\n                : new WebSocket(url);\r\n            _this._ws.binaryType = _this._binaryType;\r\n            _this._connectLock = false;\r\n            _this._addListeners();\r\n            _this._connectTimeout = setTimeout(function () { return _this._handleTimeout(); }, connectionTimeout);\r\n        });\r\n    };\r\n    ReconnectingWebSocket.prototype._handleTimeout = function () {\r\n        this._debug('timeout event');\r\n        this._handleError(new ErrorEvent(Error('TIMEOUT'), this));\r\n    };\r\n    ReconnectingWebSocket.prototype._disconnect = function (code, reason) {\r\n        if (code === void 0) { code = 1000; }\r\n        this._clearTimeouts();\r\n        if (!this._ws) {\r\n            return;\r\n        }\r\n        this._removeListeners();\r\n        try {\r\n            this._ws.close(code, reason);\r\n            this._handleClose(new CloseEvent(code, reason, this));\r\n        }\r\n        catch (error) {\r\n            // ignore\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype._acceptOpen = function () {\r\n        this._debug('accept open');\r\n        this._retryCount = 0;\r\n    };\r\n    ReconnectingWebSocket.prototype._callEventListener = function (event, listener) {\r\n        if ('handleEvent' in listener) {\r\n            // @ts-ignore\r\n            listener.handleEvent(event);\r\n        }\r\n        else {\r\n            // @ts-ignore\r\n            listener(event);\r\n        }\r\n    };\r\n    ReconnectingWebSocket.prototype._removeListeners = function () {\r\n        if (!this._ws) {\r\n            return;\r\n        }\r\n        this._debug('removeListeners');\r\n        this._ws.removeEventListener('open', this._handleOpen);\r\n        this._ws.removeEventListener('close', this._handleClose);\r\n        this._ws.removeEventListener('message', this._handleMessage);\r\n        // @ts-ignore\r\n        this._ws.removeEventListener('error', this._handleError);\r\n    };\r\n    ReconnectingWebSocket.prototype._addListeners = function () {\r\n        if (!this._ws) {\r\n            return;\r\n        }\r\n        this._debug('addListeners');\r\n        this._ws.addEventListener('open', this._handleOpen);\r\n        this._ws.addEventListener('close', this._handleClose);\r\n        this._ws.addEventListener('message', this._handleMessage);\r\n        // @ts-ignore\r\n        this._ws.addEventListener('error', this._handleError);\r\n    };\r\n    ReconnectingWebSocket.prototype._clearTimeouts = function () {\r\n        clearTimeout(this._connectTimeout);\r\n        clearTimeout(this._uptimeTimeout);\r\n    };\r\n    return ReconnectingWebSocket;\r\n}());\n\nexport default ReconnectingWebSocket;\n","import ReconnectingWebSocket from \"reconnecting-websocket\"\n\n\nfunction createWebSocketURL(url) {\n  if (typeof url === \"function\") {\n    url = url()\n  }\n\n  if (url && !/^wss?:/i.test(url)) {\n    const a = document.createElement(\"a\")\n    a.href = url\n    // Fix populating Location properties in IE. Otherwise, protocol will be blank.\n    a.href = a.href\n    a.protocol = a.protocol.replace(\"http\", \"ws\")\n    return a.href\n  } else {\n    return url\n  }\n}\n\nconst extend = function(object, properties) {\n  if (properties != null) {\n    for (let key in properties) {\n      const value = properties[key]\n      object[key] = value\n    }\n  }\n  return object\n}\n\nclass Subscription {\n  constructor(consumer, params = {}, mixin) {\n      this.consumer = consumer\n      this.identifier = JSON.stringify(params)\n      extend(this, mixin)\n  }\n\n  send(data) {\n      return this.consumer.send(data, this.identifier)\n    }\n\n  unsubscribe() {\n      return this.consumer.subscriptions.remove(this)\n  }\n}\n\nclass Subscriptions {\n  constructor(consumer) {\n      this.consumer = consumer\n      this.subscriptions = []\n  }\n\n  findAll(identifier) {\n      return this.subscriptions.filter((s) => s.identifier === identifier)\n  }\n\n  add(subscription) {\n      this.subscriptions.push(subscription)\n      this.consumer.connection.send(JSON.stringify({\n          type: 'subscribe',\n          channelName: subscription.identifier\n      }))\n      return subscription\n  }\n\n  create(channelName, mixin) {\n      const channel = channelName\n      const params = typeof channel === \"object\" ? channel : {channel}\n      const subscription = new Subscription(this.consumer, params, mixin)\n      return this.add(subscription)\n  }\n\n  forget(subscription) {\n    this.subscriptions = (this.subscriptions.filter((s) => s !== subscription))\n    return subscription\n  }\n\n  remove(subscription) {\n    this.forget(subscription)\n    if (this.findAll(subscription.identifier).length == 0) {\n      this.consumer.connection.send(JSON.stringify({\n          type: 'unsubscribe',\n          channelName: subscription.identifier\n      }))\n    }\n    return subscription\n  }\n\n  notify(subscription, callbackName, ...args) {\n    let subscriptions\n    if (typeof subscription === \"string\") {\n      subscriptions = this.findAll(subscription)\n    } else {\n      subscriptions = [subscription]\n    }\n\n    return subscriptions.map((subscription) =>\n      (typeof subscription[callbackName] === \"function\" ? subscription[callbackName](...args) : undefined))\n  }\n\n  notifyAll(callbackName, ...args) {\n    return this.subscriptions.map(\n      (subscription) => this.notify(subscription, callbackName, ...args)\n    )\n  }\n}\n\nexport class WebsocketConsumer {\n  constructor(url, options = {}) {\n      this._url = url\n      this.subscriptions = new Subscriptions(this)\n\n      options = {maxRetries: 3, ...options}\n      this.connection = new ReconnectingWebSocket(url, [], options)\n      this.connection.isOpen = function open() {\n          return this.readyState === ReconnectingWebSocket.OPEN;\n      }\n\n      // ensure socket is closed properly on full page unload\n      document.addEventListener('beforeunload', () => {\n        this.disconnect();\n      });\n\n      this.connection.addEventListener('open', (event) => {\n        var self = this\n        let notify = function() {\n          self.subscriptions.notifyAll('connected')\n        }\n        let identifiers = self.subscriptions.subscriptions.map(sub => sub.identifier).join()\n        if (!identifiers.includes('StimulusReflex::Channel')) {\n          // In chrome there was a race condition where connection is open\n          // and no subscriptions have yet to be created. So to fix this\n          // behaviour we wait for a bit. See PR for more details.\n          setTimeout(notify, 200);\n        } else {\n          notify()\n        }\n      })\n\n      this.connection.addEventListener(\"message\", (event) => {\n          let data = JSON.parse(event.data)\n          if (data.meta_type === 'cookie') {\n            document.cookie = `${data.key}=${data.value||\"\"}; max-age=${data.max_age}; path=/`;\n            return\n          }\n          this.subscriptions.notify(data.identifier, 'received', data)\n      })\n  }\n\n  get url() {\n      return createWebSocketURL(this._url)\n  }\n\n  send(data, identifier) {\n      data.identifier = identifier\n      return this.connection.send(JSON.stringify(data))\n  }\n\n  connect() {\n      return this.connection.open()\n  }\n\n  disconnect() {\n      return this.connection.close()\n  }\n}\n","import { Controller } from 'stimulus'\nimport StimulusReflex from \"stimulus_reflex\"\nimport { reflexControllerMethods, received } from \"stimulus_reflex/javascript/reflexes\"\nimport actionCable from 'stimulus_reflex/javascript/transports/action_cable'\nimport Debug from 'stimulus_reflex/javascript/debug'\nimport Deprecate from 'stimulus_reflex/javascript/deprecate'\nimport { WebsocketConsumer } from './websocket'\n\n\nlet globalConsumer\nlet params\n// read up on the default options that actioncable has for websockets.\n\nclass StimulusReflexController extends Controller {\n  constructor (...args) {\n    super(...args)\n    register(this)\n  }\n}\n\nconst createSubscription = controller => {\n  let consumer = globalConsumer || controller.application.consumer\n  const { channel } = controller.StimulusReflex\n  const subscription = { channel, ...params }\n  const identifier = JSON.stringify(subscription)\n\n  controller.StimulusReflex.subscription =\n    consumer.subscriptions.findAll(identifier)[0] ||\n    consumer.subscriptions.create(subscription, {\n      received: received,\n      connected: actionCable.connected,\n\n      // these are currently never called.\n      rejected: actionCable.rejected,\n      disconnected: actionCable.disconnected\n    })\n}\n\n\nconst register = (controller, options = {}) => {\n  const channel = 'StimulusReflex::Channel'\n  controller.StimulusReflex = { ...options, channel }\n\n  createSubscription(controller)\n  Object.assign(controller, reflexControllerMethods)\n}\n\nconst initialize = (application, {\n  controller = StimulusReflexController,\n  consumer,\n  debug,\n  params,\n  isolate,\n  deprecate\n} = {}) => {\n  let options = {consumer, controller, debug, params, isolate, deprecate}\n  globalConsumer = consumer\n  StimulusReflex.initialize(application, options)\n}\n\n\nconst Sockpuppet = {\n  initialize: initialize,\n  register: register,\n  get debug () {\n    return Debug.value\n  },\n  set debug (value) {\n    Debug.set(!!value)\n  },\n  get deprecate () {\n    return Deprecate.value\n  },\n  set deprecate (value) {\n    Deprecate.set(!!value)\n  }\n}\n\nexport {\n  Sockpuppet\n}\n\nexport default WebsocketConsumer\n","import { Application } from 'stimulus'\n// because travis had issues with 'sockpuppet-js' we had to do this.\nimport WebsocketConsumer from '../../javascript/stimulus-websocket/index'\nimport { Sockpuppet } from '../../javascript/stimulus-websocket/index'\n\nconst application = Application.start()\nconst consumer = new WebsocketConsumer(\n  `${location.protocol=='https:'?'wss':'ws'}://${window.location.host}/ws/sockpuppet-sync`, {debug: false}\n)\n\nSockpuppet.initialize(application, { consumer })\n"],"sourceRoot":""}